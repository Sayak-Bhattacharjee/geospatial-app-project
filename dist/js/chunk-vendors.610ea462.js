(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[504],{9467:function(e,t,r){r(4114),r(6573),r(8100),r(7936),function(t,r){e.exports=r()}(0,(function(){"use strict";var e=function(e,t){var r={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},i={on:function(e,t,i){if(void 0===r[e])throw new Error("Invalid event type: "+e);r[e].push({selector:t,fn:i})},render:function(e){t.store.featureChanged(e)}},n=function(e,n){for(var o=r[e],s=o.length;s--;){var a=o[s];if(a.selector(n)){a.fn.call(i,n)||t.store.render(),t.ui.updateMapClasses();break}}};return e.start.call(i),{render:e.render,stop:function(){e.stop&&e.stop()},trash:function(){e.trash&&(e.trash(),t.store.render())},combineFeatures:function(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures:function(){e.uncombineFeatures&&e.uncombineFeatures()},drag:function(e){n("drag",e)},click:function(e){n("click",e)},mousemove:function(e){n("mousemove",e)},mousedown:function(e){n("mousedown",e)},mouseup:function(e){n("mouseup",e)},mouseout:function(e){n("mouseout",e)},keydown:function(e){n("keydown",e)},keyup:function(e){n("keyup",e)},touchstart:function(e){n("touchstart",e)},touchmove:function(e){n("touchmove",e)},touchend:function(e){n("touchend",e)},tap:function(e){n("tap",e)}}};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function i(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var r=function e(){if(this instanceof e){var r=[null];r.push.apply(r,arguments);var i=Function.bind.apply(t,r);return new i}return t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var i=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,i.get?i:{enumerable:!0,get:function(){return e[t]}})})),r}var n={},o={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142},s=o;function a(e){var t=0;if(e&&e.length>0){t+=Math.abs(l(e[0]));for(var r=1;r<e.length;r++)t-=Math.abs(l(e[r]))}return t}function l(e){var t,r,i,n,o,a,l=0,u=e.length;if(u>2){for(a=0;a<u;a++)a===u-2?(i=u-2,n=u-1,o=0):a===u-1?(i=u-1,n=0,o=1):(i=a,n=a+1,o=a+2),t=e[i],r=e[n],l+=(c(e[o][0])-c(t[0]))*Math.sin(c(r[1]));l=l*s.RADIUS*s.RADIUS/2}return l}function c(e){return e*Math.PI/180}n.geometry=function e(t){var r,i=0;switch(t.type){case"Polygon":return a(t.coordinates);case"MultiPolygon":for(r=0;r<t.coordinates.length;r++)i+=a(t.coordinates[r]);return i;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(r=0;r<t.geometries.length;r++)i+=e(t.geometries[r]);return i}},n.ring=l;var u={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},h={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},d={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},p={POLYGON:"polygon",LINE:"line_string",POINT:"point"},f={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},m={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},_={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},g={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},y={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},x={ACTIVE:"true",INACTIVE:"false"},v=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],b=-85,w=Object.freeze({__proto__:null,classes:u,sources:h,cursors:d,types:p,geojsonTypes:f,modes:m,events:_,updateActions:g,meta:y,activeStates:x,interactions:v,LAT_MIN:-90,LAT_RENDERED_MIN:b,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),T={Point:0,LineString:1,MultiLineString:1,Polygon:2};function E(e,t){var r=T[e.geometry.type]-T[t.geometry.type];return 0===r&&e.geometry.type===f.POLYGON?e.area-t.area:r}function S(e){return e.map((function(e){return e.geometry.type===f.POLYGON&&(e.area=n.geometry({type:f.FEATURE,property:{},geometry:e.geometry})),e})).sort(E).map((function(e){return delete e.area,e}))}function M(e,t){return void 0===t&&(t=0),[[e.point.x-t,e.point.y-t],[e.point.x+t,e.point.y+t]]}function A(e){if(this._items={},this._nums={},this._length=e?e.length:0,e)for(var t=0,r=e.length;t<r;t++)this.add(e[t]),void 0!==e[t]&&("string"==typeof e[t]?this._items[e[t]]=t:this._nums[e[t]]=t)}A.prototype.add=function(e){return this.has(e)||(this._length++,"string"==typeof e?this._items[e]=this._length:this._nums[e]=this._length),this},A.prototype.delete=function(e){return!1===this.has(e)||(this._length--,delete this._items[e],delete this._nums[e]),this},A.prototype.has=function(e){return("string"==typeof e||"number"==typeof e)&&(void 0!==this._items[e]||void 0!==this._nums[e])},A.prototype.values=function(){var e=this,t=[];return Object.keys(this._items).forEach((function(r){t.push({k:r,v:e._items[r]})})),Object.keys(this._nums).forEach((function(r){t.push({k:JSON.parse(r),v:e._nums[r]})})),t.sort((function(e,t){return e.v-t.v})).map((function(e){return e.k}))},A.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var I=[y.FEATURE,y.MIDPOINT,y.VERTEX],C={click:function(e,t,r){return P(e,t,r,r.options.clickBuffer)},touch:function(e,t,r){return P(e,t,r,r.options.touchBuffer)}};function P(e,t,r,i){if(null===r.map)return[];var n=e?M(e,i):t,o={};r.options.styles&&(o.layers=r.options.styles.map((function(e){return e.id})).filter((function(e){return null!=r.map.getLayer(e)})));var s=r.map.queryRenderedFeatures(n,o).filter((function(e){return-1!==I.indexOf(e.properties.meta)})),a=new A,l=[];return s.forEach((function(e){var t=e.properties.id;a.has(t)||(a.add(t),l.push(e))})),S(l)}function L(e,t){var r=C.click(e,null,t),i={mouse:d.NONE};return r[0]&&(i.mouse=r[0].properties.active===x.ACTIVE?d.MOVE:d.POINTER,i.feature=r[0].properties.meta),-1!==t.events.currentModeName().indexOf("draw")&&(i.mouse=d.ADD),t.ui.queueMapClasses(i),t.ui.updateMapClasses(),r[0]}function R(e,t){var r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)}function D(e,t,r){void 0===r&&(r={});var i=null!=r.fineTolerance?r.fineTolerance:4,n=null!=r.grossTolerance?r.grossTolerance:12,o=null!=r.interval?r.interval:500;e.point=e.point||t.point,e.time=e.time||t.time;var s=R(e.point,t.point);return s<i||s<n&&t.time-e.time<o}function O(e,t,r){void 0===r&&(r={});var i=null!=r.tolerance?r.tolerance:25,n=null!=r.interval?r.interval:250;return e.point=e.point||t.point,e.time=e.time||t.time,R(e.point,t.point)<i&&t.time-e.time<n}var z={exports:{}},k=z.exports=function(e,t){if(t||(t=16),void 0===e&&(e=128),e<=0)return"0";for(var r=Math.log(Math.pow(2,e))/Math.log(t),i=2;r===1/0;i*=2)r=Math.log(Math.pow(2,e/i))/Math.log(t)*i;var n=r-Math.floor(r),o="";for(i=0;i<Math.floor(r);i++)o=Math.floor(Math.random()*t).toString(t)+o;if(n){var s=Math.pow(t,n);o=Math.floor(Math.random()*s).toString(t)+o}var a=parseInt(o,t);return a!==1/0&&a>=Math.pow(2,e)?k(e,t):o};k.rack=function(e,t,r){var i=function(i){var o=0;do{if(o++>10){if(!r)throw new Error("too many ID collisions, use more bits");e+=r}var s=k(e,t)}while(Object.hasOwnProperty.call(n,s));return n[s]=i,s},n=i.hats={};return i.get=function(e){return i.hats[e]},i.set=function(e,t){return i.hats[e]=t,i},i.bits=e||128,i.base=t||16,i};var F=t(z.exports),B=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||F(),this.type=t.geometry.type};B.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},B.prototype.incomingCoords=function(e){this.setCoordinates(e)},B.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},B.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},B.prototype.setProperty=function(e,t){this.properties[e]=t},B.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:f.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},B.prototype.internal=function(e){var t={id:this.id,meta:y.FEATURE,"meta:type":this.type,active:x.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(var r in this.properties)t["user_"+r]=this.properties[r];return{type:f.FEATURE,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var N=function(e,t){B.call(this,e,t)};(N.prototype=Object.create(B.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]},N.prototype.updateCoordinate=function(e,t,r){this.coordinates=3===arguments.length?[t,r]:[e,t],this.changed()},N.prototype.getCoordinate=function(){return this.getCoordinates()};var U=function(e,t){B.call(this,e,t)};(U.prototype=Object.create(B.prototype)).isValid=function(){return this.coordinates.length>1},U.prototype.addCoordinate=function(e,t,r){this.changed();var i=parseInt(e,10);this.coordinates.splice(i,0,[t,r])},U.prototype.getCoordinate=function(e){var t=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[t]))},U.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)},U.prototype.updateCoordinate=function(e,t,r){var i=parseInt(e,10);this.coordinates[i]=[t,r],this.changed()};var V=function(e,t){B.call(this,e,t),this.coordinates=this.coordinates.map((function(e){return e.slice(0,-1)}))};(V.prototype=Object.create(B.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every((function(e){return e.length>2}))},V.prototype.incomingCoords=function(e){this.coordinates=e.map((function(e){return e.slice(0,-1)})),this.changed()},V.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},V.prototype.addCoordinate=function(e,t,r){this.changed();var i=e.split(".").map((function(e){return parseInt(e,10)}));this.coordinates[i[0]].splice(i[1],0,[t,r])},V.prototype.removeCoordinate=function(e){this.changed();var t=e.split(".").map((function(e){return parseInt(e,10)})),r=this.coordinates[t[0]];r&&(r.splice(t[1],1),r.length<3&&this.coordinates.splice(t[0],1))},V.prototype.getCoordinate=function(e){var t=e.split(".").map((function(e){return parseInt(e,10)})),r=this.coordinates[t[0]];return JSON.parse(JSON.stringify(r[t[1]]))},V.prototype.getCoordinates=function(){return this.coordinates.map((function(e){return e.concat([e[0]])}))},V.prototype.updateCoordinate=function(e,t,r){this.changed();var i=e.split("."),n=parseInt(i[0],10),o=parseInt(i[1],10);void 0===this.coordinates[n]&&(this.coordinates[n]=[]),this.coordinates[n][o]=[t,r]};var j={MultiPoint:N,MultiLineString:U,MultiPolygon:V},G=function(e,t,r,i,n){var o=r.split("."),s=parseInt(o[0],10),a=o[1]?o.slice(1).join("."):null;return e[s][t](a,i,n)},$=function(e,t){if(B.call(this,e,t),delete this.coordinates,this.model=j[t.geometry.type],void 0===this.model)throw new TypeError(t.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(t.geometry.coordinates)};function q(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}($.prototype=Object.create(B.prototype))._coordinatesToFeatures=function(e){var t=this,r=this.model.bind(this);return e.map((function(e){return new r(t.ctx,{id:F(),type:f.FEATURE,properties:{},geometry:{coordinates:e,type:t.type.replace("Multi","")}})}))},$.prototype.isValid=function(){return this.features.every((function(e){return e.isValid()}))},$.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()},$.prototype.getCoordinate=function(e){return G(this.features,"getCoordinate",e)},$.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map((function(e){return e.type===f.POLYGON?e.getCoordinates():e.coordinates}))))},$.prototype.updateCoordinate=function(e,t,r){G(this.features,"updateCoordinate",e,t,r),this.changed()},$.prototype.addCoordinate=function(e,t,r){G(this.features,"addCoordinate",e,t,r),this.changed()},$.prototype.removeCoordinate=function(e){G(this.features,"removeCoordinate",e),this.changed()},$.prototype.getFeatures=function(){return this.features},q.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)},q.prototype.setSelectedCoordinates=function(e){var t=this;this._ctx.store.setSelectedCoordinates(e),e.reduce((function(e,r){return void 0===e[r.feature_id]&&(e[r.feature_id]=!0,t._ctx.store.get(r.feature_id).changed()),e}),{})},q.prototype.getSelected=function(){return this._ctx.store.getSelected()},q.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},q.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)},q.prototype.getFeature=function(e){return this._ctx.store.get(e)},q.prototype.select=function(e){return this._ctx.store.select(e)},q.prototype.deselect=function(e){return this._ctx.store.deselect(e)},q.prototype.deleteFeature=function(e,t){return void 0===t&&(t={}),this._ctx.store.delete(e,t)},q.prototype.addFeature=function(e){return this._ctx.store.add(e)},q.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},q.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},q.prototype.setActionableState=function(e){void 0===e&&(e={});var t={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(t)},q.prototype.changeMode=function(e,t,r){return void 0===t&&(t={}),void 0===r&&(r={}),this._ctx.events.changeMode(e,t,r)},q.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)},q.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)},q.prototype.featuresAt=function(e,t,r){if(void 0===r&&(r="click"),"click"!==r&&"touch"!==r)throw new Error("invalid buffer type");return C[r](e,t,this._ctx)},q.prototype.newFeature=function(e){var t=e.geometry.type;return t===f.POINT?new N(this._ctx,e):t===f.LINE_STRING?new U(this._ctx,e):t===f.POLYGON?new V(this._ctx,e):new $(this._ctx,e)},q.prototype.isInstanceOf=function(e,t){if(e===f.POINT)return t instanceof N;if(e===f.LINE_STRING)return t instanceof U;if(e===f.POLYGON)return t instanceof V;if("MultiFeature"===e)return t instanceof $;throw new Error("Unknown feature class: "+e)},q.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)},q.prototype.onSetup=function(){},q.prototype.onDrag=function(){},q.prototype.onClick=function(){},q.prototype.onMouseMove=function(){},q.prototype.onMouseDown=function(){},q.prototype.onMouseUp=function(){},q.prototype.onMouseOut=function(){},q.prototype.onKeyUp=function(){},q.prototype.onKeyDown=function(){},q.prototype.onTouchStart=function(){},q.prototype.onTouchMove=function(){},q.prototype.onTouchEnd=function(){},q.prototype.onTap=function(){},q.prototype.onStop=function(){},q.prototype.onTrash=function(){},q.prototype.onCombineFeature=function(){},q.prototype.onUncombineFeature=function(){},q.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Z={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},W=Object.keys(Z);function H(e){var t=Object.keys(e);return function(r,i){void 0===i&&(i={});var n={},o=t.reduce((function(t,r){return t[r]=e[r],t}),new q(r));return{start:function(){var t=this;n=o.onSetup(i),W.forEach((function(r){var i,s=Z[r],a=function(){return!1};e[s]&&(a=function(){return!0}),t.on(r,a,(i=s,function(e){return o[i](n,e)}))}))},stop:function(){o.onStop(n)},trash:function(){o.onTrash(n)},combineFeatures:function(){o.onCombineFeatures(n)},uncombineFeatures:function(){o.onUncombineFeatures(n)},render:function(e,t){o.toDisplayFeatures(n,e,t)}}}}function X(e){return[].concat(e).filter((function(e){return void 0!==e}))}function Y(){var e=this;if(!e.ctx.map||void 0===e.ctx.map.getSource(h.HOT))return l();var t=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:t});var r=[],i=[];e.isDirty?i=e.getAllIds():(r=e.getChangedIds().filter((function(t){return void 0!==e.get(t)})),i=e.sources.hot.filter((function(t){return t.properties.id&&-1===r.indexOf(t.properties.id)&&void 0!==e.get(t.properties.id)})).map((function(e){return e.properties.id}))),e.sources.hot=[];var n=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter((function(e){var t=e.properties.id||e.properties.parent;return-1===r.indexOf(t)}));var o=n!==e.sources.cold.length||i.length>0;function s(r,i){var n=e.get(r).internal(t);e.ctx.events.currentModeRender(n,(function(t){e.sources[i].push(t)}))}if(r.forEach((function(e){return s(e,"hot")})),i.forEach((function(e){return s(e,"cold")})),o&&e.ctx.map.getSource(h.COLD).setData({type:f.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(h.HOT).setData({type:f.FEATURE_COLLECTION,features:e.sources.hot}),e._emitSelectionChange&&(e.ctx.map.fire(_.SELECTION_CHANGE,{features:e.getSelected().map((function(e){return e.toGeoJSON()})),points:e.getSelectedCoordinates().map((function(e){return{type:f.FEATURE,properties:{},geometry:{type:f.POINT,coordinates:e.coordinates}}}))}),e._emitSelectionChange=!1),e._deletedFeaturesToEmit.length){var a=e._deletedFeaturesToEmit.map((function(e){return e.toGeoJSON()}));e._deletedFeaturesToEmit=[],e.ctx.map.fire(_.DELETE,{features:a})}function l(){e.isDirty=!1,e.clearChangedIds()}l(),e.ctx.map.fire(_.RENDER,{})}function K(e){var t,r=this;this._features={},this._featureIds=new A,this._selectedFeatureIds=new A,this._selectedCoordinates=[],this._changedFeatureIds=new A,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]},this.render=function(){t||(t=requestAnimationFrame((function(){t=null,Y.call(r)})))},this.isDirty=!1}function J(e,t){var r=e._selectedCoordinates.filter((function(t){return e._selectedFeatureIds.has(t.feature_id)}));e._selectedCoordinates.length===r.length||t.silent||(e._emitSelectionChange=!0),e._selectedCoordinates=r}K.prototype.createRenderBatch=function(){var e=this,t=this.render,r=0;return this.render=function(){r++},function(){e.render=t,r>0&&e.render()}},K.prototype.setDirty=function(){return this.isDirty=!0,this},K.prototype.featureChanged=function(e){return this._changedFeatureIds.add(e),this},K.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},K.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},K.prototype.getAllIds=function(){return this._featureIds.values()},K.prototype.add=function(e){return this.featureChanged(e.id),this._features[e.id]=e,this._featureIds.add(e.id),this},K.prototype.delete=function(e,t){var r=this;return void 0===t&&(t={}),X(e).forEach((function(e){r._featureIds.has(e)&&(r._featureIds.delete(e),r._selectedFeatureIds.delete(e),t.silent||-1===r._deletedFeaturesToEmit.indexOf(r._features[e])&&r._deletedFeaturesToEmit.push(r._features[e]),delete r._features[e],r.isDirty=!0)})),J(this,t),this},K.prototype.get=function(e){return this._features[e]},K.prototype.getAll=function(){var e=this;return Object.keys(this._features).map((function(t){return e._features[t]}))},K.prototype.select=function(e,t){var r=this;return void 0===t&&(t={}),X(e).forEach((function(e){r._selectedFeatureIds.has(e)||(r._selectedFeatureIds.add(e),r._changedFeatureIds.add(e),t.silent||(r._emitSelectionChange=!0))})),this},K.prototype.deselect=function(e,t){var r=this;return void 0===t&&(t={}),X(e).forEach((function(e){r._selectedFeatureIds.has(e)&&(r._selectedFeatureIds.delete(e),r._changedFeatureIds.add(e),t.silent||(r._emitSelectionChange=!0))})),J(this,t),this},K.prototype.clearSelected=function(e){return void 0===e&&(e={}),this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this},K.prototype.setSelected=function(e,t){var r=this;return void 0===t&&(t={}),e=X(e),this.deselect(this._selectedFeatureIds.values().filter((function(t){return-1===e.indexOf(t)})),{silent:t.silent}),this.select(e.filter((function(e){return!r._selectedFeatureIds.has(e)})),{silent:t.silent}),this},K.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this},K.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},K.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},K.prototype.getSelected=function(){var e=this;return this._selectedFeatureIds.values().map((function(t){return e.get(t)}))},K.prototype.getSelectedCoordinates=function(){var e=this;return this._selectedCoordinates.map((function(t){return{coordinates:e.get(t.feature_id).getCoordinate(t.coord_path)}}))},K.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)},K.prototype.setFeatureProperty=function(e,t,r){this.get(e).setProperty(t,r),this.featureChanged(e)},K.prototype.storeMapConfig=function(){var e=this;v.forEach((function(t){e.ctx.map[t]&&(e._mapInitialConfig[t]=e.ctx.map[t].isEnabled())}))},K.prototype.restoreMapConfig=function(){var e=this;Object.keys(this._mapInitialConfig).forEach((function(t){e._mapInitialConfig[t]?e.ctx.map[t].enable():e.ctx.map[t].disable()}))},K.prototype.getInitialConfigValue=function(e){return void 0===this._mapInitialConfig[e]||this._mapInitialConfig[e]};var Q=function(){for(var e=arguments,t={},r=0;r<arguments.length;r++){var i=e[r];for(var n in i)ee.call(i,n)&&(t[n]=i[n])}return t},ee=Object.prototype.hasOwnProperty,te=t(Q),re=["mode","feature","mouse"];function ie(t){var r=null,i=null,n={onRemove:function(){return t.map.off("load",n.connect),clearInterval(i),n.removeLayers(),t.store.restoreMapConfig(),t.ui.removeButtons(),t.events.removeEventListeners(),t.ui.clearMapClasses(),t.boxZoomInitial&&t.map.boxZoom.enable(),t.map=null,t.container=null,t.store=null,r&&r.parentNode&&r.parentNode.removeChild(r),r=null,this},connect:function(){t.map.off("load",n.connect),clearInterval(i),n.addLayers(),t.store.storeMapConfig(),t.events.addEventListeners()},onAdd:function(o){var s=o.fire;return o.fire=function(e,t){var r=arguments;return 1===s.length&&1!==arguments.length&&(r=[te({},{type:e},t)]),s.apply(o,r)},t.map=o,t.events=function(t){var r=Object.keys(t.options.modes).reduce((function(e,r){return e[r]=H(t.options.modes[r]),e}),{}),i={},n={},o={},s=null,a=null;o.drag=function(e,r){r({point:e.point,time:(new Date).getTime()})?(t.ui.queueMapClasses({mouse:d.DRAG}),a.drag(e)):e.originalEvent.stopPropagation()},o.mousedrag=function(e){o.drag(e,(function(e){return!D(i,e)}))},o.touchdrag=function(e){o.drag(e,(function(e){return!O(n,e)}))},o.mousemove=function(e){if(1===(void 0!==e.originalEvent.buttons?e.originalEvent.buttons:e.originalEvent.which))return o.mousedrag(e);var r=L(e,t);e.featureTarget=r,a.mousemove(e)},o.mousedown=function(e){i={time:(new Date).getTime(),point:e.point};var r=L(e,t);e.featureTarget=r,a.mousedown(e)},o.mouseup=function(e){var r=L(e,t);e.featureTarget=r,D(i,{point:e.point,time:(new Date).getTime()})?a.click(e):a.mouseup(e)},o.mouseout=function(e){a.mouseout(e)},o.touchstart=function(e){if(t.options.touchEnabled){n={time:(new Date).getTime(),point:e.point};var r=C.touch(e,null,t)[0];e.featureTarget=r,a.touchstart(e)}},o.touchmove=function(e){if(t.options.touchEnabled)return a.touchmove(e),o.touchdrag(e)},o.touchend=function(e){if(e.originalEvent.preventDefault(),t.options.touchEnabled){var r=C.touch(e,null,t)[0];e.featureTarget=r,O(n,{time:(new Date).getTime(),point:e.point})?a.tap(e):a.touchend(e)}};var l=function(e){return!(8===e||46===e||e>=48&&e<=57)};function c(i,n,o){void 0===o&&(o={}),a.stop();var l=r[i];if(void 0===l)throw new Error(i+" is not valid");s=i;var c=l(t,n);a=e(c,t),o.silent||t.map.fire(_.MODE_CHANGE,{mode:i}),t.store.setDirty(),t.store.render()}o.keydown=function(e){(e.srcElement||e.target).classList.contains("mapboxgl-canvas")&&(8!==e.keyCode&&46!==e.keyCode||!t.options.controls.trash?l(e.keyCode)?a.keydown(e):49===e.keyCode&&t.options.controls.point?c(m.DRAW_POINT):50===e.keyCode&&t.options.controls.line_string?c(m.DRAW_LINE_STRING):51===e.keyCode&&t.options.controls.polygon&&c(m.DRAW_POLYGON):(e.preventDefault(),a.trash()))},o.keyup=function(e){l(e.keyCode)&&a.keyup(e)},o.zoomend=function(){t.store.changeZoom()},o.data=function(e){if("style"===e.dataType){var r=t.setup,i=t.map,n=t.options,o=t.store;n.styles.some((function(e){return i.getLayer(e.id)}))||(r.addLayers(),o.setDirty(),o.render())}};var u={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){s=t.options.defaultMode,a=e(r[s](t),t)},changeMode:c,actionable:function(e){var r=!1;Object.keys(e).forEach((function(t){if(void 0===u[t])throw new Error("Invalid action type");u[t]!==e[t]&&(r=!0),u[t]=e[t]})),r&&t.map.fire(_.ACTIONABLE,{actions:u})},currentModeName:function(){return s},currentModeRender:function(e,t){return a.render(e,t)},fire:function(e,t){o[e]&&o[e](t)},addEventListeners:function(){t.map.on("mousemove",o.mousemove),t.map.on("mousedown",o.mousedown),t.map.on("mouseup",o.mouseup),t.map.on("data",o.data),t.map.on("touchmove",o.touchmove),t.map.on("touchstart",o.touchstart),t.map.on("touchend",o.touchend),t.container.addEventListener("mouseout",o.mouseout),t.options.keybindings&&(t.container.addEventListener("keydown",o.keydown),t.container.addEventListener("keyup",o.keyup))},removeEventListeners:function(){t.map.off("mousemove",o.mousemove),t.map.off("mousedown",o.mousedown),t.map.off("mouseup",o.mouseup),t.map.off("data",o.data),t.map.off("touchmove",o.touchmove),t.map.off("touchstart",o.touchstart),t.map.off("touchend",o.touchend),t.container.removeEventListener("mouseout",o.mouseout),t.options.keybindings&&(t.container.removeEventListener("keydown",o.keydown),t.container.removeEventListener("keyup",o.keyup))},trash:function(e){a.trash(e)},combineFeatures:function(){a.combineFeatures()},uncombineFeatures:function(){a.uncombineFeatures()},getMode:function(){return s}}}(t),t.ui=function(e){var t={},r=null,i={mode:null,feature:null,mouse:null},n={mode:null,feature:null,mouse:null};function o(e){n=te(n,e)}function s(){var t,r;if(e.container){var o=[],s=[];re.forEach((function(e){n[e]!==i[e]&&(o.push(e+"-"+i[e]),null!==n[e]&&s.push(e+"-"+n[e]))})),o.length>0&&(t=e.container.classList).remove.apply(t,o),s.length>0&&(r=e.container.classList).add.apply(r,s),i=te(i,n)}}function a(e,t){void 0===t&&(t={});var i=document.createElement("button");return i.className=u.CONTROL_BUTTON+" "+t.className,i.setAttribute("title",t.title),t.container.appendChild(i),i.addEventListener("click",(function(i){if(i.preventDefault(),i.stopPropagation(),i.target===r)return l(),void t.onDeactivate();c(e),t.onActivate()}),!0),i}function l(){r&&(r.classList.remove(u.ACTIVE_BUTTON),r=null)}function c(e){l();var i=t[e];i&&i&&"trash"!==e&&(i.classList.add(u.ACTIVE_BUTTON),r=i)}return{setActiveButton:c,queueMapClasses:o,updateMapClasses:s,clearMapClasses:function(){o({mode:null,feature:null,mouse:null}),s()},addButtons:function(){var r=e.options.controls,i=document.createElement("div");return i.className=u.CONTROL_GROUP+" "+u.CONTROL_BASE,r?(r[p.LINE]&&(t[p.LINE]=a(p.LINE,{container:i,className:u.CONTROL_BUTTON_LINE,title:"LineString tool "+(e.options.keybindings?"(l)":""),onActivate:function(){return e.events.changeMode(m.DRAW_LINE_STRING)},onDeactivate:function(){return e.events.trash()}})),r[p.POLYGON]&&(t[p.POLYGON]=a(p.POLYGON,{container:i,className:u.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(e.options.keybindings?"(p)":""),onActivate:function(){return e.events.changeMode(m.DRAW_POLYGON)},onDeactivate:function(){return e.events.trash()}})),r[p.POINT]&&(t[p.POINT]=a(p.POINT,{container:i,className:u.CONTROL_BUTTON_POINT,title:"Marker tool "+(e.options.keybindings?"(m)":""),onActivate:function(){return e.events.changeMode(m.DRAW_POINT)},onDeactivate:function(){return e.events.trash()}})),r.trash&&(t.trash=a("trash",{container:i,className:u.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){e.events.trash()}})),r.combine_features&&(t.combine_features=a("combineFeatures",{container:i,className:u.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){e.events.combineFeatures()}})),r.uncombine_features&&(t.uncombine_features=a("uncombineFeatures",{container:i,className:u.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){e.events.uncombineFeatures()}})),i):i},removeButtons:function(){Object.keys(t).forEach((function(e){var r=t[e];r.parentNode&&r.parentNode.removeChild(r),delete t[e]}))}}}(t),t.container=o.getContainer(),t.store=new K(t),r=t.ui.addButtons(),t.options.boxSelect&&(t.boxZoomInitial=o.boxZoom.isEnabled(),o.boxZoom.disable(),o.dragPan.disable(),o.dragPan.enable()),o.loaded()?n.connect():(o.on("load",n.connect),i=setInterval((function(){o.loaded()&&n.connect()}),16)),t.events.start(),r},addLayers:function(){t.map.addSource(h.COLD,{data:{type:f.FEATURE_COLLECTION,features:[]},type:"geojson"}),t.map.addSource(h.HOT,{data:{type:f.FEATURE_COLLECTION,features:[]},type:"geojson"}),t.options.styles.forEach((function(e){t.map.addLayer(e)})),t.store.setDirty(!0),t.store.render()},removeLayers:function(){t.options.styles.forEach((function(e){t.map.getLayer(e.id)&&t.map.removeLayer(e.id)})),t.map.getSource(h.COLD)&&t.map.removeSource(h.COLD),t.map.getSource(h.HOT)&&t.map.removeSource(h.HOT)}};return t.setup=n,n}var ne=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function oe(e){return function(t){var r=t.featureTarget;return!!r&&!!r.properties&&r.properties.meta===e}}function se(e){return!!e.originalEvent&&!!e.originalEvent.shiftKey&&0===e.originalEvent.button}function ae(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===x.ACTIVE&&e.featureTarget.properties.meta===y.FEATURE}function le(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===x.INACTIVE&&e.featureTarget.properties.meta===y.FEATURE}function ce(e){return void 0===e.featureTarget}function ue(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.meta===y.FEATURE}function he(e){var t=e.featureTarget;return!!t&&!!t.properties&&t.properties.meta===y.VERTEX}function de(e){return!!e.originalEvent&&!0===e.originalEvent.shiftKey}function pe(e){return 27===e.keyCode}function fe(e){return 13===e.keyCode}var me=Object.freeze({__proto__:null,isOfMetaType:oe,isShiftMousedown:se,isActiveFeature:ae,isInactiveFeature:le,noTarget:ce,isFeature:ue,isVertex:he,isShiftDown:de,isEscapeKey:pe,isEnterKey:fe,isTrue:function(){return!0}}),_e=ge;function ge(e,t){this.x=e,this.y=t}ge.prototype={clone:function(){return new ge(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,r=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),i=t*this.x-r*this.y,n=r*this.x+t*this.y;return this.x=i,this.y=n,this},_rotateAround:function(e,t){var r=Math.cos(e),i=Math.sin(e),n=t.x+r*(this.x-t.x)-i*(this.y-t.y),o=t.y+i*(this.x-t.x)+r*(this.y-t.y);return this.x=n,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ge.convert=function(e){return e instanceof ge?e:Array.isArray(e)?new ge(e[0],e[1]):e};var ye=t(_e);function xe(e,t){var r=t.getBoundingClientRect();return new ye(e.clientX-r.left-(t.clientLeft||0),e.clientY-r.top-(t.clientTop||0))}function ve(e,t,r,i){return{type:f.FEATURE,properties:{meta:y.VERTEX,parent:e,coord_path:r,active:i?x.ACTIVE:x.INACTIVE},geometry:{type:f.POINT,coordinates:t}}}function be(e,t,r){var i=t.geometry.coordinates,n=r.geometry.coordinates;if(i[1]>85||i[1]<b||n[1]>85||n[1]<b)return null;var o={lng:(i[0]+n[0])/2,lat:(i[1]+n[1])/2};return{type:f.FEATURE,properties:{meta:y.MIDPOINT,parent:e,lng:o.lng,lat:o.lat,coord_path:r.properties.coord_path},geometry:{type:f.POINT,coordinates:[o.lng,o.lat]}}}function we(e,t,r){void 0===t&&(t={}),void 0===r&&(r=null);var i,n=e.geometry,o=n.type,s=n.coordinates,a=e.properties&&e.properties.id,l=[];function c(e,r){var i="",n=null;e.forEach((function(e,o){var s=null!=r?r+"."+o:String(o),c=ve(a,e,s,u(s));if(t.midpoints&&n){var h=be(a,n,c);h&&l.push(h)}n=c;var d=JSON.stringify(e);i!==d&&l.push(c),0===o&&(i=d)}))}function u(e){return!!t.selectedPaths&&-1!==t.selectedPaths.indexOf(e)}return o===f.POINT?l.push(ve(a,s,r,u(r))):o===f.POLYGON?s.forEach((function(e,t){c(e,null!==r?r+"."+t:String(t))})):o===f.LINE_STRING?c(s,r):0===o.indexOf(f.MULTI_PREFIX)&&(i=o.replace(f.MULTI_PREFIX,""),s.forEach((function(r,n){var o={type:f.FEATURE,properties:e.properties,geometry:{type:i,coordinates:r}};l=l.concat(we(o,t,n))}))),l}var Te={enable:function(e){setTimeout((function(){e.map&&e.map.doubleClickZoom&&e._ctx&&e._ctx.store&&e._ctx.store.getInitialConfigValue&&e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()}),0)},disable:function(e){setTimeout((function(){e.map&&e.map.doubleClickZoom&&e.map.doubleClickZoom.disable()}),0)}},Ee={exports:{}},Se=function(e){if(!e||!e.type)return null;var t=Me[e.type];return t?"geometry"===t?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]}:"feature"===t?{type:"FeatureCollection",features:[e]}:"featurecollection"===t?e:void 0:null},Me={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Ae=t(Se),Ie=Object.freeze({__proto__:null,default:function e(t){switch(t&&t.type||null){case"FeatureCollection":return t.features=t.features.reduce((function(t,r){return t.concat(e(r))}),[]),t;case"Feature":return t.geometry?e(t.geometry).map((function(e){var r={type:"Feature",properties:JSON.parse(JSON.stringify(t.properties)),geometry:e};return void 0!==t.id&&(r.id=t.id),r})):[t];case"MultiPoint":return t.coordinates.map((function(e){return{type:"Point",coordinates:e}}));case"MultiPolygon":return t.coordinates.map((function(e){return{type:"Polygon",coordinates:e}}));case"MultiLineString":return t.coordinates.map((function(e){return{type:"LineString",coordinates:e}}));case"GeometryCollection":return t.geometries.map(e).reduce((function(e,t){return e.concat(t)}),[]);case"Point":case"Polygon":case"LineString":return[t]}}}),Ce=Se,Pe=i(Ie),Le=function(e){return function e(t){return Array.isArray(t)&&t.length&&"number"==typeof t[0]?[t]:t.reduce((function(t,r){return Array.isArray(r)&&Array.isArray(r[0])?t.concat(e(r)):(t.push(r),t)}),[])}(e)};Pe instanceof Function||(Pe=Pe.default);var Re={exports:{}},De=Re.exports=function(e){return new Oe(e)};function Oe(e){this.value=e}function ze(e,t,r){var i=[],n=[],o=!0;return function e(s){var a=r?ke(s):s,l={},c=!0,u={node:a,node_:s,path:[].concat(i),parent:n[n.length-1],parents:n,key:i.slice(-1)[0],isRoot:0===i.length,level:i.length,circular:null,update:function(e,t){u.isRoot||(u.parent.node[u.key]=e),u.node=e,t&&(c=!1)},delete:function(e){delete u.parent.node[u.key],e&&(c=!1)},remove:function(e){Ne(u.parent.node)?u.parent.node.splice(u.key,1):delete u.parent.node[u.key],e&&(c=!1)},keys:null,before:function(e){l.before=e},after:function(e){l.after=e},pre:function(e){l.pre=e},post:function(e){l.post=e},stop:function(){o=!1},block:function(){c=!1}};if(!o)return u;function h(){if("object"==typeof u.node&&null!==u.node){u.keys&&u.node_===u.node||(u.keys=Fe(u.node)),u.isLeaf=0==u.keys.length;for(var e=0;e<n.length;e++)if(n[e].node_===s){u.circular=n[e];break}}else u.isLeaf=!0,u.keys=null;u.notLeaf=!u.isLeaf,u.notRoot=!u.isRoot}h();var d=t.call(u,u.node);return void 0!==d&&u.update&&u.update(d),l.before&&l.before.call(u,u.node),c?("object"!=typeof u.node||null===u.node||u.circular||(n.push(u),h(),Ue(u.keys,(function(t,n){i.push(t),l.pre&&l.pre.call(u,u.node[t],t);var o=e(u.node[t]);r&&Ve.call(u.node,t)&&(u.node[t]=o.node),o.isLast=n==u.keys.length-1,o.isFirst=0==n,l.post&&l.post.call(u,o),i.pop()})),n.pop()),l.after&&l.after.call(u,u.node),u):u}(e).node}function ke(e){if("object"==typeof e&&null!==e){var t;if(Ne(e))t=[];else if("[object Date]"===Be(e))t=new Date(e.getTime?e.getTime():e);else if(function(e){return"[object RegExp]"===Be(e)}(e))t=new RegExp(e);else if(function(e){return"[object Error]"===Be(e)}(e))t={message:e.message};else if(function(e){return"[object Boolean]"===Be(e)}(e))t=new Boolean(e);else if(function(e){return"[object Number]"===Be(e)}(e))t=new Number(e);else if(function(e){return"[object String]"===Be(e)}(e))t=new String(e);else if(Object.create&&Object.getPrototypeOf)t=Object.create(Object.getPrototypeOf(e));else if(e.constructor===Object)t={};else{var r=e.constructor&&e.constructor.prototype||e.__proto__||{},i=function(){};i.prototype=r,t=new i}return Ue(Fe(e),(function(r){t[r]=e[r]})),t}return e}Oe.prototype.get=function(e){for(var t=this.value,r=0;r<e.length;r++){var i=e[r];if(!t||!Ve.call(t,i)){t=void 0;break}t=t[i]}return t},Oe.prototype.has=function(e){for(var t=this.value,r=0;r<e.length;r++){var i=e[r];if(!t||!Ve.call(t,i))return!1;t=t[i]}return!0},Oe.prototype.set=function(e,t){for(var r=this.value,i=0;i<e.length-1;i++){var n=e[i];Ve.call(r,n)||(r[n]={}),r=r[n]}return r[e[i]]=t,t},Oe.prototype.map=function(e){return ze(this.value,e,!0)},Oe.prototype.forEach=function(e){return this.value=ze(this.value,e,!1),this.value},Oe.prototype.reduce=function(e,t){var r=1===arguments.length,i=r?this.value:t;return this.forEach((function(t){this.isRoot&&r||(i=e.call(this,i,t))})),i},Oe.prototype.paths=function(){var e=[];return this.forEach((function(t){e.push(this.path)})),e},Oe.prototype.nodes=function(){var e=[];return this.forEach((function(t){e.push(this.node)})),e},Oe.prototype.clone=function(){var e=[],t=[];return function r(i){for(var n=0;n<e.length;n++)if(e[n]===i)return t[n];if("object"==typeof i&&null!==i){var o=ke(i);return e.push(i),t.push(o),Ue(Fe(i),(function(e){o[e]=r(i[e])})),e.pop(),t.pop(),o}return i}(this.value)};var Fe=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};function Be(e){return Object.prototype.toString.call(e)}var Ne=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Ue=function(e,t){if(e.forEach)return e.forEach(t);for(var r=0;r<e.length;r++)t(e[r],r,e)};Ue(Fe(Oe.prototype),(function(e){De[e]=function(t){var r=[].slice.call(arguments,1),i=new Oe(t);return i[e].apply(i,r)}}));var Ve=Object.hasOwnProperty||function(e,t){return t in e},je=Re.exports,Ge=$e;function $e(e){if(!(this instanceof $e))return new $e(e);this._bbox=e||[1/0,1/0,-1/0,-1/0],this._valid=!!e}$e.prototype.include=function(e){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[0]),this._bbox[3]=Math.max(this._bbox[3],e[1]),this},$e.prototype.equals=function(e){var t;return t=e instanceof $e?e.bbox():e,this._bbox[0]==t[0]&&this._bbox[1]==t[1]&&this._bbox[2]==t[2]&&this._bbox[3]==t[3]},$e.prototype.center=function(e){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},$e.prototype.union=function(e){var t;return this._valid=!0,t=e instanceof $e?e.bbox():e,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[2]),this._bbox[3]=Math.max(this._bbox[3],t[3]),this},$e.prototype.bbox=function(){return this._valid?this._bbox:null},$e.prototype.contains=function(e){if(!e)return this._fastContains();if(!this._valid)return null;var t=e[0],r=e[1];return this._bbox[0]<=t&&this._bbox[1]<=r&&this._bbox[2]>=t&&this._bbox[3]>=r},$e.prototype.intersect=function(e){return this._valid?(t=e instanceof $e?e.bbox():e,!(this._bbox[0]>t[2]||this._bbox[2]<t[0]||this._bbox[3]<t[1]||this._bbox[1]>t[3])):null;var t},$e.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var e="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",e)},$e.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var qe=function(e){if(!e)return[];var t=Pe(Ce(e)),r=[];return t.features.forEach((function(e){e.geometry&&(r=r.concat(Le(e.geometry.coordinates)))})),r},Ze=je,We=Ge,He={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Xe=Object.keys(He);function Ye(e){for(var t=We(),r=qe(e),i=0;i<r.length;i++)t.include(r[i]);return t}Ee.exports=function(e){return Ye(e).bbox()},Ee.exports.polygon=function(e){return Ye(e).polygon()},Ee.exports.bboxify=function(e){return Ze(e).map((function(e){e&&Xe.some((function(t){return!!e[t]&&-1!==He[t].indexOf(e.type)}))&&(e.bbox=Ye(e).bbox(),this.update(e))}))};var Ke=t(Ee.exports),Je=-90;function Qe(e,t){var r=Je,i=90,n=Je,o=90,s=270,a=-270;e.forEach((function(e){var t=Ke(e),l=t[1],c=t[3],u=t[0],h=t[2];l>r&&(r=l),c<i&&(i=c),c>n&&(n=c),l<o&&(o=l),u<s&&(s=u),h>a&&(a=h)}));var l=t;return r+l.lat>85&&(l.lat=85-r),n+l.lat>90&&(l.lat=90-n),i+l.lat<-85&&(l.lat=-85-i),o+l.lat<Je&&(l.lat=Je-o),s+l.lng<=-270&&(l.lng+=360*Math.ceil(Math.abs(l.lng)/360)),a+l.lng>=270&&(l.lng-=360*Math.ceil(Math.abs(l.lng)/360)),l}function et(e,t){var r=Qe(e.map((function(e){return e.toGeoJSON()})),t);e.forEach((function(e){var t,i=e.getCoordinates(),n=function(e){var t={lng:e[0]+r.lng,lat:e[1]+r.lat};return[t.lng,t.lat]},o=function(e){return e.map((function(e){return n(e)}))};e.type===f.POINT?t=n(i):e.type===f.LINE_STRING||e.type===f.MULTI_POINT?t=i.map(n):e.type===f.POLYGON||e.type===f.MULTI_LINE_STRING?t=i.map(o):e.type===f.MULTI_POLYGON&&(t=i.map((function(e){return e.map((function(e){return o(e)}))}))),e.incomingCoords(t)}))}var tt={onSetup:function(e){var t=this,r={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(r.initiallySelectedFeatureIds.filter((function(e){return void 0!==t.getFeature(e)}))),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),r},fireUpdate:function(){this.map.fire(_.UPDATE,{action:g.MOVE,features:this.getSelected().map((function(e){return e.toGeoJSON()}))})},fireActionable:function(){var e=this,t=this.getSelected(),r=t.filter((function(t){return e.isInstanceOf("MultiFeature",t)})),i=!1;if(t.length>1){i=!0;var n=t[0].type.replace("Multi","");t.forEach((function(e){e.type.replace("Multi","")!==n&&(i=!1)}))}var o=r.length>0,s=t.length>0;this.setActionableState({combineFeatures:i,uncombineFeatures:o,trash:s})},getUniqueIds:function(e){return e.length?e.map((function(e){return e.properties.id})).filter((function(e){return void 0!==e})).reduce((function(e,t){return e.add(t),e}),new A).values():[]},stopExtendedInteractions:function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1},onStop:function(){Te.enable(this)},onMouseMove:function(e,t){return ue(t)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0},onMouseOut:function(e){return!e.dragMoving||this.fireUpdate()}};tt.onTap=tt.onClick=function(e,t){return ce(t)?this.clickAnywhere(e,t):oe(y.VERTEX)(t)?this.clickOnVertex(e,t):ue(t)?this.clickOnFeature(e,t):void 0},tt.clickAnywhere=function(e){var t=this,r=this.getSelectedIds();r.length&&(this.clearSelectedFeatures(),r.forEach((function(e){return t.doRender(e)}))),Te.enable(this),this.stopExtendedInteractions(e)},tt.clickOnVertex=function(e,t){this.changeMode(m.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.updateUIClasses({mouse:d.MOVE})},tt.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},tt.clickOnFeature=function(e,t){var r=this;Te.disable(this),this.stopExtendedInteractions(e);var i=de(t),n=this.getSelectedIds(),o=t.featureTarget.properties.id,s=this.isSelected(o);if(!i&&s&&this.getFeature(o).type!==f.POINT)return this.changeMode(m.DIRECT_SELECT,{featureId:o});s&&i?(this.deselect(o),this.updateUIClasses({mouse:d.POINTER}),1===n.length&&Te.enable(this)):!s&&i?(this.select(o),this.updateUIClasses({mouse:d.MOVE})):s||i||(n.forEach((function(e){return r.doRender(e)})),this.setSelected(o),this.updateUIClasses({mouse:d.MOVE})),this.doRender(o)},tt.onMouseDown=function(e,t){return ae(t)?this.startOnActiveFeature(e,t):this.drawConfig.boxSelect&&se(t)?this.startBoxSelect(e,t):void 0},tt.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=xe(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0},tt.onTouchStart=function(e,t){if(ae(t))return this.startOnActiveFeature(e,t)},tt.onDrag=function(e,t){return e.canDragMove?this.dragMove(e,t):this.drawConfig.boxSelect&&e.canBoxSelect?this.whileBoxSelect(e,t):void 0},tt.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:d.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(u.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));var r=xe(t.originalEvent,this.map.getContainer()),i=Math.min(e.boxSelectStartLocation.x,r.x),n=Math.max(e.boxSelectStartLocation.x,r.x),o=Math.min(e.boxSelectStartLocation.y,r.y),s=Math.max(e.boxSelectStartLocation.y,r.y),a="translate("+i+"px, "+o+"px)";e.boxSelectElement.style.transform=a,e.boxSelectElement.style.WebkitTransform=a,e.boxSelectElement.style.width=n-i+"px",e.boxSelectElement.style.height=s-o+"px"},tt.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();var r={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};et(this.getSelected(),r),e.dragMoveLocation=t.lngLat},tt.onTouchEnd=tt.onMouseUp=function(e,t){var r=this;if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){var i=[e.boxSelectStartLocation,xe(t.originalEvent,this.map.getContainer())],n=this.featuresAt(null,i,"click"),o=this.getUniqueIds(n).filter((function(e){return!r.isSelected(e)}));o.length&&(this.select(o),o.forEach((function(e){return r.doRender(e)})),this.updateUIClasses({mouse:d.MOVE}))}this.stopExtendedInteractions(e)},tt.toDisplayFeatures=function(e,t,r){t.properties.active=this.isSelected(t.properties.id)?x.ACTIVE:x.INACTIVE,r(t),this.fireActionable(),t.properties.active===x.ACTIVE&&t.geometry.type!==f.POINT&&we(t).forEach(r)},tt.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},tt.onCombineFeatures=function(){var e=this.getSelected();if(!(0===e.length||e.length<2)){for(var t=[],r=[],i=e[0].type.replace("Multi",""),n=0;n<e.length;n++){var o=e[n];if(o.type.replace("Multi","")!==i)return;o.type.includes("Multi")?o.getCoordinates().forEach((function(e){t.push(e)})):t.push(o.getCoordinates()),r.push(o.toGeoJSON())}if(r.length>1){var s=this.newFeature({type:f.FEATURE,properties:r[0].properties,geometry:{type:"Multi"+i,coordinates:t}});this.addFeature(s),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([s.id]),this.map.fire(_.COMBINE_FEATURES,{createdFeatures:[s.toGeoJSON()],deletedFeatures:r})}this.fireActionable()}},tt.onUncombineFeatures=function(){var e=this,t=this.getSelected();if(0!==t.length){for(var r=[],i=[],n=function(n){var o=t[n];e.isInstanceOf("MultiFeature",o)&&(o.getFeatures().forEach((function(t){e.addFeature(t),t.properties=o.properties,r.push(t.toGeoJSON()),e.select([t.id])})),e.deleteFeature(o.id,{silent:!0}),i.push(o.toGeoJSON()))},o=0;o<t.length;o++)n(o);r.length>1&&this.map.fire(_.UNCOMBINE_FEATURES,{createdFeatures:r,deletedFeatures:i}),this.fireActionable()}};var rt=oe(y.VERTEX),it=oe(y.MIDPOINT),nt={fireUpdate:function(){this.map.fire(_.UPDATE,{action:g.CHANGE_COORDINATES,features:this.getSelected().map((function(e){return e.toGeoJSON()}))})},fireActionable:function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})},startDragging:function(e,t){this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},stopDragging:function(e){this.map.dragPan.enable(),e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null},onVertex:function(e,t){this.startDragging(e,t);var r=t.featureTarget.properties,i=e.selectedCoordPaths.indexOf(r.coord_path);de(t)||-1!==i?de(t)&&-1===i&&e.selectedCoordPaths.push(r.coord_path):e.selectedCoordPaths=[r.coord_path];var n=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(n)},onMidpoint:function(e,t){this.startDragging(e,t);var r=t.featureTarget.properties;e.feature.addCoordinate(r.coord_path,r.lng,r.lat),this.fireUpdate(),e.selectedCoordPaths=[r.coord_path]},pathsToCoordinates:function(e,t){return t.map((function(t){return{feature_id:e,coord_path:t}}))},onFeature:function(e,t){0===e.selectedCoordPaths.length?this.startDragging(e,t):this.stopDragging(e)},dragFeature:function(e,t,r){et(this.getSelected(),r),e.dragMoveLocation=t.lngLat},dragVertex:function(e,t,r){for(var i=e.selectedCoordPaths.map((function(t){return e.feature.getCoordinate(t)})),n=Qe(i.map((function(e){return{type:f.FEATURE,properties:{},geometry:{type:f.POINT,coordinates:e}}})),r),o=0;o<i.length;o++){var s=i[o];e.feature.updateCoordinate(e.selectedCoordPaths[o],s[0]+n.lng,s[1]+n.lat)}},clickNoTarget:function(){this.changeMode(m.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(m.SIMPLE_SELECT)},clickActiveFeature:function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()},onSetup:function(e){var t=e.featureId,r=this.getFeature(t);if(!r)throw new Error("You must provide a featureId to enter direct_select mode");if(r.type===f.POINT)throw new TypeError("direct_select mode doesn't handle point features");var i={featureId:t,feature:r,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,i.selectedCoordPaths)),this.setSelected(t),Te.disable(this),this.setActionableState({trash:!0}),i},onStop:function(){Te.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(e,t,r){e.featureId===t.properties.id?(t.properties.active=x.ACTIVE,r(t),we(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(r)):(t.properties.active=x.INACTIVE,r(t)),this.fireActionable(e)},onTrash:function(e){e.selectedCoordPaths.sort((function(e,t){return t.localeCompare(e,"en",{numeric:!0})})).forEach((function(t){return e.feature.removeCoordinate(t)})),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),!1===e.feature.isValid()&&(this.deleteFeature([e.featureId]),this.changeMode(m.SIMPLE_SELECT,{}))},onMouseMove:function(e,t){var r=ae(t),i=rt(t),n=it(t),o=0===e.selectedCoordPaths.length;return r&&o||i&&!o?this.updateUIClasses({mouse:d.MOVE}):this.updateUIClasses({mouse:d.NONE}),(i||r||n)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0},onMouseOut:function(e){return e.dragMoving&&this.fireUpdate(),!0}};nt.onTouchStart=nt.onMouseDown=function(e,t){return rt(t)?this.onVertex(e,t):ae(t)?this.onFeature(e,t):it(t)?this.onMidpoint(e,t):void 0},nt.onDrag=function(e,t){if(!0===e.canDragMove){e.dragMoving=!0,t.originalEvent.stopPropagation();var r={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,t,r):this.dragFeature(e,t,r),e.dragMoveLocation=t.lngLat}},nt.onClick=function(e,t){return ce(t)?this.clickNoTarget(e,t):ae(t)?this.clickActiveFeature(e,t):le(t)?this.clickInactive(e,t):void this.stopDragging(e)},nt.onTap=function(e,t){return ce(t)?this.clickNoTarget(e,t):ae(t)?this.clickActiveFeature(e,t):le(t)?this.clickInactive(e,t):void 0},nt.onTouchEnd=nt.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};var ot={};function st(e,t){return!!e.lngLat&&e.lngLat.lng===t[0]&&e.lngLat.lat===t[1]}ot.onSetup=function(){var e=this.newFeature({type:f.FEATURE,properties:{},geometry:{type:f.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:d.ADD}),this.activateUIButton(p.POINT),this.setActionableState({trash:!0}),{point:e}},ot.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT)},ot.onTap=ot.onClick=function(e,t){this.updateUIClasses({mouse:d.MOVE}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.map.fire(_.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(m.SIMPLE_SELECT,{featureIds:[e.point.id]})},ot.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})},ot.toDisplayFeatures=function(e,t,r){var i=t.properties.id===e.point.id;if(t.properties.active=i?x.ACTIVE:x.INACTIVE,!i)return r(t)},ot.onTrash=ot.stopDrawingAndRemove,ot.onKeyUp=function(e,t){if(pe(t)||fe(t))return this.stopDrawingAndRemove(e,t)};var at={onSetup:function(){var e=this.newFeature({type:f.FEATURE,properties:{},geometry:{type:f.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),Te.disable(this),this.updateUIClasses({mouse:d.ADD}),this.activateUIButton(p.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&st(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(m.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:d.ADD}),e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(m.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},onMouseMove:function(e,t){e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),he(t)&&this.updateUIClasses({mouse:d.POINTER})}};at.onTap=at.onClick=function(e,t){return he(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)},at.onKeyUp=function(e,t){pe(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT)):fe(t)&&this.changeMode(m.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},at.onStop=function(e){this.updateUIClasses({mouse:d.NONE}),Te.enable(this),this.activateUIButton(),void 0!==this.getFeature(e.polygon.id)&&(e.polygon.removeCoordinate("0."+e.currentVertexPosition),e.polygon.isValid()?this.map.fire(_.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT,{},{silent:!0})))},at.toDisplayFeatures=function(e,t,r){var i=t.properties.id===e.polygon.id;if(t.properties.active=i?x.ACTIVE:x.INACTIVE,!i)return r(t);if(0!==t.geometry.coordinates.length){var n=t.geometry.coordinates[0].length;if(!(n<3)){if(t.properties.meta=y.FEATURE,r(ve(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),n>3){var o=t.geometry.coordinates[0].length-3;r(ve(e.polygon.id,t.geometry.coordinates[0][o],"0."+o,!1))}if(n<=4){var s=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(r({type:f.FEATURE,properties:t.properties,geometry:{coordinates:s,type:f.LINE_STRING}}),3===n)return}return r(t)}}},at.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT)};var lt={onSetup:function(e){var t,r,i=(e=e||{}).featureId,n="forward";if(i){if(!(t=this.getFeature(i)))throw new Error("Could not find a feature with the provided featureId");var o=e.from;if(o&&"Feature"===o.type&&o.geometry&&"Point"===o.geometry.type&&(o=o.geometry),o&&"Point"===o.type&&o.coordinates&&2===o.coordinates.length&&(o=o.coordinates),!o||!Array.isArray(o))throw new Error("Please use the `from` property to indicate which point to continue the line from");var s=t.coordinates.length-1;if(t.coordinates[s][0]===o[0]&&t.coordinates[s][1]===o[1])r=s+1,t.addCoordinate.apply(t,[r].concat(t.coordinates[s]));else{if(t.coordinates[0][0]!==o[0]||t.coordinates[0][1]!==o[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");n="backwards",r=0,t.addCoordinate.apply(t,[r].concat(t.coordinates[0]))}}else t=this.newFeature({type:f.FEATURE,properties:{},geometry:{type:f.LINE_STRING,coordinates:[]}}),r=0,this.addFeature(t);return this.clearSelectedFeatures(),Te.disable(this),this.updateUIClasses({mouse:d.ADD}),this.activateUIButton(p.LINE),this.setActionableState({trash:!0}),{line:t,currentVertexPosition:r,direction:n}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&st(t,e.line.coordinates[e.currentVertexPosition-1])||"backwards"===e.direction&&st(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(m.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:d.ADD}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),"forward"===e.direction?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(m.SIMPLE_SELECT,{featureIds:[e.line.id]})},onMouseMove:function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),he(t)&&this.updateUIClasses({mouse:d.POINTER})}};lt.onTap=lt.onClick=function(e,t){if(he(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)},lt.onKeyUp=function(e,t){fe(t)?this.changeMode(m.SIMPLE_SELECT,{featureIds:[e.line.id]}):pe(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT))},lt.onStop=function(e){Te.enable(this),this.activateUIButton(),void 0!==this.getFeature(e.line.id)&&(e.line.removeCoordinate(""+e.currentVertexPosition),e.line.isValid()?this.map.fire(_.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT,{},{silent:!0})))},lt.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT)},lt.toDisplayFeatures=function(e,t,r){var i=t.properties.id===e.line.id;if(t.properties.active=i?x.ACTIVE:x.INACTIVE,!i)return r(t);t.geometry.coordinates.length<2||(t.properties.meta=y.FEATURE,r(ve(e.line.id,t.geometry.coordinates["forward"===e.direction?t.geometry.coordinates.length-2:1],""+("forward"===e.direction?t.geometry.coordinates.length-2:1),!1)),r(t))};var ct={simple_select:tt,direct_select:nt,draw_point:ot,draw_polygon:at,draw_line_string:lt},ut={defaultMode:m.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:ne,modes:ct,controls:{},userProperties:!1},ht={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},dt={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function pt(e,t){return e.map((function(e){return e.source?e:te(e,{id:e.id+"."+t,source:"hot"===t?h.HOT:h.COLD})}))}var ft={exports:{}};!function(e,t){var i="__lodash_hash_undefined__",n=9007199254740991,o="[object Arguments]",s="[object Array]",a="[object Boolean]",l="[object Date]",c="[object Error]",u="[object Function]",h="[object Map]",d="[object Number]",p="[object Object]",f="[object Promise]",m="[object RegExp]",_="[object Set]",g="[object String]",y="[object Symbol]",x="[object WeakMap]",v="[object ArrayBuffer]",b="[object DataView]",w=/^\[object .+?Constructor\]$/,T=/^(?:0|[1-9]\d*)$/,E={};E["[object Float32Array]"]=E["[object Float64Array]"]=E["[object Int8Array]"]=E["[object Int16Array]"]=E["[object Int32Array]"]=E["[object Uint8Array]"]=E["[object Uint8ClampedArray]"]=E["[object Uint16Array]"]=E["[object Uint32Array]"]=!0,E[o]=E[s]=E[v]=E[a]=E[b]=E[l]=E[c]=E[u]=E[h]=E[d]=E[p]=E[m]=E[_]=E[g]=E[x]=!1;var S="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,M="object"==typeof self&&self&&self.Object===Object&&self,A=S||M||Function("return this")(),I=t&&!t.nodeType&&t,C=I&&e&&!e.nodeType&&e,P=C&&C.exports===I,L=P&&S.process,R=function(){try{return L&&L.binding&&L.binding("util")}catch(e){}}(),D=R&&R.isTypedArray;function O(e,t){for(var r=-1,i=null==e?0:e.length;++r<i;)if(t(e[r],r,e))return!0;return!1}function z(e){var t=-1,r=Array(e.size);return e.forEach((function(e,i){r[++t]=[i,e]})),r}function k(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var F,B,N,U=Array.prototype,V=Function.prototype,j=Object.prototype,G=A["__core-js_shared__"],$=V.toString,q=j.hasOwnProperty,Z=(F=/[^.]+$/.exec(G&&G.keys&&G.keys.IE_PROTO||""))?"Symbol(src)_1."+F:"",W=j.toString,H=RegExp("^"+$.call(q).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),X=P?A.Buffer:void 0,Y=A.Symbol,K=A.Uint8Array,J=j.propertyIsEnumerable,Q=U.splice,ee=Y?Y.toStringTag:void 0,te=Object.getOwnPropertySymbols,re=X?X.isBuffer:void 0,ie=(B=Object.keys,N=Object,function(e){return B(N(e))}),ne=Re(A,"DataView"),oe=Re(A,"Map"),se=Re(A,"Promise"),ae=Re(A,"Set"),le=Re(A,"WeakMap"),ce=Re(Object,"create"),ue=ke(ne),he=ke(oe),de=ke(se),pe=ke(ae),fe=ke(le),me=Y?Y.prototype:void 0,_e=me?me.valueOf:void 0;function ge(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function ye(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function xe(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function ve(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new xe;++t<r;)this.add(e[t])}function be(e){var t=this.__data__=new ye(e);this.size=t.size}function we(e,t){var r=Ne(e),i=!r&&Be(e),n=!r&&!i&&Ue(e),o=!r&&!i&&!n&&qe(e),s=r||i||n||o,a=s?function(e,t){for(var r=-1,i=Array(e);++r<e;)i[r]=t(r);return i}(e.length,String):[],l=a.length;for(var c in e)!t&&!q.call(e,c)||s&&("length"==c||n&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||ze(c,l))||a.push(c);return a}function Te(e,t){for(var r=e.length;r--;)if(Fe(e[r][0],t))return r;return-1}function Ee(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":ee&&ee in Object(e)?function(e){var t=q.call(e,ee),r=e[ee];try{e[ee]=void 0;var i=!0}catch(e){}var n=W.call(e);return i&&(t?e[ee]=r:delete e[ee]),n}(e):function(e){return W.call(e)}(e)}function Se(e){return $e(e)&&Ee(e)==o}function Me(e,t,r,i,n){return e===t||(null==e||null==t||!$e(e)&&!$e(t)?e!=e&&t!=t:function(e,t,r,i,n,u){var f=Ne(e),x=Ne(t),w=f?s:Oe(e),T=x?s:Oe(t),E=(w=w==o?p:w)==p,S=(T=T==o?p:T)==p,M=w==T;if(M&&Ue(e)){if(!Ue(t))return!1;f=!0,E=!1}if(M&&!E)return u||(u=new be),f||qe(e)?Ce(e,t,r,i,n,u):function(e,t,r,i,n,o,s){switch(r){case b:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case v:return!(e.byteLength!=t.byteLength||!o(new K(e),new K(t)));case a:case l:case d:return Fe(+e,+t);case c:return e.name==t.name&&e.message==t.message;case m:case g:return e==t+"";case h:var u=z;case _:var p=1&i;if(u||(u=k),e.size!=t.size&&!p)return!1;var f=s.get(e);if(f)return f==t;i|=2,s.set(e,t);var x=Ce(u(e),u(t),i,n,o,s);return s.delete(e),x;case y:if(_e)return _e.call(e)==_e.call(t)}return!1}(e,t,w,r,i,n,u);if(!(1&r)){var A=E&&q.call(e,"__wrapped__"),I=S&&q.call(t,"__wrapped__");if(A||I){var C=A?e.value():e,P=I?t.value():t;return u||(u=new be),n(C,P,r,i,u)}}return!!M&&(u||(u=new be),function(e,t,r,i,n,o){var s=1&r,a=Pe(e),l=a.length,c=Pe(t).length;if(l!=c&&!s)return!1;for(var u=l;u--;){var h=a[u];if(!(s?h in t:q.call(t,h)))return!1}var d=o.get(e);if(d&&o.get(t))return d==t;var p=!0;o.set(e,t),o.set(t,e);for(var f=s;++u<l;){var m=e[h=a[u]],_=t[h];if(i)var g=s?i(_,m,h,t,e,o):i(m,_,h,e,t,o);if(!(void 0===g?m===_||n(m,_,r,i,o):g)){p=!1;break}f||(f="constructor"==h)}if(p&&!f){var y=e.constructor,x=t.constructor;y==x||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof x&&x instanceof x||(p=!1)}return o.delete(e),o.delete(t),p}(e,t,r,i,n,u))}(e,t,r,i,Me,n))}function Ae(e){return!(!Ge(e)||function(e){return!!Z&&Z in e}(e))&&(Ve(e)?H:w).test(ke(e))}function Ie(e){if(r=(t=e)&&t.constructor,i="function"==typeof r&&r.prototype||j,t!==i)return ie(e);var t,r,i,n=[];for(var o in Object(e))q.call(e,o)&&"constructor"!=o&&n.push(o);return n}function Ce(e,t,r,i,n,o){var s=1&r,a=e.length,l=t.length;if(a!=l&&!(s&&l>a))return!1;var c=o.get(e);if(c&&o.get(t))return c==t;var u=-1,h=!0,d=2&r?new ve:void 0;for(o.set(e,t),o.set(t,e);++u<a;){var p=e[u],f=t[u];if(i)var m=s?i(f,p,u,t,e,o):i(p,f,u,e,t,o);if(void 0!==m){if(m)continue;h=!1;break}if(d){if(!O(t,(function(e,t){if(s=t,!d.has(s)&&(p===e||n(p,e,r,i,o)))return d.push(t);var s}))){h=!1;break}}else if(p!==f&&!n(p,f,r,i,o)){h=!1;break}}return o.delete(e),o.delete(t),h}function Pe(e){return function(e,t,r){var i=t(e);return Ne(e)?i:function(e,t){for(var r=-1,i=t.length,n=e.length;++r<i;)e[n+r]=t[r];return e}(i,r(e))}(e,Ze,De)}function Le(e,t){var r,i,n=e.__data__;return("string"==(i=typeof(r=t))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==r:null===r)?n["string"==typeof t?"string":"hash"]:n.map}function Re(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return Ae(r)?r:void 0}ge.prototype.clear=function(){this.__data__=ce?ce(null):{},this.size=0},ge.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ge.prototype.get=function(e){var t=this.__data__;if(ce){var r=t[e];return r===i?void 0:r}return q.call(t,e)?t[e]:void 0},ge.prototype.has=function(e){var t=this.__data__;return ce?void 0!==t[e]:q.call(t,e)},ge.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=ce&&void 0===t?i:t,this},ye.prototype.clear=function(){this.__data__=[],this.size=0},ye.prototype.delete=function(e){var t=this.__data__,r=Te(t,e);return!(r<0)&&(r==t.length-1?t.pop():Q.call(t,r,1),--this.size,!0)},ye.prototype.get=function(e){var t=this.__data__,r=Te(t,e);return r<0?void 0:t[r][1]},ye.prototype.has=function(e){return Te(this.__data__,e)>-1},ye.prototype.set=function(e,t){var r=this.__data__,i=Te(r,e);return i<0?(++this.size,r.push([e,t])):r[i][1]=t,this},xe.prototype.clear=function(){this.size=0,this.__data__={hash:new ge,map:new(oe||ye),string:new ge}},xe.prototype.delete=function(e){var t=Le(this,e).delete(e);return this.size-=t?1:0,t},xe.prototype.get=function(e){return Le(this,e).get(e)},xe.prototype.has=function(e){return Le(this,e).has(e)},xe.prototype.set=function(e,t){var r=Le(this,e),i=r.size;return r.set(e,t),this.size+=r.size==i?0:1,this},ve.prototype.add=ve.prototype.push=function(e){return this.__data__.set(e,i),this},ve.prototype.has=function(e){return this.__data__.has(e)},be.prototype.clear=function(){this.__data__=new ye,this.size=0},be.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},be.prototype.get=function(e){return this.__data__.get(e)},be.prototype.has=function(e){return this.__data__.has(e)},be.prototype.set=function(e,t){var r=this.__data__;if(r instanceof ye){var i=r.__data__;if(!oe||i.length<199)return i.push([e,t]),this.size=++r.size,this;r=this.__data__=new xe(i)}return r.set(e,t),this.size=r.size,this};var De=te?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var r=-1,i=null==e?0:e.length,n=0,o=[];++r<i;){var s=e[r];t(s,r,e)&&(o[n++]=s)}return o}(te(e),(function(t){return J.call(e,t)})))}:function(){return[]},Oe=Ee;function ze(e,t){return!!(t=null==t?n:t)&&("number"==typeof e||T.test(e))&&e>-1&&e%1==0&&e<t}function ke(e){if(null!=e){try{return $.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Fe(e,t){return e===t||e!=e&&t!=t}(ne&&Oe(new ne(new ArrayBuffer(1)))!=b||oe&&Oe(new oe)!=h||se&&Oe(se.resolve())!=f||ae&&Oe(new ae)!=_||le&&Oe(new le)!=x)&&(Oe=function(e){var t=Ee(e),r=t==p?e.constructor:void 0,i=r?ke(r):"";if(i)switch(i){case ue:return b;case he:return h;case de:return f;case pe:return _;case fe:return x}return t});var Be=Se(function(){return arguments}())?Se:function(e){return $e(e)&&q.call(e,"callee")&&!J.call(e,"callee")},Ne=Array.isArray,Ue=re||function(){return!1};function Ve(e){if(!Ge(e))return!1;var t=Ee(e);return t==u||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function je(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=n}function Ge(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function $e(e){return null!=e&&"object"==typeof e}var qe=D?function(e){return function(t){return e(t)}}(D):function(e){return $e(e)&&je(e.length)&&!!E[Ee(e)]};function Ze(e){return null!=(t=e)&&je(t.length)&&!Ve(t)?we(e):Ie(e);var t}e.exports=function(e,t){return Me(e,t)}}(ft,ft.exports);var mt=t(ft.exports);function _t(e,t){return e.length===t.length&&JSON.stringify(e.map((function(e){return e})).sort())===JSON.stringify(t.map((function(e){return e})).sort())}var gt={Polygon:V,LineString:U,Point:N,MultiPolygon:$,MultiLineString:$,MultiPoint:$},yt=Object.freeze({__proto__:null,CommonSelectors:me,constrainFeatureMovement:Qe,createMidPoint:be,createSupplementaryPoints:we,createVertex:ve,doubleClickZoom:Te,euclideanDistance:R,featuresAt:C,getFeatureAtAndSetCursors:L,isClick:D,isEventAtCoordinates:st,isTap:O,mapEventToBoundingBox:M,ModeHandler:e,moveFeatures:et,sortFeatures:S,stringSetsAreEqual:_t,StringSet:A,theme:ne,toDenseArray:X}),xt=function(e,t){var r={options:e=function(e){void 0===e&&(e={});var t=te(e);return e.controls||(t.controls={}),!1===e.displayControlsDefault?t.controls=te(dt,e.controls):t.controls=te(ht,e.controls),(t=te(ut,t)).styles=pt(t.styles,"cold").concat(pt(t.styles,"hot")),t}(e)};t=function(e,t){return t.modes=m,t.getFeatureIdsAt=function(t){return C.click({point:t},null,e).map((function(e){return e.properties.id}))},t.getSelectedIds=function(){return e.store.getSelectedIds()},t.getSelected=function(){return{type:f.FEATURE_COLLECTION,features:e.store.getSelectedIds().map((function(t){return e.store.get(t)})).map((function(e){return e.toGeoJSON()}))}},t.getSelectedPoints=function(){return{type:f.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map((function(e){return{type:f.FEATURE,properties:{},geometry:{type:f.POINT,coordinates:e.coordinates}}}))}},t.set=function(r){if(void 0===r.type||r.type!==f.FEATURE_COLLECTION||!Array.isArray(r.features))throw new Error("Invalid FeatureCollection");var i=e.store.createRenderBatch(),n=e.store.getAllIds().slice(),o=t.add(r),s=new A(o);return(n=n.filter((function(e){return!s.has(e)}))).length&&t.delete(n),i(),o},t.add=function(t){var r=JSON.parse(JSON.stringify(Ae(t))).features.map((function(t){if(t.id=t.id||F(),null===t.geometry)throw new Error("Invalid geometry: null");if(void 0===e.store.get(t.id)||e.store.get(t.id).type!==t.geometry.type){var r=gt[t.geometry.type];if(void 0===r)throw new Error("Invalid geometry type: "+t.geometry.type+".");var i=new r(e,t);e.store.add(i)}else{var n=e.store.get(t.id);n.properties=t.properties,mt(n.properties,t.properties)||e.store.featureChanged(n.id),mt(n.getCoordinates(),t.geometry.coordinates)||n.incomingCoords(t.geometry.coordinates)}return t.id}));return e.store.render(),r},t.get=function(t){var r=e.store.get(t);if(r)return r.toGeoJSON()},t.getAll=function(){return{type:f.FEATURE_COLLECTION,features:e.store.getAll().map((function(e){return e.toGeoJSON()}))}},t.delete=function(r){return e.store.delete(r,{silent:!0}),t.getMode()!==m.DIRECT_SELECT||e.store.getSelectedIds().length?e.store.render():e.events.changeMode(m.SIMPLE_SELECT,void 0,{silent:!0}),t},t.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:!0}),t.getMode()===m.DIRECT_SELECT?e.events.changeMode(m.SIMPLE_SELECT,void 0,{silent:!0}):e.store.render(),t},t.changeMode=function(r,i){return void 0===i&&(i={}),r===m.SIMPLE_SELECT&&t.getMode()===m.SIMPLE_SELECT?(_t(i.featureIds||[],e.store.getSelectedIds())||(e.store.setSelected(i.featureIds,{silent:!0}),e.store.render()),t):(r===m.DIRECT_SELECT&&t.getMode()===m.DIRECT_SELECT&&i.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(r,i,{silent:!0}),t)},t.getMode=function(){return e.events.getMode()},t.trash=function(){return e.events.trash({silent:!0}),t},t.combineFeatures=function(){return e.events.combineFeatures({silent:!0}),t},t.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:!0}),t},t.setFeatureProperty=function(r,i,n){return e.store.setFeatureProperty(r,i,n),t},t}(r,t),r.api=t;var i=ie(r);return t.onAdd=i.onAdd,t.onRemove=i.onRemove,t.types=p,t.options=e,t};function vt(e){xt(e,this)}return vt.modes=ct,vt.constants=w,vt.lib=yt,vt}))},144:function(e,t,r){"use strict";r.d(t,{C4:function(){return g},EW:function(){return Ae},Gc:function(){return me},IG:function(){return Te},IJ:function(){return Re},KR:function(){return Le},Kh:function(){return fe},Pr:function(){return Fe},R1:function(){return ze},X2:function(){return c},bl:function(){return y},fE:function(){return ve},g8:function(){return ye},hZ:function(){return C},i9:function(){return Pe},ju:function(){return be},o5:function(){return l},u4:function(){return I},ux:function(){return we},yC:function(){return s}});r(4114),r(3375),r(9225),r(3972),r(9209),r(5714),r(7561),r(6197);var i=r(4232);let n,o;class s{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this.parent=n,!e&&n&&(this.index=(n.scopes||(n.scopes=[])).push(this)-1)}get active(){return this._active}run(e){if(this._active){const t=n;try{return n=this,e()}finally{n=t}}else 0}on(){n=this}off(){n=this.parent}stop(e){if(this._active){let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.scopes)for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);if(!this.detached&&this.parent&&!e){const e=this.parent.scopes.pop();e&&e!==this&&(this.parent.scopes[this.index]=e,e.index=this.index)}this.parent=void 0,this._active=!1}}}function a(e,t=n){t&&t.active&&t.effects.push(e)}function l(){return n}class c{constructor(e,t,r,i){this.fn=e,this.trigger=t,this.scheduler=r,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,a(this,i)}get dirty(){if(2===this._dirtyLevel||3===this._dirtyLevel){this._dirtyLevel=1,g();for(let e=0;e<this._depsLength;e++){const t=this.deps[e];if(t.computed&&(u(t.computed),this._dirtyLevel>=4))break}1===this._dirtyLevel&&(this._dirtyLevel=0),y()}return this._dirtyLevel>=4}set dirty(e){this._dirtyLevel=e?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let e=f,t=o;try{return f=!0,o=this,this._runnings++,h(this),this.fn()}finally{d(this),this._runnings--,o=t,f=e}}stop(){this.active&&(h(this),d(this),this.onStop&&this.onStop(),this.active=!1)}}function u(e){return e.value}function h(e){e._trackId++,e._depsLength=0}function d(e){if(e.deps.length>e._depsLength){for(let t=e._depsLength;t<e.deps.length;t++)p(e.deps[t],e);e.deps.length=e._depsLength}}function p(e,t){const r=e.get(t);void 0!==r&&t._trackId!==r&&(e.delete(t),0===e.size&&e.cleanup())}let f=!0,m=0;const _=[];function g(){_.push(f),f=!1}function y(){const e=_.pop();f=void 0===e||e}function x(){m++}function v(){m--;while(!m&&w.length)w.shift()()}function b(e,t,r){if(t.get(e)!==e._trackId){t.set(e,e._trackId);const r=e.deps[e._depsLength];r!==t?(r&&p(r,e),e.deps[e._depsLength++]=t):e._depsLength++}}const w=[];function T(e,t,r){x();for(const i of e.keys()){let r;i._dirtyLevel<t&&(null!=r?r:r=e.get(i)===i._trackId)&&(i._shouldSchedule||(i._shouldSchedule=0===i._dirtyLevel),i._dirtyLevel=t),i._shouldSchedule&&(null!=r?r:r=e.get(i)===i._trackId)&&(i.trigger(),i._runnings&&!i.allowRecurse||2===i._dirtyLevel||(i._shouldSchedule=!1,i.scheduler&&w.push(i.scheduler)))}v()}const E=(e,t)=>{const r=new Map;return r.cleanup=e,r.computed=t,r},S=new WeakMap,M=Symbol(""),A=Symbol("");function I(e,t,r){if(f&&o){let t=S.get(e);t||S.set(e,t=new Map);let i=t.get(r);i||t.set(r,i=E((()=>t.delete(r)))),b(o,i,void 0)}}function C(e,t,r,n,o,s){const a=S.get(e);if(!a)return;let l=[];if("clear"===t)l=[...a.values()];else if("length"===r&&(0,i.cy)(e)){const e=Number(n);a.forEach(((t,r)=>{("length"===r||!(0,i.Bm)(r)&&r>=e)&&l.push(t)}))}else switch(void 0!==r&&l.push(a.get(r)),t){case"add":(0,i.cy)(e)?(0,i.yI)(r)&&l.push(a.get("length")):(l.push(a.get(M)),(0,i.CE)(e)&&l.push(a.get(A)));break;case"delete":(0,i.cy)(e)||(l.push(a.get(M)),(0,i.CE)(e)&&l.push(a.get(A)));break;case"set":(0,i.CE)(e)&&l.push(a.get(M));break}x();for(const i of l)i&&T(i,4,void 0);v()}const P=(0,i.pD)("__proto__,__v_isRef,__isVue"),L=new Set(Object.getOwnPropertyNames(Symbol).filter((e=>"arguments"!==e&&"caller"!==e)).map((e=>Symbol[e])).filter(i.Bm)),R=D();function D(){const e={};return["includes","indexOf","lastIndexOf"].forEach((t=>{e[t]=function(...e){const r=we(this);for(let t=0,n=this.length;t<n;t++)I(r,"get",t+"");const i=r[t](...e);return-1===i||!1===i?r[t](...e.map(we)):i}})),["push","pop","shift","unshift","splice"].forEach((t=>{e[t]=function(...e){g(),x();const r=we(this)[t].apply(this,e);return v(),y(),r}})),e}function O(e){(0,i.Bm)(e)||(e=String(e));const t=we(this);return I(t,"has",e),t.hasOwnProperty(e)}class z{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){const n=this._isReadonly,o=this._isShallow;if("__v_isReactive"===t)return!n;if("__v_isReadonly"===t)return n;if("__v_isShallow"===t)return o;if("__v_raw"===t)return r===(n?o?he:ue:o?ce:le).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const s=(0,i.cy)(e);if(!n){if(s&&(0,i.$3)(R,t))return Reflect.get(R,t,r);if("hasOwnProperty"===t)return O}const a=Reflect.get(e,t,r);return((0,i.Bm)(t)?L.has(t):P(t))?a:(n||I(e,"get",t),o?a:Pe(a)?s&&(0,i.yI)(t)?a:a.value:(0,i.Gv)(a)?n?_e(a):fe(a):a)}}class k extends z{constructor(e=!1){super(!1,e)}set(e,t,r,n){let o=e[t];if(!this._isShallow){const t=xe(o);if(ve(r)||xe(r)||(o=we(o),r=we(r)),!(0,i.cy)(e)&&Pe(o)&&!Pe(r))return!t&&(o.value=r,!0)}const s=(0,i.cy)(e)&&(0,i.yI)(t)?Number(t)<e.length:(0,i.$3)(e,t),a=Reflect.set(e,t,r,n);return e===we(n)&&(s?(0,i.$H)(r,o)&&C(e,"set",t,r,o):C(e,"add",t,r)),a}deleteProperty(e,t){const r=(0,i.$3)(e,t),n=e[t],o=Reflect.deleteProperty(e,t);return o&&r&&C(e,"delete",t,void 0,n),o}has(e,t){const r=Reflect.has(e,t);return(0,i.Bm)(t)&&L.has(t)||I(e,"has",t),r}ownKeys(e){return I(e,"iterate",(0,i.cy)(e)?"length":M),Reflect.ownKeys(e)}}class F extends z{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const B=new k,N=new F,U=new k(!0),V=e=>e,j=e=>Reflect.getPrototypeOf(e);function G(e,t,r=!1,n=!1){e=e["__v_raw"];const o=we(e),s=we(t);r||((0,i.$H)(t,s)&&I(o,"get",t),I(o,"get",s));const{has:a}=j(o),l=n?V:r?Se:Ee;return a.call(o,t)?l(e.get(t)):a.call(o,s)?l(e.get(s)):void(e!==o&&e.get(t))}function $(e,t=!1){const r=this["__v_raw"],n=we(r),o=we(e);return t||((0,i.$H)(e,o)&&I(n,"has",e),I(n,"has",o)),e===o?r.has(e):r.has(e)||r.has(o)}function q(e,t=!1){return e=e["__v_raw"],!t&&I(we(e),"iterate",M),Reflect.get(e,"size",e)}function Z(e){e=we(e);const t=we(this),r=j(t),i=r.has.call(t,e);return i||(t.add(e),C(t,"add",e,e)),this}function W(e,t){t=we(t);const r=we(this),{has:n,get:o}=j(r);let s=n.call(r,e);s||(e=we(e),s=n.call(r,e));const a=o.call(r,e);return r.set(e,t),s?(0,i.$H)(t,a)&&C(r,"set",e,t,a):C(r,"add",e,t),this}function H(e){const t=we(this),{has:r,get:i}=j(t);let n=r.call(t,e);n||(e=we(e),n=r.call(t,e));const o=i?i.call(t,e):void 0,s=t.delete(e);return n&&C(t,"delete",e,void 0,o),s}function X(){const e=we(this),t=0!==e.size,r=void 0,i=e.clear();return t&&C(e,"clear",void 0,void 0,r),i}function Y(e,t){return function(r,i){const n=this,o=n["__v_raw"],s=we(o),a=t?V:e?Se:Ee;return!e&&I(s,"iterate",M),o.forEach(((e,t)=>r.call(i,a(e),a(t),n)))}}function K(e,t,r){return function(...n){const o=this["__v_raw"],s=we(o),a=(0,i.CE)(s),l="entries"===e||e===Symbol.iterator&&a,c="keys"===e&&a,u=o[e](...n),h=r?V:t?Se:Ee;return!t&&I(s,"iterate",c?A:M),{next(){const{value:e,done:t}=u.next();return t?{value:e,done:t}:{value:l?[h(e[0]),h(e[1])]:h(e),done:t}},[Symbol.iterator](){return this}}}}function J(e){return function(...t){return"delete"!==e&&("clear"===e?void 0:this)}}function Q(){const e={get(e){return G(this,e)},get size(){return q(this)},has:$,add:Z,set:W,delete:H,clear:X,forEach:Y(!1,!1)},t={get(e){return G(this,e,!1,!0)},get size(){return q(this)},has:$,add:Z,set:W,delete:H,clear:X,forEach:Y(!1,!0)},r={get(e){return G(this,e,!0)},get size(){return q(this,!0)},has(e){return $.call(this,e,!0)},add:J("add"),set:J("set"),delete:J("delete"),clear:J("clear"),forEach:Y(!0,!1)},i={get(e){return G(this,e,!0,!0)},get size(){return q(this,!0)},has(e){return $.call(this,e,!0)},add:J("add"),set:J("set"),delete:J("delete"),clear:J("clear"),forEach:Y(!0,!0)},n=["keys","values","entries",Symbol.iterator];return n.forEach((n=>{e[n]=K(n,!1,!1),r[n]=K(n,!0,!1),t[n]=K(n,!1,!0),i[n]=K(n,!0,!0)})),[e,r,t,i]}const[ee,te,re,ie]=Q();function ne(e,t){const r=t?e?ie:re:e?te:ee;return(t,n,o)=>"__v_isReactive"===n?!e:"__v_isReadonly"===n?e:"__v_raw"===n?t:Reflect.get((0,i.$3)(r,n)&&n in t?r:t,n,o)}const oe={get:ne(!1,!1)},se={get:ne(!1,!0)},ae={get:ne(!0,!1)};const le=new WeakMap,ce=new WeakMap,ue=new WeakMap,he=new WeakMap;function de(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function pe(e){return e["__v_skip"]||!Object.isExtensible(e)?0:de((0,i.Zf)(e))}function fe(e){return xe(e)?e:ge(e,!1,B,oe,le)}function me(e){return ge(e,!1,U,se,ce)}function _e(e){return ge(e,!0,N,ae,ue)}function ge(e,t,r,n,o){if(!(0,i.Gv)(e))return e;if(e["__v_raw"]&&(!t||!e["__v_isReactive"]))return e;const s=o.get(e);if(s)return s;const a=pe(e);if(0===a)return e;const l=new Proxy(e,2===a?n:r);return o.set(e,l),l}function ye(e){return xe(e)?ye(e["__v_raw"]):!(!e||!e["__v_isReactive"])}function xe(e){return!(!e||!e["__v_isReadonly"])}function ve(e){return!(!e||!e["__v_isShallow"])}function be(e){return!!e&&!!e["__v_raw"]}function we(e){const t=e&&e["__v_raw"];return t?we(t):e}function Te(e){return Object.isExtensible(e)&&(0,i.yQ)(e,"__v_skip",!0),e}const Ee=e=>(0,i.Gv)(e)?fe(e):e,Se=e=>(0,i.Gv)(e)?_e(e):e;class Me{constructor(e,t,r,i){this.getter=e,this._setter=t,this.dep=void 0,this.__v_isRef=!0,this["__v_isReadonly"]=!1,this.effect=new c((()=>e(this._value)),(()=>Ce(this,2===this.effect._dirtyLevel?2:3))),this.effect.computed=this,this.effect.active=this._cacheable=!i,this["__v_isReadonly"]=r}get value(){const e=we(this);return e._cacheable&&!e.effect.dirty||!(0,i.$H)(e._value,e._value=e.effect.run())||Ce(e,4),Ie(e),e.effect._dirtyLevel>=2&&Ce(e,2),e._value}set value(e){this._setter(e)}get _dirty(){return this.effect.dirty}set _dirty(e){this.effect.dirty=e}}function Ae(e,t,r=!1){let n,o;const s=(0,i.Tn)(e);s?(n=e,o=i.tE):(n=e.get,o=e.set);const a=new Me(n,o,s||!o,r);return a}function Ie(e){var t;f&&o&&(e=we(e),b(o,null!=(t=e.dep)?t:e.dep=E((()=>e.dep=void 0),e instanceof Me?e:void 0),void 0))}function Ce(e,t=4,r){e=we(e);const i=e.dep;i&&T(i,t,void 0)}function Pe(e){return!(!e||!0!==e.__v_isRef)}function Le(e){return De(e,!1)}function Re(e){return De(e,!0)}function De(e,t){return Pe(e)?e:new Oe(e,t)}class Oe{constructor(e,t){this.__v_isShallow=t,this.dep=void 0,this.__v_isRef=!0,this._rawValue=t?e:we(e),this._value=t?e:Ee(e)}get value(){return Ie(this),this._value}set value(e){const t=this.__v_isShallow||ve(e)||xe(e);e=t?e:we(e),(0,i.$H)(e,this._rawValue)&&(this._rawValue=e,this._value=t?e:Ee(e),Ce(this,4,e))}}function ze(e){return Pe(e)?e.value:e}const ke={get:(e,t,r)=>ze(Reflect.get(e,t,r)),set:(e,t,r,i)=>{const n=e[t];return Pe(n)&&!Pe(r)?(n.value=r,!0):Reflect.set(e,t,r,i)}};function Fe(e){return ye(e)?e:new Proxy(e,ke)}},6768:function(e,t,r){"use strict";r.d(t,{$u:function(){return ze},CE:function(){return ir},Df:function(){return xe},EW:function(){return Gr},FK:function(){return Zt},Gt:function(){return pt},Gy:function(){return ce},K9:function(){return Ft},Lk:function(){return cr},MZ:function(){return ye},OW:function(){return me},Q3:function(){return mr},QP:function(){return he},Qi:function(){return z},WQ:function(){return ft},Wv:function(){return nr},bF:function(){return ur},bo:function(){return oe},dY:function(){return y},eW:function(){return fr},g2:function(){return q},h:function(){return $r},jt:function(){return k},k6:function(){return F},nI:function(){return Sr},pI:function(){return je},pM:function(){return ve},pR:function(){return pe},qL:function(){return s},uX:function(){return Jt},wB:function(){return ee}});r(4114),r(3375),r(9225),r(3972),r(9209),r(5714),r(7561),r(6197);var i=r(144),n=r(4232);function o(e,t,r,i){try{return i?e(...i):e()}catch(n){a(n,t,r)}}function s(e,t,r,i){if((0,n.Tn)(e)){const s=o(e,t,r,i);return s&&(0,n.yL)(s)&&s.catch((e=>{a(e,t,r)})),s}if((0,n.cy)(e)){const n=[];for(let o=0;o<e.length;o++)n.push(s(e[o],t,r,i));return n}}function a(e,t,r,n=!0){const s=t?t.vnode:null;if(t){let n=t.parent;const s=t.proxy,a=`https://vuejs.org/error-reference/#runtime-${r}`;while(n){const t=n.ec;if(t)for(let r=0;r<t.length;r++)if(!1===t[r](e,s,a))return;n=n.parent}const l=t.appContext.config.errorHandler;if(l)return(0,i.C4)(),o(l,null,10,[e,s,a]),void(0,i.bl)()}l(e,r,s,n)}function l(e,t,r,i=!0){console.error(e)}let c=!1,u=!1;const h=[];let d=0;const p=[];let f=null,m=0;const _=Promise.resolve();let g=null;function y(e){const t=g||_;return e?t.then(this?e.bind(this):e):t}function x(e){let t=d+1,r=h.length;while(t<r){const i=t+r>>>1,n=h[i],o=M(n);o<e||o===e&&n.pre?t=i+1:r=i}return t}function v(e){h.length&&h.includes(e,c&&e.allowRecurse?d+1:d)||(null==e.id?h.push(e):h.splice(x(e.id),0,e),b())}function b(){c||u||(u=!0,g=_.then(I))}function w(e){const t=h.indexOf(e);t>d&&h.splice(t,1)}function T(e){(0,n.cy)(e)?p.push(...e):f&&f.includes(e,e.allowRecurse?m+1:m)||p.push(e),b()}function E(e,t,r=(c?d+1:0)){for(0;r<h.length;r++){const t=h[r];if(t&&t.pre){if(e&&t.id!==e.uid)continue;0,h.splice(r,1),r--,t()}}}function S(e){if(p.length){const e=[...new Set(p)].sort(((e,t)=>M(e)-M(t)));if(p.length=0,f)return void f.push(...e);for(f=e,m=0;m<f.length;m++)f[m]();f=null,m=0}}const M=e=>null==e.id?1/0:e.id,A=(e,t)=>{const r=M(e)-M(t);if(0===r){if(e.pre&&!t.pre)return-1;if(t.pre&&!e.pre)return 1}return r};function I(e){u=!1,c=!0,h.sort(A);n.tE;try{for(d=0;d<h.length;d++){const e=h[d];e&&!1!==e.active&&o(e,null,14)}}finally{d=0,h.length=0,S(e),c=!1,g=null,(h.length||p.length)&&I(e)}}function C(e,t,...r){if(e.isUnmounted)return;const i=e.vnode.props||n.MZ;let o=r;const a=t.startsWith("update:"),l=a&&t.slice(7);if(l&&l in i){const e=`${"modelValue"===l?"model":l}Modifiers`,{number:t,trim:s}=i[e]||n.MZ;s&&(o=r.map((e=>(0,n.Kg)(e)?e.trim():e))),t&&(o=r.map(n.bB))}let c;let u=i[c=(0,n.rU)(t)]||i[c=(0,n.rU)((0,n.PT)(t))];!u&&a&&(u=i[c=(0,n.rU)((0,n.Tg)(t))]),u&&s(u,e,6,o);const h=i[c+"Once"];if(h){if(e.emitted){if(e.emitted[c])return}else e.emitted={};e.emitted[c]=!0,s(h,e,6,o)}}function P(e,t,r=!1){const i=t.emitsCache,o=i.get(e);if(void 0!==o)return o;const s=e.emits;let a={},l=!1;if(!(0,n.Tn)(e)){const i=e=>{const r=P(e,t,!0);r&&(l=!0,(0,n.X$)(a,r))};!r&&t.mixins.length&&t.mixins.forEach(i),e.extends&&i(e.extends),e.mixins&&e.mixins.forEach(i)}return s||l?((0,n.cy)(s)?s.forEach((e=>a[e]=null)):(0,n.X$)(a,s),(0,n.Gv)(e)&&i.set(e,a),a):((0,n.Gv)(e)&&i.set(e,null),null)}function L(e,t){return!(!e||!(0,n.Mp)(t))&&(t=t.slice(2).replace(/Once$/,""),(0,n.$3)(e,t[0].toLowerCase()+t.slice(1))||(0,n.$3)(e,(0,n.Tg)(t))||(0,n.$3)(e,t))}let R=null,D=null;function O(e){const t=R;return R=e,D=e&&e.type.__scopeId||null,t}function z(e){D=e}function k(){D=null}function F(e,t=R,r){if(!t)return e;if(e._n)return e;const i=(...r)=>{i._d&&tr(-1);const n=O(t);let o;try{o=e(...r)}finally{O(n),i._d&&tr(1)}return o};return i._n=!0,i._c=!0,i._d=!0,i}function B(e){const{type:t,vnode:r,proxy:i,withProxy:o,propsOptions:[s],slots:l,attrs:c,emit:u,render:h,renderCache:d,props:p,data:f,setupState:m,ctx:_,inheritAttrs:g}=e,y=O(e);let x,v;try{if(4&r.shapeFlag){const e=o||i,t=e;x=_r(h.call(t,e,d,p,m,f,_)),v=c}else{const e=t;0,x=_r(e.length>1?e(p,{attrs:c,slots:l,emit:u}):e(p,null)),v=t.props?c:N(c)}}catch(w){Yt.length=0,a(w,e,1),x=ur(Ht)}let b=x;if(v&&!1!==g){const e=Object.keys(v),{shapeFlag:t}=b;e.length&&7&t&&(s&&e.some(n.CP)&&(v=U(v,s)),b=pr(b,v,!1,!0))}return r.dirs&&(b=pr(b,null,!1,!0),b.dirs=b.dirs?b.dirs.concat(r.dirs):r.dirs),r.transition&&(b.transition=r.transition),x=b,O(y),x}const N=e=>{let t;for(const r in e)("class"===r||"style"===r||(0,n.Mp)(r))&&((t||(t={}))[r]=e[r]);return t},U=(e,t)=>{const r={};for(const i in e)(0,n.CP)(i)&&i.slice(9)in t||(r[i]=e[i]);return r};function V(e,t,r){const{props:i,children:n,component:o}=e,{props:s,children:a,patchFlag:l}=t,c=o.emitsOptions;if(t.dirs||t.transition)return!0;if(!(r&&l>=0))return!(!n&&!a||a&&a.$stable)||i!==s&&(i?!s||j(i,s,c):!!s);if(1024&l)return!0;if(16&l)return i?j(i,s,c):!!s;if(8&l){const e=t.dynamicProps;for(let t=0;t<e.length;t++){const r=e[t];if(s[r]!==i[r]&&!L(c,r))return!0}}return!1}function j(e,t,r){const i=Object.keys(t);if(i.length!==Object.keys(e).length)return!0;for(let n=0;n<i.length;n++){const o=i[n];if(t[o]!==e[o]&&!L(r,o))return!0}return!1}function G({vnode:e,parent:t},r){while(t){const i=t.subTree;if(i.suspense&&i.suspense.activeBranch===e&&(i.el=e.el),i!==e)break;(e=t.vnode).el=r,t=t.parent}}const $="components";function q(e,t){return W($,e,!0,t)||e}const Z=Symbol.for("v-ndc");function W(e,t,r=!0,i=!1){const o=R||Er;if(o){const r=o.type;if(e===$){const e=Vr(r,!1);if(e&&(e===t||e===(0,n.PT)(t)||e===(0,n.ZH)((0,n.PT)(t))))return r}const s=H(o[e]||r[e],t)||H(o.appContext[e],t);return!s&&i?r:s}}function H(e,t){return e&&(e[t]||e[(0,n.PT)(t)]||e[(0,n.ZH)((0,n.PT)(t))])}const X=e=>e.__isSuspense;function Y(e,t){t&&t.pendingBranch?(0,n.cy)(e)?t.effects.push(...e):t.effects.push(e):T(e)}const K=Symbol.for("v-scx"),J=()=>{{const e=ft(K);return e}};const Q={};function ee(e,t,r){return te(e,t,r)}function te(e,t,{immediate:r,deep:a,flush:l,once:c,onTrack:u,onTrigger:h}=n.MZ){if(t&&c){const e=t;t=(...t)=>{e(...t),M()}}const d=Er,p=e=>!0===a?e:ne(e,!1===a?1:void 0);let f,m,_=!1,g=!1;if((0,i.i9)(e)?(f=()=>e.value,_=(0,i.fE)(e)):(0,i.g8)(e)?(f=()=>p(e),_=!0):(0,n.cy)(e)?(g=!0,_=e.some((e=>(0,i.g8)(e)||(0,i.fE)(e))),f=()=>e.map((e=>(0,i.i9)(e)?e.value:(0,i.g8)(e)?p(e):(0,n.Tn)(e)?o(e,d,2):void 0))):f=(0,n.Tn)(e)?t?()=>o(e,d,2):()=>(m&&m(),s(e,d,3,[x])):n.tE,t&&a){const e=f;f=()=>ne(e())}let y,x=e=>{m=E.onStop=()=>{o(e,d,4),m=E.onStop=void 0}};if(Dr){if(x=n.tE,t?r&&s(t,d,3,[f(),g?[]:void 0,x]):f(),"sync"!==l)return n.tE;{const e=J();y=e.__watcherHandles||(e.__watcherHandles=[])}}let b=g?new Array(e.length).fill(Q):Q;const w=()=>{if(E.active&&E.dirty)if(t){const e=E.run();(a||_||(g?e.some(((e,t)=>(0,n.$H)(e,b[t]))):(0,n.$H)(e,b)))&&(m&&m(),s(t,d,3,[e,b===Q?void 0:g&&b[0]===Q?[]:b,x]),b=e)}else E.run()};let T;w.allowRecurse=!!t,"sync"===l?T=w:"post"===l?T=()=>kt(w,d&&d.suspense):(w.pre=!0,d&&(w.id=d.uid),T=()=>v(w));const E=new i.X2(f,n.tE,T),S=(0,i.o5)(),M=()=>{E.stop(),S&&(0,n.TF)(S.effects,E)};return t?r?w():b=E.run():"post"===l?kt(E.run.bind(E),d&&d.suspense):E.run(),y&&y.push(M),M}function re(e,t,r){const i=this.proxy,o=(0,n.Kg)(e)?e.includes(".")?ie(i,e):()=>i[e]:e.bind(i,i);let s;(0,n.Tn)(t)?s=t:(s=t.handler,r=t);const a=Ir(this),l=te(o,s.bind(i),r);return a(),l}function ie(e,t){const r=t.split(".");return()=>{let t=e;for(let e=0;e<r.length&&t;e++)t=t[r[e]];return t}}function ne(e,t=1/0,r){if(t<=0||!(0,n.Gv)(e)||e["__v_skip"])return e;if(r=r||new Set,r.has(e))return e;if(r.add(e),t--,(0,i.i9)(e))ne(e.value,t,r);else if((0,n.cy)(e))for(let i=0;i<e.length;i++)ne(e[i],t,r);else if((0,n.vM)(e)||(0,n.CE)(e))e.forEach((e=>{ne(e,t,r)}));else if((0,n.Qd)(e))for(const i in e)ne(e[i],t,r);return e}function oe(e,t){if(null===R)return e;const r=Ur(R)||R.proxy,i=e.dirs||(e.dirs=[]);for(let o=0;o<t.length;o++){let[e,s,a,l=n.MZ]=t[o];e&&((0,n.Tn)(e)&&(e={mounted:e,updated:e}),e.deep&&ne(s),i.push({dir:e,instance:r,value:s,oldValue:void 0,arg:a,modifiers:l}))}return e}function se(e,t,r,n){const o=e.dirs,a=t&&t.dirs;for(let l=0;l<o.length;l++){const c=o[l];a&&(c.oldValue=a[l].value);let u=c.dir[n];u&&((0,i.C4)(),s(u,r,8,[e.el,c,e,t]),(0,i.bl)())}}const ae=Symbol("_leaveCb"),le=Symbol("_enterCb");function ce(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return De((()=>{e.isMounted=!0})),ke((()=>{e.isUnmounting=!0})),e}const ue=[Function,Array],he={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:ue,onEnter:ue,onAfterEnter:ue,onEnterCancelled:ue,onBeforeLeave:ue,onLeave:ue,onAfterLeave:ue,onLeaveCancelled:ue,onBeforeAppear:ue,onAppear:ue,onAfterAppear:ue,onAppearCancelled:ue},de={name:"BaseTransition",props:he,setup(e,{slots:t}){const r=Sr(),n=ce();return()=>{const o=t.default&&xe(t.default(),!0);if(!o||!o.length)return;let s=o[0];if(o.length>1){let e=!1;for(const t of o)if(t.type!==Ht){0,s=t,e=!0;break}}const a=(0,i.ux)(e),{mode:l}=a;if(n.isLeaving)return _e(s);const c=ge(s);if(!c)return _e(s);const u=me(c,a,n,r);ye(c,u);const h=r.subTree,d=h&&ge(h);if(d&&d.type!==Ht&&!sr(c,d)){const e=me(d,a,n,r);if(ye(d,e),"out-in"===l&&c.type!==Ht)return n.isLeaving=!0,e.afterLeave=()=>{n.isLeaving=!1,!1!==r.update.active&&(r.effect.dirty=!0,r.update())},_e(s);"in-out"===l&&c.type!==Ht&&(e.delayLeave=(e,t,r)=>{const i=fe(n,d);i[String(d.key)]=d,e[ae]=()=>{t(),e[ae]=void 0,delete u.delayedLeave},u.delayedLeave=r})}return s}}},pe=de;function fe(e,t){const{leavingVNodes:r}=e;let i=r.get(t.type);return i||(i=Object.create(null),r.set(t.type,i)),i}function me(e,t,r,i){const{appear:o,mode:a,persisted:l=!1,onBeforeEnter:c,onEnter:u,onAfterEnter:h,onEnterCancelled:d,onBeforeLeave:p,onLeave:f,onAfterLeave:m,onLeaveCancelled:_,onBeforeAppear:g,onAppear:y,onAfterAppear:x,onAppearCancelled:v}=t,b=String(e.key),w=fe(r,e),T=(e,t)=>{e&&s(e,i,9,t)},E=(e,t)=>{const r=t[1];T(e,t),(0,n.cy)(e)?e.every((e=>e.length<=1))&&r():e.length<=1&&r()},S={mode:a,persisted:l,beforeEnter(t){let i=c;if(!r.isMounted){if(!o)return;i=g||c}t[ae]&&t[ae](!0);const n=w[b];n&&sr(e,n)&&n.el[ae]&&n.el[ae](),T(i,[t])},enter(e){let t=u,i=h,n=d;if(!r.isMounted){if(!o)return;t=y||u,i=x||h,n=v||d}let s=!1;const a=e[le]=t=>{s||(s=!0,T(t?n:i,[e]),S.delayedLeave&&S.delayedLeave(),e[le]=void 0)};t?E(t,[e,a]):a()},leave(t,i){const n=String(e.key);if(t[le]&&t[le](!0),r.isUnmounting)return i();T(p,[t]);let o=!1;const s=t[ae]=r=>{o||(o=!0,i(),T(r?_:m,[t]),t[ae]=void 0,w[n]===e&&delete w[n])};w[n]=e,f?E(f,[t,s]):s()},clone(e){return me(e,t,r,i)}};return S}function _e(e){if(we(e))return e=pr(e),e.children=null,e}function ge(e){if(!we(e))return e;const{shapeFlag:t,children:r}=e;if(r){if(16&t)return r[0];if(32&t&&(0,n.Tn)(r.default))return r.default()}}function ye(e,t){6&e.shapeFlag&&e.component?ye(e.component.subTree,t):128&e.shapeFlag?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function xe(e,t=!1,r){let i=[],n=0;for(let o=0;o<e.length;o++){let s=e[o];const a=null==r?s.key:String(r)+String(null!=s.key?s.key:o);s.type===Zt?(128&s.patchFlag&&n++,i=i.concat(xe(s.children,t,a))):(t||s.type!==Ht)&&i.push(null!=a?pr(s,{key:a}):s)}if(n>1)for(let o=0;o<i.length;o++)i[o].patchFlag=-2;return i}
/*! #__NO_SIDE_EFFECTS__ */function ve(e,t){return(0,n.Tn)(e)?(()=>(0,n.X$)({name:e.name},t,{setup:e}))():e}const be=e=>!!e.type.__asyncLoader
/*! #__NO_SIDE_EFFECTS__ */;const we=e=>e.type.__isKeepAlive;RegExp,RegExp;function Te(e,t){return(0,n.cy)(e)?e.some((e=>Te(e,t))):(0,n.Kg)(e)?e.split(",").includes(t):!!(0,n.gd)(e)&&e.test(t)}function Ee(e,t){Me(e,"a",t)}function Se(e,t){Me(e,"da",t)}function Me(e,t,r=Er){const i=e.__wdc||(e.__wdc=()=>{let t=r;while(t){if(t.isDeactivated)return;t=t.parent}return e()});if(Pe(t,i,r),r){let e=r.parent;while(e&&e.parent)we(e.parent.vnode)&&Ae(i,t,r,e),e=e.parent}}function Ae(e,t,r,i){const o=Pe(t,e,i,!0);Fe((()=>{(0,n.TF)(i[t],o)}),r)}function Ie(e){e.shapeFlag&=-257,e.shapeFlag&=-513}function Ce(e){return 128&e.shapeFlag?e.ssContent:e}function Pe(e,t,r=Er,n=!1){if(r){const o=r[e]||(r[e]=[]),a=t.__weh||(t.__weh=(...n)=>{if(r.isUnmounted)return;(0,i.C4)();const o=Ir(r),a=s(t,r,e,n);return o(),(0,i.bl)(),a});return n?o.unshift(a):o.push(a),a}}const Le=e=>(t,r=Er)=>(!Dr||"sp"===e)&&Pe(e,((...e)=>t(...e)),r),Re=Le("bm"),De=Le("m"),Oe=Le("bu"),ze=Le("u"),ke=Le("bum"),Fe=Le("um"),Be=Le("sp"),Ne=Le("rtg"),Ue=Le("rtc");function Ve(e,t=Er){Pe("ec",e,t)}function je(e,t,r,i){let o;const s=r&&r[i];if((0,n.cy)(e)||(0,n.Kg)(e)){o=new Array(e.length);for(let r=0,i=e.length;r<i;r++)o[r]=t(e[r],r,void 0,s&&s[r])}else if("number"===typeof e){0,o=new Array(e);for(let r=0;r<e;r++)o[r]=t(r+1,r,void 0,s&&s[r])}else if((0,n.Gv)(e))if(e[Symbol.iterator])o=Array.from(e,((e,r)=>t(e,r,void 0,s&&s[r])));else{const r=Object.keys(e);o=new Array(r.length);for(let i=0,n=r.length;i<n;i++){const n=r[i];o[i]=t(e[n],n,i,s&&s[i])}}else o=[];return r&&(r[i]=o),o}const Ge=e=>e?Pr(e)?Ur(e)||e.proxy:Ge(e.parent):null,$e=(0,n.X$)(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>Ge(e.parent),$root:e=>Ge(e.root),$emit:e=>e.emit,$options:e=>Qe(e),$forceUpdate:e=>e.f||(e.f=()=>{e.effect.dirty=!0,v(e.update)}),$nextTick:e=>e.n||(e.n=y.bind(e.proxy)),$watch:e=>re.bind(e)}),qe=(e,t)=>e!==n.MZ&&!e.__isScriptSetup&&(0,n.$3)(e,t),Ze={get({_:e},t){if("__v_skip"===t)return!0;const{ctx:r,setupState:o,data:s,props:a,accessCache:l,type:c,appContext:u}=e;let h;if("$"!==t[0]){const i=l[t];if(void 0!==i)switch(i){case 1:return o[t];case 2:return s[t];case 4:return r[t];case 3:return a[t]}else{if(qe(o,t))return l[t]=1,o[t];if(s!==n.MZ&&(0,n.$3)(s,t))return l[t]=2,s[t];if((h=e.propsOptions[0])&&(0,n.$3)(h,t))return l[t]=3,a[t];if(r!==n.MZ&&(0,n.$3)(r,t))return l[t]=4,r[t];He&&(l[t]=0)}}const d=$e[t];let p,f;return d?("$attrs"===t&&(0,i.u4)(e.attrs,"get",""),d(e)):(p=c.__cssModules)&&(p=p[t])?p:r!==n.MZ&&(0,n.$3)(r,t)?(l[t]=4,r[t]):(f=u.config.globalProperties,(0,n.$3)(f,t)?f[t]:void 0)},set({_:e},t,r){const{data:i,setupState:o,ctx:s}=e;return qe(o,t)?(o[t]=r,!0):i!==n.MZ&&(0,n.$3)(i,t)?(i[t]=r,!0):!(0,n.$3)(e.props,t)&&(("$"!==t[0]||!(t.slice(1)in e))&&(s[t]=r,!0))},has({_:{data:e,setupState:t,accessCache:r,ctx:i,appContext:o,propsOptions:s}},a){let l;return!!r[a]||e!==n.MZ&&(0,n.$3)(e,a)||qe(t,a)||(l=s[0])&&(0,n.$3)(l,a)||(0,n.$3)(i,a)||(0,n.$3)($e,a)||(0,n.$3)(o.config.globalProperties,a)},defineProperty(e,t,r){return null!=r.get?e._.accessCache[t]=0:(0,n.$3)(r,"value")&&this.set(e,t,r.value,null),Reflect.defineProperty(e,t,r)}};function We(e){return(0,n.cy)(e)?e.reduce(((e,t)=>(e[t]=null,e)),{}):e}let He=!0;function Xe(e){const t=Qe(e),r=e.proxy,o=e.ctx;He=!1,t.beforeCreate&&Ke(t.beforeCreate,e,"bc");const{data:s,computed:a,methods:l,watch:c,provide:u,inject:h,created:d,beforeMount:p,mounted:f,beforeUpdate:m,updated:_,activated:g,deactivated:y,beforeDestroy:x,beforeUnmount:v,destroyed:b,unmounted:w,render:T,renderTracked:E,renderTriggered:S,errorCaptured:M,serverPrefetch:A,expose:I,inheritAttrs:C,components:P,directives:L,filters:R}=t,D=null;if(h&&Ye(h,o,D),l)for(const i in l){const e=l[i];(0,n.Tn)(e)&&(o[i]=e.bind(r))}if(s){0;const t=s.call(r,r);0,(0,n.Gv)(t)&&(e.data=(0,i.Kh)(t))}if(He=!0,a)for(const i in a){const e=a[i],t=(0,n.Tn)(e)?e.bind(r,r):(0,n.Tn)(e.get)?e.get.bind(r,r):n.tE;0;const s=!(0,n.Tn)(e)&&(0,n.Tn)(e.set)?e.set.bind(r):n.tE,l=Gr({get:t,set:s});Object.defineProperty(o,i,{enumerable:!0,configurable:!0,get:()=>l.value,set:e=>l.value=e})}if(c)for(const i in c)Je(c[i],o,r,i);if(u){const e=(0,n.Tn)(u)?u.call(r):u;Reflect.ownKeys(e).forEach((t=>{pt(t,e[t])}))}function O(e,t){(0,n.cy)(t)?t.forEach((t=>e(t.bind(r)))):t&&e(t.bind(r))}if(d&&Ke(d,e,"c"),O(Re,p),O(De,f),O(Oe,m),O(ze,_),O(Ee,g),O(Se,y),O(Ve,M),O(Ue,E),O(Ne,S),O(ke,v),O(Fe,w),O(Be,A),(0,n.cy)(I))if(I.length){const t=e.exposed||(e.exposed={});I.forEach((e=>{Object.defineProperty(t,e,{get:()=>r[e],set:t=>r[e]=t})}))}else e.exposed||(e.exposed={});T&&e.render===n.tE&&(e.render=T),null!=C&&(e.inheritAttrs=C),P&&(e.components=P),L&&(e.directives=L)}function Ye(e,t,r=n.tE){(0,n.cy)(e)&&(e=nt(e));for(const o in e){const r=e[o];let s;s=(0,n.Gv)(r)?"default"in r?ft(r.from||o,r.default,!0):ft(r.from||o):ft(r),(0,i.i9)(s)?Object.defineProperty(t,o,{enumerable:!0,configurable:!0,get:()=>s.value,set:e=>s.value=e}):t[o]=s}}function Ke(e,t,r){s((0,n.cy)(e)?e.map((e=>e.bind(t.proxy))):e.bind(t.proxy),t,r)}function Je(e,t,r,i){const o=i.includes(".")?ie(r,i):()=>r[i];if((0,n.Kg)(e)){const r=t[e];(0,n.Tn)(r)&&ee(o,r)}else if((0,n.Tn)(e))ee(o,e.bind(r));else if((0,n.Gv)(e))if((0,n.cy)(e))e.forEach((e=>Je(e,t,r,i)));else{const i=(0,n.Tn)(e.handler)?e.handler.bind(r):t[e.handler];(0,n.Tn)(i)&&ee(o,i,e)}else 0}function Qe(e){const t=e.type,{mixins:r,extends:i}=t,{mixins:o,optionsCache:s,config:{optionMergeStrategies:a}}=e.appContext,l=s.get(t);let c;return l?c=l:o.length||r||i?(c={},o.length&&o.forEach((e=>et(c,e,a,!0))),et(c,t,a)):c=t,(0,n.Gv)(t)&&s.set(t,c),c}function et(e,t,r,i=!1){const{mixins:n,extends:o}=t;o&&et(e,o,r,!0),n&&n.forEach((t=>et(e,t,r,!0)));for(const s in t)if(i&&"expose"===s);else{const i=tt[s]||r&&r[s];e[s]=i?i(e[s],t[s]):t[s]}return e}const tt={data:rt,props:at,emits:at,methods:st,computed:st,beforeCreate:ot,created:ot,beforeMount:ot,mounted:ot,beforeUpdate:ot,updated:ot,beforeDestroy:ot,beforeUnmount:ot,destroyed:ot,unmounted:ot,activated:ot,deactivated:ot,errorCaptured:ot,serverPrefetch:ot,components:st,directives:st,watch:lt,provide:rt,inject:it};function rt(e,t){return t?e?function(){return(0,n.X$)((0,n.Tn)(e)?e.call(this,this):e,(0,n.Tn)(t)?t.call(this,this):t)}:t:e}function it(e,t){return st(nt(e),nt(t))}function nt(e){if((0,n.cy)(e)){const t={};for(let r=0;r<e.length;r++)t[e[r]]=e[r];return t}return e}function ot(e,t){return e?[...new Set([].concat(e,t))]:t}function st(e,t){return e?(0,n.X$)(Object.create(null),e,t):t}function at(e,t){return e?(0,n.cy)(e)&&(0,n.cy)(t)?[...new Set([...e,...t])]:(0,n.X$)(Object.create(null),We(e),We(null!=t?t:{})):t}function lt(e,t){if(!e)return t;if(!t)return e;const r=(0,n.X$)(Object.create(null),e);for(const i in t)r[i]=ot(e[i],t[i]);return r}function ct(){return{app:null,config:{isNativeTag:n.NO,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let ut=0;function ht(e,t){return function(r,i=null){(0,n.Tn)(r)||(r=(0,n.X$)({},r)),null==i||(0,n.Gv)(i)||(i=null);const o=ct(),s=new WeakSet;let a=!1;const l=o.app={_uid:ut++,_component:r,_props:i,_container:null,_context:o,_instance:null,version:qr,get config(){return o.config},set config(e){0},use(e,...t){return s.has(e)||(e&&(0,n.Tn)(e.install)?(s.add(e),e.install(l,...t)):(0,n.Tn)(e)&&(s.add(e),e(l,...t))),l},mixin(e){return o.mixins.includes(e)||o.mixins.push(e),l},component(e,t){return t?(o.components[e]=t,l):o.components[e]},directive(e,t){return t?(o.directives[e]=t,l):o.directives[e]},mount(n,s,c){if(!a){0;const u=ur(r,i);return u.appContext=o,!0===c?c="svg":!1===c&&(c=void 0),s&&t?t(u,n):e(u,n,c),a=!0,l._container=n,n.__vue_app__=l,Ur(u.component)||u.component.proxy}},unmount(){a&&(e(null,l._container),delete l._container.__vue_app__)},provide(e,t){return o.provides[e]=t,l},runWithContext(e){const t=dt;dt=l;try{return e()}finally{dt=t}}};return l}}let dt=null;function pt(e,t){if(Er){let r=Er.provides;const i=Er.parent&&Er.parent.provides;i===r&&(r=Er.provides=Object.create(i)),r[e]=t}else 0}function ft(e,t,r=!1){const i=Er||R;if(i||dt){const o=i?null==i.parent?i.vnode.appContext&&i.vnode.appContext.provides:i.parent.provides:dt._context.provides;if(o&&e in o)return o[e];if(arguments.length>1)return r&&(0,n.Tn)(t)?t.call(i&&i.proxy):t}else 0}const mt={},_t=()=>Object.create(mt),gt=e=>Object.getPrototypeOf(e)===mt;function yt(e,t,r,n=!1){const o={},s=_t();e.propsDefaults=Object.create(null),vt(e,t,o,s);for(const i in e.propsOptions[0])i in o||(o[i]=void 0);r?e.props=n?o:(0,i.Gc)(o):e.type.props?e.props=o:e.props=s,e.attrs=s}function xt(e,t,r,o){const{props:s,attrs:a,vnode:{patchFlag:l}}=e,c=(0,i.ux)(s),[u]=e.propsOptions;let h=!1;if(!(o||l>0)||16&l){let i;vt(e,t,s,a)&&(h=!0);for(const o in c)t&&((0,n.$3)(t,o)||(i=(0,n.Tg)(o))!==o&&(0,n.$3)(t,i))||(u?!r||void 0===r[o]&&void 0===r[i]||(s[o]=bt(u,c,o,void 0,e,!0)):delete s[o]);if(a!==c)for(const e in a)t&&(0,n.$3)(t,e)||(delete a[e],h=!0)}else if(8&l){const r=e.vnode.dynamicProps;for(let i=0;i<r.length;i++){let o=r[i];if(L(e.emitsOptions,o))continue;const l=t[o];if(u)if((0,n.$3)(a,o))l!==a[o]&&(a[o]=l,h=!0);else{const t=(0,n.PT)(o);s[t]=bt(u,c,t,l,e,!1)}else l!==a[o]&&(a[o]=l,h=!0)}}h&&(0,i.hZ)(e.attrs,"set","")}function vt(e,t,r,o){const[s,a]=e.propsOptions;let l,c=!1;if(t)for(let i in t){if((0,n.SU)(i))continue;const u=t[i];let h;s&&(0,n.$3)(s,h=(0,n.PT)(i))?a&&a.includes(h)?(l||(l={}))[h]=u:r[h]=u:L(e.emitsOptions,i)||i in o&&u===o[i]||(o[i]=u,c=!0)}if(a){const t=(0,i.ux)(r),o=l||n.MZ;for(let i=0;i<a.length;i++){const l=a[i];r[l]=bt(s,t,l,o[l],e,!(0,n.$3)(o,l))}}return c}function bt(e,t,r,i,o,s){const a=e[r];if(null!=a){const e=(0,n.$3)(a,"default");if(e&&void 0===i){const e=a.default;if(a.type!==Function&&!a.skipFactory&&(0,n.Tn)(e)){const{propsDefaults:n}=o;if(r in n)i=n[r];else{const s=Ir(o);i=n[r]=e.call(null,t),s()}}else i=e}a[0]&&(s&&!e?i=!1:!a[1]||""!==i&&i!==(0,n.Tg)(r)||(i=!0))}return i}function wt(e,t,r=!1){const i=t.propsCache,o=i.get(e);if(o)return o;const s=e.props,a={},l=[];let c=!1;if(!(0,n.Tn)(e)){const i=e=>{c=!0;const[r,i]=wt(e,t,!0);(0,n.X$)(a,r),i&&l.push(...i)};!r&&t.mixins.length&&t.mixins.forEach(i),e.extends&&i(e.extends),e.mixins&&e.mixins.forEach(i)}if(!s&&!c)return(0,n.Gv)(e)&&i.set(e,n.Oj),n.Oj;if((0,n.cy)(s))for(let h=0;h<s.length;h++){0;const e=(0,n.PT)(s[h]);Tt(e)&&(a[e]=n.MZ)}else if(s){0;for(const e in s){const t=(0,n.PT)(e);if(Tt(t)){const r=s[e],i=a[t]=(0,n.cy)(r)||(0,n.Tn)(r)?{type:r}:(0,n.X$)({},r);if(i){const e=Mt(Boolean,i.type),r=Mt(String,i.type);i[0]=e>-1,i[1]=r<0||e<r,(e>-1||(0,n.$3)(i,"default"))&&l.push(t)}}}}const u=[a,l];return(0,n.Gv)(e)&&i.set(e,u),u}function Tt(e){return"$"!==e[0]&&!(0,n.SU)(e)}function Et(e){if(null===e)return"null";if("function"===typeof e)return e.name||"";if("object"===typeof e){const t=e.constructor&&e.constructor.name;return t||""}return""}function St(e,t){return Et(e)===Et(t)}function Mt(e,t){return(0,n.cy)(t)?t.findIndex((t=>St(t,e))):(0,n.Tn)(t)&&St(t,e)?0:-1}const At=e=>"_"===e[0]||"$stable"===e,It=e=>(0,n.cy)(e)?e.map(_r):[_r(e)],Ct=(e,t,r)=>{if(t._n)return t;const i=F(((...e)=>It(t(...e))),r);return i._c=!1,i},Pt=(e,t,r)=>{const i=e._ctx;for(const o in e){if(At(o))continue;const r=e[o];if((0,n.Tn)(r))t[o]=Ct(o,r,i);else if(null!=r){0;const e=It(r);t[o]=()=>e}}},Lt=(e,t)=>{const r=It(t);e.slots.default=()=>r},Rt=(e,t)=>{const r=e.slots=_t();if(32&e.vnode.shapeFlag){const e=t._;e?((0,n.X$)(r,t),(0,n.yQ)(r,"_",e,!0)):Pt(t,r)}else t&&Lt(e,t)},Dt=(e,t,r)=>{const{vnode:i,slots:o}=e;let s=!0,a=n.MZ;if(32&i.shapeFlag){const e=t._;e?r&&1===e?s=!1:((0,n.X$)(o,t),r||1!==e||delete o._):(s=!t.$stable,Pt(t,o)),a=t}else t&&(Lt(e,t),a={default:1});if(s)for(const n in o)At(n)||null!=a[n]||delete o[n]};function Ot(e,t,r,s,a=!1){if((0,n.cy)(e))return void e.forEach(((e,i)=>Ot(e,t&&((0,n.cy)(t)?t[i]:t),r,s,a)));if(be(s)&&!a)return;const l=4&s.shapeFlag?Ur(s.component)||s.component.proxy:s.el,c=a?null:l,{i:u,r:h}=e;const d=t&&t.r,p=u.refs===n.MZ?u.refs={}:u.refs,f=u.setupState;if(null!=d&&d!==h&&((0,n.Kg)(d)?(p[d]=null,(0,n.$3)(f,d)&&(f[d]=null)):(0,i.i9)(d)&&(d.value=null)),(0,n.Tn)(h))o(h,u,12,[c,p]);else{const t=(0,n.Kg)(h),o=(0,i.i9)(h);if(t||o){const i=()=>{if(e.f){const r=t?(0,n.$3)(f,h)?f[h]:p[h]:h.value;a?(0,n.cy)(r)&&(0,n.TF)(r,l):(0,n.cy)(r)?r.includes(l)||r.push(l):t?(p[h]=[l],(0,n.$3)(f,h)&&(f[h]=p[h])):(h.value=[l],e.k&&(p[e.k]=h.value))}else t?(p[h]=c,(0,n.$3)(f,h)&&(f[h]=c)):o&&(h.value=c,e.k&&(p[e.k]=c))};c?(i.id=-1,kt(i,r)):i()}else 0}}function zt(){"boolean"!==typeof __VUE_PROD_HYDRATION_MISMATCH_DETAILS__&&((0,n.We)().__VUE_PROD_HYDRATION_MISMATCH_DETAILS__=!1)}const kt=Y;function Ft(e){return Bt(e)}function Bt(e,t){zt();const r=(0,n.We)();r.__VUE__=!0;const{insert:o,remove:s,patchProp:a,createElement:l,createText:c,createComment:u,setText:h,setElementText:d,parentNode:p,nextSibling:f,setScopeId:m=n.tE,insertStaticContent:_}=e,g=(e,t,r,i=null,n=null,o=null,s=void 0,a=null,l=!!t.dynamicChildren)=>{if(e===t)return;e&&!sr(e,t)&&(i=J(e),W(e,n,o,!0),e=null),-2===t.patchFlag&&(l=!1,t.dynamicChildren=null);const{type:c,ref:u,shapeFlag:h}=t;switch(c){case Wt:y(e,t,r,i);break;case Ht:x(e,t,r,i);break;case Xt:null==e&&b(t,r,i,s);break;case Zt:O(e,t,r,i,n,o,s,a,l);break;default:1&h?A(e,t,r,i,n,o,s,a,l):6&h?z(e,t,r,i,n,o,s,a,l):(64&h||128&h)&&c.process(e,t,r,i,n,o,s,a,l,te)}null!=u&&n&&Ot(u,e&&e.ref,o,t||e,!t)},y=(e,t,r,i)=>{if(null==e)o(t.el=c(t.children),r,i);else{const r=t.el=e.el;t.children!==e.children&&h(r,t.children)}},x=(e,t,r,i)=>{null==e?o(t.el=u(t.children||""),r,i):t.el=e.el},b=(e,t,r,i)=>{[e.el,e.anchor]=_(e.children,t,r,i,e.el,e.anchor)},T=({el:e,anchor:t},r,i)=>{let n;while(e&&e!==t)n=f(e),o(e,r,i),e=n;o(t,r,i)},M=({el:e,anchor:t})=>{let r;while(e&&e!==t)r=f(e),s(e),e=r;s(t)},A=(e,t,r,i,n,o,s,a,l)=>{"svg"===t.type?s="svg":"math"===t.type&&(s="mathml"),null==e?I(t,r,i,n,o,s,a,l):L(e,t,n,o,s,a,l)},I=(e,t,r,i,s,c,u,h)=>{let p,f;const{props:m,shapeFlag:_,transition:g,dirs:y}=e;if(p=e.el=l(e.type,c,m&&m.is,m),8&_?d(p,e.children):16&_&&P(e.children,p,null,i,s,Nt(e,c),u,h),y&&se(e,null,i,"created"),C(p,e,e.scopeId,u,i),m){for(const t in m)"value"===t||(0,n.SU)(t)||a(p,t,null,m[t],c,e.children,i,s,K);"value"in m&&a(p,"value",null,m.value,c),(f=m.onVnodeBeforeMount)&&vr(f,i,e)}y&&se(e,null,i,"beforeMount");const x=Vt(s,g);x&&g.beforeEnter(p),o(p,t,r),((f=m&&m.onVnodeMounted)||x||y)&&kt((()=>{f&&vr(f,i,e),x&&g.enter(p),y&&se(e,null,i,"mounted")}),s)},C=(e,t,r,i,n)=>{if(r&&m(e,r),i)for(let o=0;o<i.length;o++)m(e,i[o]);if(n){let r=n.subTree;if(t===r){const t=n.vnode;C(e,t,t.scopeId,t.slotScopeIds,n.parent)}}},P=(e,t,r,i,n,o,s,a,l=0)=>{for(let c=l;c<e.length;c++){const l=e[c]=a?gr(e[c]):_r(e[c]);g(null,l,t,r,i,n,o,s,a)}},L=(e,t,r,i,o,s,l)=>{const c=t.el=e.el;let{patchFlag:u,dynamicChildren:h,dirs:p}=t;u|=16&e.patchFlag;const f=e.props||n.MZ,m=t.props||n.MZ;let _;if(r&&Ut(r,!1),(_=m.onVnodeBeforeUpdate)&&vr(_,r,t,e),p&&se(t,e,r,"beforeUpdate"),r&&Ut(r,!0),h?R(e.dynamicChildren,h,c,r,i,Nt(t,o),s):l||j(e,t,c,null,r,i,Nt(t,o),s,!1),u>0){if(16&u)D(c,t,f,m,r,i,o);else if(2&u&&f.class!==m.class&&a(c,"class",null,m.class,o),4&u&&a(c,"style",f.style,m.style,o),8&u){const n=t.dynamicProps;for(let t=0;t<n.length;t++){const s=n[t],l=f[s],u=m[s];u===l&&"value"!==s||a(c,s,l,u,o,e.children,r,i,K)}}1&u&&e.children!==t.children&&d(c,t.children)}else l||null!=h||D(c,t,f,m,r,i,o);((_=m.onVnodeUpdated)||p)&&kt((()=>{_&&vr(_,r,t,e),p&&se(t,e,r,"updated")}),i)},R=(e,t,r,i,n,o,s)=>{for(let a=0;a<t.length;a++){const l=e[a],c=t[a],u=l.el&&(l.type===Zt||!sr(l,c)||70&l.shapeFlag)?p(l.el):r;g(l,c,u,null,i,n,o,s,!0)}},D=(e,t,r,i,o,s,l)=>{if(r!==i){if(r!==n.MZ)for(const c in r)(0,n.SU)(c)||c in i||a(e,c,r[c],null,l,t.children,o,s,K);for(const c in i){if((0,n.SU)(c))continue;const u=i[c],h=r[c];u!==h&&"value"!==c&&a(e,c,h,u,l,t.children,o,s,K)}"value"in i&&a(e,"value",r.value,i.value,l)}},O=(e,t,r,i,n,s,a,l,u)=>{const h=t.el=e?e.el:c(""),d=t.anchor=e?e.anchor:c("");let{patchFlag:p,dynamicChildren:f,slotScopeIds:m}=t;m&&(l=l?l.concat(m):m),null==e?(o(h,r,i),o(d,r,i),P(t.children||[],r,d,n,s,a,l,u)):p>0&&64&p&&f&&e.dynamicChildren?(R(e.dynamicChildren,f,r,n,s,a,l),(null!=t.key||n&&t===n.subTree)&&jt(e,t,!0)):j(e,t,r,d,n,s,a,l,u)},z=(e,t,r,i,n,o,s,a,l)=>{t.slotScopeIds=a,null==e?512&t.shapeFlag?n.ctx.activate(t,r,i,s,l):k(t,r,i,n,o,s,l):F(e,t,l)},k=(e,t,r,i,n,o,s)=>{const a=e.component=Tr(e,i,n);if(we(e)&&(a.ctx.renderer=te),Or(a),a.asyncDep){if(n&&n.registerDep(a,N),!e.el){const e=a.subTree=ur(Ht);x(null,e,t,r)}}else N(a,e,t,r,n,o,s)},F=(e,t,r)=>{const i=t.component=e.component;if(V(e,t,r)){if(i.asyncDep&&!i.asyncResolved)return void U(i,t,r);i.next=t,w(i.update),i.effect.dirty=!0,i.update()}else t.el=e.el,i.vnode=t},N=(e,t,r,o,s,a,l)=>{const c=()=>{if(e.isMounted){let{next:t,bu:r,u:i,parent:o,vnode:u}=e;{const r=$t(e);if(r)return t&&(t.el=u.el,U(e,t,l)),void r.asyncDep.then((()=>{e.isUnmounted||c()}))}let h,d=t;0,Ut(e,!1),t?(t.el=u.el,U(e,t,l)):t=u,r&&(0,n.DY)(r),(h=t.props&&t.props.onVnodeBeforeUpdate)&&vr(h,o,t,u),Ut(e,!0);const f=B(e);0;const m=e.subTree;e.subTree=f,g(m,f,p(m.el),J(m),e,s,a),t.el=f.el,null===d&&G(e,f.el),i&&kt(i,s),(h=t.props&&t.props.onVnodeUpdated)&&kt((()=>vr(h,o,t,u)),s)}else{let i;const{el:l,props:c}=t,{bm:u,m:h,parent:d}=e,p=be(t);if(Ut(e,!1),u&&(0,n.DY)(u),!p&&(i=c&&c.onVnodeBeforeMount)&&vr(i,d,t),Ut(e,!0),l&&ie){const r=()=>{e.subTree=B(e),ie(l,e.subTree,e,s,null)};p?t.type.__asyncLoader().then((()=>!e.isUnmounted&&r())):r()}else{0;const i=e.subTree=B(e);0,g(null,i,r,o,e,s,a),t.el=i.el}if(h&&kt(h,s),!p&&(i=c&&c.onVnodeMounted)){const e=t;kt((()=>vr(i,d,e)),s)}(256&t.shapeFlag||d&&be(d.vnode)&&256&d.vnode.shapeFlag)&&e.a&&kt(e.a,s),e.isMounted=!0,t=r=o=null}},u=e.effect=new i.X2(c,n.tE,(()=>v(h)),e.scope),h=e.update=()=>{u.dirty&&u.run()};h.id=e.uid,Ut(e,!0),h()},U=(e,t,r)=>{t.component=e;const n=e.vnode.props;e.vnode=t,e.next=null,xt(e,t.props,n,r),Dt(e,t.children,r),(0,i.C4)(),E(e),(0,i.bl)()},j=(e,t,r,i,n,o,s,a,l=!1)=>{const c=e&&e.children,u=e?e.shapeFlag:0,h=t.children,{patchFlag:p,shapeFlag:f}=t;if(p>0){if(128&p)return void q(c,h,r,i,n,o,s,a,l);if(256&p)return void $(c,h,r,i,n,o,s,a,l)}8&f?(16&u&&K(c,n,o),h!==c&&d(r,h)):16&u?16&f?q(c,h,r,i,n,o,s,a,l):K(c,n,o,!0):(8&u&&d(r,""),16&f&&P(h,r,i,n,o,s,a,l))},$=(e,t,r,i,o,s,a,l,c)=>{e=e||n.Oj,t=t||n.Oj;const u=e.length,h=t.length,d=Math.min(u,h);let p;for(p=0;p<d;p++){const i=t[p]=c?gr(t[p]):_r(t[p]);g(e[p],i,r,null,o,s,a,l,c)}u>h?K(e,o,s,!0,!1,d):P(t,r,i,o,s,a,l,c,d)},q=(e,t,r,i,o,s,a,l,c)=>{let u=0;const h=t.length;let d=e.length-1,p=h-1;while(u<=d&&u<=p){const i=e[u],n=t[u]=c?gr(t[u]):_r(t[u]);if(!sr(i,n))break;g(i,n,r,null,o,s,a,l,c),u++}while(u<=d&&u<=p){const i=e[d],n=t[p]=c?gr(t[p]):_r(t[p]);if(!sr(i,n))break;g(i,n,r,null,o,s,a,l,c),d--,p--}if(u>d){if(u<=p){const e=p+1,n=e<h?t[e].el:i;while(u<=p)g(null,t[u]=c?gr(t[u]):_r(t[u]),r,n,o,s,a,l,c),u++}}else if(u>p)while(u<=d)W(e[u],o,s,!0),u++;else{const f=u,m=u,_=new Map;for(u=m;u<=p;u++){const e=t[u]=c?gr(t[u]):_r(t[u]);null!=e.key&&_.set(e.key,u)}let y,x=0;const v=p-m+1;let b=!1,w=0;const T=new Array(v);for(u=0;u<v;u++)T[u]=0;for(u=f;u<=d;u++){const i=e[u];if(x>=v){W(i,o,s,!0);continue}let n;if(null!=i.key)n=_.get(i.key);else for(y=m;y<=p;y++)if(0===T[y-m]&&sr(i,t[y])){n=y;break}void 0===n?W(i,o,s,!0):(T[n-m]=u+1,n>=w?w=n:b=!0,g(i,t[n],r,null,o,s,a,l,c),x++)}const E=b?Gt(T):n.Oj;for(y=E.length-1,u=v-1;u>=0;u--){const e=m+u,n=t[e],d=e+1<h?t[e+1].el:i;0===T[u]?g(null,n,r,d,o,s,a,l,c):b&&(y<0||u!==E[y]?Z(n,r,d,2):y--)}}},Z=(e,t,r,i,n=null)=>{const{el:s,type:a,transition:l,children:c,shapeFlag:u}=e;if(6&u)return void Z(e.component.subTree,t,r,i);if(128&u)return void e.suspense.move(t,r,i);if(64&u)return void a.move(e,t,r,te);if(a===Zt){o(s,t,r);for(let e=0;e<c.length;e++)Z(c[e],t,r,i);return void o(e.anchor,t,r)}if(a===Xt)return void T(e,t,r);const h=2!==i&&1&u&&l;if(h)if(0===i)l.beforeEnter(s),o(s,t,r),kt((()=>l.enter(s)),n);else{const{leave:e,delayLeave:i,afterLeave:n}=l,a=()=>o(s,t,r),c=()=>{e(s,(()=>{a(),n&&n()}))};i?i(s,a,c):c()}else o(s,t,r)},W=(e,t,r,i=!1,n=!1)=>{const{type:o,props:s,ref:a,children:l,dynamicChildren:c,shapeFlag:u,patchFlag:h,dirs:d}=e;if(null!=a&&Ot(a,null,r,e,!0),256&u)return void t.ctx.deactivate(e);const p=1&u&&d,f=!be(e);let m;if(f&&(m=s&&s.onVnodeBeforeUnmount)&&vr(m,t,e),6&u)Y(e.component,r,i);else{if(128&u)return void e.suspense.unmount(r,i);p&&se(e,null,t,"beforeUnmount"),64&u?e.type.remove(e,t,r,n,te,i):c&&(o!==Zt||h>0&&64&h)?K(c,t,r,!1,!0):(o===Zt&&384&h||!n&&16&u)&&K(l,t,r),i&&H(e)}(f&&(m=s&&s.onVnodeUnmounted)||p)&&kt((()=>{m&&vr(m,t,e),p&&se(e,null,t,"unmounted")}),r)},H=e=>{const{type:t,el:r,anchor:i,transition:n}=e;if(t===Zt)return void X(r,i);if(t===Xt)return void M(e);const o=()=>{s(r),n&&!n.persisted&&n.afterLeave&&n.afterLeave()};if(1&e.shapeFlag&&n&&!n.persisted){const{leave:t,delayLeave:i}=n,s=()=>t(r,o);i?i(e.el,o,s):s()}else o()},X=(e,t)=>{let r;while(e!==t)r=f(e),s(e),e=r;s(t)},Y=(e,t,r)=>{const{bum:i,scope:o,update:s,subTree:a,um:l}=e;i&&(0,n.DY)(i),o.stop(),s&&(s.active=!1,W(a,e,t,r)),l&&kt(l,t),kt((()=>{e.isUnmounted=!0}),t),t&&t.pendingBranch&&!t.isUnmounted&&e.asyncDep&&!e.asyncResolved&&e.suspenseId===t.pendingId&&(t.deps--,0===t.deps&&t.resolve())},K=(e,t,r,i=!1,n=!1,o=0)=>{for(let s=o;s<e.length;s++)W(e[s],t,r,i,n)},J=e=>6&e.shapeFlag?J(e.component.subTree):128&e.shapeFlag?e.suspense.next():f(e.anchor||e.el);let Q=!1;const ee=(e,t,r)=>{null==e?t._vnode&&W(t._vnode,null,null,!0):g(t._vnode||null,e,t,null,null,null,r),Q||(Q=!0,E(),S(),Q=!1),t._vnode=e},te={p:g,um:W,m:Z,r:H,mt:k,mc:P,pc:j,pbc:R,n:J,o:e};let re,ie;return t&&([re,ie]=t(te)),{render:ee,hydrate:re,createApp:ht(ee,re)}}function Nt({type:e,props:t},r){return"svg"===r&&"foreignObject"===e||"mathml"===r&&"annotation-xml"===e&&t&&t.encoding&&t.encoding.includes("html")?void 0:r}function Ut({effect:e,update:t},r){e.allowRecurse=t.allowRecurse=r}function Vt(e,t){return(!e||e&&!e.pendingBranch)&&t&&!t.persisted}function jt(e,t,r=!1){const i=e.children,o=t.children;if((0,n.cy)(i)&&(0,n.cy)(o))for(let n=0;n<i.length;n++){const e=i[n];let t=o[n];1&t.shapeFlag&&!t.dynamicChildren&&((t.patchFlag<=0||32===t.patchFlag)&&(t=o[n]=gr(o[n]),t.el=e.el),r||jt(e,t)),t.type===Wt&&(t.el=e.el)}}function Gt(e){const t=e.slice(),r=[0];let i,n,o,s,a;const l=e.length;for(i=0;i<l;i++){const l=e[i];if(0!==l){if(n=r[r.length-1],e[n]<l){t[i]=n,r.push(i);continue}o=0,s=r.length-1;while(o<s)a=o+s>>1,e[r[a]]<l?o=a+1:s=a;l<e[r[o]]&&(o>0&&(t[i]=r[o-1]),r[o]=i)}}o=r.length,s=r[o-1];while(o-- >0)r[o]=s,s=t[s];return r}function $t(e){const t=e.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:$t(t)}const qt=e=>e.__isTeleport;const Zt=Symbol.for("v-fgt"),Wt=Symbol.for("v-txt"),Ht=Symbol.for("v-cmt"),Xt=Symbol.for("v-stc"),Yt=[];let Kt=null;function Jt(e=!1){Yt.push(Kt=e?null:[])}function Qt(){Yt.pop(),Kt=Yt[Yt.length-1]||null}let er=1;function tr(e){er+=e}function rr(e){return e.dynamicChildren=er>0?Kt||n.Oj:null,Qt(),er>0&&Kt&&Kt.push(e),e}function ir(e,t,r,i,n,o){return rr(cr(e,t,r,i,n,o,!0))}function nr(e,t,r,i,n){return rr(ur(e,t,r,i,n,!0))}function or(e){return!!e&&!0===e.__v_isVNode}function sr(e,t){return e.type===t.type&&e.key===t.key}const ar=({key:e})=>null!=e?e:null,lr=({ref:e,ref_key:t,ref_for:r})=>("number"===typeof e&&(e=""+e),null!=e?(0,n.Kg)(e)||(0,i.i9)(e)||(0,n.Tn)(e)?{i:R,r:e,k:t,f:!!r}:e:null);function cr(e,t=null,r=null,i=0,o=null,s=(e===Zt?0:1),a=!1,l=!1){const c={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&ar(t),ref:t&&lr(t),scopeId:D,slotScopeIds:null,children:r,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:s,patchFlag:i,dynamicProps:o,dynamicChildren:null,appContext:null,ctx:R};return l?(yr(c,r),128&s&&e.normalize(c)):r&&(c.shapeFlag|=(0,n.Kg)(r)?8:16),er>0&&!a&&Kt&&(c.patchFlag>0||6&s)&&32!==c.patchFlag&&Kt.push(c),c}const ur=hr;function hr(e,t=null,r=null,o=0,s=null,a=!1){if(e&&e!==Z||(e=Ht),or(e)){const i=pr(e,t,!0);return r&&yr(i,r),er>0&&!a&&Kt&&(6&i.shapeFlag?Kt[Kt.indexOf(e)]=i:Kt.push(i)),i.patchFlag|=-2,i}if(jr(e)&&(e=e.__vccOpts),t){t=dr(t);let{class:e,style:r}=t;e&&!(0,n.Kg)(e)&&(t.class=(0,n.C4)(e)),(0,n.Gv)(r)&&((0,i.ju)(r)&&!(0,n.cy)(r)&&(r=(0,n.X$)({},r)),t.style=(0,n.Tr)(r))}const l=(0,n.Kg)(e)?1:X(e)?128:qt(e)?64:(0,n.Gv)(e)?4:(0,n.Tn)(e)?2:0;return cr(e,t,r,o,s,l,a,!0)}function dr(e){return e?(0,i.ju)(e)||gt(e)?(0,n.X$)({},e):e:null}function pr(e,t,r=!1,i=!1){const{props:o,ref:s,patchFlag:a,children:l,transition:c}=e,u=t?xr(o||{},t):o,h={__v_isVNode:!0,__v_skip:!0,type:e.type,props:u,key:u&&ar(u),ref:t&&t.ref?r&&s?(0,n.cy)(s)?s.concat(lr(t)):[s,lr(t)]:lr(t):s,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:l,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==Zt?-1===a?16:16|a:a,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:c,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&pr(e.ssContent),ssFallback:e.ssFallback&&pr(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return c&&i&&(h.transition=c.clone(h)),h}function fr(e=" ",t=0){return ur(Wt,null,e,t)}function mr(e="",t=!1){return t?(Jt(),nr(Ht,null,e)):ur(Ht,null,e)}function _r(e){return null==e||"boolean"===typeof e?ur(Ht):(0,n.cy)(e)?ur(Zt,null,e.slice()):"object"===typeof e?gr(e):ur(Wt,null,String(e))}function gr(e){return null===e.el&&-1!==e.patchFlag||e.memo?e:pr(e)}function yr(e,t){let r=0;const{shapeFlag:i}=e;if(null==t)t=null;else if((0,n.cy)(t))r=16;else if("object"===typeof t){if(65&i){const r=t.default;return void(r&&(r._c&&(r._d=!1),yr(e,r()),r._c&&(r._d=!0)))}{r=32;const i=t._;i||gt(t)?3===i&&R&&(1===R.slots._?t._=1:(t._=2,e.patchFlag|=1024)):t._ctx=R}}else(0,n.Tn)(t)?(t={default:t,_ctx:R},r=32):(t=String(t),64&i?(r=16,t=[fr(t)]):r=8);e.children=t,e.shapeFlag|=r}function xr(...e){const t={};for(let r=0;r<e.length;r++){const i=e[r];for(const e in i)if("class"===e)t.class!==i.class&&(t.class=(0,n.C4)([t.class,i.class]));else if("style"===e)t.style=(0,n.Tr)([t.style,i.style]);else if((0,n.Mp)(e)){const r=t[e],o=i[e];!o||r===o||(0,n.cy)(r)&&r.includes(o)||(t[e]=r?[].concat(r,o):o)}else""!==e&&(t[e]=i[e])}return t}function vr(e,t,r,i=null){s(e,t,7,[r,i])}const br=ct();let wr=0;function Tr(e,t,r){const o=e.type,s=(t?t.appContext:e.appContext)||br,a={uid:wr++,vnode:e,type:o,parent:t,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,scope:new i.yC(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(s.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:wt(o,s),emitsOptions:P(o,s),emit:null,emitted:null,propsDefaults:n.MZ,inheritAttrs:o.inheritAttrs,ctx:n.MZ,data:n.MZ,props:n.MZ,attrs:n.MZ,slots:n.MZ,refs:n.MZ,setupState:n.MZ,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:r,suspenseId:r?r.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return a.ctx={_:a},a.root=t?t.root:a,a.emit=C.bind(null,a),e.ce&&e.ce(a),a}let Er=null;const Sr=()=>Er||R;let Mr,Ar;{const e=(0,n.We)(),t=(t,r)=>{let i;return(i=e[t])||(i=e[t]=[]),i.push(r),e=>{i.length>1?i.forEach((t=>t(e))):i[0](e)}};Mr=t("__VUE_INSTANCE_SETTERS__",(e=>Er=e)),Ar=t("__VUE_SSR_SETTERS__",(e=>Dr=e))}const Ir=e=>{const t=Er;return Mr(e),e.scope.on(),()=>{e.scope.off(),Mr(t)}},Cr=()=>{Er&&Er.scope.off(),Mr(null)};function Pr(e){return 4&e.vnode.shapeFlag}let Lr,Rr,Dr=!1;function Or(e,t=!1){t&&Ar(t);const{props:r,children:i}=e.vnode,n=Pr(e);yt(e,r,n,t),Rt(e,i);const o=n?zr(e,t):void 0;return t&&Ar(!1),o}function zr(e,t){const r=e.type;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,Ze);const{setup:s}=r;if(s){const r=e.setupContext=s.length>1?Nr(e):null,l=Ir(e);(0,i.C4)();const c=o(s,e,0,[e.props,r]);if((0,i.bl)(),l(),(0,n.yL)(c)){if(c.then(Cr,Cr),t)return c.then((r=>{kr(e,r,t)})).catch((t=>{a(t,e,0)}));e.asyncDep=c}else kr(e,c,t)}else Fr(e,t)}function kr(e,t,r){(0,n.Tn)(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:(0,n.Gv)(t)&&(e.setupState=(0,i.Pr)(t)),Fr(e,r)}function Fr(e,t,r){const o=e.type;if(!e.render){if(!t&&Lr&&!o.render){const t=o.template||Qe(e).template;if(t){0;const{isCustomElement:r,compilerOptions:i}=e.appContext.config,{delimiters:s,compilerOptions:a}=o,l=(0,n.X$)((0,n.X$)({isCustomElement:r,delimiters:s},i),a);o.render=Lr(t,l)}}e.render=o.render||n.tE,Rr&&Rr(e)}{const t=Ir(e);(0,i.C4)();try{Xe(e)}finally{(0,i.bl)(),t()}}}const Br={get(e,t){return(0,i.u4)(e,"get",""),e[t]}};function Nr(e){const t=t=>{e.exposed=t||{}};return{attrs:new Proxy(e.attrs,Br),slots:e.slots,emit:e.emit,expose:t}}function Ur(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy((0,i.Pr)((0,i.IG)(e.exposed)),{get(t,r){return r in t?t[r]:r in $e?$e[r](e):void 0},has(e,t){return t in e||t in $e}}))}function Vr(e,t=!0){return(0,n.Tn)(e)?e.displayName||e.name:e.name||t&&e.__name}function jr(e){return(0,n.Tn)(e)&&"__vccOpts"in e}const Gr=(e,t)=>{const r=(0,i.EW)(e,t,Dr);return r};function $r(e,t,r){const i=arguments.length;return 2===i?(0,n.Gv)(t)&&!(0,n.cy)(t)?or(t)?ur(e,null,[t]):ur(e,t):ur(e,null,t):(i>3?r=Array.prototype.slice.call(arguments,2):3===i&&or(r)&&(r=[r]),ur(e,t,r))}const qr="3.4.27"},5130:function(e,t,r){"use strict";r.d(t,{D$:function(){return be},Ef:function(){return Se},Jo:function(){return ye}});r(4114),r(3375),r(9225),r(3972),r(9209),r(5714),r(7561),r(6197);var i=r(6768),n=r(4232),o=r(144);
/**
* @vue/runtime-dom v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/
const s="http://www.w3.org/2000/svg",a="http://www.w3.org/1998/Math/MathML",l="undefined"!==typeof document?document:null,c=l&&l.createElement("template"),u={insert:(e,t,r)=>{t.insertBefore(e,r||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,r,i)=>{const n="svg"===t?l.createElementNS(s,e):"mathml"===t?l.createElementNS(a,e):l.createElement(e,r?{is:r}:void 0);return"select"===e&&i&&null!=i.multiple&&n.setAttribute("multiple",i.multiple),n},createText:e=>l.createTextNode(e),createComment:e=>l.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>l.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,r,i,n,o){const s=r?r.previousSibling:t.lastChild;if(n&&(n===o||n.nextSibling)){while(1)if(t.insertBefore(n.cloneNode(!0),r),n===o||!(n=n.nextSibling))break}else{c.innerHTML="svg"===i?`<svg>${e}</svg>`:"mathml"===i?`<math>${e}</math>`:e;const n=c.content;if("svg"===i||"mathml"===i){const e=n.firstChild;while(e.firstChild)n.appendChild(e.firstChild);n.removeChild(e)}t.insertBefore(n,r)}return[s?s.nextSibling:t.firstChild,r?r.previousSibling:t.lastChild]}},h="transition",d="animation",p=Symbol("_vtc"),f=(e,{slots:t})=>(0,i.h)(i.pR,x(e),t);f.displayName="Transition";const m={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},_=f.props=(0,n.X$)({},i.QP,m),g=(e,t=[])=>{(0,n.cy)(e)?e.forEach((e=>e(...t))):e&&e(...t)},y=e=>!!e&&((0,n.cy)(e)?e.some((e=>e.length>1)):e.length>1);function x(e){const t={};for(const n in e)n in m||(t[n]=e[n]);if(!1===e.css)return t;const{name:r="v",type:i,duration:o,enterFromClass:s=`${r}-enter-from`,enterActiveClass:a=`${r}-enter-active`,enterToClass:l=`${r}-enter-to`,appearFromClass:c=s,appearActiveClass:u=a,appearToClass:h=l,leaveFromClass:d=`${r}-leave-from`,leaveActiveClass:p=`${r}-leave-active`,leaveToClass:f=`${r}-leave-to`}=e,_=v(o),x=_&&_[0],b=_&&_[1],{onBeforeEnter:S,onEnter:A,onEnterCancelled:I,onLeave:C,onLeaveCancelled:L,onBeforeAppear:R=S,onAppear:D=A,onAppearCancelled:O=I}=t,z=(e,t,r)=>{T(e,t?h:l),T(e,t?u:a),r&&r()},k=(e,t)=>{e._isLeaving=!1,T(e,d),T(e,f),T(e,p),t&&t()},F=e=>(t,r)=>{const n=e?D:A,o=()=>z(t,e,r);g(n,[t,o]),E((()=>{T(t,e?c:s),w(t,e?h:l),y(n)||M(t,i,x,o)}))};return(0,n.X$)(t,{onBeforeEnter(e){g(S,[e]),w(e,s),w(e,a)},onBeforeAppear(e){g(R,[e]),w(e,c),w(e,u)},onEnter:F(!1),onAppear:F(!0),onLeave(e,t){e._isLeaving=!0;const r=()=>k(e,t);w(e,d),w(e,p),P(),E((()=>{e._isLeaving&&(T(e,d),w(e,f),y(C)||M(e,i,b,r))})),g(C,[e,r])},onEnterCancelled(e){z(e,!1),g(I,[e])},onAppearCancelled(e){z(e,!0),g(O,[e])},onLeaveCancelled(e){k(e),g(L,[e])}})}function v(e){if(null==e)return null;if((0,n.Gv)(e))return[b(e.enter),b(e.leave)];{const t=b(e);return[t,t]}}function b(e){const t=(0,n.Ro)(e);return t}function w(e,t){t.split(/\s+/).forEach((t=>t&&e.classList.add(t))),(e[p]||(e[p]=new Set)).add(t)}function T(e,t){t.split(/\s+/).forEach((t=>t&&e.classList.remove(t)));const r=e[p];r&&(r.delete(t),r.size||(e[p]=void 0))}function E(e){requestAnimationFrame((()=>{requestAnimationFrame(e)}))}let S=0;function M(e,t,r,i){const n=e._endId=++S,o=()=>{n===e._endId&&i()};if(r)return setTimeout(o,r);const{type:s,timeout:a,propCount:l}=A(e,t);if(!s)return i();const c=s+"end";let u=0;const h=()=>{e.removeEventListener(c,d),o()},d=t=>{t.target===e&&++u>=l&&h()};setTimeout((()=>{u<l&&h()}),a+1),e.addEventListener(c,d)}function A(e,t){const r=window.getComputedStyle(e),i=e=>(r[e]||"").split(", "),n=i(`${h}Delay`),o=i(`${h}Duration`),s=I(n,o),a=i(`${d}Delay`),l=i(`${d}Duration`),c=I(a,l);let u=null,p=0,f=0;t===h?s>0&&(u=h,p=s,f=o.length):t===d?c>0&&(u=d,p=c,f=l.length):(p=Math.max(s,c),u=p>0?s>c?h:d:null,f=u?u===h?o.length:l.length:0);const m=u===h&&/\b(transform|all)(,|$)/.test(i(`${h}Property`).toString());return{type:u,timeout:p,propCount:f,hasTransform:m}}function I(e,t){while(e.length<t.length)e=e.concat(e);return Math.max(...t.map(((t,r)=>C(t)+C(e[r]))))}function C(e){return"auto"===e?0:1e3*Number(e.slice(0,-1).replace(",","."))}function P(){return document.body.offsetHeight}function L(e,t,r){const i=e[p];i&&(t=(t?[t,...i]:[...i]).join(" ")),null==t?e.removeAttribute("class"):r?e.setAttribute("class",t):e.className=t}const R=Symbol("_vod"),D=Symbol("_vsh");const O=Symbol("");const z=/(^|;)\s*display\s*:/;function k(e,t,r){const i=e.style,o=(0,n.Kg)(r);let s=!1;if(r&&!o){if(t)if((0,n.Kg)(t))for(const e of t.split(";")){const t=e.slice(0,e.indexOf(":")).trim();null==r[t]&&B(i,t,"")}else for(const e in t)null==r[e]&&B(i,e,"");for(const e in r)"display"===e&&(s=!0),B(i,e,r[e])}else if(o){if(t!==r){const e=i[O];e&&(r+=";"+e),i.cssText=r,s=z.test(r)}}else t&&e.removeAttribute("style");R in e&&(e[R]=s?i.display:"",e[D]&&(i.display="none"))}const F=/\s*!important$/;function B(e,t,r){if((0,n.cy)(r))r.forEach((r=>B(e,t,r)));else if(null==r&&(r=""),t.startsWith("--"))e.setProperty(t,r);else{const i=V(e,t);F.test(r)?e.setProperty((0,n.Tg)(i),r.replace(F,""),"important"):e[i]=r}}const N=["Webkit","Moz","ms"],U={};function V(e,t){const r=U[t];if(r)return r;let i=(0,n.PT)(t);if("filter"!==i&&i in e)return U[t]=i;i=(0,n.ZH)(i);for(let n=0;n<N.length;n++){const r=N[n]+i;if(r in e)return U[t]=r}return t}const j="http://www.w3.org/1999/xlink";function G(e,t,r,i,o){if(i&&t.startsWith("xlink:"))null==r?e.removeAttributeNS(j,t.slice(6,t.length)):e.setAttributeNS(j,t,r);else{const i=(0,n.J$)(t);null==r||i&&!(0,n.Y2)(r)?e.removeAttribute(t):e.setAttribute(t,i?"":r)}}function $(e,t,r,i,o,s,a){if("innerHTML"===t||"textContent"===t)return i&&a(i,o,s),void(e[t]=null==r?"":r);const l=e.tagName;if("value"===t&&"PROGRESS"!==l&&!l.includes("-")){const i="OPTION"===l?e.getAttribute("value")||"":e.value,n=null==r?"":r;return i===n&&"_value"in e||(e.value=n),null==r&&e.removeAttribute(t),void(e._value=r)}let c=!1;if(""===r||null==r){const i=typeof e[t];"boolean"===i?r=(0,n.Y2)(r):null==r&&"string"===i?(r="",c=!0):"number"===i&&(r=0,c=!0)}try{e[t]=r}catch(u){0}c&&e.removeAttribute(t)}function q(e,t,r,i){e.addEventListener(t,r,i)}function Z(e,t,r,i){e.removeEventListener(t,r,i)}const W=Symbol("_vei");function H(e,t,r,i,n=null){const o=e[W]||(e[W]={}),s=o[t];if(i&&s)s.value=i;else{const[r,a]=Y(t);if(i){const s=o[t]=ee(i,n);q(e,r,s,a)}else s&&(Z(e,r,s,a),o[t]=void 0)}}const X=/(?:Once|Passive|Capture)$/;function Y(e){let t;if(X.test(e)){let r;t={};while(r=e.match(X))e=e.slice(0,e.length-r[0].length),t[r[0].toLowerCase()]=!0}const r=":"===e[2]?e.slice(3):(0,n.Tg)(e.slice(2));return[r,t]}let K=0;const J=Promise.resolve(),Q=()=>K||(J.then((()=>K=0)),K=Date.now());function ee(e,t){const r=e=>{if(e._vts){if(e._vts<=r.attached)return}else e._vts=Date.now();(0,i.qL)(te(e,r.value),t,5,[e])};return r.value=e,r.attached=Q(),r}function te(e,t){if((0,n.cy)(t)){const r=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{r.call(e),e._stopped=!0},t.map((e=>t=>!t._stopped&&e&&e(t)))}return t}const re=e=>111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,ie=(e,t,r,i,o,s,a,l,c)=>{const u="svg"===o;"class"===t?L(e,i,u):"style"===t?k(e,r,i):(0,n.Mp)(t)?(0,n.CP)(t)||H(e,t,r,i,a):("."===t[0]?(t=t.slice(1),1):"^"===t[0]?(t=t.slice(1),0):ne(e,t,i,u))?$(e,t,i,s,a,l,c):("true-value"===t?e._trueValue=i:"false-value"===t&&(e._falseValue=i),G(e,t,i,u))};function ne(e,t,r,i){if(i)return"innerHTML"===t||"textContent"===t||!!(t in e&&re(t)&&(0,n.Tn)(r));if("spellcheck"===t||"draggable"===t||"translate"===t)return!1;if("form"===t)return!1;if("list"===t&&"INPUT"===e.tagName)return!1;if("type"===t&&"TEXTAREA"===e.tagName)return!1;if("width"===t||"height"===t){const t=e.tagName;if("IMG"===t||"VIDEO"===t||"CANVAS"===t||"SOURCE"===t)return!1}return(!re(t)||!(0,n.Kg)(r))&&t in e}
/*! #__NO_SIDE_EFFECTS__ */
/*! #__NO_SIDE_EFFECTS__ */
"undefined"!==typeof HTMLElement&&HTMLElement;const oe=new WeakMap,se=new WeakMap,ae=Symbol("_moveCb"),le=Symbol("_enterCb"),ce={name:"TransitionGroup",props:(0,n.X$)({},_,{tag:String,moveClass:String}),setup(e,{slots:t}){const r=(0,i.nI)(),n=(0,i.Gy)();let s,a;return(0,i.$u)((()=>{if(!s.length)return;const t=e.moveClass||`${e.name||"v"}-move`;if(!pe(s[0].el,r.vnode.el,t))return;s.forEach(ue),s.forEach(he);const i=s.filter(de);P(),i.forEach((e=>{const r=e.el,i=r.style;w(r,t),i.transform=i.webkitTransform=i.transitionDuration="";const n=r[ae]=e=>{e&&e.target!==r||e&&!/transform$/.test(e.propertyName)||(r.removeEventListener("transitionend",n),r[ae]=null,T(r,t))};r.addEventListener("transitionend",n)}))})),()=>{const l=(0,o.ux)(e),c=x(l);let u=l.tag||i.FK;if(s=[],a)for(let e=0;e<a.length;e++){const t=a[e];t.el&&t.el instanceof Element&&(s.push(t),(0,i.MZ)(t,(0,i.OW)(t,c,n,r)),oe.set(t,t.el.getBoundingClientRect()))}a=t.default?(0,i.Df)(t.default()):[];for(let e=0;e<a.length;e++){const t=a[e];null!=t.key&&(0,i.MZ)(t,(0,i.OW)(t,c,n,r))}return(0,i.bF)(u,null,a)}}};ce.props;function ue(e){const t=e.el;t[ae]&&t[ae](),t[le]&&t[le]()}function he(e){se.set(e,e.el.getBoundingClientRect())}function de(e){const t=oe.get(e),r=se.get(e),i=t.left-r.left,n=t.top-r.top;if(i||n){const t=e.el.style;return t.transform=t.webkitTransform=`translate(${i}px,${n}px)`,t.transitionDuration="0s",e}}function pe(e,t,r){const i=e.cloneNode(),n=e[p];n&&n.forEach((e=>{e.split(/\s+/).forEach((e=>e&&i.classList.remove(e)))})),r.split(/\s+/).forEach((e=>e&&i.classList.add(e))),i.style.display="none";const o=1===t.nodeType?t:t.parentNode;o.appendChild(i);const{hasTransform:s}=A(i);return o.removeChild(i),s}const fe=e=>{const t=e.props["onUpdate:modelValue"]||!1;return(0,n.cy)(t)?e=>(0,n.DY)(t,e):t};function me(e){e.target.composing=!0}function _e(e){const t=e.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}const ge=Symbol("_assign"),ye={created(e,{modifiers:{lazy:t,trim:r,number:i}},o){e[ge]=fe(o);const s=i||o.props&&"number"===o.props.type;q(e,t?"change":"input",(t=>{if(t.target.composing)return;let i=e.value;r&&(i=i.trim()),s&&(i=(0,n.bB)(i)),e[ge](i)})),r&&q(e,"change",(()=>{e.value=e.value.trim()})),t||(q(e,"compositionstart",me),q(e,"compositionend",_e),q(e,"change",_e))},mounted(e,{value:t}){e.value=null==t?"":t},beforeUpdate(e,{value:t,modifiers:{lazy:r,trim:i,number:o}},s){if(e[ge]=fe(s),e.composing)return;const a=!o&&"number"!==e.type||/^0\d/.test(e.value)?e.value:(0,n.bB)(e.value),l=null==t?"":t;if(a!==l){if(document.activeElement===e&&"range"!==e.type){if(r)return;if(i&&e.value.trim()===l)return}e.value=l}}};const xe=["ctrl","shift","alt","meta"],ve={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&0!==e.button,middle:e=>"button"in e&&1!==e.button,right:e=>"button"in e&&2!==e.button,exact:(e,t)=>xe.some((r=>e[`${r}Key`]&&!t.includes(r)))},be=(e,t)=>{const r=e._withMods||(e._withMods={}),i=t.join(".");return r[i]||(r[i]=(r,...i)=>{for(let e=0;e<t.length;e++){const i=ve[t[e]];if(i&&i(r,t))return}return e(r,...i)})},we=(0,n.X$)({patchProp:ie},u);let Te;function Ee(){return Te||(Te=(0,i.K9)(we))}const Se=(...e)=>{const t=Ee().createApp(...e);const{mount:r}=t;return t.mount=e=>{const i=Ae(e);if(!i)return;const o=t._component;(0,n.Tn)(o)||o.render||o.template||(o.template=i.innerHTML),i.innerHTML="";const s=r(i,!1,Me(i));return i instanceof Element&&(i.removeAttribute("v-cloak"),i.setAttribute("data-v-app","")),s},t};function Me(e){return e instanceof SVGElement?"svg":"function"===typeof MathMLElement&&e instanceof MathMLElement?"mathml":void 0}function Ae(e){if((0,n.Kg)(e)){const t=document.querySelector(e);return t}return e}},4232:function(e,t,r){"use strict";r.d(t,{$3:function(){return p},$H:function(){return F},BH:function(){return q},BX:function(){return re},Bm:function(){return b},C4:function(){return K},CE:function(){return m},CP:function(){return c},DY:function(){return B},Gv:function(){return w},J$:function(){return Q},Kg:function(){return v},MZ:function(){return n},Mp:function(){return l},NO:function(){return a},Oj:function(){return o},PT:function(){return R},Qd:function(){return A},Ro:function(){return V},SU:function(){return C},TF:function(){return h},Tg:function(){return O},Tn:function(){return x},Tr:function(){return Z},We:function(){return G},X$:function(){return u},Y2:function(){return ee},ZH:function(){return z},Zf:function(){return M},bB:function(){return U},cy:function(){return f},gd:function(){return y},pD:function(){return i},rU:function(){return k},tE:function(){return s},u3:function(){return ie},vM:function(){return _},v_:function(){return ne},yI:function(){return I},yL:function(){return T},yQ:function(){return N}});r(4114),r(3375),r(9225),r(3972),r(9209),r(5714),r(7561),r(6197);
/**
* @vue/shared v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/
/*! #__NO_SIDE_EFFECTS__ */
function i(e,t){const r=new Set(e.split(","));return t?e=>r.has(e.toLowerCase()):e=>r.has(e)}const n={},o=[],s=()=>{},a=()=>!1,l=e=>111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),c=e=>e.startsWith("onUpdate:"),u=Object.assign,h=(e,t)=>{const r=e.indexOf(t);r>-1&&e.splice(r,1)},d=Object.prototype.hasOwnProperty,p=(e,t)=>d.call(e,t),f=Array.isArray,m=e=>"[object Map]"===S(e),_=e=>"[object Set]"===S(e),g=e=>"[object Date]"===S(e),y=e=>"[object RegExp]"===S(e),x=e=>"function"===typeof e,v=e=>"string"===typeof e,b=e=>"symbol"===typeof e,w=e=>null!==e&&"object"===typeof e,T=e=>(w(e)||x(e))&&x(e.then)&&x(e.catch),E=Object.prototype.toString,S=e=>E.call(e),M=e=>S(e).slice(8,-1),A=e=>"[object Object]"===S(e),I=e=>v(e)&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e,C=i(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),P=e=>{const t=Object.create(null);return r=>{const i=t[r];return i||(t[r]=e(r))}},L=/-(\w)/g,R=P((e=>e.replace(L,((e,t)=>t?t.toUpperCase():"")))),D=/\B([A-Z])/g,O=P((e=>e.replace(D,"-$1").toLowerCase())),z=P((e=>e.charAt(0).toUpperCase()+e.slice(1))),k=P((e=>{const t=e?`on${z(e)}`:"";return t})),F=(e,t)=>!Object.is(e,t),B=(e,t)=>{for(let r=0;r<e.length;r++)e[r](t)},N=(e,t,r,i=!1)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:i,value:r})},U=e=>{const t=parseFloat(e);return isNaN(t)?e:t},V=e=>{const t=v(e)?Number(e):NaN;return isNaN(t)?e:t};let j;const G=()=>j||(j="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:"undefined"!==typeof r.g?r.g:{});const $="Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt,console,Error",q=i($);function Z(e){if(f(e)){const t={};for(let r=0;r<e.length;r++){const i=e[r],n=v(i)?Y(i):Z(i);if(n)for(const e in n)t[e]=n[e]}return t}if(v(e)||w(e))return e}const W=/;(?![^(]*\))/g,H=/:([^]+)/,X=/\/\*[^]*?\*\//g;function Y(e){const t={};return e.replace(X,"").split(W).forEach((e=>{if(e){const r=e.split(H);r.length>1&&(t[r[0].trim()]=r[1].trim())}})),t}function K(e){let t="";if(v(e))t=e;else if(f(e))for(let r=0;r<e.length;r++){const i=K(e[r]);i&&(t+=i+" ")}else if(w(e))for(const r in e)e[r]&&(t+=r+" ");return t.trim()}const J="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Q=i(J);function ee(e){return!!e||""===e}function te(e,t){if(e.length!==t.length)return!1;let r=!0;for(let i=0;r&&i<e.length;i++)r=re(e[i],t[i]);return r}function re(e,t){if(e===t)return!0;let r=g(e),i=g(t);if(r||i)return!(!r||!i)&&e.getTime()===t.getTime();if(r=b(e),i=b(t),r||i)return e===t;if(r=f(e),i=f(t),r||i)return!(!r||!i)&&te(e,t);if(r=w(e),i=w(t),r||i){if(!r||!i)return!1;const n=Object.keys(e).length,o=Object.keys(t).length;if(n!==o)return!1;for(const r in e){const i=e.hasOwnProperty(r),n=t.hasOwnProperty(r);if(i&&!n||!i&&n||!re(e[r],t[r]))return!1}}return String(e)===String(t)}function ie(e,t){return e.findIndex((e=>re(e,t)))}const ne=e=>v(e)?e:null==e?"":f(e)||w(e)&&(e.toString===E||!x(e.toString))?JSON.stringify(e,oe,2):String(e),oe=(e,t)=>t&&t.__v_isRef?oe(e,t.value):m(t)?{[`Map(${t.size})`]:[...t.entries()].reduce(((e,[t,r],i)=>(e[se(t,i)+" =>"]=r,e)),{})}:_(t)?{[`Set(${t.size})`]:[...t.values()].map((e=>se(e)))}:b(t)?se(t):!w(t)||f(t)||A(t)?t:String(t),se=(e,t="")=>{var r;return b(e)?`Symbol(${null!=(r=e.description)?r:t})`:e}},2693:function(e,t,r){r(4114),r(6573),r(8100),r(7936),r(9479),r(7467),r(4732),r(9577),r(3375),r(9225),r(3972),r(9209),r(5714),r(7561),r(6197),r(4979),r(4603),r(7566),r(8721),function(t,r){e.exports=r()}(0,(function(){"use strict";var e,t,r;function i(i,n){if(e)if(t){var o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",s={};e(s),r=n(s),"undefined"!==typeof window&&window&&window.URL&&window.URL.createObjectURL&&(r.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else t=n;else e=n}i(["exports"],(function(e){var t="3.3.0";let r;const i={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==r){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{r=null!={NODE_ENV:"production",BASE_URL:"/"}.API_URL_REGEX?new RegExp({NODE_ENV:"production",BASE_URL:"/"}.API_URL_REGEX):e}catch(t){r=e}}return r},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!i.API_URL)return null;try{const e=new URL(i.API_URL);return"api.mapbox.cn"===e.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===e.hostname?"https://events.mapbox.com/events/v2":null}catch(e){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function n(e){return i.API_URL_REGEX.test(e)}function o(e){return 0===e.indexOf("mapbox:")}function s(e){return i.API_CDN_URL_REGEX.test(e)}function a(e){return i.API_SPRITE_REGEX.test(e)}function l(e){return i.API_STYLE_REGEX.test(e)&&!a(e)}const c={create:"create",load:"load",fullLoad:"fullLoad"};function u(e){const t=e.name.split("?")[0];return s(t)&&t.includes("mapbox-gl.js")?"javascript":s(t)&&t.includes("mapbox-gl.css")?"css":function(e){return i.API_FONTS_REGEX.test(e)}(t)?"fontRange":a(t)?"sprite":l(t)?"style":function(e){return i.API_TILEJSON_REGEX.test(e)}(t)?"tilejson":"other"}function h(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var d=p;function p(e,t,r,i){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=r,this.p2y=i}p.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var r=e,i=0;i<8;i++){var n=this.sampleCurveX(r)-e;if(Math.abs(n)<t)return r;var o=this.sampleCurveDerivativeX(r);if(Math.abs(o)<1e-6)break;r-=n/o}var s=0,a=1;for(r=e,i=0;i<20&&(n=this.sampleCurveX(r),!(Math.abs(n-e)<t));i++)e>n?s=r:a=r,r=.5*(a-s)+s;return r},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var f=h(d),m=_;function _(e,t){this.x=e,this.y=t}_.prototype={clone:function(){return new _(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),i=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=i,this},_rotateAround:function(e,t){var r=Math.cos(e),i=Math.sin(e),n=t.y+i*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-i*(this.y-t.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},_.convert=function(e){return e instanceof _?e:Array.isArray(e)?new _(e[0],e[1]):e};var g=h(m);const y=Math.PI/180,x=180/Math.PI;function v(e){return e*y}function b(e){return e*x}const w=[[0,0],[1,0],[1,1],[0,1]];function T(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,r=t*e;return 4*(e<.5?r:3*(e-t)+r-.75)}function E(e,t,r,i){const n=new f(e,t,r,i);return function(e){return n.solve(e)}}const S=E(.25,.1,.25,1);function M(e,t,r){return Math.min(r,Math.max(t,e))}function A(e,t,r){return(r=M((r-e)/(t-e),0,1))*r*(3-2*r)}function I(e,t,r){const i=r-t,n=((e-t)%i+i)%i+t;return n===t?r:n}function C(e,t,r){if(!e.length)return r(null,[]);let i=e.length;const n=new Array(e.length);let o=null;e.forEach(((e,s)=>{t(e,((e,t)=>{e&&(o=e),n[s]=t,0==--i&&r(o,n)}))}))}function P(e,...t){for(const r of t)for(const t in r)e[t]=r[t];return e}let L=1;function R(){return L++}function D(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function O(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function z(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function k(e,t){e.forEach((e=>{t[e]&&(t[e]=t[e].bind(t))}))}function F(e,t){return-1!==e.indexOf(t,e.length-t.length)}function B(e,t,r){const i={};for(const n in e)i[n]=t.call(r||this,e[n],n,e);return i}function N(e,t,r){const i={};for(const n in e)t.call(r||this,e[n],n,e)&&(i[n]=e[n]);return i}function U(e){return Array.isArray(e)?e.map(U):"object"==typeof e&&e?B(e,U):e}const V={};function j(e){V[e]||("undefined"!=typeof console&&console.warn(e),V[e]=!0)}function G(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function $(e){let t=0;for(let r,i,n=0,o=e.length,s=o-1;n<o;s=n++)r=e[n],i=e[s],t+=(i.x-r.x)*(r.y+i.y);return t}function q([e,t,r]){const i=v(t+90),n=v(r);return{x:e*Math.cos(i)*Math.sin(n),y:e*Math.sin(i)*Math.sin(n),z:e*Math.cos(n),azimuthal:t,polar:r}}function Z(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function W(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,r,i,n)=>{const o=i||n;return t[r]=!o||o.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let H,X,Y,K,J,Q,ee=null;function te(e){try{const t=self[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}}function re(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function ie(e,t,r,i){for(;t<r;){const n=t+r>>1;e[n]<i?t=n+1:r=n}return t}function ne(e,t,r,i){for(;t<r;){const n=t+r>>1;e[n]<=i?t=n+1:r=n}return t}function oe(){return null==H&&(H=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),H}const se={now:()=>void 0!==K?K:performance.now(),setNow(e){K=e},restoreNow(){K=void 0},frame(e){const t=requestAnimationFrame(e);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(e,t=0){const{width:r,height:i}=e;J||(J=document.createElement("canvas"));const n=J.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return(r>J.width||i>J.height)&&(J.width=r,J.height=i),n.clearRect(-t,-t,r+2*t,i+2*t),n.drawImage(e,0,0,r,i),n.getImageData(-t,-t,r+2*t,i+2*t)},resolveURL:e=>(X||(X=document.createElement("a")),X.href=e,X.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==Y&&(Y=window.matchMedia("(prefers-reduced-motion: reduce)")),Y.matches)},hasCanvasFingerprintNoise(){if(void 0!==Q)return Q;if(!oe())return Q=!1,!1;const e=new OffscreenCanvas(85,1),t=e.getContext("2d",{willReadFrequently:!0});let r=0;for(let n=0;n<e.width;++n)t.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,t.fillRect(n,0,1,1);const i=t.getImageData(0,0,e.width,e.height);r=0;for(let n=0;n<i.data.length;++n)if(n%4!=3&&r++!==i.data[n])return Q=!0,!0;return Q=!1,!1}},ae="mapbox-tiles";let le,ce,ue=500,he=50;function de(){try{return caches}catch(e){}}function pe(){const e=de();e&&!le&&(le=e.open(ae))}function fe(e){const t=e.indexOf("?");if(t<0)return e;const r=["language","worldview"],i=new URLSearchParams,n=new URLSearchParams(e.slice(t));for(const o of r){const e=n.get(o);e&&i.set(o,e)}return`${e.slice(0,t)}?${i.toString()}`}function me(e,t){const r=e.indexOf("?");if(r<0)return`${e}?${new URLSearchParams(t).toString()}`;const i=new URLSearchParams(e.slice(r));for(const n in t)i.set(n,t[n]);return`${e.slice(0,r)}?${i.toString()}`}let _e=1/0;const ge={supported:!1,testSupport:function(e){!ve&&xe&&(be?Te(e):ye=e)}};let ye,xe,ve=!1,be=!1;const we="undefined"!=typeof self?self:{};function Te(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,xe),e.isContextLost())return;ge.supported=!0}catch(e){}e.deleteTexture(t),ve=!0}we.document&&(xe=we.document.createElement("img"),xe.onload=function(){ye&&Te(ye),ye=null,be=!0},xe.onerror=function(){ve=!0,ye=null},xe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ee={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Ee);class Se extends Error{constructor(e,t,r){401===t&&n(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Me=Z()?()=>self.worker&&self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,Ae=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(Me())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(e,t){const r=new AbortController,i=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:Me(),referrerPolicy:e.referrerPolicy,signal:r.signal});let o=!1,s=!1;const a=(l=i.url).indexOf("sku=")>0&&n(l);var l;"json"===e.type&&i.headers.set("Accept","application/json");const c=(r,n,o)=>{if(s)return;if(r&&"SecurityError"!==r.message&&j(r.toString()),n&&o)return u(n);const l=Date.now();fetch(i).then((r=>{if(r.ok){const e=a?r.clone():null;return u(r,e,l)}return t(new Se(r.statusText,r.status,e.url))})).catch((r=>{"AbortError"!==r.name&&t(new Error(`${r.message} ${e.url}`))}))},u=(r,n,a)=>{("arrayBuffer"===e.type?r.arrayBuffer():"json"===e.type?r.json():r.text()).then((e=>{s||(n&&a&&function(e,t,r){if(pe(),!le)return;const i=W(t.headers.get("Cache-Control")||"");if(i["no-store"])return;const n={status:t.status,statusText:t.statusText,headers:new Headers};t.headers.forEach(((e,t)=>n.headers.set(t,e))),i["max-age"]&&n.headers.set("Expires",new Date(r+1e3*i["max-age"]).toUTCString());const o=n.headers.get("Expires");if(!o)return;if(new Date(o).getTime()-r<42e4)return;let s=fe(e.url);if(206===t.status){const t=e.headers.get("Range");if(!t)return;n.status=200,s=me(s,{range:t})}!function(e,t){if(void 0===ce)try{new Response(new ReadableStream),ce=!0}catch(e){ce=!1}ce?t(e.body):e.blob().then(t)}(t,(e=>{const t=new Response(e,n);pe(),le&&le.then((e=>e.put(s,t))).catch((e=>j(e.message)))}))}(i,n,a),o=!0,t(null,e,r.headers.get("Cache-Control"),r.headers.get("Expires")))})).catch((e=>{s||t(new Error(e.message))}))};return a?function(e,t){if(pe(),!le)return t(null);le.then((r=>{let i=fe(e.url);const n=e.headers.get("Range");n&&(i=me(i,{range:n})),r.match(i).then((e=>{const n=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),r=W(e.headers.get("Cache-Control")||"");return t>Date.now()&&!r["no-cache"]}(e);r.delete(i),n&&r.put(i,e.clone()),t(null,e,n)})).catch(t)})).catch(t)}(i,c):c(null,null),{cancel:()=>{s=!0,o||r.abort()}}}(e,t);if(Z()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(e,t){const r=new XMLHttpRequest;r.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(r.responseType="arraybuffer");for(const i in e.headers)r.setRequestHeader(i,e.headers[i]);return"json"===e.type&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials="include"===e.credentials,r.onerror=()=>{t(new Error(r.statusText))},r.onload=()=>{if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){let i=r.response;if("json"===e.type)try{i=JSON.parse(r.response)}catch(e){return t(e)}t(null,i,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"))}else t(new Se(r.statusText,r.status,e.url))},r.send(e.body),{cancel:()=>r.abort()}}(e,t)},Ie=function(e,t){return Ae(P(e,{type:"arrayBuffer"}),t)};function Ce(e){const t=document.createElement("a");return t.href=e,t.protocol===location.protocol&&t.host===location.host}const Pe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Le,Re;Le=[],Re=0;const De=function(e,t){if(ge.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Re>=i.MAX_PARALLEL_IMAGE_REQUESTS){const r={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Le.push(r),r}Re++;let r=!1;const n=()=>{if(!r)for(r=!0,Re--;Le.length&&Re<i.MAX_PARALLEL_IMAGE_REQUESTS;){const e=Le.shift(),{requestParameters:t,callback:r,cancelled:i}=e;i||(e.cancel=De(t,r).cancel)}},o=Ie(e,((e,r,i,o)=>{n(),e?t(e):r&&(self.createImageBitmap?function(e,t){const r=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(r).then((e=>{t(null,e)})).catch((e=>{t(new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(r,((e,r)=>t(e,r,i,o))):function(e,t){const r=new Image;r.onload=()=>{t(null,r),URL.revokeObjectURL(r.src),r.onload=null,requestAnimationFrame((()=>{r.src=Pe}))},r.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const i=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?URL.createObjectURL(i):Pe}(r,((e,r)=>t(e,r,i,o))))}));return{cancel:()=>{o.cancel(),n()}}},Oe="01",ze="NO_ACCESS_TOKEN",ke=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Fe(e){const t=e.match(ke);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Be(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}const Ne="mapbox.eventData";function Ue(e){if(!e)return null;const t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(atob(t[1]).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(e){return null}}class Ve{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const t=Ue(i.ACCESS_TOKEN);let r="";return r=t&&t.u?btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode(Number("0x"+t))))):i.ACCESS_TOKEN||"",e?`${Ne}.${e}:${r}`:`${Ne}:${r}`}fetchEventData(){const e=te("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{const e=localStorage.getItem(t);e&&(this.eventData=JSON.parse(e));const i=localStorage.getItem(r);i&&(this.anonId=i)}catch(e){j("Unable to read from LocalStorage")}}saveEventData(){const e=te("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid"),i=this.anonId;if(e&&i)try{localStorage.setItem(r,i),Object.keys(this.eventData).length>=1&&localStorage.setItem(t,JSON.stringify(this.eventData))}catch(e){j("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,r,n){if(!i.EVENTS_URL)return;const o=Fe(i.EVENTS_URL);o.params.push(`access_token=${n||i.ACCESS_TOKEN||""}`);const s={event:this.type,created:new Date(e).toISOString()},a=t?P(s,t):s,l={url:Be(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=function(e,t){return Ae(P(e,{method:"POST"}),t)}(l,(e=>{this.pendingRequest=null,r(e),this.saveEventData(),this.processRequests(n)}))}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const je=new class extends Ve{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){i.EVENTS_URL&&i.ACCESS_TOKEN&&Array.isArray(e)&&e.some((e=>o(e)||n(e)))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=Ue(i.ACCESS_TOKEN),n=r?r.u:i.ACCESS_TOKEN;let o=n!==this.eventData.tokenU;z(this.anonId)||(this.anonId=D(),o=!0);const s=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(s),r=(s-this.eventData.lastSuccess)/864e5;o=o||r>=1||r<-1||e.getDate()!==t.getDate()}else o=!0;o?this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:Oe,"enabled.telemetry":!1,userId:this.anonId},(e=>{e||(this.eventData.lastSuccess=s,this.eventData.tokenU=n)}),e):this.processRequests()}},Ge=je.postTurnstileEvent.bind(je),$e=new class extends Ve{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,r,n){this.skuToken=t,this.errorCb=n,i.EVENTS_URL&&(r||i.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},r):this.errorCb(new Error(ze)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:i}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),z(this.anonId)||(this.anonId=D()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:Oe,skuToken:this.skuToken,userId:this.anonId},(e=>{e?this.errorCb(e):r&&(this.success[r]=!0)}),e))}remove(){this.errorCb=null}},qe=$e.postMapLoadEvent.bind($e),Ze=new class extends Ve{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){i.EVENTS_URL&&(e||i.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:r,performanceData:i}=this.queue.shift(),n=function(e){const r=performance.getEntriesByType("resource"),i=performance.getEntriesByType("mark"),n=function(e){const t={};if(e)for(const r in e)if("other"!==r)for(const i of e[r]){const e=`${r}ResolveRangeMin`,n=`${r}ResolveRangeMax`,o=`${r}RequestCount`,s=`${r}RequestCachedCount`;t[e]=Math.min(t[e]||1/0,i.startTime),t[n]=Math.max(t[n]||-1/0,i.responseEnd);const a=e=>{void 0===t[e]&&(t[e]=0),++t[e]};void 0!==i.transferSize&&0===i.transferSize&&a(s),a(o)}return t}(function(e,t){const r={};if(e)for(const i of e){const e=t(i);void 0===r[e]&&(r[e]=[]),r[e].push(i)}return r}(r,u)),o=window.devicePixelRatio,s=navigator.connection||navigator.mozConnection||navigator.webkitConnection,a=s?s.effectiveType:void 0,h={counters:[],metadata:[],attributes:[]},d=(e,t,r)=>{null!=r&&e.push({name:t,value:r.toString()})};for(const t in n)d(h.counters,t,n[t]);if(e.interactionRange[0]!==1/0&&e.interactionRange[1]!==-1/0&&(d(h.counters,"interactionRangeMin",e.interactionRange[0]),d(h.counters,"interactionRangeMax",e.interactionRange[1])),i)for(const t of Object.keys(c)){const e=c[t],r=i.find((t=>t.name===e));r&&d(h.counters,e,r.startTime)}return d(h.counters,"visibilityHidden",e.visibilityHidden),d(h.attributes,"style",function(e){if(e)for(const t of e){const e=t.name.split("?")[0];if(l(e)){const t=e.split("/").slice(-2);if(2===t.length)return`mapbox://styles/${t[0]}/${t[1]}`}}}(r)),d(h.attributes,"terrainEnabled",e.terrainEnabled?"true":"false"),d(h.attributes,"fogEnabled",e.fogEnabled?"true":"false"),d(h.attributes,"projection",e.projection),d(h.attributes,"zoom",e.zoom),d(h.metadata,"devicePixelRatio",o),d(h.metadata,"connectionEffectiveType",a),d(h.metadata,"navigatorUserAgent",navigator.userAgent),d(h.metadata,"screenWidth",window.screen.width),d(h.metadata,"screenHeight",window.screen.height),d(h.metadata,"windowWidth",window.innerWidth),d(h.metadata,"windowHeight",window.innerHeight),d(h.metadata,"mapWidth",e.width/o),d(h.metadata,"mapHeight",e.height/o),d(h.metadata,"webglRenderer",e.renderer),d(h.metadata,"webglVendor",e.vendor),d(h.metadata,"sdkVersion",t),d(h.metadata,"sdkIdentifier","mapbox-gl-js"),h}(i);for(const t of n.metadata);for(const t of n.counters);for(const t of n.attributes);this.postEvent(r,n,(()=>{}),e)}},We=Ze.postPerformanceEvent.bind(Ze),He=new class extends Ve{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,r,n){if(!i.API_URL||!i.SESSION_PATH)return;const o=Fe(i.API_URL+i.SESSION_PATH);o.params.push(`sku=${t||""}`),o.params.push(`access_token=${n||i.ACCESS_TOKEN||""}`);const s={url:Be(o),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(e,t){return Ae(P(e,{method:"GET"}),t)}(s,(e=>{this.pendingRequest=null,r(e),this.saveEventData(),this.processRequests(n)}))}getSessionAPI(e,t,r,n){this.skuToken=t,this.errorCb=n,i.SESSION_PATH&&i.API_URL&&(r||i.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},r):this.errorCb(new Error(ze)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e)}remove(){this.errorCb=null}},Xe=He.getSessionAPI.bind(He),Ye=new Set;function Ke(e,t,r){r[e]&&-1!==r[e].indexOf(t)||(r[e]=r[e]||[],r[e].push(t))}function Je(e,t,r){if(r&&r[e]){const i=r[e].indexOf(t);-1!==i&&r[e].splice(i,1)}}class Qe{constructor(e,t={}){P(this,t),this.type=e}}class et extends Qe{constructor(e,t={}){super("error",P({error:e},t))}}class tt{on(e,t){return this._listeners=this._listeners||{},Ke(e,t,this._listeners),this}off(e,t){return Je(e,t,this._listeners),Je(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},Ke(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){"string"==typeof e&&(e=new Qe(e,t||{}));const r=e.type;if(this.listens(r)){e.target=this;const t=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const r of t)r.call(this,e);const i=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const o of i)Je(r,o,this._oneTimeListeners),o.call(this,e);const n=this._eventedParent;n&&(P(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),n.fire(e))}else e instanceof et&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}e.y=void 0;var rt={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function it(e){return(e=Math.round(e))<0?0:e>255?255:e}function nt(e){return it("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function ot(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function st(e,t,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?e+(t-e)*r*6:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}try{e.y={}.parseCSSColor=function(e){var t,r=e.replace(/ /g,"").toLowerCase();if(r in rt)return rt[r].slice();if("#"===r[0])return 4===r.length?(t=parseInt(r.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===r.length&&(t=parseInt(r.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var i=r.indexOf("("),n=r.indexOf(")");if(-1!==i&&n+1===r.length){var o=r.substr(0,i),s=r.substr(i+1,n-(i+1)).split(","),a=1;switch(o){case"rgba":if(4!==s.length)return null;a=ot(s.pop());case"rgb":return 3!==s.length?null:[nt(s[0]),nt(s[1]),nt(s[2]),a];case"hsla":if(4!==s.length)return null;a=ot(s.pop());case"hsl":if(3!==s.length)return null;var l=(parseFloat(s[0])%360+360)%360/360,c=ot(s[1]),u=ot(s[2]),h=u<=.5?u*(c+1):u+c-u*c,d=2*u-h;return[it(255*st(d,h,l+1/3)),it(255*st(d,h,l)),it(255*st(d,h,l-1/3)),a];default:return null}}return null}}catch(e){}class at{constructor(e,t,r,i=1){this.r=e,this.g=t,this.b=r,this.a=i}static parse(t){if(!t)return;if(t instanceof at)return t;if("string"!=typeof t)return;const r=e.y(t);return r?new at(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,t,r,i]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(r)},${i})`}toArray(){const{r:e,g:t,b:r,a:i}=this;return 0===i?[0,0,0,0]:[255*e/i,255*t/i,255*r/i,i]}toArray01(){const{r:e,g:t,b:r,a:i}=this;return 0===i?[0,0,0,0]:[e/i,t/i,r/i,i]}toArray01Scaled(e){const{r:t,g:r,b:i,a:n}=this;return 0===n?[0,0,0]:[t/n*e,r/n*e,i/n*e]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:r,a:i}=this;return[e,t,r,i]}toArray01Linear(){const{r:e,g:t,b:r,a:i}=this;return 0===i?[0,0,0,0]:[Math.pow(e/i,2.2),Math.pow(t/i,2.2),Math.pow(r/i,2.2),i]}}at.black=new at(0,0,0,1),at.white=new at(1,1,1,1),at.transparent=new at(0,0,0,0),at.red=new at(1,0,0,1),at.blue=new at(0,0,1,1);var lt=at;function ct(e,t,r){return e*(1-r)+t*r}function ut(e,t,r){return e.map(((e,i)=>ct(e,t[i],r)))}var ht=Object.freeze({__proto__:null,array:ut,color:function(e,t,r){return new lt(ct(e.r,t.r,r),ct(e.g,t.g,r),ct(e.b,t.b,r),ct(e.a,t.a,r))},number:ct});function dt(e,...t){for(const r of t)for(const t in r)e[t]=r[t];return e}class pt extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var ft=pt;class mt{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[r,i]of t)this.bindings[r]=i}concat(e){return new mt(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var _t=mt;const gt={kind:"null"},yt={kind:"number"},xt={kind:"string"},vt={kind:"boolean"},bt={kind:"color"},wt={kind:"object"},Tt={kind:"value"},Et={kind:"collator"},St={kind:"formatted"},Mt={kind:"resolvedImage"};function At(e,t){return{kind:"array",itemType:e,N:t}}function It(e){if("array"===e.kind){const t=It(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const Ct=[gt,yt,xt,vt,bt,St,wt,At(Tt),Mt];function Pt(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Pt(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Ct)if(!Pt(e,t))return null}return`Expected ${It(e)} but found ${It(t)} instead.`}function Lt(e,t){return t.some((t=>t.kind===e.kind))}function Rt(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}class Dt{constructor(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ot{constructor(e,t,r,i,n){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=r,this.fontStack=i,this.textColor=n}}class zt{constructor(e){this.sections=e}static fromString(e){return new zt([new Ot(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.namePrimary.length))}static factory(e){return e instanceof zt?e:zt.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.namePrimary]);continue}e.push(t.text);const r={};t.fontStack&&(r["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(r["font-scale"]=t.scale),t.textColor&&(r["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(r)}return e}}class kt{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,t){return e?new kt({namePrimary:e,nameSecondary:t,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Ft(e,t,r,i){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:`Invalid rgba value [${[e,t,r,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof i?[e,t,r,i]:[e,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Bt(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof lt)return!0;if(e instanceof Dt)return!0;if(e instanceof zt)return!0;if(e instanceof kt)return!0;if(Array.isArray(e)){for(const t of e)if(!Bt(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!Bt(e[t]))return!1;return!0}return!1}function Nt(e){if(null===e)return gt;if("string"==typeof e)return xt;if("boolean"==typeof e)return vt;if("number"==typeof e)return yt;if(e instanceof lt)return bt;if(e instanceof Dt)return Et;if(e instanceof zt)return St;if(e instanceof kt)return Mt;if(Array.isArray(e)){const t=e.length;let r;for(const i of e){const e=Nt(i);if(r){if(r===e)continue;r=Tt;break}r=e}return At(r||Tt,t)}return wt}function Ut(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof lt||e instanceof zt||e instanceof kt?e.toString():JSON.stringify(e)}class Vt{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Bt(e[1]))return t.error("invalid value");const r=e[1];let i=Nt(r);const n=t.expectedType;return"array"!==i.kind||0!==i.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(i=n),new Vt(i,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof lt?["rgba"].concat(this.value.toArray()):this.value instanceof zt?this.value.serialize():this.value}}var jt=Vt,Gt=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const $t={string:xt,number:yt,boolean:vt,object:wt};class qt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let r,i=1;const n=e[0];if("array"===n){let n,o;if(e.length>2){const r=e[1];if("string"!=typeof r||!(r in $t)||"object"===r)return t.error('The item type argument of "array" must be one of string, number, boolean',1);n=$t[r],i++}else n=Tt;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],i++}r=At(n,o)}else r=$t[n];const o=[];for(;i<e.length;i++){const r=t.parse(e[i],i,Tt);if(!r)return null;o.push(r)}return new qt(r,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const r=this.args[t].evaluate(e);if(!Pt(this.type,Nt(r)))return r;if(t===this.args.length-1)throw new Gt(`Expected value to be of type ${It(this.type)}, but found ${It(Nt(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const r=e.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){t.push(r.kind);const i=e.N;("number"==typeof i||this.args.length>1)&&t.push(i)}}return t.concat(this.args.map((e=>e.serialize())))}}var Zt=qt;class Wt{constructor(e){this.type=St,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&"object"==typeof r)return t.error("First argument must be an image or text section.");const i=[];let n=!1;for(let o=1;o<=e.length-1;++o){const r=e[o];if(n&&"object"==typeof r&&!Array.isArray(r)){n=!1;let e=null;if(r["font-scale"]&&(e=t.parse(r["font-scale"],1,yt),!e))return null;let o=null;if(r["text-font"]&&(o=t.parse(r["text-font"],1,At(xt)),!o))return null;let s=null;if(r["text-color"]&&(s=t.parse(r["text-color"],1,bt),!s))return null;const a=i[i.length-1];a.scale=e,a.font=o,a.textColor=s}else{const r=t.parse(e[o],1,Tt);if(!r)return null;const s=r.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,i.push({content:r,scale:null,font:null,textColor:null})}}return new Wt(i)}evaluate(e){return new zt(this.sections.map((t=>{const r=t.content.evaluate(e);return Nt(r)===Mt?new Ot("",r,null,null,null):new Ot(Ut(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const r={};t.scale&&(r["font-scale"]=t.scale.serialize()),t.font&&(r["text-font"]=t.font.serialize()),t.textColor&&(r["text-color"]=t.textColor.serialize()),e.push(r)}return e}}class Ht{constructor(e,t){this.type=Mt,this.inputPrimary=e,this.inputSecondary=t}static parse(e,t){if(e.length<2)return t.error("Expected two or more arguments.");const r=t.parse(e[1],1,xt);if(!r)return t.error("No image name provided.");if(2===e.length)return new Ht(r);const i=t.parse(e[2],1,xt);return i?new Ht(r,i):t.error("Secondary image variant is not a string.")}evaluate(e){const t=kt.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return t&&e.availableImages&&(t.available=e.availableImages.indexOf(t.namePrimary)>-1,t.nameSecondary&&t.available&&e.availableImages&&(t.available=e.availableImages.indexOf(t.nameSecondary)>-1)),t}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Xt(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}const Yt={"to-boolean":vt,"to-color":bt,"to-number":yt,"to-string":xt};class Kt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[0],i=[];let n=gt;if("to-array"===r){if(!Array.isArray(e[1]))return null;const r=e[1].length;if(t.expectedType){if("array"!==t.expectedType.kind)return t.error(`Expected ${t.expectedType.kind} but found array.`);n=At(t.expectedType.itemType,r)}else{if(!(r>0&&Bt(e[1][0])))return null;n=At(Nt(e[1][0]),r)}for(let o=0;o<r;o++){const r=e[1][o];let s;if("array"===Xt(r))s=t.parse(r,void 0,n.itemType);else{const e=Xt(r);if(e!==n.itemType.kind)return t.error(`Expected ${n.itemType.kind} but found ${e}.`);s=t.registry.literal.parse(["literal",void 0===r?null:r],t)}if(!s)return null;i.push(s)}}else{if(("to-boolean"===r||"to-string"===r)&&2!==e.length)return t.error("Expected one argument.");n=Yt[r];for(let r=1;r<e.length;r++){const n=t.parse(e[r],r,Tt);if(!n)return null;i.push(n)}}return new Kt(n,i)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,r;for(const i of this.args){if(t=i.evaluate(e),r=null,t instanceof lt)return t;if("string"==typeof t){const r=e.parseColor(t);if(r)return r}else if(Array.isArray(t)&&(r=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:Ft(t[0],t[1],t[2],t[3]),!r))return new lt(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Gt(r||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const r of this.args){if(t=r.evaluate(e),null===t)return 0;const i=Number(t);if(!isNaN(i))return i}throw new Gt(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?zt.fromString(Ut(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?kt.fromString(Ut(this.args[0].evaluate(e))):"array"===this.type.kind?this.args.map((t=>t.evaluate(e))):Ut(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new Wt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Ht(this.args[0]).serialize();const e="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild((t=>{e.push(t.serialize())})),e}}var Jt=Kt;const Qt=["Unknown","Point","LineString","Polygon"];var er=class{constructor(e,t){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=t}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Qt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:r,y:i}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*t-e[0])+this.featureDistanceData.bearing[1]*(i*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=lt.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}};class tr{constructor(e,t,r,i,n){this.name=e,this.type=t,this._evaluate=r,this.args=i,this._overloadIndex=n}evaluate(e){if(!this._evaluate){const e=tr.definitions[this.name];this._evaluate=Array.isArray(e)?e[2]:e.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const r=e[0],i=tr.definitions[r];if(!i)return t.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const n=Array.isArray(i)?i[0]:i.type,o=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=[];let a=null,l=-1;for(const[c,u]of o){if(Array.isArray(c)&&c.length!==e.length-1)continue;s.push(c),l++,a=new vi(t.registry,t.path,null,t.scope,void 0,t._scope,t.options);const i=[];let o=!1;for(let t=1;t<e.length;t++){const r=e[t],n=Array.isArray(c)?c[t-1]:c.type,s=a.parse(r,1+i.length,n);if(!s){o=!0;break}i.push(s)}if(!o)if(Array.isArray(c)&&c.length!==i.length)a.error(`Expected ${c.length} arguments, but found ${i.length} instead.`);else{for(let e=0;e<i.length;e++){const t=Array.isArray(c)?c[e]:c.type,r=i[e];a.concat(e+1).checkSubtype(t,r.type)}if(0===a.errors.length)return new tr(r,n,u,i,l)}}if(1===s.length)t.errors.push(...a.errors);else{const r=(s.length?s:o.map((([e])=>e))).map(rr).join(" | "),i=[];for(let n=1;n<e.length;n++){const r=t.parse(e[n],1+i.length);if(!r)return null;i.push(It(r.type))}t.error(`Expected arguments of type ${r}, but found (${i.join(", ")}) instead.`)}return null}static register(e,t){tr.definitions=t;for(const r in t)e[r]=tr}}function rr(e){return Array.isArray(e)?`(${e.map(It).join(", ")})`:`(${It(e.type)}...)`}var ir=tr;class nr{constructor(e,t,r){this.type=Et,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const r=e[1];if("object"!=typeof r||Array.isArray(r))return t.error("Collator options argument must be an object.");const i=t.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,vt);if(!i)return null;const n=t.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,vt);if(!n)return null;let o=null;return r.locale&&(o=t.parse(r.locale,1,xt),!o)?null:new nr(i,n,o)}evaluate(e){return new Dt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var or={exports:{}};or.exports=function(){function e(r,i,n,o,s){for(;o>n;){if(o-n>600){var a=o-n+1,l=i-n+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);e(r,i,Math.max(n,Math.floor(i-l*u/a+h)),Math.min(o,Math.floor(i+(a-l)*u/a+h)),s)}var d=r[i],p=n,f=o;for(t(r,n,i),s(r[o],d)>0&&t(r,n,o);p<f;){for(t(r,p,f),p++,f--;s(r[p],d)<0;)p++;for(;s(r[f],d)>0;)f--}0===s(r[n],d)?t(r,n,f):t(r,++f,o),f<=i&&(n=f+1),i<=f&&(o=f-1)}}function t(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function r(e,t){return e<t?-1:e>t?1:0}return function(t,i,n,o,s){e(t,i,n||0,o||t.length-1,s||r)}}();var sr=h(or.exports);function ar(e){let t=0;for(let r,i,n=0,o=e.length,s=o-1;n<o;s=n++)r=e[n],i=e[s],t+=(i.x-r.x)*(r.y+i.y);return t}function lr(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function cr(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function ur(e,t,r){const i=e[0]-t[0],n=e[1]-t[1],o=e[0]-r[0],s=e[1]-r[1];return i*s-o*n==0&&i*o<=0&&n*s<=0}function hr(e,t,r=!1){let i=!1;for(let a=0,l=t.length;a<l;a++){const l=t[a];for(let t=0,a=l.length,c=a-1;t<a;c=t++){const a=l[c],u=l[t];if(ur(e,a,u))return r;(o=a)[1]>(n=e)[1]!=(s=u)[1]>n[1]&&n[0]<(s[0]-o[0])*(n[1]-o[1])/(s[1]-o[1])+o[0]&&(i=!i)}}var n,o,s;return i}function dr(e,t,r,i){const n=i[0]-r[0],o=i[1]-r[1],s=(e[0]-r[0])*o-n*(e[1]-r[1]),a=(t[0]-r[0])*o-n*(t[1]-r[1]);return s>0&&a<0||s<0&&a>0}function pr(e,t,r,i){return 0!=(n=[i[0]-r[0],i[1]-r[1]])[0]*(o=[t[0]-e[0],t[1]-e[1]])[1]-n[1]*o[0]&&!(!dr(e,t,r,i)||!dr(r,i,e,t));var n,o}const fr=8192;function mr(e,t){const r=(180+e[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,n=Math.pow(2,t.z);return[Math.round(r*n*fr),Math.round(i*n*fr)]}function _r(e,t){for(let r=0;r<t.length;r++)if(hr(e,t[r]))return!0;return!1}function gr(e,t,r){for(const i of r)for(let r=0,n=i.length,o=n-1;r<n;o=r++)if(pr(e,t,i[o],i[r]))return!0;return!1}function yr(e,t){for(let r=0;r<e.length;++r)if(!hr(e[r],t))return!1;for(let r=0;r<e.length-1;++r)if(gr(e[r],e[r+1],t))return!1;return!0}function xr(e,t){for(let r=0;r<t.length;r++)if(yr(e,t[r]))return!0;return!1}function vr(e,t,r){const i=[];for(let n=0;n<e.length;n++){const o=[];for(let i=0;i<e[n].length;i++){const s=mr(e[n][i],r);lr(t,s),o.push(s)}i.push(o)}return i}function br(e,t,r){const i=[];for(let n=0;n<e.length;n++){const o=vr(e[n],t,r);i.push(o)}return i}function wr(e,t,r,i){if(e[0]<r[0]||e[0]>r[2]){const t=.5*i;let n=e[0]-r[0]>t?-i:r[0]-e[0]>t?i:0;0===n&&(n=e[0]-r[2]>t?-i:r[2]-e[0]>t?i:0),e[0]+=n}lr(t,e)}function Tr(e,t,r,i){const n=Math.pow(2,i.z)*fr,o=[i.x*fr,i.y*fr],s=[];if(!e)return s;for(const a of e)for(const e of a){const i=[e.x+o[0],e.y+o[1]];wr(i,t,r,n),s.push(i)}return s}function Er(e,t,r,i){const n=Math.pow(2,i.z)*fr,o=[i.x*fr,i.y*fr],s=[];if(!e)return s;for(const l of e){const e=[];for(const r of l){const i=[r.x+o[0],r.y+o[1]];lr(t,i),e.push(i)}s.push(e)}if(t[2]-t[0]<=n/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const e of s)for(const i of e)wr(i,t,r,n)}var a;return s}class Sr{constructor(e,t){this.type=vt,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Bt(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const r=t.features[e].geometry.type;if("Polygon"===r||"MultiPolygon"===r)return new Sr(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new Sr(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new Sr(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const r=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if(!n)return!1;if("Polygon"===t.type){const o=vr(t.coordinates,i,n),s=Tr(e.geometry(),r,i,n);if(!cr(r,i))return!1;for(const e of s)if(!hr(e,o))return!1}if("MultiPolygon"===t.type){const o=br(t.coordinates,i,n),s=Tr(e.geometry(),r,i,n);if(!cr(r,i))return!1;for(const e of s)if(!_r(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const r=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if(!n)return!1;if("Polygon"===t.type){const o=vr(t.coordinates,i,n),s=Er(e.geometry(),r,i,n);if(!cr(r,i))return!1;for(const e of s)if(!yr(e,o))return!1}if("MultiPolygon"===t.type){const o=br(t.coordinates,i,n),s=Er(e.geometry(),r,i,n);if(!cr(r,i))return!1;for(const e of s)if(!xr(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Mr=Sr,Ar={exports:{}};Ar.exports=function(){var e={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},t=1/298.257223563,r=t*(2-t),i=Math.PI/180,n=function(t,n){if(void 0===t)throw new Error("No latitude given.");if(n&&!e[n])throw new Error("Unknown unit "+n+". Use one of: "+Object.keys(e).join(", "));var o=6378.137*i*(n?e[n]:1),s=Math.cos(t*i),a=1/(1-r*(1-s*s)),l=Math.sqrt(a);this.kx=o*l*s,this.ky=o*l*a*(1-r)},o={units:{configurable:!0}};function s(e,t){return e[0]===t[0]&&e[1]===t[1]}function a(e,t,r){var i=l(t[0]-e[0]);return[e[0]+i*r,e[1]+(t[1]-e[1])*r]}function l(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}return n.fromTile=function(e,t,r){var o=Math.PI*(1-2*(e+.5)/Math.pow(2,t)),s=Math.atan(.5*(Math.exp(o)-Math.exp(-o)))/i;return new n(s,r)},o.units.get=function(){return e},n.prototype.distance=function(e,t){var r=l(e[0]-t[0])*this.kx,i=(e[1]-t[1])*this.ky;return Math.sqrt(r*r+i*i)},n.prototype.bearing=function(e,t){var r=l(t[0]-e[0])*this.kx;return Math.atan2(r,(t[1]-e[1])*this.ky)/i},n.prototype.destination=function(e,t,r){var n=r*i;return this.offset(e,Math.sin(n)*t,Math.cos(n)*t)},n.prototype.offset=function(e,t,r){return[e[0]+t/this.kx,e[1]+r/this.ky]},n.prototype.lineDistance=function(e){for(var t=0,r=0;r<e.length-1;r++)t+=this.distance(e[r],e[r+1]);return t},n.prototype.area=function(e){for(var t=0,r=0;r<e.length;r++)for(var i=e[r],n=0,o=i.length,s=o-1;n<o;s=n++)t+=l(i[n][0]-i[s][0])*(i[n][1]+i[s][1])*(r?-1:1);return Math.abs(t)/2*this.kx*this.ky},n.prototype.along=function(e,t){var r=0;if(t<=0)return e[0];for(var i=0;i<e.length-1;i++){var n=e[i],o=e[i+1],s=this.distance(n,o);if((r+=s)>t)return a(n,o,(t-(r-s))/s)}return e[e.length-1]},n.prototype.pointToSegmentDistance=function(e,t,r){var i=t[0],n=t[1],o=l(r[0]-i)*this.kx,s=(r[1]-n)*this.ky,a=0;return 0===o&&0===s||((a=(l(e[0]-i)*this.kx*o+(e[1]-n)*this.ky*s)/(o*o+s*s))>1?(i=r[0],n=r[1]):a>0&&(i+=o/this.kx*a,n+=s/this.ky*a)),o=l(e[0]-i)*this.kx,s=(e[1]-n)*this.ky,Math.sqrt(o*o+s*s)},n.prototype.pointOnLine=function(e,t){for(var r,i,n,o,s=1/0,a=0;a<e.length-1;a++){var c=e[a][0],u=e[a][1],h=l(e[a+1][0]-c)*this.kx,d=(e[a+1][1]-u)*this.ky,p=0;0===h&&0===d||((p=(l(t[0]-c)*this.kx*h+(t[1]-u)*this.ky*d)/(h*h+d*d))>1?(c=e[a+1][0],u=e[a+1][1]):p>0&&(c+=h/this.kx*p,u+=d/this.ky*p));var f=(h=l(t[0]-c)*this.kx)*h+(d=(t[1]-u)*this.ky)*d;f<s&&(s=f,r=c,i=u,n=a,o=p)}return{point:[r,i],index:n,t:Math.max(0,Math.min(1,o))}},n.prototype.lineSlice=function(e,t,r){var i=this.pointOnLine(r,e),n=this.pointOnLine(r,t);if(i.index>n.index||i.index===n.index&&i.t>n.t){var o=i;i=n,n=o}var a=[i.point],l=i.index+1,c=n.index;!s(r[l],a[0])&&l<=c&&a.push(r[l]);for(var u=l+1;u<=c;u++)a.push(r[u]);return s(r[c],n.point)||a.push(n.point),a},n.prototype.lineSliceAlong=function(e,t,r){for(var i=0,n=[],o=0;o<r.length-1;o++){var s=r[o],l=r[o+1],c=this.distance(s,l);if((i+=c)>e&&0===n.length&&n.push(a(s,l,(e-(i-c))/c)),i>=t)return n.push(a(s,l,(t-(i-c))/c)),n;i>e&&n.push(l)}return n},n.prototype.bufferPoint=function(e,t){var r=t/this.ky,i=t/this.kx;return[e[0]-i,e[1]-r,e[0]+i,e[1]+r]},n.prototype.bufferBBox=function(e,t){var r=t/this.ky,i=t/this.kx;return[e[0]-i,e[1]-r,e[2]+i,e[3]+r]},n.prototype.insideBBox=function(e,t){return l(e[0]-t[0])>=0&&l(e[0]-t[2])<=0&&e[1]>=t[1]&&e[1]<=t[3]},Object.defineProperties(n,o),n}();var Ir=h(Ar.exports),Cr={exports:{}};Cr.exports=function(){var e=function(e,r){if(void 0===e&&(e=[]),void 0===r&&(r=t),this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)};function t(e,t){return e<t?-1:e>t?1:0}return e.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(0!==this.length){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(e){for(var t=this.data,r=this.compare,i=t[e];e>0;){var n=e-1>>1,o=t[n];if(r(i,o)>=0)break;t[e]=o,e=n}t[e]=i},e.prototype._down=function(e){for(var t=this.data,r=this.compare,i=this.length>>1,n=t[e];e<i;){var o=1+(e<<1),s=t[o],a=o+1;if(a<this.length&&r(t[a],s)<0&&(o=a,s=t[a]),r(s,n)>=0)break;t[e]=s,e=o}t[e]=n},e}();var Pr=h(Cr.exports),Lr=8192;function Rr(e,t){return t.dist-e.dist}const Dr=100,Or=50;function zr(e){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function kr(e){return e[1]-e[0]+1}function Fr(e,t){const r=e[1]>=e[0]&&e[1]<t;return r||console.warn("Distance Expression: Index is out of range"),r}function Br(e,t){if(e[0]>e[1])return[null,null];const r=kr(e);if(t){if(2===r)return[e,null];const t=Math.floor(r/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}{if(1===r)return[e,null];const t=Math.floor(r/2)-1;return[[e[0],e[0]+t],[e[0]+t+1,e[1]]]}}function Nr(e,t){const r=[1/0,1/0,-1/0,-1/0];if(!Fr(t,e.length))return r;for(let i=t[0];i<=t[1];++i)lr(r,e[i]);return r}function Ur(e){const t=[1/0,1/0,-1/0,-1/0];for(let r=0;r<e.length;++r)for(let i=0;i<e[r].length;++i)lr(t,e[r][i]);return t}function Vr(e,t,r){if(zr(e)||zr(t))return NaN;let i=0,n=0;return e[2]<t[0]&&(i=t[0]-e[2]),e[0]>t[2]&&(i=e[0]-t[2]),e[1]>t[3]&&(n=e[1]-t[3]),e[3]<t[1]&&(n=t[1]-e[3]),r.distance([0,0],[i,n])}function jr(e){return 360*e-180}function Gr(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function $r(e,t){const r=Math.pow(2,t.z),i=(e.y/Lr+t.y)/r;return[jr((e.x/Lr+t.x)/r),Gr(i)]}function qr(e,t){const r=[];for(let i=0;i<e.length;++i)r.push($r(e[i],t));return r}function Zr(e,t,r){const i=r.pointOnLine(t,e).point;return r.distance(e,i)}function Wr(e,t,r,i,n){const o=r.slice(i[0],i[1]+1);let s=1/0;for(let a=t[0];a<=t[1];++a)if(0===(s=Math.min(s,Zr(e[a],o,n))))return 0;return s}function Hr(e,t,r,i,n){const o=Math.min(n.pointToSegmentDistance(e,r,i),n.pointToSegmentDistance(t,r,i)),s=Math.min(n.pointToSegmentDistance(r,e,t),n.pointToSegmentDistance(i,e,t));return Math.min(o,s)}function Xr(e,t,r,i,n){if(!Fr(t,e.length)||!Fr(i,r.length))return NaN;let o=1/0;for(let s=t[0];s<t[1];++s)for(let t=i[0];t<i[1];++t){if(pr(e[s],e[s+1],r[t],r[t+1]))return 0;o=Math.min(o,Hr(e[s],e[s+1],r[t],r[t+1],n))}return o}function Yr(e,t,r,i,n){if(!Fr(t,e.length)||!Fr(i,r.length))return NaN;let o=1/0;for(let s=t[0];s<=t[1];++s)for(let t=i[0];t<=i[1];++t)if(0===(o=Math.min(o,n.distance(e[s],r[t]))))return o;return o}function Kr(e,t,r){if(hr(e,t,!0))return 0;let i=1/0;for(const n of t){const t=n.length;if(t<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(n[0]!==n[t-1]&&0===(i=Math.min(i,r.pointToSegmentDistance(e,n[t-1],n[0]))))return i;if(0===(i=Math.min(i,Zr(e,n,r))))return i}return i}function Jr(e,t,r,i){if(!Fr(t,e.length))return NaN;for(let o=t[0];o<=t[1];++o)if(hr(e[o],r,!0))return 0;let n=1/0;for(let o=t[0];o<t[1];++o)for(const t of r)for(let r=0,s=t.length,a=s-1;r<s;a=r++){if(pr(e[o],e[o+1],t[a],t[r]))return 0;n=Math.min(n,Hr(e[o],e[o+1],t[a],t[r],i))}return n}function Qr(e,t){for(const r of e)for(let e=0;e<=r.length-1;++e)if(hr(r[e],t,!0))return!0;return!1}function ei(e,t,r,i=1/0){const n=Ur(e),o=Ur(t);if(i!==1/0&&Vr(n,o,r)>=i)return i;if(cr(n,o)){if(Qr(e,t))return 0}else if(Qr(t,e))return 0;let s=i;for(const a of e)for(let e=0,i=a.length,n=i-1;e<i;n=e++)for(const o of t)for(let t=0,i=o.length,l=i-1;t<i;l=t++){if(pr(a[n],a[e],o[l],o[t]))return 0;s=Math.min(s,Hr(a[n],a[e],o[l],o[t],r))}return s}function ti(e,t,r,i,n,o,s){if(null===o||null===s)return;const a=Vr(Nr(i,o),Nr(n,s),r);a<t&&e.push({dist:a,range1:o,range2:s})}function ri(e,t,r,i,n=1/0){let o=Math.min(i.distance(e[0],r[0][0]),n);if(0===o)return o;const s=new Pr([{dist:0,range1:[0,e.length-1],range2:[0,0]}],Rr),a=t?Or:Dr,l=Ur(r);for(;s.length;){const n=s.pop();if(n.dist>=o)continue;const c=n.range1;if(kr(c)<=a){if(!Fr(c,e.length))return NaN;if(t){const t=Jr(e,c,r,i);if(0===(o=Math.min(o,t)))return o}else for(let t=c[0];t<=c[1];++t){const n=Kr(e[t],r,i);if(0===(o=Math.min(o,n)))return o}}else{const r=Br(c,t);if(null!==r[0]){const t=Vr(Nr(e,r[0]),l,i);t<o&&s.push({dist:t,range1:r[0],range2:[0,0]})}if(null!==r[1]){const t=Vr(Nr(e,r[1]),l,i);t<o&&s.push({dist:t,range1:r[1],range2:[0,0]})}}}return o}function ii(e,t,r,i,n,o=1/0){let s=Math.min(o,n.distance(e[0],r[0]));if(0===s)return s;const a=new Pr([{dist:0,range1:[0,e.length-1],range2:[0,r.length-1]}],Rr),l=t?Or:Dr,c=i?Or:Dr;for(;a.length;){const o=a.pop();if(o.dist>=s)continue;const u=o.range1,h=o.range2;if(kr(u)<=l&&kr(h)<=c){if(!Fr(u,e.length)||!Fr(h,r.length))return NaN;if(t&&i?s=Math.min(s,Xr(e,u,r,h,n)):t||i?t&&!i?s=Math.min(s,Wr(r,h,e,u,n)):!t&&i&&(s=Math.min(s,Wr(e,u,r,h,n))):s=Math.min(s,Yr(e,u,r,h,n)),0===s)return s}else{const o=Br(u,t),l=Br(h,i);ti(a,s,n,e,r,o[0],l[0]),ti(a,s,n,e,r,o[0],l[1]),ti(a,s,n,e,r,o[1],l[0]),ti(a,s,n,e,r,o[1],l[1])}}return s}function ni(e,t,r,i,n=1/0){let o=n;const s=Nr(e,[0,e.length-1]);for(const a of r)if(!(o!==1/0&&Vr(s,Nr(a,[0,a.length-1]),i)>=o)&&(o=Math.min(o,ii(e,t,a,!0,i,o)),0===o))return o;return o}function oi(e,t,r,i,n=1/0){let o=n;const s=Nr(e,[0,e.length-1]);for(const a of r){if(o!==1/0&&Vr(s,Ur(a),i)>=o)continue;const r=ri(e,t,a,i,o);if(isNaN(r))return r;if(0===(o=Math.min(o,r)))return o}return o}function si(e){return"Point"===e||"MultiPoint"===e||"LineString"===e||"MultiLineString"===e||"Polygon"===e||"MultiPolygon"===e}class ai{constructor(e,t){this.type=yt,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Bt(e[1])){const t=e[1];if("FeatureCollection"===t.type){for(let e=0;e<t.features.length;++e)if(si(t.features[e].geometry.type))return new ai(t,t.features[e].geometry)}else if("Feature"===t.type){if(si(t.geometry.type))return new ai(t,t.geometry)}else if(si(t.type))return new ai(t,t)}return t.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const t=e.geometry(),r=e.canonicalID();if(null!=t&&null!=r){if("Point"===e.geometryType())return function(e,t,r){const i=[];for(const o of e)for(const e of o)i.push($r(e,t));const n=new Ir(i[0][1],"meters");return"Point"===r.type||"MultiPoint"===r.type||"LineString"===r.type?ii(i,!1,"Point"===r.type?[r.coordinates]:r.coordinates,"LineString"===r.type,n):"MultiLineString"===r.type?ni(i,!1,r.coordinates,n):"Polygon"===r.type||"MultiPolygon"===r.type?oi(i,!1,"Polygon"===r.type?[r.coordinates]:r.coordinates,n):null}(t,r,this.geometries);if("LineString"===e.geometryType())return function(e,t,r){const i=[];for(const o of e){const e=[];for(const r of o)e.push($r(r,t));i.push(e)}const n=new Ir(i[0][0][1],"meters");if("Point"===r.type||"MultiPoint"===r.type||"LineString"===r.type)return ni("Point"===r.type?[r.coordinates]:r.coordinates,"LineString"===r.type,i,n);if("MultiLineString"===r.type){let e=1/0;for(let t=0;t<r.coordinates.length;t++){const o=ni(r.coordinates[t],!0,i,n,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}if("Polygon"===r.type||"MultiPolygon"===r.type){let e=1/0;for(let t=0;t<i.length;t++){const o=oi(i[t],!0,"Polygon"===r.type?[r.coordinates]:r.coordinates,n,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}return null}(t,r,this.geometries);if("Polygon"===e.geometryType())return function(e,t,r){const i=[];for(const o of function(e,t){const r=e.length;if(r<=1)return[e];const i=[];let n,o;for(let s=0;s<r;s++){const t=ar(e[s]);0!==t&&(e[s].area=Math.abs(t),void 0===o&&(o=t<0),o===t<0?(n&&i.push(n),n=[e[s]]):n.push(e[s]))}return n&&i.push(n),i}(e)){const e=[];for(let r=0;r<o.length;++r)e.push(qr(o[r],t));i.push(e)}const n=new Ir(i[0][0][0][1],"meters");if("Point"===r.type||"MultiPoint"===r.type||"LineString"===r.type)return oi("Point"===r.type?[r.coordinates]:r.coordinates,"LineString"===r.type,i,n);if("MultiLineString"===r.type){let e=1/0;for(let t=0;t<r.coordinates.length;t++){const o=oi(r.coordinates[t],!0,i,n,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}return"Polygon"===r.type||"MultiPolygon"===r.type?function(e,t,r){let i=1/0;for(const n of e)for(const e of t){const t=ei(n,e,r,i);if(isNaN(t))return t;if(0===(i=Math.min(i,t)))return i}return i}("Polygon"===r.type?[r.coordinates]:r.coordinates,i,n):null}(t,r,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var li=ai;function ci(e,t){switch(e){case"string":return Ut(t);case"number":return+t;case"boolean":return!!t;case"color":return lt.parse(t);case"formatted":return zt.fromString(Ut(t));case"resolvedImage":return kt.fromString(Ut(t))}return t}function ui(e,t,r,i){return void 0!==i&&(e=i*Math.round(e/i)),void 0!==t&&e<t&&(e=t),void 0!==r&&e>r&&(e=r),e}class hi{constructor(e,t,r){this.type=e,this.key=t,this.scope=r}static parse(e,t){let r=t.expectedType;if(null==r&&(r=Tt),e.length<2||e.length>3)return t.error("Invalid number of arguments for 'config' expression.");const i=t.parse(e[1],1);if(!(i instanceof jt))return t.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const n=t.parse(e[2],2);return n instanceof jt?new hi(r,Ut(i.value),Ut(n.value)):t.error("Scope of 'config' expression must be a string literal.")}return new hi(r,Ut(i.value))}evaluate(e){const t=[this.key,this.scope,e.scope].filter(Boolean).join(""),r=e.getConfig(t);if(!r)return null;const{type:i,value:n,values:o,minValue:s,maxValue:a,stepValue:l}=r,c=r.default.evaluate(e);let u=c;if(n){const t=e.scope;e.scope=(t||"").split("").slice(1).join(""),u=n.evaluate(e),e.scope=t}return i&&(u=ci(i,u)),void 0===u||void 0===s&&void 0===a&&void 0===l||("number"==typeof u?u=ui(u,s,a,l):Array.isArray(u)&&(u=u.map((e=>"number"==typeof e?ui(e,s,a,l):e)))),void 0!==n&&void 0!==u&&o&&!o.includes(u)&&(u=c,i&&(u=ci(i,u))),(i&&i!==this.type||void 0!==u&&Nt(u)!==this.type)&&(u=ci(this.type.kind,u)),u}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}var di=hi;function pi(e){if(e instanceof ir){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Mr)return!1;if(e instanceof li)return!1;let t=!0;return e.eachChild((e=>{t&&!pi(e)&&(t=!1)})),t}function fi(e){if(e instanceof ir&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!fi(e)&&(t=!1)})),t}function mi(e){if(e instanceof di)return!1;let t=!0;return e.eachChild((e=>{t&&!mi(e)&&(t=!1)})),t}function _i(e,t){if(e instanceof ir&&t.indexOf(e.name)>=0)return!1;let r=!0;return e.eachChild((e=>{r&&!_i(e,t)&&(r=!1)})),r}class gi{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const r=e[1];return t.scope.has(r)?new gi(r,t.scope.get(r)):t.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var yi=gi;class xi{constructor(e,t=[],r,i=new _t,n=[],o,s){this.registry=e,this.path=t,this.key=t.map((e=>`[${e}]`)).join(""),this.scope=i,this.errors=n,this.expectedType=r,this._scope=o,this.options=s}parse(e,t,r,i,n={}){return t||r?this.concat(t,r,i)._parse(e,n):this._parse(e,n)}_parse(e,t){function r(e,t,r){return"assert"===r?new Zt(t,[e]):"coerce"===r?new Jt(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i="string"==typeof e[0]?this.registry[e[0]]:void 0;if(i){let n=i.parse(e,this);if(!n)return null;if(this.expectedType){const e=this.expectedType,i=n.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==i.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==i.kind&&"string"!==i.kind){if(this.checkSubtype(e,i))return null}else n=r(n,e,t.typeAnnotation||"coerce");else n=r(n,e,t.typeAnnotation||"assert")}if(!(n instanceof jt)&&"resolvedImage"!==n.type.kind&&bi(n)){const t=new er(this._scope,this.options);try{n=new jt(n.type,n.evaluate(t))}catch(e){return this.error(e.message),null}}return n}return Jt.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,r){const i="number"==typeof e?this.path.concat(e):this.path,n=r?this.scope.concat(r):this.scope;return new xi(this.registry,i,t||null,n,this.errors,this._scope,this.options)}error(e,...t){const r=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new ft(r,e))}checkSubtype(e,t){const r=Pt(e,t);return r&&this.error(r),r}}var vi=xi;function bi(e){if(e instanceof yi)return bi(e.boundExpression);if(e instanceof ir&&"error"===e.name)return!1;if(e instanceof nr)return!1;if(e instanceof Mr)return!1;if(e instanceof li)return!1;if(e instanceof di)return!1;const t=e instanceof Jt||e instanceof Zt;let r=!0;return e.eachChild((e=>{r=t?r&&bi(e):r&&e instanceof jt})),!!r&&pi(e)&&_i(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function wi(e,t){const r=e.length-1;let i,n,o=0,s=r,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),i=e[a],n=e[a+1],i<=t){if(a===r||t<n)return a;o=a+1}else{if(!(i>t))throw new Gt("Input is not a number.");s=a-1}return 0}class Ti{constructor(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[i,n]of r)this.labels.push(i),this.outputs.push(n)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const r=t.parse(e[1],1,yt);if(!r)return null;const i=[];let n=null;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);for(let o=1;o<e.length;o+=2){const r=1===o?-1/0:e[o],s=e[o+1],a=o,l=o+1;if("number"!=typeof r)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(i.length&&i[i.length-1][0]>=r)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=t.parse(s,l,n);if(!c)return null;n=n||c.type,i.push([r,c])}return new Ti(n,r,i)}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return r[0].evaluate(e);const n=t.length;return i>=t[n-1]?r[n-1].evaluate(e):r[wi(t,i)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var Ei=Ti;const Si=.95047,Mi=1.08883,Ai=4/29,Ii=6/29,Ci=3*Ii*Ii,Pi=Ii*Ii*Ii,Li=Math.PI/180,Ri=180/Math.PI;function Di(e){return e>Pi?Math.pow(e,1/3):e/Ci+Ai}function Oi(e){return e>Ii?e*e*e:Ci*(e-Ai)}function zi(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function ki(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Fi(e){const t=ki(e.r),r=ki(e.g),i=ki(e.b),n=Di((.4124564*t+.3575761*r+.1804375*i)/Si),o=Di((.2126729*t+.7151522*r+.072175*i)/1);return{l:116*o-16,a:500*(n-o),b:200*(o-Di((.0193339*t+.119192*r+.9503041*i)/Mi)),alpha:e.a}}function Bi(e){let t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,i=isNaN(e.b)?t:t-e.b/200;return t=1*Oi(t),r=Si*Oi(r),i=Mi*Oi(i),new lt(zi(3.2404542*r-1.5371385*t-.4985314*i),zi(-.969266*r+1.8760108*t+.041556*i),zi(.0556434*r-.2040259*t+1.0572252*i),e.alpha)}function Ni(e,t,r){const i=t-e;return e+r*(i>180||i<-180?i-360*Math.round(i/360):i)}const Ui={forward:Fi,reverse:Bi,interpolate:function(e,t,r){return{l:ct(e.l,t.l,r),a:ct(e.a,t.a,r),b:ct(e.b,t.b,r),alpha:ct(e.alpha,t.alpha,r)}}},Vi={forward:function(e){const{l:t,a:r,b:i}=Fi(e),n=Math.atan2(i,r)*Ri;return{h:n<0?n+360:n,c:Math.sqrt(r*r+i*i),l:t,alpha:e.a}},reverse:function(e){const t=e.h*Li,r=e.c;return Bi({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:Ni(e.h,t.h,r),c:ct(e.c,t.c,r),l:ct(e.l,t.l,r),alpha:ct(e.alpha,t.alpha,r)}}};var ji=Object.freeze({__proto__:null,hcl:Vi,lab:Ui});class Gi{constructor(e,t,r,i,n){this.type=e,this.operator=t,this.interpolation=r,this.input=i,this.labels=[],this.outputs=[];for(const[o,s]of n)this.labels.push(o),this.outputs.push(s)}static interpolationFactor(e,t,r,i){let n=0;if("exponential"===e.name)n=$i(t,e.base,r,i);else if("linear"===e.name)n=$i(t,1,r,i);else if("cubic-bezier"===e.name){const o=e.controlPoints;n=new f(o[0],o[1],o[2],o[3]).solve($i(t,1,r,i))}return n}static parse(e,t){let[r,i,n,...o]=e;if(!Array.isArray(i)||0===i.length)return t.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){const e=i[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:e}}else{if("cubic-bezier"!==i[0])return t.error(`Unknown interpolation type ${String(i[0])}`,1,0);{const e=i.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(n=t.parse(n,2,yt),!n)return null;const s=[];let a=null;"interpolate-hcl"===r||"interpolate-lab"===r?a=bt:t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let l=0;l<o.length;l+=2){const e=o[l],r=o[l+1],i=l+3,n=l+4;if("number"!=typeof e)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(s.length&&s[s.length-1][0]>=e)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const c=t.parse(r,n,a);if(!c)return null;a=a||c.type,s.push([e,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new Gi(a,r,i,n,s):t.error(`Type ${It(a)} is not interpolatable.`)}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return r[0].evaluate(e);const n=t.length;if(i>=t[n-1])return r[n-1].evaluate(e);const o=wi(t,i),s=Gi.interpolationFactor(this.interpolation,i,t[o],t[o+1]),a=r[o].evaluate(e),l=r[o+1].evaluate(e);return"interpolate"===this.operator?ht[this.type.kind.toLowerCase()](a,l,s):"interpolate-hcl"===this.operator?Vi.reverse(Vi.interpolate(Vi.forward(a),Vi.forward(l),s)):Ui.reverse(Ui.interpolate(Ui.forward(a),Ui.forward(l),s))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t}}function $i(e,t,r,i){const n=i-r,o=e-r;return 0===n?0:1===t?o/n:(Math.pow(t,o)-1)/(Math.pow(t,n)-1)}var qi=Gi;class Zi{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let r=null;const i=t.expectedType;i&&"value"!==i.kind&&(r=i);const n=[];for(const s of e.slice(1)){const e=t.parse(s,1+n.length,r,void 0,{typeAnnotation:"omit"});if(!e)return null;r=r||e.type,n.push(e)}const o=i&&n.some((e=>Pt(i,e.type)));return new Zi(o?Tt:r,n)}evaluate(e){let t,r=null,i=0;for(const n of this.args){if(i++,r=n.evaluate(e),r&&r instanceof kt&&!r.available&&(t||(t=r),r=null,i===this.args.length))return t;if(null!==r)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var Wi=Zi;class Hi{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let n=1;n<e.length-1;n+=2){const i=e[n];if("string"!=typeof i)return t.error(`Expected string, but found ${typeof i} instead.`,n);if(/[^a-zA-Z0-9_]/.test(i))return t.error("Variable names must contain only alphanumeric characters or '_'.",n);const o=t.parse(e[n+1],n+1);if(!o)return null;r.push([i,o])}const i=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return i?new Hi(r,i):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,r]of this.bindings)e.push(t,r.serialize());return e.push(this.result.serialize()),e}}var Xi=Hi;class Yi{constructor(e,t,r){this.type=e,this.index=t,this.input=r}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,yt),i=t.parse(e[2],2,At(t.expectedType||Tt));return r&&i?new Yi(i.type.itemType,r,i):null}evaluate(e){const t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new Gt(`Array index out of bounds: ${t} < 0.`);if(t>=r.length)throw new Gt(`Array index out of bounds: ${t} > ${r.length-1}.`);if(t!==Math.floor(t))throw new Gt(`Array index must be an integer, but found ${t} instead.`);return r[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Ki=Yi;class Ji{constructor(e,t){this.type=vt,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,Tt),i=t.parse(e[2],2,Tt);return r&&i?Lt(r.type,[vt,xt,yt,gt,Tt])?new Ji(r,i):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${It(r.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(null==r)return!1;if(!Rt(t,["boolean","string","number","null"]))throw new Gt(`Expected first argument to be of type boolean, string, number or null, but found ${It(Nt(t))} instead.`);if(!Rt(r,["string","array"]))throw new Gt(`Expected second argument to be of type array or string, but found ${It(Nt(r))} instead.`);return r.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Qi=Ji;class en{constructor(e,t,r){this.type=yt,this.needle=e,this.haystack=t,this.fromIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,Tt),i=t.parse(e[2],2,Tt);if(!r||!i)return null;if(!Lt(r.type,[vt,xt,yt,gt,Tt]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${It(r.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,yt);return n?new en(r,i,n):null}return new en(r,i)}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Rt(t,["boolean","string","number","null"]))throw new Gt(`Expected first argument to be of type boolean, string, number or null, but found ${It(Nt(t))} instead.`);if(!Rt(r,["string","array"]))throw new Gt(`Expected second argument to be of type array or string, but found ${It(Nt(r))} instead.`);if(this.fromIndex){const i=this.fromIndex.evaluate(e);return r.indexOf(t,i)}return r.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var tn=en;class rn{constructor(e,t,r,i,n,o){this.inputType=e,this.type=t,this.input=r,this.cases=i,this.outputs=n,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let r,i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const n={},o=[];for(let l=2;l<e.length-1;l+=2){let s=e[l];const a=e[l+1];Array.isArray(s)||(s=[s]);const c=t.concat(l);if(0===s.length)return c.error("Expected at least one branch label.");for(const e of s){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(r){if(c.checkSubtype(r,Nt(e)))return null}else r=Nt(e);if(void 0!==n[String(e)])return c.error("Branch labels must be unique.");n[String(e)]=o.length}const u=t.parse(a,l,i);if(!u)return null;i=i||u.type,o.push(u)}const s=t.parse(e[1],1,Tt);if(!s)return null;const a=t.parse(e[e.length-1],e.length-1,i);return a?"value"!==s.type.kind&&t.concat(1).checkSubtype(r,s.type)?null:new rn(r,i,s,n,o,a):null}evaluate(e){const t=this.input.evaluate(e);return(Nt(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),r=[],i={};for(const o of t){const e=i[this.cases[o]];void 0===e?(i[this.cases[o]]=r.length,r.push([this.cases[o],[o]])):r[e][1].push(o)}const n=e=>"number"===this.inputType.kind?Number(e):e;for(const[o,s]of r)e.push(1===s.length?n(s[0]):s.map(n)),e.push(this.outputs[o].serialize());return e.push(this.otherwise.serialize()),e}}var nn=rn;class on{constructor(e,t,r){this.type=e,this.branches=t,this.otherwise=r}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const i=[];for(let o=1;o<e.length-1;o+=2){const n=t.parse(e[o],o,vt);if(!n)return null;const s=t.parse(e[o+1],o+1,r);if(!s)return null;i.push([n,s]),r=r||s.type}const n=t.parse(e[e.length-1],e.length-1,r);return n?new on(r,i,n):null}evaluate(e){for(const[t,r]of this.branches)if(t.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,r]of this.branches)e(t),e(r);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var sn=on;class an{constructor(e,t,r,i){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,Tt),i=t.parse(e[2],2,yt);if(!r||!i)return null;if(!Lt(r.type,[At(Tt),xt,Tt]))return t.error(`Expected first argument to be of type array or string, but found ${It(r.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,yt);return n?new an(r.type,r,i,n):null}return new an(r.type,r,i)}evaluate(e){const t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!Rt(t,["string","array"]))throw new Gt(`Expected first argument to be of type array or string, but found ${It(Nt(t))} instead.`);if(this.endIndex){const i=this.endIndex.evaluate(e);return t.slice(r,i)}return t.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var ln=an;function cn(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function un(e,t,r,i){return 0===i.compare(t,r)}function hn(e,t,r){const i="=="!==e&&"!="!==e;return class n{constructor(e,t,r){this.type=vt,this.lhs=e,this.rhs=t,this.collator=r,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const r=e[0];let o=t.parse(e[1],1,Tt);if(!o)return null;if(!cn(r,o.type))return t.concat(1).error(`"${r}" comparisons are not supported for type '${It(o.type)}'.`);let s=t.parse(e[2],2,Tt);if(!s)return null;if(!cn(r,s.type))return t.concat(2).error(`"${r}" comparisons are not supported for type '${It(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error(`Cannot compare types '${It(o.type)}' and '${It(s.type)}'.`);i&&("value"===o.type.kind&&"value"!==s.type.kind?o=new Zt(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new Zt(o.type,[s])));let a=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error("Cannot use collator to compare non-string types.");if(a=t.parse(e[3],3,Et),!a)return null}return new n(o,s,a)}evaluate(n){const o=this.lhs.evaluate(n),s=this.rhs.evaluate(n);if(i&&this.hasUntypedArgument){const t=Nt(o),r=Nt(s);if(t.kind!==r.kind||"string"!==t.kind&&"number"!==t.kind)throw new Gt(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${r.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){const e=Nt(o),r=Nt(s);if("string"!==e.kind||"string"!==r.kind)return t(n,o,s)}return this.collator?r(n,o,s,this.collator.evaluate(n)):t(n,o,s)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const dn=hn("==",(function(e,t,r){return t===r}),un),pn=hn("!=",(function(e,t,r){return t!==r}),(function(e,t,r,i){return!un(0,t,r,i)})),fn=hn("<",(function(e,t,r){return t<r}),(function(e,t,r,i){return i.compare(t,r)<0})),mn=hn(">",(function(e,t,r){return t>r}),(function(e,t,r,i){return i.compare(t,r)>0})),_n=hn("<=",(function(e,t,r){return t<=r}),(function(e,t,r,i){return i.compare(t,r)<=0})),gn=hn(">=",(function(e,t,r){return t>=r}),(function(e,t,r,i){return i.compare(t,r)>=0}));class yn{constructor(e,t,r,i,n,o){this.type=xt,this.number=e,this.locale=t,this.currency=r,this.unit=i,this.minFractionDigits=n,this.maxFractionDigits=o}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const r=t.parse(e[1],1,yt);if(!r)return null;const i=e[2];if("object"!=typeof i||Array.isArray(i))return t.error("NumberFormat options argument must be an object.");let n=null;if(i.locale&&(n=t.parse(i.locale,1,xt),!n))return null;let o=null;if(i.currency&&(o=t.parse(i.currency,1,xt),!o))return null;let s=null;if(i.unit&&(s=t.parse(i.unit,1,xt),!s))return null;let a=null;if(i["min-fraction-digits"]&&(a=t.parse(i["min-fraction-digits"],1,yt),!a))return null;let l=null;return i["max-fraction-digits"]&&(l=t.parse(i["max-fraction-digits"],1,yt),!l)?null:new yn(r,n,o,s,a,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class xn{constructor(e){this.type=yt,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=t.parse(e[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?t.error(`Expected argument of type string or array, but found ${It(r.type)} instead.`):new xn(r):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new Gt(`Expected value to be of type string or array, but found ${It(Nt(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}function vn(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const bn={"==":dn,"!=":pn,">":mn,"<":fn,">=":gn,"<=":_n,array:Zt,at:Ki,boolean:Zt,case:sn,coalesce:Wi,collator:nr,format:Wt,image:Ht,in:Qi,"index-of":tn,interpolate:qi,"interpolate-hcl":qi,"interpolate-lab":qi,length:xn,let:Xi,literal:jt,match:nn,number:Zt,"number-format":yn,object:Zt,slice:ln,step:Ei,string:Zt,"to-boolean":Jt,"to-color":Jt,"to-number":Jt,"to-string":Jt,var:yi,within:Mr,distance:li,config:di};function wn(e,[t,r,i,n]){t=t.evaluate(e),r=r.evaluate(e),i=i.evaluate(e);const o=n?n.evaluate(e):1,s=Ft(t,r,i,o);if(s)throw new Gt(s);return new lt(t/255*o,r/255*o,i/255*o,o)}function Tn(e,[t,r,i,n]){t=t.evaluate(e),r=r.evaluate(e),i=i.evaluate(e);const o=n?n.evaluate(e):1,s=function(e,t,r,i){return"number"==typeof e&&e>=0&&e<=360?"number"==typeof t&&t>=0&&t<=100&&"number"==typeof r&&r>=0&&r<=100?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:`Invalid hsla value [${[e,t,r,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof i?[e,t,r,i]:[e,t,r]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof i?[e,t,r,i]:[e,t,r]).join(", ")}]: 'h' must be between 0 and 360.`}(t,r,i,o);if(s)throw new Gt(s);const a=`hsla(${t}, ${r}%, ${i}%, ${o})`,l=lt.parse(a);if(!l)throw new Gt(`Failed to parse HSLA color: ${a}`);return l}function En(e,t){return e in t}function Sn(e,t){const r=t[e];return void 0===r?null:r}function Mn(e){return{type:e}}ir.register(bn,{error:[{kind:"error"},[xt],(e,[t])=>{throw new Gt(t.evaluate(e))}],typeof:[xt,[Tt],(e,[t])=>It(Nt(t.evaluate(e)))],"to-rgba":[At(yt,4),[bt],(e,[t])=>t.evaluate(e).toArray()],rgb:[bt,[yt,yt,yt],wn],rgba:[bt,[yt,yt,yt,yt],wn],hsl:[bt,[yt,yt,yt],Tn],hsla:[bt,[yt,yt,yt,yt],Tn],has:{type:vt,overloads:[[[xt],(e,[t])=>En(t.evaluate(e),e.properties())],[[xt,wt],(e,[t,r])=>En(t.evaluate(e),r.evaluate(e))]]},get:{type:Tt,overloads:[[[xt],(e,[t])=>Sn(t.evaluate(e),e.properties())],[[xt,wt],(e,[t,r])=>Sn(t.evaluate(e),r.evaluate(e))]]},"feature-state":[Tt,[xt],(e,[t])=>Sn(t.evaluate(e),e.featureState||{})],properties:[wt,[],e=>e.properties()],"geometry-type":[xt,[],e=>e.geometryType()],id:[Tt,[],e=>e.id()],zoom:[yt,[],e=>e.globals.zoom],pitch:[yt,[],e=>e.globals.pitch||0],"distance-from-center":[yt,[],e=>e.distanceFromCenter()],"measure-light":[yt,[xt],(e,[t])=>e.measureLight(t.evaluate(e))],"heatmap-density":[yt,[],e=>e.globals.heatmapDensity||0],"line-progress":[yt,[],e=>e.globals.lineProgress||0],"raster-value":[yt,[],e=>e.globals.rasterValue||0],"raster-particle-speed":[yt,[],e=>e.globals.rasterParticleSpeed||0],"sky-radial-progress":[yt,[],e=>e.globals.skyRadialProgress||0],accumulated:[Tt,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[yt,Mn(yt),(e,t)=>{let r=0;for(const i of t)r+=i.evaluate(e);return r}],"*":[yt,Mn(yt),(e,t)=>{let r=1;for(const i of t)r*=i.evaluate(e);return r}],"-":{type:yt,overloads:[[[yt,yt],(e,[t,r])=>t.evaluate(e)-r.evaluate(e)],[[yt],(e,[t])=>-t.evaluate(e)]]},"/":[yt,[yt,yt],(e,[t,r])=>t.evaluate(e)/r.evaluate(e)],"%":[yt,[yt,yt],(e,[t,r])=>t.evaluate(e)%r.evaluate(e)],ln2:[yt,[],()=>Math.LN2],pi:[yt,[],()=>Math.PI],e:[yt,[],()=>Math.E],"^":[yt,[yt,yt],(e,[t,r])=>Math.pow(t.evaluate(e),r.evaluate(e))],sqrt:[yt,[yt],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[yt,[yt],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[yt,[yt],(e,[t])=>Math.log(t.evaluate(e))],log2:[yt,[yt],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[yt,[yt],(e,[t])=>Math.sin(t.evaluate(e))],cos:[yt,[yt],(e,[t])=>Math.cos(t.evaluate(e))],tan:[yt,[yt],(e,[t])=>Math.tan(t.evaluate(e))],asin:[yt,[yt],(e,[t])=>Math.asin(t.evaluate(e))],acos:[yt,[yt],(e,[t])=>Math.acos(t.evaluate(e))],atan:[yt,[yt],(e,[t])=>Math.atan(t.evaluate(e))],min:[yt,Mn(yt),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[yt,Mn(yt),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[yt,[yt],(e,[t])=>Math.abs(t.evaluate(e))],round:[yt,[yt],(e,[t])=>{const r=t.evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[yt,[yt],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[yt,[yt],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[vt,[xt,Tt],(e,[t,r])=>e.properties()[t.value]===r.value],"filter-id-==":[vt,[Tt],(e,[t])=>e.id()===t.value],"filter-type-==":[vt,[xt],(e,[t])=>e.geometryType()===t.value],"filter-<":[vt,[xt,Tt],(e,[t,r])=>{const i=e.properties()[t.value],n=r.value;return typeof i==typeof n&&i<n}],"filter-id-<":[vt,[Tt],(e,[t])=>{const r=e.id(),i=t.value;return typeof r==typeof i&&r<i}],"filter->":[vt,[xt,Tt],(e,[t,r])=>{const i=e.properties()[t.value],n=r.value;return typeof i==typeof n&&i>n}],"filter-id->":[vt,[Tt],(e,[t])=>{const r=e.id(),i=t.value;return typeof r==typeof i&&r>i}],"filter-<=":[vt,[xt,Tt],(e,[t,r])=>{const i=e.properties()[t.value],n=r.value;return typeof i==typeof n&&i<=n}],"filter-id-<=":[vt,[Tt],(e,[t])=>{const r=e.id(),i=t.value;return typeof r==typeof i&&r<=i}],"filter->=":[vt,[xt,Tt],(e,[t,r])=>{const i=e.properties()[t.value],n=r.value;return typeof i==typeof n&&i>=n}],"filter-id->=":[vt,[Tt],(e,[t])=>{const r=e.id(),i=t.value;return typeof r==typeof i&&r>=i}],"filter-has":[vt,[Tt],(e,[t])=>t.value in e.properties()],"filter-has-id":[vt,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[vt,[At(xt)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[vt,[At(Tt)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[vt,[xt,At(Tt)],(e,[t,r])=>r.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[vt,[xt,At(Tt)],(e,[t,r])=>function(e,t,r,i){for(;r<=i;){const n=r+i>>1;if(t[n]===e)return!0;t[n]>e?i=n-1:r=n+1}return!1}(e.properties()[t.value],r.value,0,r.value.length-1)],all:{type:vt,overloads:[[[vt,vt],(e,[t,r])=>t.evaluate(e)&&r.evaluate(e)],[Mn(vt),(e,t)=>{for(const r of t)if(!r.evaluate(e))return!1;return!0}]]},any:{type:vt,overloads:[[[vt,vt],(e,[t,r])=>t.evaluate(e)||r.evaluate(e)],[Mn(vt),(e,t)=>{for(const r of t)if(r.evaluate(e))return!0;return!1}]]},"!":[vt,[vt],(e,[t])=>!t.evaluate(e)],"is-supported-script":[vt,[xt],(e,[t])=>{const r=e.globals&&e.globals.isSupportedScript;return!r||r(t.evaluate(e))}],upcase:[xt,[xt],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[xt,[xt],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[xt,Mn(Tt),(e,t)=>t.map((t=>Ut(t.evaluate(e)))).join("")],"resolved-locale":[xt,[Et],(e,[t])=>t.evaluate(e).resolvedLocale()],random:[yt,[yt,yt,Tt],(e,t)=>{const[r,i,n]=t.map((t=>t.evaluate(e)));if(r>i)return r;if(r===i)return r;let o;if("string"==typeof n)o=function(e){let t=0;if(0===e.length)return t;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}(n);else{if("number"!=typeof n)throw new Gt(`Invalid seed input: ${n}`);o=n}return r+vn(o)()*(i-r)}]});var An=bn;function In(e){return{result:"success",value:e}}function Cn(e){return{result:"error",value:e}}function Pn(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function Ln(e){return"data-driven"===e["property-type"]}function Rn(e){return Pn(e.expression,"measure-light")}function Dn(e){return Pn(e.expression,"zoom")}function On(e){return!!e.expression&&e.expression.interpolated}function zn(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function kn(e){return e}function Fn(e,t){const r="color"===t.type,i=e.stops&&"object"==typeof e.stops[0][0],n=i||!(i||void 0!==e.property),o=e.type||(On(t)?"exponential":"interval");if(r&&((e=dt({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],lt.parse(e[1])]))),e.default=lt.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!ji[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let s,a,l;if("exponential"===o)s=Vn;else if("interval"===o)s=Un;else if("categorical"===o){s=Nn,a=Object.create(null);for(const t of e.stops)a[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);s=jn}if(i){const r={},i=[];for(let t=0;t<e.stops.length;t++){const n=e.stops[t],o=n[0].zoom;void 0===r[o]&&(r[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},i.push(o)),r[o].stops.push([n[0].value,n[1]])}const n=[];for(const e of i)n.push([r[e].zoom,Fn(r[e],t)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:qi.interpolationFactor.bind(void 0,o),zoomStops:n.map((e=>e[0])),evaluate:({zoom:r},i)=>Vn({stops:n,base:e.base},t,r).evaluate(r,i)}}if(n){const r="exponential"===o?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:r,interpolationFactor:qi.interpolationFactor.bind(void 0,r),zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:r})=>s(e,t,r,a,l)}}return{kind:"source",evaluate(r,i){const n=i&&i.properties?i.properties[e.property]:void 0;return void 0===n?Bn(e.default,t.default):s(e,t,n,a,l)}}}function Bn(e,t,r){return void 0!==e?e:void 0!==t?t:void 0!==r?r:void 0}function Nn(e,t,r,i,n){return Bn(typeof r===n?i[r]:void 0,e.default,t.default)}function Un(e,t,r){if("number"!==Xt(r))return Bn(e.default,t.default);const i=e.stops.length;if(1===i)return e.stops[0][1];if(r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[i-1][0])return e.stops[i-1][1];const n=wi(e.stops.map((e=>e[0])),r);return e.stops[n][1]}function Vn(e,t,r){const i=void 0!==e.base?e.base:1;if("number"!==Xt(r))return Bn(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[n-1][0])return e.stops[n-1][1];const o=wi(e.stops.map((e=>e[0])),r),s=function(e,t,r,i){const n=i-r,o=e-r;return 0===n?0:1===t?o/n:(Math.pow(t,o)-1)/(Math.pow(t,n)-1)}(r,i,e.stops[o][0],e.stops[o+1][0]),a=e.stops[o][1],l=e.stops[o+1][1];let c=ht[t.type]||kn;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=ji[e.colorSpace];c=(e,r)=>t.reverse(t.interpolate(t.forward(e),t.forward(r),s))}return"function"==typeof a.evaluate?{evaluate(...e){const t=a.evaluate.apply(void 0,e),r=l.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==r)return c(t,r,s)}}:c(a,l,s)}function jn(e,t,r){return"color"===t.type?r=lt.parse(r):"formatted"===t.type?r=zt.fromString(r.toString()):"resolvedImage"===t.type?r=kt.fromString(r.toString()):Xt(r)===t.type||"enum"===t.type&&t.values[r]||(r=void 0),Bn(r,e.default,t.default)}class Gn{constructor(e,t,r,i){this.expression=e,this._warningHistory={},this._evaluator=new er(r,i),this._defaultValue=t?function(e){return"color"===e.type&&(zn(e.default)||Array.isArray(e.default))?new lt(0,0,0,0):"color"===e.type?lt.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,r,i,n,o,s,a){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=i||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,r,i,n,o,s,a){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=i||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new Gt(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function $n(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in An}function qn(e,t,r,i){const n=new vi(An,[],t?function(e){const t={color:bt,string:xt,number:yt,enum:xt,boolean:vt,formatted:St,resolvedImage:Mt};return"array"===e.type?At(t[e.value]||Tt,e.length):t[e.type]}(t):void 0,void 0,void 0,r,i),o=n.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return o?In(new Gn(o,t,r,i)):Cn(n.errors)}class Zn{constructor(e,t,r){this.kind=e,this._styleExpression=t,this.isLightConstant=r,this.isStateDependent="constant"!==e&&!fi(t.expression),this.isConfigDependent=!mi(t.expression)}evaluateWithoutErrorHandling(e,t,r,i,n,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,i,n,o)}evaluate(e,t,r,i,n,o){return this._styleExpression.evaluate(e,t,r,i,n,o)}}class Wn{constructor(e,t,r,i,n){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent="camera"!==e&&!fi(t.expression),this.isLightConstant=n,this.isConfigDependent=!mi(t.expression),this.interpolationType=i}evaluateWithoutErrorHandling(e,t,r,i,n,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,i,n,o)}evaluate(e,t,r,i,n,o){return this._styleExpression.evaluate(e,t,r,i,n,o)}interpolationFactor(e,t,r){return this.interpolationType?qi.interpolationFactor(this.interpolationType,e,t,r):0}}function Hn(e,t,r,i){if("error"===(e=qn(e,t,r,i)).result)return e;const n=e.value.expression,o=pi(n);if(!o&&!Ln(t))return Cn([new ft("","data expressions not supported")]);const s=_i(n,["zoom","pitch","distance-from-center"]);if(!s&&!Dn(t))return Cn([new ft("","zoom expressions not supported")]);const a=_i(n,["measure-light"]);if(!a&&!Rn(t))return Cn([new ft("","measure-light expression not supported")]);const l=t.expression&&t.expression.relaxZoomRestriction,c=Yn(n);return c||s||l?c instanceof ft?Cn([c]):c instanceof qi&&!On(t)?Cn([new ft("",'"interpolate" expressions cannot be used with this property')]):In(c?new Wn(o?"camera":"composite",e.value,c.labels,c instanceof qi?c.interpolation:void 0,a):new Zn(o?"constant":"source",e.value,a)):Cn([new ft("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Xn{constructor(e,t){this._parameters=e,this._specification=t,dt(this,Fn(this._parameters,this._specification))}static deserialize(e){return new Xn(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Yn(e){let t=null;if(e instanceof Xi)t=Yn(e.result);else if(e instanceof Wi){for(const r of e.args)if(t=Yn(r),t)break}else(e instanceof Ei||e instanceof qi)&&e.input instanceof ir&&"zoom"===e.input.name&&(t=e);return t instanceof ft||e.eachChild((e=>{const r=Yn(e);r instanceof ft?t=r:t&&r&&t!==r&&(t=new ft("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}var Kn=Qn,Jn=3;function Qn(e,t,r){var i=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var n=new Int32Array(this.arrayBuffer);e=n[0],this.d=(t=n[1])+2*(r=n[2]);for(var o=0;o<this.d*this.d;o++){var s=n[Jn+o],a=n[Jn+o+1];i.push(s===a?null:n.subarray(s,a))}var l=n[Jn+i.length+1];this.keys=n.subarray(n[Jn+i.length],l),this.bboxes=n.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var c=0;c<this.d*this.d;c++)i.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var u=r/t*e;this.min=-u,this.max=e+u}Qn.prototype.insert=function(e,t,r,i,n){this._forEachCell(t,r,i,n,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(n)},Qn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Qn.prototype._insertCell=function(e,t,r,i,n,o){this.cells[n].push(o)},Qn.prototype.query=function(e,t,r,i,n){var o=this.min,s=this.max;if(e<=o&&t<=o&&s<=r&&s<=i&&!n)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(e,t,r,i,this._queryCell,a,{},n),a},Qn.prototype._queryCell=function(e,t,r,i,n,o,s,a){var l=this.cells[n];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var d=l[h];if(void 0===s[d]){var p=4*d;(a?a(u[p+0],u[p+1],u[p+2],u[p+3]):e<=u[p+2]&&t<=u[p+3]&&r>=u[p+0]&&i>=u[p+1])?(s[d]=!0,o.push(c[d])):s[d]=!1}}},Qn.prototype._forEachCell=function(e,t,r,i,n,o,s,a){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(r),h=this._convertToCellCoord(i),d=l;d<=u;d++)for(var p=c;p<=h;p++){var f=this.d*p+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&n.call(this,e,t,r,i,f,o,s,a))return}},Qn.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Qn.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Qn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=Jn+this.cells.length+1+1,r=0,i=0;i<this.cells.length;i++)r+=this.cells[i].length;var n=new Int32Array(t+r+this.keys.length+this.bboxes.length);n[0]=this.extent,n[1]=this.n,n[2]=this.padding;for(var o=t,s=0;s<e.length;s++){var a=e[s];n[Jn+s]=o,n.set(a,o),o+=a.length}return n[Jn+e.length]=o,n.set(this.keys,o),n[Jn+e.length+1]=o+=this.keys.length,n.set(this.bboxes,o),o+=this.bboxes.length,n.buffer};var eo=h(Kn);const to={};function ro(e,t,r={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),to[t]={klass:e,omit:r.omit||[]}}ro(Object,"Object"),eo.serialize=function(e,t){const r=e.toArrayBuffer();return t&&t.add(r),{buffer:r}},eo.deserialize=function(e){return new eo(e.buffer)},Object.defineProperty(eo,"name",{value:"Grid"}),ro(eo,"Grid"),ro(lt,"Color"),ro(Error,"Error"),ro(zt,"Formatted"),ro(Ot,"FormattedSection"),ro(Se,"AJAXError"),ro(kt,"ResolvedImage"),ro(Xn,"StylePropertyFunction"),ro(Gn,"StyleExpression",{omit:["_evaluator"]}),ro(Wn,"ZoomDependentExpression"),ro(Zn,"ZoomConstantExpression"),ro(ir,"CompoundExpression",{omit:["_evaluate"]});for(const Av in An)to[An[Av]._classRegistryKey]||ro(An[Av],`Expression${Av}`);function io(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function no(e){return self.ImageBitmap&&e instanceof ImageBitmap}function oo(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(io(e)||no(e))return t&&t.add(e),e;if(ArrayBuffer.isView(e)){const r=e;return t&&t.add(r.buffer),r}if(e instanceof ImageData)return t&&t.add(e.data.buffer),e;if(Array.isArray(e)){const r=[];for(const i of e)r.push(oo(i,t));return r}if(e instanceof Map){const t={$name:"Map"};for(const[r,i]of e.entries())t[r]=oo(i);return t}if("object"==typeof e){const r=e.constructor,i=r._classRegistryKey;if(!i)throw new Error(`can't serialize object of unregistered class ${i}`);const n=r.serialize?r.serialize(e,t):{};if(!r.serialize){for(const r in e)e.hasOwnProperty(r)&&(to[i].omit.indexOf(r)>=0||(n[r]=oo(e[r],t)));e instanceof Error&&(n.message=e.message)}if(n.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(n.$name=i),n}throw new Error("can't serialize object of type "+typeof e)}function so(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||io(e)||no(e)||ArrayBuffer.isView(e)||e instanceof ImageData)return e;if(Array.isArray(e))return e.map(so);if("object"==typeof e){const t=e.$name||"Object";if("Map"===t){const t=new Map;for(const r of Object.keys(e))"$name"!==r&&t.set(r,so(e[r]));return t}const{klass:r}=to[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(e);const i=Object.create(r.prototype);for(const n of Object.keys(e))"$name"!==n&&(i[n]=so(e[n]));return i}throw new Error("can't deserialize object of type "+typeof e)}const ao={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function lo(e){for(const t of e)if(ho(t.charCodeAt(0)))return!0;return!1}function co(e){for(const t of e)if(!uo(t.charCodeAt(0)))return!1;return!0}function uo(e){return!(ao.Arabic(e)||ao["Arabic Supplement"](e)||ao["Arabic Extended-A"](e)||ao["Arabic Presentation Forms-A"](e)||ao["Arabic Presentation Forms-B"](e))}function ho(e){return!(746!==e&&747!==e&&(e<4352||!(ao["Bopomofo Extended"](e)||ao.Bopomofo(e)||ao["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||ao["CJK Compatibility Ideographs"](e)||ao["CJK Compatibility"](e)||ao["CJK Radicals Supplement"](e)||ao["CJK Strokes"](e)||!(!ao["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||ao["CJK Unified Ideographs Extension A"](e)||ao["CJK Unified Ideographs"](e)||ao["Enclosed CJK Letters and Months"](e)||ao["Hangul Compatibility Jamo"](e)||ao["Hangul Jamo Extended-A"](e)||ao["Hangul Jamo Extended-B"](e)||ao["Hangul Jamo"](e)||ao["Hangul Syllables"](e)||ao.Hiragana(e)||ao["Ideographic Description Characters"](e)||ao.Kanbun(e)||ao["Kangxi Radicals"](e)||ao["Katakana Phonetic Extensions"](e)||ao.Katakana(e)&&12540!==e||!(!ao["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!ao["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||ao["Unified Canadian Aboriginal Syllabics"](e)||ao["Unified Canadian Aboriginal Syllabics Extended"](e)||ao["Vertical Forms"](e)||ao["Yijing Hexagram Symbols"](e)||ao["Yi Syllables"](e)||ao["Yi Radicals"](e))))}function po(e){return!(ho(e)||function(e){return!!(ao["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||ao["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||ao["Letterlike Symbols"](e)||ao["Number Forms"](e)||ao["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||ao["Control Pictures"](e)&&9251!==e||ao["Optical Character Recognition"](e)||ao["Enclosed Alphanumerics"](e)||ao["Geometric Shapes"](e)||ao["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ao["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ao["CJK Symbols and Punctuation"](e)||ao.Katakana(e)||ao["Private Use Area"](e)||ao["CJK Compatibility Forms"](e)||ao["Small Form Variants"](e)||ao["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function fo(e){return e>=1424&&e<=2303||ao["Arabic Presentation Forms-A"](e)||ao["Arabic Presentation Forms-B"](e)}function mo(e,t){return!(!t&&fo(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||ao.Khmer(e))}function _o(e){for(const t of e)if(fo(t.charCodeAt(0)))return!0;return!1}const go="deferred",yo="loading",xo="loaded";let vo=null,bo="unavailable",wo=null;const To=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(bo="error"),vo&&vo(e)};function Eo(){So.fire(new Qe("pluginStateChange",{pluginStatus:bo,pluginURL:wo}))}const So=new tt,Mo=function(){return bo},Ao=function(){if(bo!==go||!wo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");bo=yo,Eo(),wo&&Ie({url:wo},(e=>{e?To(e):(bo=xo,Eo())}))},Io={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>bo===xo||null!=Io.applyArabicShaping,isLoading:()=>bo===yo,setState(e){bo=e.pluginStatus,wo=e.pluginURL},isParsed:()=>null!=Io.applyArabicShaping&&null!=Io.processBidirectionalText&&null!=Io.processStyledBidirectionalText,getPluginURL:()=>wo};class Co{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.transition=t.transition,this.pitch=t.pitch,this.brightness=t.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(e,t){for(const r of e)if(!mo(r.charCodeAt(0),t))return!1;return!0}(e,Io.isLoaded())}}class Po{constructor(e,t,r,i){this.property=e,this.value=t,this.expression=function(e,t,r,i){if(zn(e))return new Xn(e,t);if($n(e)||Array.isArray(e)&&e.length>0){const n=Hn(e,t,r,i);if("error"===n.result)throw new Error(n.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return n.value}{let r=e;return"string"==typeof e&&"color"===t.type&&(r=lt.parse(e)),{kind:"constant",isConfigDependent:!1,evaluate:()=>r}}}(void 0===t?e.specification.default:t,e.specification,r,i)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)}}class Lo{constructor(e,t,r){this.property=e,this.value=new Po(e,void 0,t,r)}transitioned(e,t){return new Do(this.property,this.value,t,P({},e.transition,this.transition),e.now)}untransitioned(){return new Do(this.property,this.value,null,{},0)}}class Ro{constructor(e,t,r){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=t,this._options=r,this.isConfigDependent=!1}getValue(e){return U(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Lo(this._values[e].property,this._scope,this._options)),this._values[e].value=new Po(this._values[e].property,null===t?void 0:U(t),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,t){t&&(this._options=t);const r=this._properties.properties;if(e)for(const i in e){const t=e[i];if(F(i,"-transition")){const e=i.slice(0,-11);r[e]&&this.setTransition(e,t)}else r[i]&&this.setValue(i,t)}}getTransition(e){return U(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Lo(this._values[e].property)),this._values[e].transition=U(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const r=this.getValue(t);void 0!==r&&(e[t]=r);const i=this.getTransition(t);void 0!==i&&(e[`${t}-transition`]=i)}return e}transitioned(e,t){const r=new Oo(this._properties);for(const i of Object.keys(this._values))r._values[i]=this._values[i].transitioned(e,t._values[i]);return r}untransitioned(){const e=new Oo(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class Do{constructor(e,t,r,i,n){const o=i.delay||0,s=i.duration||0;n=n||0,this.property=e,this.value=t,this.begin=n+o,this.end=this.begin+s,e.specification.transition&&(i.delay||i.duration)&&(this.prior=r)}possiblyEvaluate(e,t,r){const i=e.now||0,n=this.value.possiblyEvaluate(e,t,r),o=this.prior;if(o){if(i>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(i<this.begin)return o.possiblyEvaluate(e,t,r);{const s=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,r),n,T(s))}}return n}}class Oo{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,r){const i=new Fo(this._properties);for(const n of Object.keys(this._values))i._values[n]=this._values[n].possiblyEvaluate(e,t,r);return i}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class zo{constructor(e,t,r){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=t,this._options=r,this.isConfigDependent=!1}getValue(e){return U(this._values[e].value)}setValue(e,t){this._values[e]=new Po(this._values[e].property,null===t?void 0:U(t),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const t of Object.keys(this._values)){const r=this.getValue(t);void 0!==r&&(e[t]=r)}return e}possiblyEvaluate(e,t,r){const i=new Fo(this._properties);for(const n of Object.keys(this._values))i._values[n]=this._values[n].possiblyEvaluate(e,t,r);return i}}class ko{constructor(e,t,r){this.property=e,this.value=t,this.parameters=r}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,r,i){return this.property.evaluate(this.value,this.parameters,e,t,r,i)}}class Fo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Bo{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,r){const i=ht[this.specification.type];return i?i(e,t,r):e}}class No{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,r,i){return new ko(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},r,i)}:e.expression,t)}interpolate(e,t,r){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new ko(this,{kind:"constant",value:void 0},e.parameters);const i=ht[this.specification.type];return i?new ko(this,{kind:"constant",value:i(e.value.value,t.value.value,r)},e.parameters):e}evaluate(e,t,r,i,n,o){return"constant"===e.kind?e.value:e.evaluate(t,r,i,n,o)}}class Uo{constructor(e){this.specification=e}possiblyEvaluate(e,t,r,i){return!!e.expression.evaluate(t,null,{},r,i)}interpolate(){return!1}}class Vo{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new Co(0,{});for(const r in e){const i=e[r];i.specification.overridable&&this.overridableProperties.push(r);const n=this.defaultPropertyValues[r]=new Po(i,void 0),o=this.defaultTransitionablePropertyValues[r]=new Lo(i);this.defaultTransitioningPropertyValues[r]=o.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=n.possiblyEvaluate(t)}}}function jo(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Go(e){if(Array.isArray(e))return e.map(Go);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const r in e)t[r]=Go(e[r]);return t}return jo(e)}ro(No,"DataDrivenProperty"),ro(Bo,"DataConstantProperty"),ro(Uo,"ColorRampProperty");var $o=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function qo(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!qo(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function Zo(e,t="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};qo(e)||(e=Qo(e));const r=e;let i=!0;try{i=function(e){if(!Xo(e))return e;let t=Go(e);return Ho(t),t=Wo(t),t}(r)}catch(e){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(r,null,2)}\n        `)}const n=$o[`filter_${t}`],o=qn(i,n);let s=null;if("error"===o.result)throw new Error(o.value.map((e=>`${e.key}: ${e.message}`)).join(", "));s=(e,t,r)=>o.value.evaluate(e,t,{},r);let a=null,l=null;if(i!==r){const e=qn(r,n);if("error"===e.result)throw new Error(e.value.map((e=>`${e.key}: ${e.message}`)).join(", "));a=(t,r,i,n,o)=>e.value.evaluate(t,r,{},i,void 0,void 0,n,o),l=!pi(e.value.expression)}return{filter:s,dynamicFilter:a||void 0,needGeometry:Jo(i),needFeature:!!l}}function Wo(e){if(!Array.isArray(e))return e;const t=function(e){if(Yo.has(e[0]))for(let t=1;t<e.length;t++)if(Xo(e[t]))return!0;return e}(e);return!0===t?t:t.map((e=>Wo(e)))}function Ho(e){let t=!1;const r=[];if("case"===e[0]){for(let i=1;i<e.length-1;i+=2)t=t||Xo(e[i]),r.push(e[i+1]);r.push(e[e.length-1])}else if("match"===e[0]){t=t||Xo(e[1]);for(let t=2;t<e.length-1;t+=2)r.push(e[t+1]);r.push(e[e.length-1])}else if("step"===e[0]){t=t||Xo(e[1]);for(let t=1;t<e.length-1;t+=2)r.push(e[t+1])}t&&(e.length=0,e.push("any",...r));for(let i=1;i<e.length;i++)Ho(e[i])}function Xo(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let r=1;r<e.length;r++)if(Xo(e[r]))return!0;return!1}const Yo=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ko(e,t){return e<t?-1:e>t?1:0}function Jo(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(Jo(e[t]))return!0;return!1}function Qo(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?es(e[1],e[2],"=="):"!="===t?is(es(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?es(e[1],e[2],t):"any"===t?(r=e.slice(1),["any"].concat(r.map(Qo))):"all"===t?["all"].concat(e.slice(1).map(Qo)):"none"===t?["all"].concat(e.slice(1).map(Qo).map(is)):"in"===t?ts(e[1],e.slice(2)):"!in"===t?is(ts(e[1],e.slice(2))):"has"===t?rs(e[1]):"!has"!==t||is(rs(e[1]));var r}function es(e,t,r){switch(e){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,e,t]}}function ts(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(Ko)]]:["filter-in-small",e,["literal",t]]}}function rs(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function is(e){return["!",e]}const ns="";function os(e,t){return t?`${e}${ns}${t}`:e}const ss="-transition";class as extends tt{constructor(e,t,r,i){if(super(),this.id=e.id,this.fqid=os(this.id,r),this.type=e.type,this.scope=r,this.options=i,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),t.layout&&(this._unevaluatedLayout=new zo(t.layout,this.scope,i),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),t.paint)){this._transitionablePaint=new Ro(t.paint,this.scope,i);for(const t in e.paint)this.setPaintProperty(t,e.paint[t]);for(const t in e.layout)this.setLayoutProperty(t,e.layout[t]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Fo(t.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t){if("custom"===this.type&&"visibility"===e)return void(this.visibility=t);const r=this._unevaluatedLayout;r._properties.properties[e]&&(r.setValue(e,t),this.isConfigDependent=this.isConfigDependent||r.isConfigDependent,"visibility"===e&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return F(e,ss)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t){const r=this._transitionablePaint,i=r._properties.properties;if(F(e,ss)){const n=e.slice(0,-11);return i[n]&&r.setTransition(n,t||void 0),!1}if(!i[e])return!1;const n=r._values[e],o=n.value.isDataDriven(),s=n.value;r.setValue(e,t),this.isConfigDependent=this.isConfigDependent||r.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const a=r._values[e].value,l=a.isDataDriven(),c=F(e,"pattern")||"line-dasharray"===e;return l||o||c||this._handleOverridablePaintPropertyUpdate(e,s,a)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,t){return null}_handleOverridablePaintPropertyUpdate(e,t,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){return N({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof ko&&Ln(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Zo(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&("shadow"===e.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}}const ls={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class cs{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class us{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function hs(e,t=1){let r=0,i=0;return{members:e.map((e=>{const n=ls[e.type].BYTES_PER_ELEMENT,o=r=ds(r,Math.max(t,n)),s=e.components||1;return i=Math.max(i,n),r+=n*s,{name:e.name,type:e.type,components:s,offset:o}})),size:ds(r,Math.max(i,t)),alignment:t}}function ds(e,t){return Math.ceil(e/t)*t}class ps extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const i=2*e;return this.int16[i+0]=t,this.int16[i+1]=r,e}}ps.prototype.bytesPerElement=4,ro(ps,"StructArrayLayout2i4");class fs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r)}emplace(e,t,r,i){const n=3*e;return this.int16[n+0]=t,this.int16[n+1]=r,this.int16[n+2]=i,e}}fs.prototype.bytesPerElement=6,ro(fs,"StructArrayLayout3i6");class ms extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r,i)}emplace(e,t,r,i,n){const o=4*e;return this.int16[o+0]=t,this.int16[o+1]=r,this.int16[o+2]=i,this.int16[o+3]=n,e}}ms.prototype.bytesPerElement=8,ro(ms,"StructArrayLayout4i8");class _s extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,i,n)}emplace(e,t,r,i,n,o){const s=5*e;return this.int16[s+0]=t,this.int16[s+1]=r,this.int16[s+2]=i,this.int16[s+3]=n,this.int16[s+4]=o,e}}_s.prototype.bytesPerElement=10,ro(_s,"StructArrayLayout5i10");class gs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,i,n,o,s)}emplace(e,t,r,i,n,o,s,a){const l=6*e,c=12*e,u=3*e;return this.int16[l+0]=t,this.int16[l+1]=r,this.uint8[c+4]=i,this.uint8[c+5]=n,this.uint8[c+6]=o,this.uint8[c+7]=s,this.float32[u+2]=a,e}}gs.prototype.bytesPerElement=12,ro(gs,"StructArrayLayout2i4ub1f12");class ys extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r,i)}emplace(e,t,r,i,n){const o=4*e;return this.float32[o+0]=t,this.float32[o+1]=r,this.float32[o+2]=i,this.float32[o+3]=n,e}}ys.prototype.bytesPerElement=16,ro(ys,"StructArrayLayout4f16");class xs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,i,n)}emplace(e,t,r,i,n,o){const s=6*e,a=3*e;return this.uint16[s+0]=t,this.uint16[s+1]=r,this.uint16[s+2]=i,this.uint16[s+3]=n,this.float32[a+2]=o,e}}xs.prototype.bytesPerElement=12,ro(xs,"StructArrayLayout4ui1f12");class vs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r,i)}emplace(e,t,r,i,n){const o=4*e;return this.uint16[o+0]=t,this.uint16[o+1]=r,this.uint16[o+2]=i,this.uint16[o+3]=n,e}}vs.prototype.bytesPerElement=8,ro(vs,"StructArrayLayout4ui8");class bs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,i,n,o)}emplace(e,t,r,i,n,o,s){const a=6*e;return this.int16[a+0]=t,this.int16[a+1]=r,this.int16[a+2]=i,this.int16[a+3]=n,this.int16[a+4]=o,this.int16[a+5]=s,e}}bs.prototype.bytesPerElement=12,ro(bs,"StructArrayLayout6i12");class ws extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,o,s,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,r,i,n,o,s,a,l,c,u,h)}emplace(e,t,r,i,n,o,s,a,l,c,u,h,d){const p=12*e;return this.int16[p+0]=t,this.int16[p+1]=r,this.int16[p+2]=i,this.int16[p+3]=n,this.uint16[p+4]=o,this.uint16[p+5]=s,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,e}}ws.prototype.bytesPerElement=24,ro(ws,"StructArrayLayout4i4ui4i24");class Ts extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,i,n,o)}emplace(e,t,r,i,n,o,s){const a=10*e,l=5*e;return this.int16[a+0]=t,this.int16[a+1]=r,this.int16[a+2]=i,this.float32[l+2]=n,this.float32[l+3]=o,this.float32[l+4]=s,e}}Ts.prototype.bytesPerElement=20,ro(Ts,"StructArrayLayout3i3f20");class Es extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}Es.prototype.bytesPerElement=4,ro(Es,"StructArrayLayout1ul4");class Ss extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const i=2*e;return this.uint16[i+0]=t,this.uint16[i+1]=r,e}}Ss.prototype.bytesPerElement=4,ro(Ss,"StructArrayLayout2ui4");class Ms extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,o,s,a,l,c,u,h,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,r,i,n,o,s,a,l,c,u,h,d)}emplace(e,t,r,i,n,o,s,a,l,c,u,h,d,p){const f=20*e,m=10*e;return this.int16[f+0]=t,this.int16[f+1]=r,this.int16[f+2]=i,this.int16[f+3]=n,this.int16[f+4]=o,this.float32[m+3]=s,this.float32[m+4]=a,this.float32[m+5]=l,this.float32[m+6]=c,this.int16[f+14]=u,this.uint32[m+8]=h,this.uint16[f+18]=d,this.uint16[f+19]=p,e}}Ms.prototype.bytesPerElement=40,ro(Ms,"StructArrayLayout5i4f1i1ul2ui40");class As extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,i,n,o,s)}emplace(e,t,r,i,n,o,s,a){const l=8*e;return this.int16[l+0]=t,this.int16[l+1]=r,this.int16[l+2]=i,this.int16[l+4]=n,this.int16[l+5]=o,this.int16[l+6]=s,this.int16[l+7]=a,e}}As.prototype.bytesPerElement=16,ro(As,"StructArrayLayout3i2i2i16");class Is extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,i,n)}emplace(e,t,r,i,n,o){const s=4*e,a=8*e;return this.float32[s+0]=t,this.float32[s+1]=r,this.float32[s+2]=i,this.int16[a+6]=n,this.int16[a+7]=o,e}}Is.prototype.bytesPerElement=16,ro(Is,"StructArrayLayout2f1f2i16");class Cs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r,i)}emplace(e,t,r,i,n){const o=12*e,s=3*e;return this.uint8[o+0]=t,this.uint8[o+1]=r,this.float32[s+1]=i,this.float32[s+2]=n,e}}Cs.prototype.bytesPerElement=12,ro(Cs,"StructArrayLayout2ub2f12");class Ps extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r)}emplace(e,t,r,i){const n=3*e;return this.uint16[n+0]=t,this.uint16[n+1]=r,this.uint16[n+2]=i,e}}Ps.prototype.bytesPerElement=6,ro(Ps,"StructArrayLayout3ui6");class Ls extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,o,s,a,l,c,u,h,d,p,f,m,_,g,y,x,v){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,r,i,n,o,s,a,l,c,u,h,d,p,f,m,_,g,y,x,v)}emplace(e,t,r,i,n,o,s,a,l,c,u,h,d,p,f,m,_,g,y,x,v,b){const w=30*e,T=15*e,E=60*e;return this.int16[w+0]=t,this.int16[w+1]=r,this.int16[w+2]=i,this.float32[T+2]=n,this.float32[T+3]=o,this.uint16[w+8]=s,this.uint16[w+9]=a,this.uint32[T+5]=l,this.uint32[T+6]=c,this.uint32[T+7]=u,this.uint16[w+16]=h,this.uint16[w+17]=d,this.uint16[w+18]=p,this.float32[T+10]=f,this.float32[T+11]=m,this.uint8[E+48]=_,this.uint8[E+49]=g,this.uint8[E+50]=y,this.uint32[T+13]=x,this.int16[w+28]=v,this.uint8[E+58]=b,e}}Ls.prototype.bytesPerElement=60,ro(Ls,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Rs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,o,s,a,l,c,u,h,d,p,f,m,_,g,y,x,v,b,w,T,E,S,M,A,I,C,P,L){const R=this.length;return this.resize(R+1),this.emplace(R,e,t,r,i,n,o,s,a,l,c,u,h,d,p,f,m,_,g,y,x,v,b,w,T,E,S,M,A,I,C,P,L)}emplace(e,t,r,i,n,o,s,a,l,c,u,h,d,p,f,m,_,g,y,x,v,b,w,T,E,S,M,A,I,C,P,L,R){const D=20*e,O=40*e,z=80*e;return this.float32[D+0]=t,this.float32[D+1]=r,this.int16[O+4]=i,this.int16[O+5]=n,this.int16[O+6]=o,this.int16[O+7]=s,this.int16[O+8]=a,this.int16[O+9]=l,this.int16[O+10]=c,this.int16[O+11]=u,this.int16[O+12]=h,this.uint16[O+13]=d,this.uint16[O+14]=p,this.uint16[O+15]=f,this.uint16[O+16]=m,this.uint16[O+17]=_,this.uint16[O+18]=g,this.uint16[O+19]=y,this.uint16[O+20]=x,this.uint16[O+21]=v,this.uint16[O+22]=b,this.uint16[O+23]=w,this.uint16[O+24]=T,this.uint16[O+25]=E,this.uint16[O+26]=S,this.uint16[O+27]=M,this.uint32[D+14]=A,this.float32[D+15]=I,this.float32[D+16]=C,this.float32[D+17]=P,this.float32[D+18]=L,this.uint8[z+76]=R,e}}Rs.prototype.bytesPerElement=80,ro(Rs,"StructArrayLayout2f9i15ui1ul4f1ub80");class Ds extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}Ds.prototype.bytesPerElement=4,ro(Ds,"StructArrayLayout1f4");class Os extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,i,n)}emplace(e,t,r,i,n,o){const s=5*e;return this.float32[s+0]=t,this.float32[s+1]=r,this.float32[s+2]=i,this.float32[s+3]=n,this.float32[s+4]=o,e}}Os.prototype.bytesPerElement=20,ro(Os,"StructArrayLayout5f20");class zs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,i,n,o,s)}emplace(e,t,r,i,n,o,s,a){const l=7*e;return this.float32[l+0]=t,this.float32[l+1]=r,this.float32[l+2]=i,this.float32[l+3]=n,this.float32[l+4]=o,this.float32[l+5]=s,this.float32[l+6]=a,e}}zs.prototype.bytesPerElement=28,ro(zs,"StructArrayLayout7f28");class ks extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r,i)}emplace(e,t,r,i,n){const o=6*e;return this.uint32[3*e+0]=t,this.uint16[o+2]=r,this.uint16[o+3]=i,this.uint16[o+4]=n,e}}ks.prototype.bytesPerElement=12,ro(ks,"StructArrayLayout1ul3ui12");class Fs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}Fs.prototype.bytesPerElement=2,ro(Fs,"StructArrayLayout1ui2");class Bs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r)}emplace(e,t,r,i){const n=3*e;return this.float32[n+0]=t,this.float32[n+1]=r,this.float32[n+2]=i,e}}Bs.prototype.bytesPerElement=12,ro(Bs,"StructArrayLayout3f12");class Ns extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const i=2*e;return this.float32[i+0]=t,this.float32[i+1]=r,e}}Ns.prototype.bytesPerElement=8,ro(Ns,"StructArrayLayout2f8");class Us extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,o,s,a,l,c,u,h,d,p,f,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,t,r,i,n,o,s,a,l,c,u,h,d,p,f,m)}emplace(e,t,r,i,n,o,s,a,l,c,u,h,d,p,f,m,_){const g=16*e;return this.float32[g+0]=t,this.float32[g+1]=r,this.float32[g+2]=i,this.float32[g+3]=n,this.float32[g+4]=o,this.float32[g+5]=s,this.float32[g+6]=a,this.float32[g+7]=l,this.float32[g+8]=c,this.float32[g+9]=u,this.float32[g+10]=h,this.float32[g+11]=d,this.float32[g+12]=p,this.float32[g+13]=f,this.float32[g+14]=m,this.float32[g+15]=_,e}}Us.prototype.bytesPerElement=64,ro(Us,"StructArrayLayout16f64");class Vs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,i,n,o,s)}emplace(e,t,r,i,n,o,s,a){const l=10*e,c=5*e;return this.uint16[l+0]=t,this.uint16[l+1]=r,this.uint16[l+2]=i,this.uint16[l+3]=n,this.float32[c+2]=o,this.float32[c+3]=s,this.float32[c+4]=a,e}}Vs.prototype.bytesPerElement=20,ro(Vs,"StructArrayLayout4ui3f20");class js extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint8[1*e+0]=t,e}}js.prototype.bytesPerElement=1,ro(js,"StructArrayLayout1ub1");class Gs extends cs{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Gs.prototype.size=40;class $s extends Ms{get(e){return new Gs(this,e)}}ro($s,"CollisionBoxArray");class qs extends cs{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}qs.prototype.size=60;class Zs extends Ls{get(e){return new qs(this,e)}}ro(Zs,"PlacedSymbolArray");class Ws extends cs{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Ws.prototype.size=80;class Hs extends Rs{get(e){return new Ws(this,e)}}ro(Hs,"SymbolInstanceArray");class Xs extends Ds{getoffsetX(e){return this.float32[1*e+0]}}ro(Xs,"GlyphOffsetArray");class Ys extends ps{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ro(Ys,"SymbolLineVertexArray");class Ks extends cs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ks.prototype.size=12;class Js extends ks{get(e){return new Ks(this,e)}}ro(Js,"FeatureIndexArray");class Qs extends Ss{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ro(Qs,"FillExtrusionCentroidArray");const ea=hs([{name:"a_pos",components:2,type:"Int16"}],4),ta=hs([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ra{constructor(e=[]){this.segments=e}_prepareSegment(e,t,r,i){let n=this.segments[this.segments.length-1];return e>ra.MAX_VERTEX_ARRAY_LENGTH&&j(`Max vertices per segment is ${ra.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!n||n.vertexLength+e>ra.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==i)&&(n={vertexOffset:t,primitiveOffset:r,vertexLength:0,primitiveLength:0},void 0!==i&&(n.sortKey=i),this.segments.push(n)),n}prepareSegment(e,t,r,i){return this._prepareSegment(e,t.length,r.length,i)}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,r,i){return new ra([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:i,vaos:{},sortKey:0}])}}function ia(e,t){return 256*(e=M(Math.floor(e),0,255))+M(Math.floor(t),0,255)}ra.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ro(ra,"SegmentVector");const na=hs([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),oa=hs([{name:"a_dash",components:4,type:"Uint16"}]);var sa={exports:{}},aa={exports:{}};!function(e){e.exports=function(e,t){var r,i,n,o,s,a,l,c;for(i=e.length-(r=3&e.length),n=t,s=3432918353,a=461845907,c=0;c<i;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,n=27492+(65535&(o=5*(65535&(n=(n^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,r){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:n^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return n^=e.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0}}(aa);var la=aa.exports,ca={exports:{}};!function(e){e.exports=function(e,t){for(var r,i=e.length,n=t^i,o=0;i>=4;)r=1540483477*(65535&(r=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(r>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),i-=4,++o;switch(i){case 3:n^=(255&e.charCodeAt(o+2))<<16;case 2:n^=(255&e.charCodeAt(o+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(o)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0}}(ca);var ua=la,ha=ca.exports;sa.exports=ua,sa.exports.murmur3=ua,sa.exports.murmur2=ha;var da=h(sa.exports);class pa{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,t,r,i){this.ids.push(fa(e)),this.positions.push(t,r,i)}eachPosition(e,t){const r=fa(e);let i=0,n=this.ids.length-1;for(;i<n;){const e=i+n>>1;this.ids[e]>=r?n=e:i=e+1}for(;this.ids[i]===r;)t(this.positions[3*i],this.positions[3*i+1],this.positions[3*i+2]),i++}static serialize(e,t){const r=new Float64Array(e.ids),i=new Uint32Array(e.positions);return ma(r,i,0,r.length-1),t&&(t.add(r.buffer),t.add(i.buffer)),{ids:r,positions:i}}static deserialize(e){const t=new pa;let r;t.ids=e.ids,t.positions=e.positions;for(const i of t.ids)i!==r&&t.uniqueIds.push(i),r=i;return t.indexed=!0,t}}function fa(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:da(String(e))}function ma(e,t,r,i){for(;r<i;){const n=e[r+i>>1];let o=r-1,s=i+1;for(;;){do{o++}while(e[o]<n);do{s--}while(e[s]>n);if(o>=s)break;_a(e,o,s),_a(t,3*o,3*s),_a(t,3*o+1,3*s+1),_a(t,3*o+2,3*s+2)}s-r<i-s?(ma(e,t,r,s),r=s+1):(ma(e,t,s+1,i),i=s)}}function _a(e,t,r){const i=e[t];e[t]=e[r],e[r]=i}ro(pa,"FeaturePositionMap");class ga{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}class ya extends ga{constructor(e){super(e),this.current=0}set(e,t,r){this.fetchUniformLocation(e,t)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}}class xa extends ga{constructor(e){super(e),this.current=0}set(e,t,r){this.fetchUniformLocation(e,t)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class va extends ga{constructor(e){super(e),this.current=[0,0]}set(e,t,r){this.fetchUniformLocation(e,t)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}}class ba extends ga{constructor(e){super(e),this.current=[0,0,0]}set(e,t,r){this.fetchUniformLocation(e,t)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}}class wa extends ga{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,r){this.fetchUniformLocation(e,t)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}class Ta extends ga{constructor(e){super(e),this.current=lt.transparent}set(e,t,r){this.fetchUniformLocation(e,t)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}const Ea=new Float32Array(16);class Sa extends ga{constructor(e){super(e),this.current=Ea}set(e,t,r){if(this.fetchUniformLocation(e,t)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}}const Ma=new Float32Array(9),Aa=new Float32Array(4);class Ia extends ga{constructor(e){super(e),this.current=Aa}set(e,t,r){if(this.fetchUniformLocation(e,t))for(let i=0;i<4;i++)if(r[i]!==this.current[i]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}function Ca(e){return[ia(255*e.r,255*e.g),ia(255*e.b,255*e.a)]}class Pa{constructor(e,t,r){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=r}setUniform(e,t,r,i,n){t.set(e,n,i.constantOr(this.value))}getBinding(e,t){return"color"===this.type?new Ta(e):new xa(e)}}class La{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,t,r,i,n){const o="u_pattern"===n||"u_dash"===n?this.pattern:"u_pixel_ratio"===n?this.pixelRatio:null;o&&t.set(e,n,o)}getBinding(e,t){return"u_pattern"===t||"u_dash"===t?new wa(e):new xa(e)}}class Ra{constructor(e,t,r,i){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===r?2:1,offset:0}))),this.paintVertexArray=new i}populatePaintArray(e,t,r,i,n,o,s){const a=this.paintVertexArray.length,l=this.expression.evaluate(new Co(0,{brightness:o}),t,{},n,i,s);this.paintVertexArray.resize(e),this._setPaintValue(a,e,l)}updatePaintArray(e,t,r,i,n,o,s){const a=this.expression.evaluate({zoom:0,brightness:s},r,i,void 0,n);this._setPaintValue(e,t,a)}_setPaintValue(e,t,r){if("color"===this.type){const i=Ca(r);for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,i[0],i[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Da{constructor(e,t,r,i,n,o){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=r,this.useIntegerZoom=i,this.zoom=n,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===r?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(e,t,r,i,n,o,s){const a=this.expression.evaluate(new Co(this.zoom,{brightness:o}),t,{},n,i,s),l=this.expression.evaluate(new Co(this.zoom+1,{brightness:o}),t,{},n,i,s),c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(c,e,a,l)}updatePaintArray(e,t,r,i,n,o,s){const a=this.expression.evaluate({zoom:this.zoom,brightness:s},r,i,void 0,n),l=this.expression.evaluate({zoom:this.zoom+1,brightness:s},r,i,void 0,n);this._setPaintValue(e,t,a,l)}_setPaintValue(e,t,r,i){if("color"===this.type){const n=Ca(r),o=Ca(i);for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n[0],n[1],o[0],o[1])}else{for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,r,i);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,r,i,n){const o=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,s=M(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(e,n,s)}getBinding(e,t){return new xa(e)}}class Oa{constructor(e,t,r,i,n){this.expression=e,this.layerId=n,this.paintVertexAttributes=("array"===r?oa:na).members;for(let o=0;o<t.length;++o);this.paintVertexArray=new i}populatePaintArray(e,t,r){const i=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(i,e,t.patterns&&t.patterns[this.layerId],r)}updatePaintArray(e,t,r,i,n,o,s){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],o)}_setPaintValues(e,t,r,i){if(!i||!r)return;const n=i[r];if(!n)return;const{tl:o,br:s,pixelRatio:a}=n;for(let l=e;l<t;l++)this.paintVertexArray.emplace(l,o[0],o[1],s[0],s[1],a)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class za{constructor(e,t,r=(()=>!0)){this.binders={},this._buffers=[];const i=[];for(const n in e.paint._values){const o=e.paint.get(n);if(!r(n))continue;if(!(o instanceof ko&&Ln(o.property.specification)))continue;const s=Ba(n,e.type),a=o.value,l=o.property.specification.type,c=!!o.property.useIntegerZoom,u="line-dasharray"===n||n.endsWith("pattern"),h="line-dasharray"===n&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==a.kind||h)if("source"===a.kind||h||u){const t=Va(n,l,"source");this.binders[n]=u?new Oa(a,s,l,t,e.id):new Ra(a,s,l,t),i.push(`/a_${n}`)}else{const e=Va(n,l,"composite");this.binders[n]=new Da(a,s,l,c,t,e),i.push(`/z_${n}`)}else this.binders[n]=u?new La(a.value,s):new Pa(a.value,s,l),i.push(`/u_${n}`)}this.cacheKey=i.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Ra||t instanceof Da?t.maxValue:0}populatePaintArrays(e,t,r,i,n,o,s){for(const a in this.binders){const l=this.binders[a];(l instanceof Ra||l instanceof Da||l instanceof Oa)&&l.populatePaintArray(e,t,r,i,n,o,s)}}setConstantPatternPositions(e){for(const t in this.binders){const r=this.binders[t];r instanceof La&&r.setConstantPatternPositions(e)}}updatePaintArrays(e,t,r,i,n,o,s,a){let l=!1;const c=Object.keys(e),u=0!==c.length,h=u?c:t.uniqueIds;for(const d in this.binders){const c=this.binders[d];if((c instanceof Ra||c instanceof Da||c instanceof Oa)&&(!0===c.expression.isStateDependent||!1===c.expression.isLightConstant)){const p=n.paint.get(d);c.expression=p.value;for(const r of h){const n=e[r.toString()];t.eachPosition(r,((e,t,r)=>{const l=i.feature(e);c.updatePaintArray(t,r,l,n,o,s,a)}))}if(!u)for(const t of r.uniqueIds){const n=e[t.toString()];r.eachPosition(t,((e,t,r)=>{const l=i.feature(e);c.updatePaintArray(t,r,l,n,o,s,a)}))}l=!0}}return l}defines(){const e=[];for(const t in this.binders){const r=this.binders[t];(r instanceof Pa||r instanceof La)&&e.push(...r.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const r=this.binders[t];if(r instanceof Ra||r instanceof Da||r instanceof Oa)for(let t=0;t<r.paintVertexAttributes.length;t++)e.push(r.paintVertexAttributes[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const r=this.binders[t];if(r instanceof Pa||r instanceof La||r instanceof Da)for(const t of r.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const r in this.binders){const i=this.binders[r];if(i instanceof Pa||i instanceof La||i instanceof Da)for(const n of i.uniformNames)t.push({name:n,property:r,binding:i.getBinding(e,n)})}return t}setUniforms(e,t,r,i,n){for(const{name:o,property:s,binding:a}of r)this.binders[s].setUniform(e,a,n,i.get(s),o)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const t=this.binders[e];(t instanceof Ra||t instanceof Da||t instanceof Oa)&&t.paintVertexBuffer&&this._buffers.push(t.paintVertexBuffer)}}upload(e){for(const t in this.binders){const r=this.binders[t];(r instanceof Ra||r instanceof Da||r instanceof Oa)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Ra||t instanceof Da||t instanceof Oa)&&t.destroy()}}}class ka{constructor(e,t,r=(()=>!0)){this.programConfigurations={};for(const i of e)this.programConfigurations[i.id]=new za(i,t,r);this.needsUpload=!1,this._featureMap=new pa,this._featureMapWithoutIds=new pa,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,t,r,i,n,o,s,a){for(const l in this.programConfigurations)this.programConfigurations[l].populatePaintArrays(e,t,i,n,o,s,a);void 0!==t.id?this._featureMap.add(t.id,r,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,r,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,r,i,n,o){for(const s of r)this.needsUpload=this.programConfigurations[s.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,t,s,i,n,o||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Fa={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Ba(e,t){return Fa[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const Na={"line-pattern":{source:xs,composite:xs},"fill-pattern":{source:xs,composite:xs},"fill-extrusion-pattern":{source:xs,composite:xs},"line-dasharray":{source:vs,composite:vs}},Ua={color:{source:Ns,composite:ys},number:{source:Ds,composite:Ns}};function Va(e,t,r){const i=Na[e];return i&&i[r]||Ua[t][r]}ro(Pa,"ConstantBinder"),ro(La,"PatternConstantBinder"),ro(Ra,"SourceExpressionBinder"),ro(Oa,"PatternCompositeBinder"),ro(Da,"CompositeExpressionBinder"),ro(za,"ProgramConfiguration",{omit:["_buffers"]}),ro(ka,"ProgramConfigurationSet");const ja=Lr/Math.PI/2,Ga=5,$a=6,qa=16383,Za=64,Wa=[Za,32,16],Ha=-ja,Xa=ja;function Ya(e,t,r,i=ja){return r=v(r),[e*Math.sin(r)*i,-t*i,e*Math.cos(r)*i]}function Ka(e,t,r){return Ya(Math.cos(v(e)),Math.sin(v(e)),t,r)}const Ja=6371008.8,Qa=2*Math.PI*Ja;class el{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new el(I(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,r=this.lat*t,i=e.lat*t,n=Math.sin(r)*Math.sin(i)+Math.cos(r)*Math.cos(i)*Math.cos((e.lng-this.lng)*t);return Ja*Math.acos(Math.min(n,1))}toBounds(e=0){const t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new tl({lng:this.lng-r,lat:this.lat-t},{lng:this.lng+r,lat:this.lat+t})}toEcef(e){return Ka(this.lat,this.lng,ja+e*ja/Ja)}static convert(e){if(e instanceof el)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new el(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new el(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class tl{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof el?new el(e.lng,e.lat):el.convert(e),this}setSouthWest(e){return this._sw=e instanceof el?new el(e.lng,e.lat):el.convert(e),this}extend(e){const t=this._sw,r=this._ne;let i,n;if(e instanceof el)i=e,n=e;else{if(!(e instanceof tl))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(tl.convert(e)):this.extend(el.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(el.convert(e)):this;if(i=e._sw,n=e._ne,!i||!n)return this}return t||r?(t.lng=Math.min(i.lng,t.lng),t.lat=Math.min(i.lat,t.lat),r.lng=Math.max(n.lng,r.lng),r.lat=Math.max(n.lat,r.lat)):(this._sw=new el(i.lng,i.lat),this._ne=new el(n.lng,n.lat)),this}getCenter(){return new el((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new el(this.getWest(),this.getNorth())}getSouthEast(){return new el(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:r}=el.convert(e);let i=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&i}static convert(e){return!e||e instanceof tl?e:new tl(e)}}var rl={};!function(e,t){!function(e){function t(e,t,i){var n=r(256*e,256*(t=Math.pow(2,i)-t-1),i),o=r(256*(e+1),256*(t+1),i);return n[0]+","+n[1]+","+o[0]+","+o[1]}function r(e,t,r){var i=2*Math.PI*6378137/256/Math.pow(2,r);return[e*i-2*Math.PI*6378137/2,t*i-2*Math.PI*6378137/2]}e.getURL=function(e,r,i,n,o,s){return s=s||{},e+"?"+["bbox="+t(i,n,o),"format="+(s.format||"image/png"),"service="+(s.service||"WMS"),"version="+(s.version||"1.1.1"),"request="+(s.request||"GetMap"),"srs="+(s.srs||"EPSG:3857"),"width="+(s.width||256),"height="+(s.height||256),"layers="+r].join("&")},e.getTileBBox=t,e.getMercCoords=r,Object.defineProperty(e,"__esModule",{value:!0})}(t)}(0,rl);var il=rl;class nl{constructor(e,t,r){this.z=e,this.x=t,this.y=r,this.key=al(0,e,e,t,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const r=il.getTileBBox(this.x,this.y,this.z),i=function(e,t,r){let i,n="";for(let o=e;o>0;o--)i=1<<o-1,n+=(t&i?1:0)+(r&i?2:0);return n}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",i).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ol{constructor(e,t){this.wrap=e,this.canonical=t,this.key=al(e,t.z,t.z,t.x,t.y)}}class sl{constructor(e,t,r,i,n){this.overscaledZ=e,this.wrap=t,this.canonical=new nl(r,+i,+n),this.key=0===t&&e===r?this.canonical.key:al(t,e,r,i,n)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new sl(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new sl(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return al(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-e;return al(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new sl(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,r=2*this.canonical.x,i=2*this.canonical.y;return[new sl(t,this.wrap,t,r,i),new sl(t,this.wrap,t,r+1,i),new sl(t,this.wrap,t,r,i+1),new sl(t,this.wrap,t,r+1,i+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new sl(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new sl(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ol(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function al(e,t,r,i,n){const o=1<<Math.min(r,22);let s=o*(n%o)+i%o;return e&&r<22&&(s+=o*o*((e<0?-2*e-1:2*e)%(1<<2*(22-r)))),16*(32*s+r)+(t-r)}const ll=[e=>{let t=e.canonical.x-1,r=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,r--),new sl(e.overscaledZ,r,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,r=e.wrap;return t===1<<e.canonical.z&&(t=0,r++),new sl(e.overscaledZ,r,e.canonical.z,t,e.canonical.y)},e=>new sl(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new sl(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];ro(nl,"CanonicalTileID"),ro(sl,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const cl=0,ul=25.5;function hl(e){return Qa*Math.cos(e*Math.PI/180)}function dl(e){return(180+e)/360}function pl(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function fl(e,t){return e/hl(t)}function ml(e){return 360*e-180}function _l(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function gl(e,t){return e*hl(_l(t))}const yl=85.051129;function xl(e){return Math.cos(v(M(e,-yl,yl)))}function vl(e,t){const r=M(t,cl,ul),i=Math.pow(2,r);return xl(e)*Qa/(512*i)}function bl(e){return 1/Math.cos(e*Math.PI/180)}function wl(e,t=0){const r=Math.exp(Math.PI*(1-(e.y+t/Lr)/(1<<e.z)*2));return 80150034*r/(r*r+1)/Lr/(1<<e.z)}class Tl{constructor(e,t,r=0){this.x=+e,this.y=+t,this.z=+r}static fromLngLat(e,t=0){const r=el.convert(e);return new Tl(dl(r.lng),pl(r.lat),fl(t,r.lat))}toLngLat(){return new el(ml(this.x),_l(this.y))}toAltitude(){return gl(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Qa*bl(_l(this.y))}}function El(e,t,r,i,n,o,s,a,l){const c=(t+i)/2,u=(r+n)/2,h=new g(c,u);a(h),function(e,t,r,i,n,o){const s=r-n,a=i-o;return Math.abs((i-t)*s-(r-e)*a)/Math.hypot(s,a)}(h.x,h.y,o.x,o.y,s.x,s.y)>=l?(El(e,t,r,c,u,o,h,a,l),El(e,c,u,i,n,h,s,a,l)):e.push(s)}function Sl(e,t,r){let i=e[0],n=i.x,o=i.y;t(i);const s=[i];for(let a=1;a<e.length;a++){const l=e[a],{x:c,y:u}=l;t(l),El(s,n,o,c,u,i,l,t,r),n=c,o=u,i=l}return s}function Ml(e,t,r,i){if(i(t,r)){const n=t.add(r)._mult(.5);Ml(e,t,n,i),Ml(e,n,r,i)}else e.push(r)}function Al(e,t){let r=e[0];const i=[r];for(let n=1;n<e.length;n++){const o=e[n];Ml(i,r,o,t),r=o}return i}const Il=Math.pow(2,14)-1,Cl=-Il-1;function Pl(e,t){const r=Math.round(e.x*t),i=Math.round(e.y*t);return e.x=M(r,Cl,Il),e.y=M(i,Cl,Il),(r<e.x||r>e.x+1||i<e.y||i>e.y+1)&&j("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function Ll(e,t,r){const i=e.loadGeometry(),n=e.extent,o=Lr/n;if(t&&r&&r.projection.isReprojectedInTileSpace){const o=1<<t.z,{scale:s,x:a,y:l,projection:c}=r,u=e=>{const r=ml((t.x+e.x/n)/o),i=_l((t.y+e.y/n)/o),u=c.project(r,i);e.x=(u.x*s-a)*n,e.y=(u.y*s-l)*n};for(let t=0;t<i.length;t++)if(1!==e.type)i[t]=Sl(i[t],u,1);else{const e=[];for(const r of i[t])r.x<0||r.x>=n||r.y<0||r.y>=n||(u(r),e.push(r));i[t]=e}}for(const s of i)for(const e of s)Pl(e,o);return i}function Rl(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Ll(e):[]}}function Dl(e,t,r,i,n){e.emplaceBack(2*t+(i+1)/2,2*r+(n+1)/2)}function Ol(e,t,r){const i=16384;e.emplaceBack(t.x,t.y,t.z,r[0]*i,r[1]*i,r[2]*i)}class zl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ps,this.indexArray=new Ps,this.segments=new ra,this.programConfigurations=new ka(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,r,i){const n=this.layers[0],o=[];let s=null;"circle"===n.type&&(s=n.layout.get("circle-sort-key"));for(const{feature:l,id:c,index:u,sourceLayerIndex:h}of e){const e=this.layers[0]._featureFilter.needGeometry,t=Rl(l,e);if(!this.layers[0]._featureFilter.filter(new Co(this.zoom),t,r))continue;const n=s?s.evaluate(t,{},r):void 0,a={id:c,properties:l.properties,type:l.type,sourceLayerIndex:h,index:u,geometry:e?t.geometry:Ll(l,r,i),patterns:{},sortKey:n};o.push(a)}s&&o.sort(((e,t)=>e.sortKey-t.sortKey));let a=null;"globe"===i.projection.name&&(this.globeExtVertexArray=new bs,a=i.projection);for(const l of o){const{geometry:i,index:n,sourceLayerIndex:o}=l,s=e[n].feature;this.addFeature(l,i,n,t.availableImages,r,a,t.brightness),t.featureIndex.insert(s,i,n,o,this.index)}}update(e,t,r,i,n){const o=0!==Object.keys(e).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,o?this.stateDependentLayers:this.layers,r,i,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ea.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,ta.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,r,i,n,o,s){for(const a of t)for(const t of a){const r=t.x,i=t.y;if(r<0||r>=Lr||i<0||i>=Lr)continue;if(o){const e=o.projectTilePoint(r,i,n),t=o.upVector(n,r,i),s=this.globeExtVertexArray;Ol(s,e,t),Ol(s,e,t),Ol(s,e,t),Ol(s,e,t)}const s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),a=s.vertexLength;Dl(this.layoutVertexArray,r,i,-1,-1),Dl(this.layoutVertexArray,r,i,1,-1),Dl(this.layoutVertexArray,r,i,1,1),Dl(this.layoutVertexArray,r,i,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+2,a+3),s.vertexLength+=4,s.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},i,n,s)}}function kl(e,t){for(let r=0;r<e.length;r++)if(ql(t,e[r]))return!0;for(let r=0;r<t.length;r++)if(ql(e,t[r]))return!0;return!!Ul(e,t)}function Fl(e,t,r){return!!ql(e,t)||!!jl(t,e,r)}function Bl(e,t){if(1===e.length)return $l(t,e[0]);for(let r=0;r<t.length;r++){const i=t[r];for(let t=0;t<i.length;t++)if(ql(e,i[t]))return!0}for(let r=0;r<e.length;r++)if($l(t,e[r]))return!0;for(let r=0;r<t.length;r++)if(Ul(e,t[r]))return!0;return!1}function Nl(e,t,r){if(e.length>1){if(Ul(e,t))return!0;for(let i=0;i<t.length;i++)if(jl(t[i],e,r))return!0}for(let i=0;i<e.length;i++)if(jl(e[i],t,r))return!0;return!1}function Ul(e,t){if(0===e.length||0===t.length)return!1;for(let r=0;r<e.length-1;r++){const i=e[r],n=e[r+1];for(let e=0;e<t.length-1;e++)if(Vl(i,n,t[e],t[e+1]))return!0}return!1}function Vl(e,t,r,i){return G(e,r,i)!==G(t,r,i)&&G(e,t,r)!==G(e,t,i)}function jl(e,t,r){const i=r*r;if(1===t.length)return e.distSqr(t[0])<i;for(let n=1;n<t.length;n++)if(Gl(e,t[n-1],t[n])<i)return!0;return!1}function Gl(e,t,r){const i=t.distSqr(r);if(0===i)return e.distSqr(t);const n=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/i;return e.distSqr(n<0?t:n>1?r:r.sub(t)._mult(n)._add(t))}function $l(e,t){let r,i,n,o=!1;for(let s=0;s<e.length;s++){r=e[s];for(let e=0,s=r.length-1;e<r.length;s=e++)i=r[e],n=r[s],i.y>t.y!=n.y>t.y&&t.x<(n.x-i.x)*(t.y-i.y)/(n.y-i.y)+i.x&&(o=!o)}return o}function ql(e,t){let r=!1;for(let i=0,n=e.length-1;i<e.length;n=i++){const o=e[i],s=e[n];o.y>t.y!=s.y>t.y&&t.x<(s.x-o.x)*(t.y-o.y)/(s.y-o.y)+o.x&&(r=!r)}return r}function Zl(e,t,r,i,n){for(const s of e)if(t<=s.x&&r<=s.y&&i>=s.x&&n>=s.y)return!0;const o=[new g(t,r),new g(t,n),new g(i,n),new g(i,r)];if(e.length>2)for(const s of o)if(ql(e,s))return!0;for(let s=0;s<e.length-1;s++)if(Wl(e[s],e[s+1],o))return!0;return!1}function Wl(e,t,r){const i=r[0],n=r[2];if(e.x<i.x&&t.x<i.x||e.x>n.x&&t.x>n.x||e.y<i.y&&t.y<i.y||e.y>n.y&&t.y>n.y)return!1;const o=G(e,t,r[0]);return o!==G(e,t,r[1])||o!==G(e,t,r[2])||o!==G(e,t,r[3])}function Hl(e,t,r,i,n,o){let s=t.y-e.y,a=e.x-t.x;if(o=o||0){const e=s*s+a*a;if(0===e)return!0;const t=Math.sqrt(e);s/=t,a/=t}return!((r.x-e.x)*s+(r.y-e.y)*a-o<0||(i.x-e.x)*s+(i.y-e.y)*a-o<0||(n.x-e.x)*s+(n.y-e.y)*a-o<0)}function Xl(e,t,r,i,n,o,s){return!(Hl(e,t,i,n,o,s)||Hl(t,r,i,n,o,s)||Hl(r,e,i,n,o,s)||Hl(i,n,e,t,r,s)||Hl(n,o,e,t,r,s)||Hl(o,i,e,t,r,s))}function Yl(e,t,r){const i=t.paint.get(e).value;return"constant"===i.kind?i.value:r.programConfigurations.get(t.id).getMaxValue(e)}function Kl(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Jl(e,t,r,i,n){if(!t[0]&&!t[1])return e;const o=g.convert(t)._mult(n);"viewport"===r&&o._rotate(-i);const s=[];for(let a=0;a<e.length;a++)s.push(e[a].sub(o));return s}function Ql(e,t,r,i){const n=g.convert(e)._mult(i);return"viewport"===t&&n._rotate(-r),n}ro(zl,"CircleBucket",{omit:["layers"]});const ec=new Vo({"circle-sort-key":new No($o.layout_circle["circle-sort-key"]),visibility:new Bo($o.layout_circle.visibility)});var tc={paint:new Vo({"circle-radius":new No($o.paint_circle["circle-radius"]),"circle-color":new No($o.paint_circle["circle-color"]),"circle-blur":new No($o.paint_circle["circle-blur"]),"circle-opacity":new No($o.paint_circle["circle-opacity"]),"circle-translate":new Bo($o.paint_circle["circle-translate"]),"circle-translate-anchor":new Bo($o.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Bo($o.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Bo($o.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new No($o.paint_circle["circle-stroke-width"]),"circle-stroke-color":new No($o.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new No($o.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Bo($o.paint_circle["circle-emissive-strength"])}),layout:ec},rc={},ic={};Object.defineProperty(ic,"__esModule",{value:!0}),ic.setMatrixArrayType=function(e){ic.ARRAY_TYPE=oc=e},ic.toRadian=function(e){return e*ac},ic.equals=function(e,t){return Math.abs(e-t)<=nc*Math.max(1,Math.abs(e),Math.abs(t))},ic.RANDOM=ic.ARRAY_TYPE=ic.EPSILON=void 0;var nc=1e-6;ic.EPSILON=nc;var oc="undefined"!=typeof Float32Array?Float32Array:Array;ic.ARRAY_TYPE=oc;var sc=Math.random;ic.RANDOM=sc;var ac=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var lc={};function cc(e){return cc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cc(e)}Object.defineProperty(lc,"__esModule",{value:!0}),lc.create=function(){var e=new uc.ARRAY_TYPE(4);return uc.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},lc.clone=function(e){var t=new uc.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},lc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},lc.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},lc.fromValues=function(e,t,r,i){var n=new uc.ARRAY_TYPE(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n},lc.set=function(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e},lc.transpose=function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},lc.invert=function(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],s=r*o-n*i;return s?(e[0]=o*(s=1/s),e[1]=-i*s,e[2]=-n*s,e[3]=r*s,e):null},lc.adjoint=function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},lc.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},lc.multiply=dc,lc.rotate=function(e,t,r){var i=t[0],n=t[1],o=t[2],s=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+o*a,e[1]=n*l+s*a,e[2]=i*-a+o*l,e[3]=n*-a+s*l,e},lc.scale=function(e,t,r){var i=t[1],n=t[2],o=t[3],s=r[0],a=r[1];return e[0]=t[0]*s,e[1]=i*s,e[2]=n*a,e[3]=o*a,e},lc.fromRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e},lc.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},lc.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},lc.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},lc.LDU=function(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]},lc.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},lc.subtract=pc,lc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},lc.equals=function(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],s=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(r-s)<=uc.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=uc.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-l)<=uc.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(o-c)<=uc.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},lc.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},lc.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},lc.sub=lc.mul=void 0;var uc=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==cc(e)&&"function"!=typeof e)return{default:e};var r=hc(void 0);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,r&&r.set(e,i),i}(ic);function hc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(hc=function(e){return e?r:t})(e)}function dc(e,t,r){var i=t[0],n=t[1],o=t[2],s=t[3],a=r[0],l=r[1],c=r[2],u=r[3];return e[0]=i*a+o*l,e[1]=n*a+s*l,e[2]=i*c+o*u,e[3]=n*c+s*u,e}function pc(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}lc.mul=dc,lc.sub=pc;var fc={};function mc(e){return mc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mc(e)}Object.defineProperty(fc,"__esModule",{value:!0}),fc.create=function(){var e=new _c.ARRAY_TYPE(6);return _c.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},fc.clone=function(e){var t=new _c.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},fc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},fc.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},fc.fromValues=function(e,t,r,i,n,o){var s=new _c.ARRAY_TYPE(6);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s[4]=n,s[5]=o,s},fc.set=function(e,t,r,i,n,o,s){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=o,e[5]=s,e},fc.invert=function(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=r*o-i*n;return l?(e[0]=o*(l=1/l),e[1]=-i*l,e[2]=-n*l,e[3]=r*l,e[4]=(n*a-o*s)*l,e[5]=(i*s-r*a)*l,e):null},fc.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},fc.multiply=yc,fc.rotate=function(e,t,r){var i=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=Math.sin(r),u=Math.cos(r);return e[0]=i*u+o*c,e[1]=n*u+s*c,e[2]=i*-c+o*u,e[3]=n*-c+s*u,e[4]=a,e[5]=l,e},fc.scale=function(e,t,r){var i=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=r[0],c=r[1];return e[0]=t[0]*l,e[1]=i*l,e[2]=n*c,e[3]=o*c,e[4]=s,e[5]=a,e},fc.translate=function(e,t,r){var i=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=r[0],u=r[1];return e[0]=i,e[1]=n,e[2]=o,e[3]=s,e[4]=i*c+o*u+a,e[5]=n*c+s*u+l,e},fc.fromRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e},fc.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},fc.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},fc.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},fc.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},fc.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},fc.subtract=xc,fc.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},fc.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e},fc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},fc.equals=function(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=t[0],c=t[1],u=t[2],h=t[3],d=t[4],p=t[5];return Math.abs(r-l)<=_c.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=_c.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-u)<=_c.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(o-h)<=_c.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-d)<=_c.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(a-p)<=_c.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))},fc.sub=fc.mul=void 0;var _c=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==mc(e)&&"function"!=typeof e)return{default:e};var r=gc(void 0);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,r&&r.set(e,i),i}(ic);function gc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(gc=function(e){return e?r:t})(e)}function yc(e,t,r){var i=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=r[0],u=r[1],h=r[2],d=r[3],p=r[4],f=r[5];return e[0]=i*c+o*u,e[1]=n*c+s*u,e[2]=i*h+o*d,e[3]=n*h+s*d,e[4]=i*p+o*f+a,e[5]=n*p+s*f+l,e}function xc(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}fc.mul=yc,fc.sub=xc;var vc={};function bc(e){return bc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bc(e)}Object.defineProperty(vc,"__esModule",{value:!0}),vc.create=function(){var e=new wc.ARRAY_TYPE(9);return wc.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},vc.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},vc.clone=function(e){var t=new wc.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},vc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},vc.fromValues=function(e,t,r,i,n,o,s,a,l){var c=new wc.ARRAY_TYPE(9);return c[0]=e,c[1]=t,c[2]=r,c[3]=i,c[4]=n,c[5]=o,c[6]=s,c[7]=a,c[8]=l,c},vc.set=function(e,t,r,i,n,o,s,a,l,c){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=o,e[5]=s,e[6]=a,e[7]=l,e[8]=c,e},vc.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},vc.transpose=function(e,t){if(e===t){var r=t[1],i=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},vc.invert=function(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=u*s-a*c,d=-u*o+a*l,p=c*o-s*l,f=r*h+i*d+n*p;return f?(e[0]=h*(f=1/f),e[1]=(-u*i+n*c)*f,e[2]=(a*i-n*s)*f,e[3]=d*f,e[4]=(u*r-n*l)*f,e[5]=(-a*r+n*o)*f,e[6]=p*f,e[7]=(-c*r+i*l)*f,e[8]=(s*r-i*o)*f,e):null},vc.adjoint=function(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return e[0]=s*u-a*c,e[1]=n*c-i*u,e[2]=i*a-n*s,e[3]=a*l-o*u,e[4]=r*u-n*l,e[5]=n*o-r*a,e[6]=o*c-s*l,e[7]=i*l-r*c,e[8]=r*s-i*o,e},vc.determinant=function(e){var t=e[3],r=e[4],i=e[5],n=e[6],o=e[7],s=e[8];return e[0]*(s*r-i*o)+e[1]*(-s*t+i*n)+e[2]*(o*t-r*n)},vc.multiply=Ec,vc.translate=function(e,t,r){var i=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=r[0],p=r[1];return e[0]=i,e[1]=n,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=d*i+p*s+c,e[7]=d*n+p*a+u,e[8]=d*o+p*l+h,e},vc.rotate=function(e,t,r){var i=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=Math.sin(r),p=Math.cos(r);return e[0]=p*i+d*s,e[1]=p*n+d*a,e[2]=p*o+d*l,e[3]=p*s-d*i,e[4]=p*a-d*n,e[5]=p*l-d*o,e[6]=c,e[7]=u,e[8]=h,e},vc.scale=function(e,t,r){var i=r[0],n=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},vc.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},vc.fromRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},vc.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},vc.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},vc.fromQuat=function(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],s=r+r,a=i+i,l=n+n,c=r*s,u=i*s,h=i*a,d=n*s,p=n*a,f=n*l,m=o*s,_=o*a,g=o*l;return e[0]=1-h-f,e[3]=u-g,e[6]=d+_,e[1]=u+g,e[4]=1-c-f,e[7]=p-m,e[2]=d-_,e[5]=p+m,e[8]=1-c-h,e},vc.normalFromMat4=function(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],_=t[14],g=t[15],y=r*a-i*s,x=r*l-n*s,v=r*c-o*s,b=i*l-n*a,w=i*c-o*a,T=n*c-o*l,E=u*m-h*f,S=u*_-d*f,M=u*g-p*f,A=h*_-d*m,I=h*g-p*m,C=d*g-p*_,P=y*C-x*I+v*A+b*M-w*S+T*E;return P?(e[0]=(a*C-l*I+c*A)*(P=1/P),e[1]=(l*M-s*C-c*S)*P,e[2]=(s*I-a*M+c*E)*P,e[3]=(n*I-i*C-o*A)*P,e[4]=(r*C-n*M+o*S)*P,e[5]=(i*M-r*I-o*E)*P,e[6]=(m*T-_*w+g*b)*P,e[7]=(_*v-f*T-g*x)*P,e[8]=(f*w-m*v+g*y)*P,e):null},vc.projection=function(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},vc.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},vc.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},vc.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},vc.subtract=Sc,vc.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},vc.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e},vc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},vc.equals=function(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=t[0],d=t[1],p=t[2],f=t[3],m=t[4],_=t[5],g=t[6],y=t[7],x=t[8];return Math.abs(r-h)<=wc.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-d)<=wc.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(n-p)<=wc.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-f)<=wc.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-m)<=wc.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(a-_)<=wc.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(l-g)<=wc.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-y)<=wc.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(u-x)<=wc.EPSILON*Math.max(1,Math.abs(u),Math.abs(x))},vc.sub=vc.mul=void 0;var wc=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==bc(e)&&"function"!=typeof e)return{default:e};var r=Tc(void 0);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,r&&r.set(e,i),i}(ic);function Tc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Tc=function(e){return e?r:t})(e)}function Ec(e,t,r){var i=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=r[0],p=r[1],f=r[2],m=r[3],_=r[4],g=r[5],y=r[6],x=r[7],v=r[8];return e[0]=d*i+p*s+f*c,e[1]=d*n+p*a+f*u,e[2]=d*o+p*l+f*h,e[3]=m*i+_*s+g*c,e[4]=m*n+_*a+g*u,e[5]=m*o+_*l+g*h,e[6]=y*i+x*s+v*c,e[7]=y*n+x*a+v*u,e[8]=y*o+x*l+v*h,e}function Sc(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}vc.mul=Ec,vc.sub=Sc;var Mc={};function Ac(e){return Ac="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ac(e)}Object.defineProperty(Mc,"__esModule",{value:!0}),Mc.create=function(){var e=new Ic.ARRAY_TYPE(16);return Ic.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},Mc.clone=function(e){var t=new Ic.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Mc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Mc.fromValues=function(e,t,r,i,n,o,s,a,l,c,u,h,d,p,f,m){var _=new Ic.ARRAY_TYPE(16);return _[0]=e,_[1]=t,_[2]=r,_[3]=i,_[4]=n,_[5]=o,_[6]=s,_[7]=a,_[8]=l,_[9]=c,_[10]=u,_[11]=h,_[12]=d,_[13]=p,_[14]=f,_[15]=m,_},Mc.set=function(e,t,r,i,n,o,s,a,l,c,u,h,d,p,f,m,_){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=o,e[5]=s,e[6]=a,e[7]=l,e[8]=c,e[9]=u,e[10]=h,e[11]=d,e[12]=p,e[13]=f,e[14]=m,e[15]=_,e},Mc.identity=Pc,Mc.transpose=function(e,t){if(e===t){var r=t[1],i=t[2],n=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=o,e[11]=t[14],e[12]=n,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},Mc.invert=function(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],_=t[14],g=t[15],y=r*a-i*s,x=r*l-n*s,v=r*c-o*s,b=i*l-n*a,w=i*c-o*a,T=n*c-o*l,E=u*m-h*f,S=u*_-d*f,M=u*g-p*f,A=h*_-d*m,I=h*g-p*m,C=d*g-p*_,P=y*C-x*I+v*A+b*M-w*S+T*E;return P?(e[0]=(a*C-l*I+c*A)*(P=1/P),e[1]=(n*I-i*C-o*A)*P,e[2]=(m*T-_*w+g*b)*P,e[3]=(d*w-h*T-p*b)*P,e[4]=(l*M-s*C-c*S)*P,e[5]=(r*C-n*M+o*S)*P,e[6]=(_*v-f*T-g*x)*P,e[7]=(u*T-d*v+p*x)*P,e[8]=(s*I-a*M+c*E)*P,e[9]=(i*M-r*I-o*E)*P,e[10]=(f*w-m*v+g*y)*P,e[11]=(h*v-u*w-p*y)*P,e[12]=(a*S-s*A-l*E)*P,e[13]=(r*A-i*S+n*E)*P,e[14]=(m*x-f*b-_*y)*P,e[15]=(u*b-h*x+d*y)*P,e):null},Mc.adjoint=function(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],_=t[14],g=t[15];return e[0]=a*(d*g-p*_)-h*(l*g-c*_)+m*(l*p-c*d),e[1]=-(i*(d*g-p*_)-h*(n*g-o*_)+m*(n*p-o*d)),e[2]=i*(l*g-c*_)-a*(n*g-o*_)+m*(n*c-o*l),e[3]=-(i*(l*p-c*d)-a*(n*p-o*d)+h*(n*c-o*l)),e[4]=-(s*(d*g-p*_)-u*(l*g-c*_)+f*(l*p-c*d)),e[5]=r*(d*g-p*_)-u*(n*g-o*_)+f*(n*p-o*d),e[6]=-(r*(l*g-c*_)-s*(n*g-o*_)+f*(n*c-o*l)),e[7]=r*(l*p-c*d)-s*(n*p-o*d)+u*(n*c-o*l),e[8]=s*(h*g-p*m)-u*(a*g-c*m)+f*(a*p-c*h),e[9]=-(r*(h*g-p*m)-u*(i*g-o*m)+f*(i*p-o*h)),e[10]=r*(a*g-c*m)-s*(i*g-o*m)+f*(i*c-o*a),e[11]=-(r*(a*p-c*h)-s*(i*p-o*h)+u*(i*c-o*a)),e[12]=-(s*(h*_-d*m)-u*(a*_-l*m)+f*(a*d-l*h)),e[13]=r*(h*_-d*m)-u*(i*_-n*m)+f*(i*d-n*h),e[14]=-(r*(a*_-l*m)-s*(i*_-n*m)+f*(i*l-n*a)),e[15]=r*(a*d-l*h)-s*(i*d-n*h)+u*(i*l-n*a),e},Mc.determinant=function(e){var t=e[0],r=e[1],i=e[2],n=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],_=e[15];return(t*s-r*o)*(h*_-d*m)-(t*a-i*o)*(u*_-d*f)+(t*l-n*o)*(u*m-h*f)+(r*a-i*s)*(c*_-d*p)-(r*l-n*s)*(c*m-h*p)+(i*l-n*a)*(c*f-u*p)},Mc.multiply=Lc,Mc.translate=function(e,t,r){var i,n,o,s,a,l,c,u,h,d,p,f,m=r[0],_=r[1],g=r[2];return t===e?(e[12]=t[0]*m+t[4]*_+t[8]*g+t[12],e[13]=t[1]*m+t[5]*_+t[9]*g+t[13],e[14]=t[2]*m+t[6]*_+t[10]*g+t[14],e[15]=t[3]*m+t[7]*_+t[11]*g+t[15]):(n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=i=t[0],e[1]=n,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=i*m+a*_+h*g+t[12],e[13]=n*m+l*_+d*g+t[13],e[14]=o*m+c*_+p*g+t[14],e[15]=s*m+u*_+f*g+t[15]),e},Mc.scale=function(e,t,r){var i=r[0],n=r[1],o=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Mc.rotate=function(e,t,r,i){var n,o,s,a,l,c,u,h,d,p,f,m,_,g,y,x,v,b,w,T,E,S,M,A,I=i[0],C=i[1],P=i[2],L=Math.hypot(I,C,P);return L<Ic.EPSILON?null:(I*=L=1/L,C*=L,P*=L,n=Math.sin(r),o=Math.cos(r),l=t[1],c=t[2],u=t[3],d=t[5],p=t[6],f=t[7],_=t[9],g=t[10],y=t[11],x=I*I*(s=1-o)+o,w=I*C*s-P*n,T=C*C*s+o,E=P*C*s+I*n,S=I*P*s+C*n,M=C*P*s-I*n,A=P*P*s+o,e[0]=(a=t[0])*x+(h=t[4])*(v=C*I*s+P*n)+(m=t[8])*(b=P*I*s-C*n),e[1]=l*x+d*v+_*b,e[2]=c*x+p*v+g*b,e[3]=u*x+f*v+y*b,e[4]=a*w+h*T+m*E,e[5]=l*w+d*T+_*E,e[6]=c*w+p*T+g*E,e[7]=u*w+f*T+y*E,e[8]=a*S+h*M+m*A,e[9]=l*S+d*M+_*A,e[10]=c*S+p*M+g*A,e[11]=u*S+f*M+y*A,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},Mc.rotateX=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*n+c*i,e[5]=s*n+u*i,e[6]=a*n+h*i,e[7]=l*n+d*i,e[8]=c*n-o*i,e[9]=u*n-s*i,e[10]=h*n-a*i,e[11]=d*n-l*i,e},Mc.rotateY=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),o=t[0],s=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*n-c*i,e[1]=s*n-u*i,e[2]=a*n-h*i,e[3]=l*n-d*i,e[8]=o*i+c*n,e[9]=s*i+u*n,e[10]=a*i+h*n,e[11]=l*i+d*n,e},Mc.rotateZ=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*n+c*i,e[1]=s*n+u*i,e[2]=a*n+h*i,e[3]=l*n+d*i,e[4]=c*n-o*i,e[5]=u*n-s*i,e[6]=h*n-a*i,e[7]=d*n-l*i,e},Mc.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},Mc.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Mc.fromRotation=function(e,t,r){var i,n,o,s=r[0],a=r[1],l=r[2],c=Math.hypot(s,a,l);return c<Ic.EPSILON?null:(s*=c=1/c,a*=c,l*=c,i=Math.sin(t),n=Math.cos(t),e[0]=s*s*(o=1-n)+n,e[1]=a*s*o+l*i,e[2]=l*s*o-a*i,e[3]=0,e[4]=s*a*o-l*i,e[5]=a*a*o+n,e[6]=l*a*o+s*i,e[7]=0,e[8]=s*l*o+a*i,e[9]=a*l*o-s*i,e[10]=l*l*o+n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},Mc.fromXRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Mc.fromYRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Mc.fromZRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Mc.fromRotationTranslation=Rc,Mc.fromQuat2=function(e,t){var r=new Ic.ARRAY_TYPE(3),i=-t[0],n=-t[1],o=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=i*i+n*n+o*o+s*s;return h>0?(r[0]=2*(a*s+u*i+l*o-c*n)/h,r[1]=2*(l*s+u*n+c*i-a*o)/h,r[2]=2*(c*s+u*o+a*n-l*i)/h):(r[0]=2*(a*s+u*i+l*o-c*n),r[1]=2*(l*s+u*n+c*i-a*o),r[2]=2*(c*s+u*o+a*n-l*i)),Rc(e,t,r),e},Mc.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},Mc.getScaling=Dc,Mc.getRotation=function(e,t){var r=new Ic.ARRAY_TYPE(3);Dc(r,t);var i=1/r[0],n=1/r[1],o=1/r[2],s=t[0]*i,a=t[1]*n,l=t[2]*o,c=t[4]*i,u=t[5]*n,h=t[6]*o,d=t[8]*i,p=t[9]*n,f=t[10]*o,m=s+u+f,_=0;return m>0?(_=2*Math.sqrt(m+1),e[3]=.25*_,e[0]=(h-p)/_,e[1]=(d-l)/_,e[2]=(a-c)/_):s>u&&s>f?(_=2*Math.sqrt(1+s-u-f),e[3]=(h-p)/_,e[0]=.25*_,e[1]=(a+c)/_,e[2]=(d+l)/_):u>f?(_=2*Math.sqrt(1+u-s-f),e[3]=(d-l)/_,e[0]=(a+c)/_,e[1]=.25*_,e[2]=(h+p)/_):(_=2*Math.sqrt(1+f-s-u),e[3]=(a-c)/_,e[0]=(d+l)/_,e[1]=(h+p)/_,e[2]=.25*_),e},Mc.fromRotationTranslationScale=function(e,t,r,i){var n=t[0],o=t[1],s=t[2],a=t[3],l=n+n,c=o+o,u=s+s,h=n*l,d=n*c,p=n*u,f=o*c,m=o*u,_=s*u,g=a*l,y=a*c,x=a*u,v=i[0],b=i[1],w=i[2];return e[0]=(1-(f+_))*v,e[1]=(d+x)*v,e[2]=(p-y)*v,e[3]=0,e[4]=(d-x)*b,e[5]=(1-(h+_))*b,e[6]=(m+g)*b,e[7]=0,e[8]=(p+y)*w,e[9]=(m-g)*w,e[10]=(1-(h+f))*w,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},Mc.fromRotationTranslationScaleOrigin=function(e,t,r,i,n){var o=t[0],s=t[1],a=t[2],l=t[3],c=o+o,u=s+s,h=a+a,d=o*c,p=o*u,f=o*h,m=s*u,_=s*h,g=a*h,y=l*c,x=l*u,v=l*h,b=i[0],w=i[1],T=i[2],E=n[0],S=n[1],M=n[2],A=(1-(m+g))*b,I=(p+v)*b,C=(f-x)*b,P=(p-v)*w,L=(1-(d+g))*w,R=(_+y)*w,D=(f+x)*T,O=(_-y)*T,z=(1-(d+m))*T;return e[0]=A,e[1]=I,e[2]=C,e[3]=0,e[4]=P,e[5]=L,e[6]=R,e[7]=0,e[8]=D,e[9]=O,e[10]=z,e[11]=0,e[12]=r[0]+E-(A*E+P*S+D*M),e[13]=r[1]+S-(I*E+L*S+O*M),e[14]=r[2]+M-(C*E+R*S+z*M),e[15]=1,e},Mc.fromQuat=function(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],s=r+r,a=i+i,l=n+n,c=r*s,u=i*s,h=i*a,d=n*s,p=n*a,f=n*l,m=o*s,_=o*a,g=o*l;return e[0]=1-h-f,e[1]=u+g,e[2]=d-_,e[3]=0,e[4]=u-g,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=d+_,e[9]=p-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Mc.frustum=function(e,t,r,i,n,o,s){var a=1/(r-t),l=1/(n-i),c=1/(o-s);return e[0]=2*o*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*l,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(n+i)*l,e[10]=(s+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*o*2*c,e[15]=0,e},Mc.perspectiveNO=Oc,Mc.perspectiveZO=function(e,t,r,i,n){var o,s=1/Math.tan(t/2);return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(e[10]=n*(o=1/(i-n)),e[14]=n*i*o):(e[10]=-1,e[14]=-i),e},Mc.perspectiveFromFieldOfView=function(e,t,r,i){var n=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(s+a),c=2/(n+o);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(s-a)*l*.5,e[9]=(n-o)*c*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e},Mc.orthoNO=zc,Mc.orthoZO=function(e,t,r,i,n,o,s){var a=1/(t-r),l=1/(i-n),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=c,e[11]=0,e[12]=(t+r)*a,e[13]=(n+i)*l,e[14]=o*c,e[15]=1,e},Mc.lookAt=function(e,t,r,i){var n,o,s,a,l,c,u,h,d,p,f=t[0],m=t[1],_=t[2],g=i[0],y=i[1],x=i[2],v=r[0],b=r[1],w=r[2];return Math.abs(f-v)<Ic.EPSILON&&Math.abs(m-b)<Ic.EPSILON&&Math.abs(_-w)<Ic.EPSILON?Pc(e):(u=f-v,h=m-b,d=_-w,n=y*(d*=p=1/Math.hypot(u,h,d))-x*(h*=p),o=x*(u*=p)-g*d,s=g*h-y*u,(p=Math.hypot(n,o,s))?(n*=p=1/p,o*=p,s*=p):(n=0,o=0,s=0),a=h*s-d*o,l=d*n-u*s,c=u*o-h*n,(p=Math.hypot(a,l,c))?(a*=p=1/p,l*=p,c*=p):(a=0,l=0,c=0),e[0]=n,e[1]=a,e[2]=u,e[3]=0,e[4]=o,e[5]=l,e[6]=h,e[7]=0,e[8]=s,e[9]=c,e[10]=d,e[11]=0,e[12]=-(n*f+o*m+s*_),e[13]=-(a*f+l*m+c*_),e[14]=-(u*f+h*m+d*_),e[15]=1,e)},Mc.targetTo=function(e,t,r,i){var n=t[0],o=t[1],s=t[2],a=i[0],l=i[1],c=i[2],u=n-r[0],h=o-r[1],d=s-r[2],p=u*u+h*h+d*d;p>0&&(u*=p=1/Math.sqrt(p),h*=p,d*=p);var f=l*d-c*h,m=c*u-a*d,_=a*h-l*u;return(p=f*f+m*m+_*_)>0&&(f*=p=1/Math.sqrt(p),m*=p,_*=p),e[0]=f,e[1]=m,e[2]=_,e[3]=0,e[4]=h*_-d*m,e[5]=d*f-u*_,e[6]=u*m-h*f,e[7]=0,e[8]=u,e[9]=h,e[10]=d,e[11]=0,e[12]=n,e[13]=o,e[14]=s,e[15]=1,e},Mc.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},Mc.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},Mc.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},Mc.subtract=kc,Mc.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},Mc.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e},Mc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},Mc.equals=function(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],_=e[14],g=e[15],y=t[0],x=t[1],v=t[2],b=t[3],w=t[4],T=t[5],E=t[6],S=t[7],M=t[8],A=t[9],I=t[10],C=t[11],P=t[12],L=t[13],R=t[14],D=t[15];return Math.abs(r-y)<=Ic.EPSILON*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(i-x)<=Ic.EPSILON*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(n-v)<=Ic.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(o-b)<=Ic.EPSILON*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(s-w)<=Ic.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(a-T)<=Ic.EPSILON*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(l-E)<=Ic.EPSILON*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(c-S)<=Ic.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(u-M)<=Ic.EPSILON*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(h-A)<=Ic.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(d-I)<=Ic.EPSILON*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(p-C)<=Ic.EPSILON*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(f-P)<=Ic.EPSILON*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(m-L)<=Ic.EPSILON*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(_-R)<=Ic.EPSILON*Math.max(1,Math.abs(_),Math.abs(R))&&Math.abs(g-D)<=Ic.EPSILON*Math.max(1,Math.abs(g),Math.abs(D))},Mc.sub=Mc.mul=Mc.ortho=Mc.perspective=void 0;var Ic=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Ac(e)&&"function"!=typeof e)return{default:e};var r=Cc(void 0);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,r&&r.set(e,i),i}(ic);function Cc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Cc=function(e){return e?r:t})(e)}function Pc(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Lc(e,t,r){var i=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],_=t[13],g=t[14],y=t[15],x=r[0],v=r[1],b=r[2],w=r[3];return e[0]=x*i+v*a+b*h+w*m,e[1]=x*n+v*l+b*d+w*_,e[2]=x*o+v*c+b*p+w*g,e[3]=x*s+v*u+b*f+w*y,e[4]=(x=r[4])*i+(v=r[5])*a+(b=r[6])*h+(w=r[7])*m,e[5]=x*n+v*l+b*d+w*_,e[6]=x*o+v*c+b*p+w*g,e[7]=x*s+v*u+b*f+w*y,e[8]=(x=r[8])*i+(v=r[9])*a+(b=r[10])*h+(w=r[11])*m,e[9]=x*n+v*l+b*d+w*_,e[10]=x*o+v*c+b*p+w*g,e[11]=x*s+v*u+b*f+w*y,e[12]=(x=r[12])*i+(v=r[13])*a+(b=r[14])*h+(w=r[15])*m,e[13]=x*n+v*l+b*d+w*_,e[14]=x*o+v*c+b*p+w*g,e[15]=x*s+v*u+b*f+w*y,e}function Rc(e,t,r){var i=t[0],n=t[1],o=t[2],s=t[3],a=i+i,l=n+n,c=o+o,u=i*a,h=i*l,d=i*c,p=n*l,f=n*c,m=o*c,_=s*a,g=s*l,y=s*c;return e[0]=1-(p+m),e[1]=h+y,e[2]=d-g,e[3]=0,e[4]=h-y,e[5]=1-(u+m),e[6]=f+_,e[7]=0,e[8]=d+g,e[9]=f-_,e[10]=1-(u+p),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Dc(e,t){var r=t[4],i=t[5],n=t[6],o=t[8],s=t[9],a=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(r,i,n),e[2]=Math.hypot(o,s,a),e}function Oc(e,t,r,i,n){var o,s=1/Math.tan(t/2);return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(e[10]=(n+i)*(o=1/(i-n)),e[14]=2*n*i*o):(e[10]=-1,e[14]=-2*i),e}function zc(e,t,r,i,n,o,s){var a=1/(t-r),l=1/(i-n),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*a,e[13]=(n+i)*l,e[14]=(s+o)*c,e[15]=1,e}function kc(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}Mc.perspective=Oc,Mc.ortho=zc,Mc.mul=Lc,Mc.sub=kc;var Fc={},Bc={};function Nc(e){return Nc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nc(e)}Object.defineProperty(Bc,"__esModule",{value:!0}),Bc.create=jc,Bc.clone=function(e){var t=new Uc.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Bc.length=Gc,Bc.fromValues=function(e,t,r){var i=new Uc.ARRAY_TYPE(3);return i[0]=e,i[1]=t,i[2]=r,i},Bc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Bc.set=function(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e},Bc.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},Bc.subtract=$c,Bc.multiply=qc,Bc.divide=Zc,Bc.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},Bc.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},Bc.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},Bc.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},Bc.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},Bc.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},Bc.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e},Bc.distance=Wc,Bc.squaredDistance=Hc,Bc.squaredLength=Xc,Bc.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},Bc.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},Bc.normalize=function(e,t){var r=t[0],i=t[1],n=t[2],o=r*r+i*i+n*n;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e},Bc.dot=Yc,Bc.cross=function(e,t,r){var i=t[0],n=t[1],o=t[2],s=r[0],a=r[1],l=r[2];return e[0]=n*l-o*a,e[1]=o*s-i*l,e[2]=i*a-n*s,e},Bc.lerp=function(e,t,r,i){var n=t[0],o=t[1],s=t[2];return e[0]=n+i*(r[0]-n),e[1]=o+i*(r[1]-o),e[2]=s+i*(r[2]-s),e},Bc.hermite=function(e,t,r,i,n,o){var s=o*o,a=s*(2*o-3)+1,l=s*(o-2)+o,c=s*(o-1),u=s*(3-2*o);return e[0]=t[0]*a+r[0]*l+i[0]*c+n[0]*u,e[1]=t[1]*a+r[1]*l+i[1]*c+n[1]*u,e[2]=t[2]*a+r[2]*l+i[2]*c+n[2]*u,e},Bc.bezier=function(e,t,r,i,n,o){var s=1-o,a=s*s,l=o*o,c=a*s,u=3*o*a,h=3*l*s,d=l*o;return e[0]=t[0]*c+r[0]*u+i[0]*h+n[0]*d,e[1]=t[1]*c+r[1]*u+i[1]*h+n[1]*d,e[2]=t[2]*c+r[2]*u+i[2]*h+n[2]*d,e},Bc.random=function(e,t){t=t||1;var r=2*Uc.RANDOM()*Math.PI,i=2*Uc.RANDOM()-1,n=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e[2]=i*t,e},Bc.transformMat4=function(e,t,r){var i=t[0],n=t[1],o=t[2],s=r[3]*i+r[7]*n+r[11]*o+r[15];return e[0]=(r[0]*i+r[4]*n+r[8]*o+r[12])/(s=s||1),e[1]=(r[1]*i+r[5]*n+r[9]*o+r[13])/s,e[2]=(r[2]*i+r[6]*n+r[10]*o+r[14])/s,e},Bc.transformMat3=function(e,t,r){var i=t[0],n=t[1],o=t[2];return e[0]=i*r[0]+n*r[3]+o*r[6],e[1]=i*r[1]+n*r[4]+o*r[7],e[2]=i*r[2]+n*r[5]+o*r[8],e},Bc.transformQuat=function(e,t,r){var i=r[0],n=r[1],o=r[2],s=t[0],a=t[1],l=t[2],c=n*l-o*a,u=o*s-i*l,h=i*a-n*s,d=n*h-o*u,p=o*c-i*h,f=i*u-n*c,m=2*r[3];return u*=m,h*=m,p*=2,f*=2,e[0]=s+(c*=m)+(d*=2),e[1]=a+u+p,e[2]=l+h+f,e},Bc.rotateX=function(e,t,r,i){var n=[],o=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],o[0]=n[0],o[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),o[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e},Bc.rotateY=function(e,t,r,i){var n=[],o=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],o[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),o[1]=n[1],o[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e},Bc.rotateZ=function(e,t,r,i){var n=[],o=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],o[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),o[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),o[2]=n[2],e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e},Bc.angle=function(e,t){var r=e[0],i=e[1],n=e[2],o=t[0],s=t[1],a=t[2],l=Math.sqrt(r*r+i*i+n*n)*Math.sqrt(o*o+s*s+a*a),c=l&&Yc(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))},Bc.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e},Bc.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},Bc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},Bc.equals=function(e,t){var r=e[0],i=e[1],n=e[2],o=t[0],s=t[1],a=t[2];return Math.abs(r-o)<=Uc.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=Uc.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-a)<=Uc.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))},Bc.forEach=Bc.sqrLen=Bc.len=Bc.sqrDist=Bc.dist=Bc.div=Bc.mul=Bc.sub=void 0;var Uc=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Nc(e)&&"function"!=typeof e)return{default:e};var r=Vc(void 0);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,r&&r.set(e,i),i}(ic);function Vc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Vc=function(e){return e?r:t})(e)}function jc(){var e=new Uc.ARRAY_TYPE(3);return Uc.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Gc(e){return Math.hypot(e[0],e[1],e[2])}function $c(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function qc(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function Zc(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function Wc(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function Hc(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function Xc(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function Yc(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}Bc.sub=$c,Bc.mul=qc,Bc.div=Zc,Bc.dist=Wc,Bc.sqrDist=Hc,Bc.len=Gc,Bc.sqrLen=Xc;var Kc,Jc=(Kc=jc(),function(e,t,r,i,n,o){var s,a;for(t||(t=3),r||(r=0),a=i?Math.min(i*t+r,e.length):e.length,s=r;s<a;s+=t)Kc[0]=e[s],Kc[1]=e[s+1],Kc[2]=e[s+2],n(Kc,Kc,o),e[s]=Kc[0],e[s+1]=Kc[1],e[s+2]=Kc[2];return e});Bc.forEach=Jc;var Qc={};function eu(e){return eu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},eu(e)}Object.defineProperty(Qc,"__esModule",{value:!0}),Qc.create=iu,Qc.clone=function(e){var t=new tu.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Qc.fromValues=function(e,t,r,i){var n=new tu.ARRAY_TYPE(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n},Qc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Qc.set=function(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e},Qc.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},Qc.subtract=nu,Qc.multiply=ou,Qc.divide=su,Qc.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},Qc.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},Qc.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},Qc.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},Qc.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},Qc.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},Qc.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},Qc.distance=au,Qc.squaredDistance=lu,Qc.length=cu,Qc.squaredLength=uu,Qc.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},Qc.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},Qc.normalize=function(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],s=r*r+i*i+n*n+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=r*s,e[1]=i*s,e[2]=n*s,e[3]=o*s,e},Qc.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},Qc.cross=function(e,t,r,i){var n=r[0]*i[1]-r[1]*i[0],o=r[0]*i[2]-r[2]*i[0],s=r[0]*i[3]-r[3]*i[0],a=r[1]*i[2]-r[2]*i[1],l=r[1]*i[3]-r[3]*i[1],c=r[2]*i[3]-r[3]*i[2],u=t[0],h=t[1],d=t[2],p=t[3];return e[0]=h*c-d*l+p*a,e[1]=-u*c+d*s-p*o,e[2]=u*l-h*s+p*n,e[3]=-u*a+h*o-d*n,e},Qc.lerp=function(e,t,r,i){var n=t[0],o=t[1],s=t[2],a=t[3];return e[0]=n+i*(r[0]-n),e[1]=o+i*(r[1]-o),e[2]=s+i*(r[2]-s),e[3]=a+i*(r[3]-a),e},Qc.random=function(e,t){var r,i,n,o,s,a;t=t||1;do{s=(r=2*tu.RANDOM()-1)*r+(i=2*tu.RANDOM()-1)*i}while(s>=1);do{a=(n=2*tu.RANDOM()-1)*n+(o=2*tu.RANDOM()-1)*o}while(a>=1);var l=Math.sqrt((1-s)/a);return e[0]=t*r,e[1]=t*i,e[2]=t*n*l,e[3]=t*o*l,e},Qc.transformMat4=function(e,t,r){var i=t[0],n=t[1],o=t[2],s=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*o+r[12]*s,e[1]=r[1]*i+r[5]*n+r[9]*o+r[13]*s,e[2]=r[2]*i+r[6]*n+r[10]*o+r[14]*s,e[3]=r[3]*i+r[7]*n+r[11]*o+r[15]*s,e},Qc.transformQuat=function(e,t,r){var i=t[0],n=t[1],o=t[2],s=r[0],a=r[1],l=r[2],c=r[3],u=c*i+a*o-l*n,h=c*n+l*i-s*o,d=c*o+s*n-a*i,p=-s*i-a*n-l*o;return e[0]=u*c+p*-s+h*-l-d*-a,e[1]=h*c+p*-a+d*-s-u*-l,e[2]=d*c+p*-l+u*-a-h*-s,e[3]=t[3],e},Qc.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},Qc.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Qc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},Qc.equals=function(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],s=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(r-s)<=tu.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=tu.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-l)<=tu.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(o-c)<=tu.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},Qc.forEach=Qc.sqrLen=Qc.len=Qc.sqrDist=Qc.dist=Qc.div=Qc.mul=Qc.sub=void 0;var tu=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==eu(e)&&"function"!=typeof e)return{default:e};var r=ru(void 0);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,r&&r.set(e,i),i}(ic);function ru(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(ru=function(e){return e?r:t})(e)}function iu(){var e=new tu.ARRAY_TYPE(4);return tu.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function nu(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function ou(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function su(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function au(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function lu(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],o=t[3]-e[3];return r*r+i*i+n*n+o*o}function cu(e){return Math.hypot(e[0],e[1],e[2],e[3])}function uu(e){var t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n}Qc.sub=nu,Qc.mul=ou,Qc.div=su,Qc.dist=au,Qc.sqrDist=lu,Qc.len=cu,Qc.sqrLen=uu;var hu=function(){var e=iu();return function(t,r,i,n,o,s){var a,l;for(r||(r=4),i||(i=0),l=n?Math.min(n*r+i,t.length):t.length,a=i;a<l;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],o(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}}();function du(e){return du="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},du(e)}Qc.forEach=hu,Object.defineProperty(Fc,"__esModule",{value:!0}),Fc.create=xu,Fc.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},Fc.setAxisAngle=vu,Fc.getAxisAngle=function(e,t){var r=2*Math.acos(t[3]),i=Math.sin(r/2);return i>pu.EPSILON?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r},Fc.getAngle=function(e,t){var r=Au(e,t);return Math.acos(2*r*r-1)},Fc.multiply=bu,Fc.rotateX=function(e,t,r){r*=.5;var i=t[0],n=t[1],o=t[2],s=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+s*a,e[1]=n*l+o*a,e[2]=o*l-n*a,e[3]=s*l-i*a,e},Fc.rotateY=function(e,t,r){r*=.5;var i=t[0],n=t[1],o=t[2],s=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l-o*a,e[1]=n*l+s*a,e[2]=o*l+i*a,e[3]=s*l-n*a,e},Fc.rotateZ=function(e,t,r){r*=.5;var i=t[0],n=t[1],o=t[2],s=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*a,e[1]=n*l-i*a,e[2]=o*l+s*a,e[3]=s*l-o*a,e},Fc.calculateW=function(e,t){var r=t[0],i=t[1],n=t[2];return e[0]=r,e[1]=i,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),e},Fc.exp=wu,Fc.ln=Tu,Fc.pow=function(e,t,r){return Tu(e,t),Mu(e,e,r),wu(e,e),e},Fc.slerp=Eu,Fc.random=function(e){var t=pu.RANDOM(),r=pu.RANDOM(),i=pu.RANDOM(),n=Math.sqrt(1-t),o=Math.sqrt(t);return e[0]=n*Math.sin(2*Math.PI*r),e[1]=n*Math.cos(2*Math.PI*r),e[2]=o*Math.sin(2*Math.PI*i),e[3]=o*Math.cos(2*Math.PI*i),e},Fc.invert=function(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],s=r*r+i*i+n*n+o*o,a=s?1/s:0;return e[0]=-r*a,e[1]=-i*a,e[2]=-n*a,e[3]=o*a,e},Fc.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},Fc.fromMat3=Su,Fc.fromEuler=function(e,t,r,i){var n=.5*Math.PI/180;t*=n,r*=n,i*=n;var o=Math.sin(t),s=Math.cos(t),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),u=Math.cos(i);return e[0]=o*l*u-s*a*c,e[1]=s*a*u+o*l*c,e[2]=s*l*c-o*a*u,e[3]=s*l*u+o*a*c,e},Fc.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Fc.setAxes=Fc.sqlerp=Fc.rotationTo=Fc.equals=Fc.exactEquals=Fc.normalize=Fc.sqrLen=Fc.squaredLength=Fc.len=Fc.length=Fc.lerp=Fc.dot=Fc.scale=Fc.mul=Fc.add=Fc.set=Fc.copy=Fc.fromValues=Fc.clone=void 0;var pu=yu(ic),fu=yu(vc),mu=yu(Bc),_u=yu(Qc);function gu(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(gu=function(e){return e?r:t})(e)}function yu(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==du(e)&&"function"!=typeof e)return{default:e};var r=gu(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,r&&r.set(e,i),i}function xu(){var e=new pu.ARRAY_TYPE(4);return pu.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function vu(e,t,r){r*=.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function bu(e,t,r){var i=t[0],n=t[1],o=t[2],s=t[3],a=r[0],l=r[1],c=r[2],u=r[3];return e[0]=i*u+s*a+n*c-o*l,e[1]=n*u+s*l+o*a-i*c,e[2]=o*u+s*c+i*l-n*a,e[3]=s*u-i*a-n*l-o*c,e}function wu(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],s=Math.sqrt(r*r+i*i+n*n),a=Math.exp(o),l=s>0?a*Math.sin(s)/s:0;return e[0]=r*l,e[1]=i*l,e[2]=n*l,e[3]=a*Math.cos(s),e}function Tu(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],s=Math.sqrt(r*r+i*i+n*n),a=s>0?Math.atan2(s,o)/s:0;return e[0]=r*a,e[1]=i*a,e[2]=n*a,e[3]=.5*Math.log(r*r+i*i+n*n+o*o),e}function Eu(e,t,r,i){var n,o,s,a,l,c=t[0],u=t[1],h=t[2],d=t[3],p=r[0],f=r[1],m=r[2],_=r[3];return(o=c*p+u*f+h*m+d*_)<0&&(o=-o,p=-p,f=-f,m=-m,_=-_),1-o>pu.EPSILON?(n=Math.acos(o),s=Math.sin(n),a=Math.sin((1-i)*n)/s,l=Math.sin(i*n)/s):(a=1-i,l=i),e[0]=a*c+l*p,e[1]=a*u+l*f,e[2]=a*h+l*m,e[3]=a*d+l*_,e}function Su(e,t){var r,i=t[0]+t[4]+t[8];if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,e[0]=(t[5]-t[7])*(r=.5/r),e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);var o=(n+1)%3,s=(n+2)%3;r=Math.sqrt(t[3*n+n]-t[3*o+o]-t[3*s+s]+1),e[n]=.5*r,e[3]=(t[3*o+s]-t[3*s+o])*(r=.5/r),e[o]=(t[3*o+n]+t[3*n+o])*r,e[s]=(t[3*s+n]+t[3*n+s])*r}return e}Fc.clone=_u.clone,Fc.fromValues=_u.fromValues,Fc.copy=_u.copy,Fc.set=_u.set,Fc.add=_u.add,Fc.mul=bu;var Mu=_u.scale;Fc.scale=Mu;var Au=_u.dot;Fc.dot=Au,Fc.lerp=_u.lerp;var Iu=_u.length;Fc.length=Iu,Fc.len=Iu;var Cu=_u.squaredLength;Fc.squaredLength=Cu,Fc.sqrLen=Cu;var Pu=_u.normalize;Fc.normalize=Pu,Fc.exactEquals=_u.exactEquals,Fc.equals=_u.equals;var Lu,Ru,Du,Ou=(Lu=mu.create(),Ru=mu.fromValues(1,0,0),Du=mu.fromValues(0,1,0),function(e,t,r){var i=mu.dot(t,r);return i<-.999999?(mu.cross(Lu,Ru,t),mu.len(Lu)<1e-6&&mu.cross(Lu,Du,t),mu.normalize(Lu,Lu),vu(e,Lu,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(mu.cross(Lu,t,r),e[0]=Lu[0],e[1]=Lu[1],e[2]=Lu[2],e[3]=1+i,Pu(e,e))});Fc.rotationTo=Ou;var zu,ku,Fu=(zu=xu(),ku=xu(),function(e,t,r,i,n,o){return Eu(zu,t,n,o),Eu(ku,r,i,o),Eu(e,zu,ku,2*o*(1-o)),e});Fc.sqlerp=Fu;var Bu,Nu=(Bu=fu.create(),function(e,t,r,i){return Bu[0]=r[0],Bu[3]=r[1],Bu[6]=r[2],Bu[1]=i[0],Bu[4]=i[1],Bu[7]=i[2],Bu[2]=-t[0],Bu[5]=-t[1],Bu[8]=-t[2],Pu(e,Su(e,Bu))});Fc.setAxes=Nu;var Uu={};function Vu(e){return Vu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vu(e)}Object.defineProperty(Uu,"__esModule",{value:!0}),Uu.create=function(){var e=new ju.ARRAY_TYPE(8);return ju.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},Uu.clone=function(e){var t=new ju.ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},Uu.fromValues=function(e,t,r,i,n,o,s,a){var l=new ju.ARRAY_TYPE(8);return l[0]=e,l[1]=t,l[2]=r,l[3]=i,l[4]=n,l[5]=o,l[6]=s,l[7]=a,l},Uu.fromRotationTranslationValues=function(e,t,r,i,n,o,s){var a=new ju.ARRAY_TYPE(8);a[0]=e,a[1]=t,a[2]=r,a[3]=i;var l=.5*n,c=.5*o,u=.5*s;return a[4]=l*i+c*r-u*t,a[5]=c*i+u*e-l*r,a[6]=u*i+l*t-c*e,a[7]=-l*e-c*t-u*r,a},Uu.fromRotationTranslation=Wu,Uu.fromTranslation=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},Uu.fromRotation=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},Uu.fromMat4=function(e,t){var r=Gu.create();$u.getRotation(r,t);var i=new ju.ARRAY_TYPE(3);return $u.getTranslation(i,t),Wu(e,r,i),e},Uu.copy=Hu,Uu.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},Uu.set=function(e,t,r,i,n,o,s,a,l){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=o,e[5]=s,e[6]=a,e[7]=l,e},Uu.getDual=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},Uu.setDual=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},Uu.getTranslation=function(e,t){var r=t[4],i=t[5],n=t[6],o=t[7],s=-t[0],a=-t[1],l=-t[2],c=t[3];return e[0]=2*(r*c+o*s+i*l-n*a),e[1]=2*(i*c+o*a+n*s-r*l),e[2]=2*(n*c+o*l+r*a-i*s),e},Uu.translate=function(e,t,r){var i=t[0],n=t[1],o=t[2],s=t[3],a=.5*r[0],l=.5*r[1],c=.5*r[2],u=t[4],h=t[5],d=t[6],p=t[7];return e[0]=i,e[1]=n,e[2]=o,e[3]=s,e[4]=s*a+n*c-o*l+u,e[5]=s*l+o*a-i*c+h,e[6]=s*c+i*l-n*a+d,e[7]=-i*a-n*l-o*c+p,e},Uu.rotateX=function(e,t,r){var i=-t[0],n=-t[1],o=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=a*s+u*i+l*o-c*n,d=l*s+u*n+c*i-a*o,p=c*s+u*o+a*n-l*i,f=u*s-a*i-l*n-c*o;return Gu.rotateX(e,t,r),e[4]=h*(s=e[3])+f*(i=e[0])+d*(o=e[2])-p*(n=e[1]),e[5]=d*s+f*n+p*i-h*o,e[6]=p*s+f*o+h*n-d*i,e[7]=f*s-h*i-d*n-p*o,e},Uu.rotateY=function(e,t,r){var i=-t[0],n=-t[1],o=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=a*s+u*i+l*o-c*n,d=l*s+u*n+c*i-a*o,p=c*s+u*o+a*n-l*i,f=u*s-a*i-l*n-c*o;return Gu.rotateY(e,t,r),e[4]=h*(s=e[3])+f*(i=e[0])+d*(o=e[2])-p*(n=e[1]),e[5]=d*s+f*n+p*i-h*o,e[6]=p*s+f*o+h*n-d*i,e[7]=f*s-h*i-d*n-p*o,e},Uu.rotateZ=function(e,t,r){var i=-t[0],n=-t[1],o=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=a*s+u*i+l*o-c*n,d=l*s+u*n+c*i-a*o,p=c*s+u*o+a*n-l*i,f=u*s-a*i-l*n-c*o;return Gu.rotateZ(e,t,r),e[4]=h*(s=e[3])+f*(i=e[0])+d*(o=e[2])-p*(n=e[1]),e[5]=d*s+f*n+p*i-h*o,e[6]=p*s+f*o+h*n-d*i,e[7]=f*s-h*i-d*n-p*o,e},Uu.rotateByQuatAppend=function(e,t,r){var i=r[0],n=r[1],o=r[2],s=r[3],a=t[0],l=t[1],c=t[2],u=t[3];return e[0]=a*s+u*i+l*o-c*n,e[1]=l*s+u*n+c*i-a*o,e[2]=c*s+u*o+a*n-l*i,e[3]=u*s-a*i-l*n-c*o,e[4]=(a=t[4])*s+(u=t[7])*i+(l=t[5])*o-(c=t[6])*n,e[5]=l*s+u*n+c*i-a*o,e[6]=c*s+u*o+a*n-l*i,e[7]=u*s-a*i-l*n-c*o,e},Uu.rotateByQuatPrepend=function(e,t,r){var i=t[0],n=t[1],o=t[2],s=t[3],a=r[0],l=r[1],c=r[2],u=r[3];return e[0]=i*u+s*a+n*c-o*l,e[1]=n*u+s*l+o*a-i*c,e[2]=o*u+s*c+i*l-n*a,e[3]=s*u-i*a-n*l-o*c,e[4]=i*(u=r[7])+s*(a=r[4])+n*(c=r[6])-o*(l=r[5]),e[5]=n*u+s*l+o*a-i*c,e[6]=o*u+s*c+i*l-n*a,e[7]=s*u-i*a-n*l-o*c,e},Uu.rotateAroundAxis=function(e,t,r,i){if(Math.abs(i)<ju.EPSILON)return Hu(e,t);var n=Math.hypot(r[0],r[1],r[2]);i*=.5;var o=Math.sin(i),s=o*r[0]/n,a=o*r[1]/n,l=o*r[2]/n,c=Math.cos(i),u=t[0],h=t[1],d=t[2],p=t[3];e[0]=u*c+p*s+h*l-d*a,e[1]=h*c+p*a+d*s-u*l,e[2]=d*c+p*l+u*a-h*s,e[3]=p*c-u*s-h*a-d*l;var f=t[4],m=t[5],_=t[6],g=t[7];return e[4]=f*c+g*s+m*l-_*a,e[5]=m*c+g*a+_*s-f*l,e[6]=_*c+g*l+f*a-m*s,e[7]=g*c-f*s-m*a-_*l,e},Uu.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e},Uu.multiply=Xu,Uu.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e},Uu.lerp=function(e,t,r,i){var n=1-i;return Yu(t,r)<0&&(i=-i),e[0]=t[0]*n+r[0]*i,e[1]=t[1]*n+r[1]*i,e[2]=t[2]*n+r[2]*i,e[3]=t[3]*n+r[3]*i,e[4]=t[4]*n+r[4]*i,e[5]=t[5]*n+r[5]*i,e[6]=t[6]*n+r[6]*i,e[7]=t[7]*n+r[7]*i,e},Uu.invert=function(e,t){var r=Ju(t);return e[0]=-t[0]/r,e[1]=-t[1]/r,e[2]=-t[2]/r,e[3]=t[3]/r,e[4]=-t[4]/r,e[5]=-t[5]/r,e[6]=-t[6]/r,e[7]=t[7]/r,e},Uu.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},Uu.normalize=function(e,t){var r=Ju(t);if(r>0){r=Math.sqrt(r);var i=t[0]/r,n=t[1]/r,o=t[2]/r,s=t[3]/r,a=t[4],l=t[5],c=t[6],u=t[7],h=i*a+n*l+o*c+s*u;e[0]=i,e[1]=n,e[2]=o,e[3]=s,e[4]=(a-i*h)/r,e[5]=(l-n*h)/r,e[6]=(c-o*h)/r,e[7]=(u-s*h)/r}return e},Uu.str=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},Uu.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},Uu.equals=function(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=t[0],h=t[1],d=t[2],p=t[3],f=t[4],m=t[5],_=t[6],g=t[7];return Math.abs(r-u)<=ju.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-h)<=ju.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-d)<=ju.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-p)<=ju.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-f)<=ju.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(a-m)<=ju.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(l-_)<=ju.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(c-g)<=ju.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))},Uu.sqrLen=Uu.squaredLength=Uu.len=Uu.length=Uu.dot=Uu.mul=Uu.setReal=Uu.getReal=void 0;var ju=Zu(ic),Gu=Zu(Fc),$u=Zu(Mc);function qu(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(qu=function(e){return e?r:t})(e)}function Zu(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==Vu(e)&&"function"!=typeof e)return{default:e};var r=qu(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,r&&r.set(e,i),i}function Wu(e,t,r){var i=.5*r[0],n=.5*r[1],o=.5*r[2],s=t[0],a=t[1],l=t[2],c=t[3];return e[0]=s,e[1]=a,e[2]=l,e[3]=c,e[4]=i*c+n*l-o*a,e[5]=n*c+o*s-i*l,e[6]=o*c+i*a-n*s,e[7]=-i*s-n*a-o*l,e}function Hu(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function Xu(e,t,r){var i=t[0],n=t[1],o=t[2],s=t[3],a=r[4],l=r[5],c=r[6],u=r[7],h=t[4],d=t[5],p=t[6],f=t[7],m=r[0],_=r[1],g=r[2],y=r[3];return e[0]=i*y+s*m+n*g-o*_,e[1]=n*y+s*_+o*m-i*g,e[2]=o*y+s*g+i*_-n*m,e[3]=s*y-i*m-n*_-o*g,e[4]=i*u+s*a+n*c-o*l+h*y+f*m+d*g-p*_,e[5]=n*u+s*l+o*a-i*c+d*y+f*_+p*m-h*g,e[6]=o*u+s*c+i*l-n*a+p*y+f*g+h*_-d*m,e[7]=s*u-i*a-n*l-o*c+f*y-h*m-d*_-p*g,e}Uu.getReal=Gu.copy,Uu.setReal=Gu.copy,Uu.mul=Xu;var Yu=Gu.dot;Uu.dot=Yu;var Ku=Gu.length;Uu.length=Ku,Uu.len=Ku;var Ju=Gu.squaredLength;Uu.squaredLength=Ju,Uu.sqrLen=Ju;var Qu={};function eh(e){return eh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},eh(e)}Object.defineProperty(Qu,"__esModule",{value:!0}),Qu.create=ih,Qu.clone=function(e){var t=new th.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},Qu.fromValues=function(e,t){var r=new th.ARRAY_TYPE(2);return r[0]=e,r[1]=t,r},Qu.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},Qu.set=function(e,t,r){return e[0]=t,e[1]=r,e},Qu.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},Qu.subtract=nh,Qu.multiply=oh,Qu.divide=sh,Qu.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},Qu.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},Qu.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},Qu.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},Qu.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},Qu.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},Qu.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e},Qu.distance=ah,Qu.squaredDistance=lh,Qu.length=ch,Qu.squaredLength=uh,Qu.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},Qu.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},Qu.normalize=function(e,t){var r=t[0],i=t[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e},Qu.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},Qu.cross=function(e,t,r){var i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e},Qu.lerp=function(e,t,r,i){var n=t[0],o=t[1];return e[0]=n+i*(r[0]-n),e[1]=o+i*(r[1]-o),e},Qu.random=function(e,t){t=t||1;var r=2*th.RANDOM()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},Qu.transformMat2=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e},Qu.transformMat2d=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e},Qu.transformMat3=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e},Qu.transformMat4=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e},Qu.rotate=function(e,t,r,i){var n=t[0]-r[0],o=t[1]-r[1],s=Math.sin(i),a=Math.cos(i);return e[0]=n*a-o*s+r[0],e[1]=n*s+o*a+r[1],e},Qu.angle=function(e,t){var r=e[0],i=e[1],n=t[0],o=t[1],s=Math.sqrt(r*r+i*i)*Math.sqrt(n*n+o*o);return Math.acos(Math.min(Math.max(s&&(r*n+i*o)/s,-1),1))},Qu.zero=function(e){return e[0]=0,e[1]=0,e},Qu.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},Qu.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Qu.equals=function(e,t){var r=e[0],i=e[1],n=t[0],o=t[1];return Math.abs(r-n)<=th.EPSILON*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=th.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))},Qu.forEach=Qu.sqrLen=Qu.sqrDist=Qu.dist=Qu.div=Qu.mul=Qu.sub=Qu.len=void 0;var th=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==eh(e)&&"function"!=typeof e)return{default:e};var r=rh(void 0);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,r&&r.set(e,i),i}(ic);function rh(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(rh=function(e){return e?r:t})(e)}function ih(){var e=new th.ARRAY_TYPE(2);return th.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function nh(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function oh(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function sh(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function ah(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function lh(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function ch(e){return Math.hypot(e[0],e[1])}function uh(e){var t=e[0],r=e[1];return t*t+r*r}Qu.len=ch,Qu.sub=nh,Qu.mul=oh,Qu.div=sh,Qu.dist=ah,Qu.sqrDist=lh,Qu.sqrLen=uh;var hh=function(){var e=ih();return function(t,r,i,n,o,s){var a,l;for(r||(r=2),i||(i=0),l=n?Math.min(n*r+i,t.length):t.length,a=i;a<l;a+=r)e[0]=t[a],e[1]=t[a+1],o(e,e,s),t[a]=e[0],t[a+1]=e[1];return t}}();function dh(e){return dh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dh(e)}Qu.forEach=hh,Object.defineProperty(rc,"__esModule",{value:!0}),e.a7=rc.vec4=e.N=rc.vec3=rc.vec2=rc.quat2=e.bi=rc.quat=e.a6=rc.mat4=e.co=rc.mat3=rc.mat2d=e.b4=rc.mat2=rc.glMatrix=void 0;var ph=Eh(ic);rc.glMatrix=ph;var fh=Eh(lc);e.b4=rc.mat2=fh;var mh=Eh(fc);rc.mat2d=mh;var _h=Eh(vc);e.co=rc.mat3=_h;var gh=Eh(Mc);e.a6=rc.mat4=gh;var yh=Eh(Fc);e.bi=rc.quat=yh;var xh=Eh(Uu);rc.quat2=xh;var vh=Eh(Qu);rc.vec2=vh;var bh=Eh(Bc);e.N=rc.vec3=bh;var wh=Eh(Qc);function Th(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Th=function(e){return e?r:t})(e)}function Eh(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==dh(e)&&"function"!=typeof e)return{default:e};var r=Th(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,r&&r.set(e,i),i}e.a7=rc.vec4=wh;class Sh{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(t,r,i){const n=e.N.dot(r,this.dir);if(Math.abs(n)<1e-6)return!1;const o=((t[0]-this.pos[0])*r[0]+(t[1]-this.pos[1])*r[1]+(t[2]-this.pos[2])*r[2])/n;return i[0]=this.pos[0]+this.dir[0]*o,i[1]=this.pos[1]+this.dir[1]*o,i[2]=this.pos[2]+this.dir[2]*o,!0}closestPointOnSphere(t,r,i){if(e.N.equals(this.pos,t)||0===r)return i[0]=i[1]=i[2]=0,!1;const[n,o,s]=this.dir,a=this.pos[0]-t[0],l=this.pos[1]-t[1],c=this.pos[2]-t[2],u=n*n+o*o+s*s,h=2*(a*n+l*o+c*s),d=h*h-4*u*(a*a+l*l+c*c-r*r);if(d<0){const e=Math.max(-h/2,0),t=a+n*e,u=l+o*e,d=c+s*e,p=Math.hypot(t,u,d);return i[0]=t*r/p,i[1]=u*r/p,i[2]=d*r/p,!1}{const e=(-h-Math.sqrt(d))/(2*u);if(e<0){const e=Math.hypot(a,l,c);return i[0]=a*r/e,i[1]=l*r/e,i[2]=c*r/e,!1}return i[0]=a+n*e,i[1]=l+o*e,i[2]=c+s*e,!0}}}class Mh{constructor(e,t,r,i,n){this.TL=e,this.TR=t,this.BR=r,this.BL=i,this.horizon=n}static fromInvProjectionMatrix(t,r,i){const n=[-1,1,1],o=[1,1,1],s=[1,-1,1],a=[-1,-1,1],l=e.N.transformMat4(n,n,t),c=e.N.transformMat4(o,o,t),u=e.N.transformMat4(s,s,t),h=e.N.transformMat4(a,a,t);return new Mh(l,c,u,h,r/i)}}function Ah(t,r,i){let n=1/0,o=-1/0;const s=[];for(const a of t){e.N.sub(s,a,r);const t=e.N.dot(s,i);n=Math.min(n,t),o=Math.max(o,t)}return[n,o]}function Ih(t,r){let i=!0;for(let n=0;n<t.planes.length;n++){const o=t.planes[n];let s=0;for(let t=0;t<r.length;t++)s+=e.N.dot(o,r[t])+o[3]>=0;if(0===s)return 0;s!==r.length&&(i=!1)}return i?2:1}function Ch(e,t){for(const r of e.projections){const i=Ah(t,e.points[0],r.axis);if(r.projection[1]<i[0]||r.projection[0]>i[1])return 0}return 1}function Ph(t,r){let i=0;const n=[0,0,0,0];for(let o=0;o<t.length;o++)n[0]=t[o][0],n[1]=t[o][1],n[2]=t[o][2],n[3]=1,e.a7.dot(n,r)>=0&&i++;return i}class Lh{constructor(t,r){this.points=t||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=Rh.fromPoints(this.points),this.projections=[],this.frustumEdges=[e.N.sub([],this.points[2],this.points[3]),e.N.sub([],this.points[0],this.points[3]),e.N.sub([],this.points[4],this.points[0]),e.N.sub([],this.points[5],this.points[1]),e.N.sub([],this.points[6],this.points[2]),e.N.sub([],this.points[7],this.points[3])];for(const e of this.frustumEdges){const t=[0,-e[2],e[1]],r=[e[2],0,-e[0]];this.projections.push({axis:t,projection:Ah(this.points,this.points[0],t)}),this.projections.push({axis:r,projection:Ah(this.points,this.points[0],r)})}}static fromInvProjectionMatrix(t,r,i,n){const o=Math.pow(2,i),s=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((i=>{const s=e.a7.transformMat4([],i,t),a=1/s[3]/r*o;return e.a7.mul(s,s,[a,a,n?1/s[3]:a,a])})),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((t=>{const r=e.N.sub([],s[t[0]],s[t[1]]),i=e.N.sub([],s[t[2]],s[t[1]]),n=e.N.normalize([],e.N.cross([],r,i)),o=-e.N.dot(n,s[t[1]]);return n.concat(o)})),l=[];for(let e=0;e<s.length;e++)l.push([s[e][0],s[e][1],s[e][2]]);return new Lh(l,a)}intersectsPrecise(t,r,i){for(let e=0;e<r.length;e++)if(!Ph(t,r[e]))return 0;for(let e=0;e<this.planes.length;e++)if(!Ph(t,this.planes[e]))return 0;for(const n of i)for(const r of this.frustumEdges){const i=e.N.cross([],n,r),o=e.N.length(i);if(0===o)continue;e.N.scale(i,i,1/o);const s=Ah(this.points,this.points[0],i),a=Ah(t,this.points[0],i);if(s[0]>a[1]||a[0]>s[1])return 0}return 1}}class Rh{static fromPoints(t){const r=[1/0,1/0,1/0],i=[-1/0,-1/0,-1/0];for(const n of t)e.N.min(r,r,n),e.N.max(i,i,n);return new Rh(r,i)}static fromTileIdAndHeight(e,t,r){const i=1<<e.canonical.z,n=e.canonical.x,o=e.canonical.y;return new Rh([n/i,o/i,t],[(n+1)/i,(o+1)/i,r])}static applyTransform(t,r){const i=t.getCorners();for(let n=0;n<i.length;++n)e.N.transformMat4(i[n],i[n],r);return Rh.fromPoints(i)}static projectAabbCorners(t,r){const i=t.getCorners();for(let n=0;n<i.length;++n)e.N.transformMat4(i[n],i[n],r);return i}constructor(t,r){this.min=t,this.max=r,this.center=e.N.scale([],e.N.add([],this.min,this.max),.5)}quadrant(t){const r=[t%2==0,t<2],i=e.N.clone(this.min),n=e.N.clone(this.max);for(let e=0;e<r.length;e++)i[e]=r[e]?this.min[e]:this.center[e],n[e]=r[e]?this.center[e]:this.max[e];return n[2]=this.max[2],new Rh(i,n)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Ih(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Ih(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,t){return t||this.intersects(e)?Ch(e,this.getCorners()):0}intersectsPreciseFlat(e,t){return t||this.intersectsFlat(e)?Ch(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let t=0;t<3;++t)if(this.min[t]>e.max[t]||e.min[t]>this.max[t])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e.min[t]),this.max[t]=Math.max(this.max[t],e.max[t])}encapsulatePoint(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e[t]),this.max[t]=Math.max(this.max[t],e[t])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}ro(Rh,"Aabb");const Dh=hs([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Oh}=Dh,zh=hs([{name:"a_pos_3",components:3,type:"Int16"}]);var kh=hs([{name:"a_pos",type:"Int16",components:2}]);function Fh(e){return e*ja/Ja}const Bh=[new Rh([Ha,Ha,Ha],[Xa,Xa,Xa]),new Rh([Ha,Ha,Ha],[0,0,Xa]),new Rh([0,Ha,Ha],[Xa,0,Xa]),new Rh([Ha,0,Ha],[0,Xa,Xa]),new Rh([0,0,Ha],[Xa,Xa,Xa])];function Nh(t,r,i,n=!0){const o=e.N.scale([],t._camera.position,t.worldSize),s=[r,i,1,1];e.a7.transformMat4(s,s,t.pixelMatrixInverse),e.a7.scale(s,s,1/s[3]);const a=e.N.sub([],s,o),l=e.N.normalize([],a),c=t.globeMatrix,u=[c[12],c[13],c[14]],h=e.N.sub([],u,o),d=e.N.length(h),p=e.N.normalize([],h),f=t.worldSize/(2*Math.PI),m=e.N.dot(p,l),_=Math.asin(f/d);if(_<Math.acos(m)){if(!n)return null;const t=[],r=[];e.N.scale(t,l,d/m),e.N.normalize(r,e.N.sub(r,t,h)),e.N.normalize(l,e.N.add(l,h,e.N.scale(l,r,Math.tan(_)*d)))}const g=[];new Sh(o,l).closestPointOnSphere(u,f,g);const y=e.N.normalize([],re(c,0)),x=e.N.normalize([],re(c,1)),v=e.N.normalize([],re(c,2)),w=e.N.dot(y,g),T=e.N.dot(x,g),E=e.N.dot(v,g),S=b(Math.asin(-T/f));let A=b(Math.atan2(w,E));A=t.center.lng+function(e,t){const r=(t-e+180)%360-180;return r<-180?r+360:r}(t.center.lng,A);const I=dl(A),C=M(pl(S),0,1);return new Tl(I,C)}class Uh{constructor(t,r,i){this.a=e.N.sub([],t,i),this.b=e.N.sub([],r,i),this.center=i;const n=e.N.normalize([],this.a),o=e.N.normalize([],this.b);this.angle=Math.acos(e.N.dot(n,o))}}function Vh(e,t){if(0===e.angle)return null;let r;return r=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),r<0||r>1?null:function(e,t,r,i){const n=Math.sin(r);return e*(Math.sin((1-i)*r)/n)+t*(Math.sin(i*r)/n)}(e.a[t],e.b[t],e.angle,M(r,0,1))+e.center[t]}function jh(e){if(e.z<=1)return Bh[e.z+2*e.y+e.x];const t=Wh(Zh(e));return Rh.fromPoints(t)}function Gh(t,r,i){return e.N.scale(t,t,1-i),e.N.scaleAndAdd(t,t,r,i)}function $h(t,r,i){for(const n of t)e.N.transformMat4(n,n,r),e.N.scale(n,n,i)}function qh(t,r,i,n){const o=r/t.worldSize,s=t.globeMatrix;if(i.z<=1){const e=jh(i).getCorners();return $h(e,s,o),Rh.fromPoints(e)}const a=Zh(i,n),l=Wh(a,ja+Fh(t._tileCoverLift));$h(l,s,o);const c=Number.MAX_VALUE,u=[-c,-c,-c],h=[c,c,c];if(a.contains(t.center)){for(const t of l)e.N.min(h,h,t),e.N.max(u,u,t);u[2]=0;const r=t.point,i=[r.x*o,r.y*o,0];return e.N.min(h,h,i),e.N.max(u,u,i),new Rh(h,u)}if(t._tileCoverLift>0){for(const t of l)e.N.min(h,h,t),e.N.max(u,u,t);return new Rh(h,u)}const d=[s[12]*o,s[13]*o,s[14]*o],p=a.getCenter(),f=M(t.center.lat,-yl,yl),m=M(p.lat,-yl,yl),_=dl(t.center.lng),g=pl(f);let y=_-dl(p.lng);const x=g-pl(m);y>.5?y-=1:y<-.5&&(y+=1);let b=0;if(Math.abs(y)>Math.abs(x))b=y>=0?1:3;else{b=x>=0?0:2;const t=[s[4]*o,s[5]*o,s[6]*o],r=-Math.sin(v(x>=0?a.getSouth():a.getNorth()))*ja;e.N.scaleAndAdd(d,d,t,r)}const w=l[b],T=l[(b+1)%4],E=new Uh(w,T,d),S=[Vh(E,0)||w[0],Vh(E,1)||w[1],Vh(E,2)||w[2]],A=rd(t.zoom);if(A>0){const n=function({x:e,y:t,z:r},i,n,o,s){const a=1/(1<<r);let l=e*a,c=l+a,u=t*a,h=u+a,d=0;const p=(l+c)/2-o;return p>.5?d=-1:p<-.5&&(d=1),l=((l+d)*i-(o*=i))*n+o,c=((c+d)*i-o)*n+o,u=(u*i-(s*=i))*n+s,h=(h*i-s)*n+s,[[l,h,0],[c,h,0],[c,u,0],[l,u,0]]}(i,r,t._pixelsPerMercatorPixel,_,g);for(let e=0;e<l.length;e++)Gh(l[e],n[e],A);const o=e.N.add([],n[b],n[(b+1)%4]);e.N.scale(o,o,.5),Gh(S,o,A)}for(const v of l)e.N.min(h,h,v),e.N.max(u,u,v);return h[2]=Math.min(w[2],T[2]),e.N.min(h,h,S),e.N.max(u,u,S),new Rh(h,u)}function Zh({x:e,y:t,z:r},i=!1){const n=1/(1<<r),o=new el(ml(e*n),t===(1<<r)-1&&i?-90:_l((t+1)*n)),s=new el(ml((e+1)*n),0===t&&i?90:_l(t*n));return new tl(o,s)}function Wh(e,t=ja){const r=v(e.getNorth()),i=v(e.getSouth()),n=Math.cos(r),o=Math.cos(i),s=Math.sin(r),a=Math.sin(i),l=e.getWest(),c=e.getEast();return[Ya(o,a,l,t),Ya(o,a,c,t),Ya(n,s,c,t),Ya(n,s,l,t)]}function Hh(e,t,r,i){const n=1<<r.z,o=(e/Lr+r.x)/n;return Ka(_l((t/Lr+r.y)/n),ml(o),i)}function Xh({min:e,max:t}){return qa/Math.max(t[0]-e[0],t[1]-e[1],t[2]-e[2])}const Yh=new Float64Array(16);function Kh(t){const r=Xh(t),i=e.a6.fromScaling(Yh,[r,r,r]);return e.a6.translate(i,i,e.N.negate([],t.min))}function Jh(t){const r=e.a6.fromTranslation(Yh,t.min),i=1/Xh(t);return e.a6.scale(r,r,[i,i,i])}function Qh(e){const t=Lr/(2*Math.PI);return e/(2*Math.PI)/t}function ed(e,t){return Lr/(512*Math.pow(2,e))*Xh(jh(t))}function td(t,r,i,n,o){const s=Qh(i),a=[t,r,-i/(2*Math.PI)],l=e.a6.identity(new Float64Array(16));return e.a6.translate(l,l,a),e.a6.scale(l,l,[s,s,s]),e.a6.rotateX(l,l,v(-o)),e.a6.rotateY(l,l,v(-n)),l}function rd(e){return A(Ga,$a,e)}function id(t,r){const i=Ka(r.lat,r.lng),n=function(t){const r=Ka(t._center.lat,t._center.lng),i=e.N.fromValues(0,1,0);let n=e.N.cross([],i,r);const o=e.a6.fromRotation([],-t.angle,r);n=e.N.transformMat4(n,n,o),e.a6.fromRotation(o,-t._pitch,n);const s=e.N.normalize([],r);return e.N.scale(s,s,Fh(t.cameraToCenterDistance/t.pixelsPerMeter)),e.N.transformMat4(s,s,o),e.N.add([],r,s)}(t),o=e.N.subtract([],n,i);return e.N.angle(o,i)}function nd(e,t){return id(e,t)>Math.PI/2*1.01}const od=v(85),sd=Math.cos(od),ad=Math.sin(od),ld=e.a6.create(),cd=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t};function ud(t,r,i,n,o,s,a,l,c){if(s&&t.queryGeometry.isAboveHorizon)return!1;s&&(c*=t.pixelToTileUnitsFactor);const u=t.tileID.canonical,h=i.projection.upVectorScale(u,i.center.lat,i.worldSize).metersToTile;for(const d of r)for(const r of d){const d=r.add(l),p=o&&i.elevation?i.elevation.exaggeration()*o.getElevationAt(d.x,d.y,!0):0,f=i.projection.projectTilePoint(d.x,d.y,u);if(p>0){const e=i.projection.upVector(u,d.x,d.y);f.x+=e[0]*h*p,f.y+=e[1]*h*p,f.z+=e[2]*h*p}const m=s?d:hd(f.x,f.y,f.z,n),_=s?t.tilespaceRays.map((e=>fd(e,p))):t.queryGeometry.screenGeometry,g=e.a7.transformMat4([],[f.x,f.y,f.z,1],n);if(!a&&s?c*=g[3]/i.cameraToCenterDistance:a&&!s&&(c*=i.cameraToCenterDistance/g[3]),s){const e=_l((r.y/Lr+u.y)/(1<<u.z));c/=i.projection.pixelsPerMeter(e,1)/fl(1,e)}if(Fl(_,m,c))return!0}return!1}function hd(t,r,i,n){const o=e.a7.transformMat4([],[t,r,i,1],n);return new g(o[0]/o[3],o[1]/o[3])}const dd=e.N.fromValues(0,0,0),pd=e.N.fromValues(0,0,1);function fd(t,r){const i=e.N.create();return dd[2]=r,t.intersectsPlane(dd,pd,i),new g(i[0],i[1])}class md extends zl{}function _d(e,{width:t,height:r},i,n){if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==t*r*i)throw new RangeError("mismatched image size")}else n=new Uint8Array(t*r*i);return e.width=t,e.height=r,e.data=n,e}function gd(e,t,r){const{width:i,height:n}=t;i===e.width&&n===e.height||(yd(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,i),height:Math.min(e.height,n)},r),e.width=i,e.height=n,e.data=t.data)}function yd(e,t,r,i,n,o,s){if(0===n.width||0===n.height)return t;if(n.width>e.width||n.height>e.height||r.x>e.width-n.width||r.y>e.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>t.width||n.height>t.height||i.x>t.width-n.width||i.y>t.height-n.height)throw new RangeError("out of range destination coordinates for image copy");const a=e.data,l=t.data,c=4===o&&s;for(let u=0;u<n.height;u++){const s=((r.y+u)*e.width+r.x)*o,h=((i.y+u)*t.width+i.x)*o;if(c)for(let e=0;e<n.width;e++){const t=s+e*o+3,r=h+e*o;l[r+0]=255,l[r+1]=255,l[r+2]=255,l[r+3]=a[t]}else for(let e=0;e<n.width*o;e++)l[h+e]=a[s+e]}return t}ro(md,"HeatmapBucket",{omit:["layers"]});class xd{constructor(e,t){_d(this,e,1,t)}resize(e){gd(this,new xd(e),1)}clone(){return new xd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,i,n){yd(e,t,r,i,n,1)}}class vd{constructor(e,t){_d(this,e,4,t)}resize(e){gd(this,new vd(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new vd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,i,n,o){yd(e,t,r,i,n,4,o)}}class bd{constructor(e,t){this.width=e.width,this.height=e.height,this.data=t instanceof Uint8Array?new Float32Array(t.buffer):t}}ro(xd,"AlphaImage"),ro(vd,"RGBAImage");const wd=new Vo({visibility:new Bo($o.layout_heatmap.visibility)});var Td={paint:new Vo({"heatmap-radius":new No($o.paint_heatmap["heatmap-radius"]),"heatmap-weight":new No($o.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Bo($o.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Uo($o.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Bo($o.paint_heatmap["heatmap-opacity"])}),layout:wd};function Ed(e){const t={},r=e.resolution||256,i=e.clips?e.clips.length:1,n=e.image||new vd({width:r,height:i}),o=(r,i,o)=>{t[e.evaluationKey]=o;const s=e.expression.evaluate(t);s&&(n.data[r+i+0]=Math.floor(255*s.r/s.a),n.data[r+i+1]=Math.floor(255*s.g/s.a),n.data[r+i+2]=Math.floor(255*s.b/s.a),n.data[r+i+3]=Math.floor(255*s.a))};if(e.clips)for(let s=0,a=0;s<i;++s,a+=4*r)for(let t=0,i=0;t<r;t++,i+=4){const n=t/(r-1),{start:l,end:c}=e.clips[s];o(a,i,l*(1-n)+c*n)}else for(let s=0,a=0;s<r;s++,a+=4)o(0,a,s/(r-1));return n}const Sd=new Vo({visibility:new Bo($o.layout_hillshade.visibility)});var Md={paint:new Vo({"hillshade-illumination-direction":new Bo($o.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Bo($o.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Bo($o.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Bo($o.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Bo($o.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Bo($o.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Bo($o.paint_hillshade["hillshade-emissive-strength"])}),layout:Sd};const Ad=hs([{name:"a_pos",components:2,type:"Int16"}],4),{members:Id}=Ad;var Cd={exports:{}};function Pd(e,t,r){r=r||2;var i,n,o,s,a,l,c,u=t&&t.length,h=u?t[0]*r:e.length,d=Ld(e,0,h,r,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(e,t,r,i){var n,o,s,a=[];for(n=0,o=t.length;n<o;n++)(s=Ld(e,t[n]*i,n<o-1?t[n+1]*i:e.length,i,!1))===s.next&&(s.steiner=!0),a.push(jd(s));for(a.sort(Bd),n=0;n<a.length;n++)r=Nd(a[n],r);return r}(e,t,d,r)),e.length>80*r){i=o=e[0],n=s=e[1];for(var f=r;f<h;f+=r)(a=e[f])<i&&(i=a),(l=e[f+1])<n&&(n=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-i,s-n))?32767/c:0}return Dd(d,p,r,i,n,c,0),p}function Ld(e,t,r,i,n){var o,s;if(n===tp(e,t,r,i)>0)for(o=t;o<r;o+=i)s=Jd(o,e[o],e[o+1],s);else for(o=r-i;o>=t;o-=i)s=Jd(o,e[o],e[o+1],s);return s&&Zd(s,s.next)&&(Qd(s),s=s.next),s}function Rd(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!Zd(i,i.next)&&0!==qd(i.prev,i,i.next))i=i.next;else{if(Qd(i),(i=t=i.prev)===i.next)break;r=!0}}while(r||i!==t);return t}function Dd(e,t,r,i,n,o,s){if(e){!s&&o&&function(e,t,r,i){var n=e;do{0===n.z&&(n.z=Vd(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,r,i,n,o,s,a,l,c=1;do{for(r=e,e=null,o=null,s=0;r;){for(s++,i=r,a=0,t=0;t<c&&(a++,i=i.nextZ);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||r.z<=i.z)?(n=r,r=r.nextZ,a--):(n=i,i=i.nextZ,l--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;r=i}o.nextZ=null,c*=2}while(s>1)}(n)}(e,i,n,o);for(var a,l,c=e;e.prev!==e.next;)if(a=e.prev,l=e.next,o?zd(e,i,n,o):Od(e))t.push(a.i/r|0),t.push(e.i/r|0),t.push(l.i/r|0),Qd(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?Dd(e=kd(Rd(e),t,r),t,r,i,n,o,2):2===s&&Fd(e,t,r,i,n,o):Dd(Rd(e),t,r,i,n,o,1);break}}}function Od(e){var t=e.prev,r=e,i=e.next;if(qd(t,r,i)>=0)return!1;for(var n=t.x,o=r.x,s=i.x,a=t.y,l=r.y,c=i.y,u=n<o?n<s?n:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,d=n>o?n>s?n:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c,f=i.next;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&Gd(n,a,o,l,s,c,f.x,f.y)&&qd(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function zd(e,t,r,i){var n=e.prev,o=e,s=e.next;if(qd(n,o,s)>=0)return!1;for(var a=n.x,l=o.x,c=s.x,u=n.y,h=o.y,d=s.y,p=a<l?a<c?a:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,m=a>l?a>c?a:c:l>c?l:c,_=u>h?u>d?u:d:h>d?h:d,g=Vd(p,f,t,r,i),y=Vd(m,_,t,r,i),x=e.prevZ,v=e.nextZ;x&&x.z>=g&&v&&v.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=_&&x!==n&&x!==s&&Gd(a,u,l,h,c,d,x.x,x.y)&&qd(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,v.x>=p&&v.x<=m&&v.y>=f&&v.y<=_&&v!==n&&v!==s&&Gd(a,u,l,h,c,d,v.x,v.y)&&qd(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;x&&x.z>=g;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=_&&x!==n&&x!==s&&Gd(a,u,l,h,c,d,x.x,x.y)&&qd(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;v&&v.z<=y;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=_&&v!==n&&v!==s&&Gd(a,u,l,h,c,d,v.x,v.y)&&qd(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function kd(e,t,r){var i=e;do{var n=i.prev,o=i.next.next;!Zd(n,o)&&Wd(n,i,i.next,o)&&Yd(n,o)&&Yd(o,n)&&(t.push(n.i/r|0),t.push(i.i/r|0),t.push(o.i/r|0),Qd(i),Qd(i.next),i=e=o),i=i.next}while(i!==e);return Rd(i)}function Fd(e,t,r,i,n,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&$d(s,a)){var l=Kd(s,a);return s=Rd(s,s.next),l=Rd(l,l.next),Dd(s,t,r,i,n,o,0),void Dd(l,t,r,i,n,o,0)}a=a.next}s=s.next}while(s!==e)}function Bd(e,t){return e.x-t.x}function Nd(e,t){var r=function(e,t){var r,i=t,n=e.x,o=e.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var a=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=n&&a>s&&(s=a,r=i.x<i.next.x?i:i.next,a===n))return r}i=i.next}while(i!==t);if(!r)return null;var l,c=r,u=r.x,h=r.y,d=1/0;i=r;do{n>=i.x&&i.x>=u&&n!==i.x&&Gd(o<h?n:s,o,u,h,o<h?s:n,o,i.x,i.y)&&(l=Math.abs(o-i.y)/(n-i.x),Yd(i,e)&&(l<d||l===d&&(i.x>r.x||i.x===r.x&&Ud(r,i)))&&(r=i,d=l)),i=i.next}while(i!==c);return r}(e,t);if(!r)return t;var i=Kd(r,e);return Rd(i,i.next),Rd(r,r.next)}function Ud(e,t){return qd(e.prev,e,t.prev)<0&&qd(t.next,e,e.next)<0}function Vd(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function jd(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function Gd(e,t,r,i,n,o,s,a){return(n-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(i-a)>=(r-s)*(t-a)&&(r-s)*(o-a)>=(n-s)*(i-a)}function $d(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Wd(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(Yd(e,t)&&Yd(t,e)&&function(e,t){var r=e,i=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&n<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}(e,t)&&(qd(e.prev,e,t.prev)||qd(e,t.prev,t))||Zd(e,t)&&qd(e.prev,e,e.next)>0&&qd(t.prev,t,t.next)>0)}function qd(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Zd(e,t){return e.x===t.x&&e.y===t.y}function Wd(e,t,r,i){var n=Xd(qd(e,t,r)),o=Xd(qd(e,t,i)),s=Xd(qd(r,i,e)),a=Xd(qd(r,i,t));return n!==o&&s!==a||!(0!==n||!Hd(e,r,t))||!(0!==o||!Hd(e,i,t))||!(0!==s||!Hd(r,e,i))||!(0!==a||!Hd(r,t,i))}function Hd(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function Xd(e){return e>0?1:e<0?-1:0}function Yd(e,t){return qd(e.prev,e,e.next)<0?qd(e,t,e.next)>=0&&qd(e,e.prev,t)>=0:qd(e,t,e.prev)<0||qd(e,e.next,t)<0}function Kd(e,t){var r=new ep(e.i,e.x,e.y),i=new ep(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,o.next=i,i.prev=o,i}function Jd(e,t,r,i){var n=new ep(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Qd(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function ep(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function tp(e,t,r,i){for(var n=0,o=t,s=r-i;o<r;o+=i)n+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return n}Cd.exports=Pd,Cd.exports.default=Pd,Pd.deviation=function(e,t,r,i){var n=t&&t.length,o=Math.abs(tp(e,0,n?t[0]*r:e.length,r));if(n)for(var s=0,a=t.length;s<a;s++)o-=Math.abs(tp(e,t[s]*r,s<a-1?t[s+1]*r:e.length,r));var l=0;for(s=0;s<i.length;s+=3){var c=i[s]*r,u=i[s+1]*r,h=i[s+2]*r;l+=Math.abs((e[c]-e[h])*(e[u+1]-e[c+1])-(e[c]-e[u])*(e[h+1]-e[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},Pd.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var s=0;s<t;s++)r.vertices.push(e[n][o][s]);n>0&&r.holes.push(i+=e[n-1].length)}return r};var rp=h(Cd.exports);function ip(e,t){const r=e.length;if(r<=1)return[e];const i=[];let n,o;for(let s=0;s<r;s++){const t=$(e[s]);0!==t&&(e[s].area=Math.abs(t),void 0===o&&(o=t<0),o===t<0?(n&&i.push(n),n=[e[s]]):n.push(e[s]))}if(n&&i.push(n),t>1)for(let s=0;s<i.length;s++)i[s].length<=t||(sr(i[s],t,1,i[s].length-1,np),i[s]=i[s].slice(0,t));return i}function np(e,t){return t.area-e.area}function op(e,t,r){const i=r.patternDependencies;let n=!1;for(const o of t){const t=o.paint.get(`${e}-pattern`);t.isConstant()||(n=!0);const r=t.constantOr(null);r&&(n=!0,i[r]=!0)}return n}function sp(e,t,r,i,n){const o=n.patternDependencies;for(const s of t){const t=s.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:i},r,{},n.availableImages);e=e&&e.name?e.name:e,o[e]=!0,r.patterns[s.id]=e}}return r}class ap{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ps,this.indexArray=new Ps,this.indexArray2=new Ss,this.programConfigurations=new ka(e.layers,e.zoom),this.segments=new ra,this.segments2=new ra,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.projection=e.projection}populate(e,t,r,i){this.hasPattern=op("fill",this.layers,t);const n=this.layers[0].layout.get("fill-sort-key"),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=Rl(s,e);if(!this.layers[0]._featureFilter.filter(new Co(this.zoom),u,r))continue;const h=n?n.evaluate(u,{},r,t.availableImages):void 0,d={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:Ll(s,r,i),patterns:{},sortKey:h};o.push(d)}n&&o.sort(((e,t)=>e.sortKey-t.sortKey));for(const s of o){const{geometry:i,index:n,sourceLayerIndex:o}=s;if(this.hasPattern){const e=sp("fill",this.layers,s,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(s,i,n,r,{},t.availableImages,t.brightness);t.featureIndex.insert(e[n].feature,i,n,o,this.index)}}update(e,t,r,i,n){const o=0!==Object.keys(e).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,o?this.stateDependentLayers:this.layers,r,i,n)}addFeatures(e,t,r,i,n,o){for(const s of this.patternFeatures)this.addFeature(s,s.geometry,s.index,t,r,i,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Id),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,r,i,n,o=[],s){for(const a of ip(t,500)){let e=0;for(const s of a)e+=s.length;const t=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),r=t.vertexLength,i=[],n=[];for(const s of a){if(0===s.length)continue;s!==a[0]&&n.push(i.length/2);const e=this.segments2.prepareSegment(s.length,this.layoutVertexArray,this.indexArray2),t=e.vertexLength;this.layoutVertexArray.emplaceBack(s[0].x,s[0].y),this.indexArray2.emplaceBack(t+s.length-1,t),i.push(s[0].x),i.push(s[0].y);for(let r=1;r<s.length;r++)this.layoutVertexArray.emplaceBack(s[r].x,s[r].y),this.indexArray2.emplaceBack(t+r-1,t+r),i.push(s[r].x),i.push(s[r].y);e.vertexLength+=s.length,e.primitiveLength+=s.length}const o=rp(i,n);for(let s=0;s<o.length;s+=3)this.indexArray.emplaceBack(r+o[s],r+o[s+1],r+o[s+2]);t.vertexLength+=e,t.primitiveLength+=o.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,n,o,i,s)}}ro(ap,"FillBucket",{omit:["layers","patternFeatures"]});const lp=new Vo({"fill-sort-key":new No($o.layout_fill["fill-sort-key"]),visibility:new Bo($o.layout_fill.visibility)});var cp={paint:new Vo({"fill-antialias":new Bo($o.paint_fill["fill-antialias"]),"fill-opacity":new No($o.paint_fill["fill-opacity"]),"fill-color":new No($o.paint_fill["fill-color"]),"fill-outline-color":new No($o.paint_fill["fill-outline-color"]),"fill-translate":new Bo($o.paint_fill["fill-translate"]),"fill-translate-anchor":new Bo($o.paint_fill["fill-translate-anchor"]),"fill-pattern":new No($o.paint_fill["fill-pattern"]),"fill-emissive-strength":new Bo($o.paint_fill["fill-emissive-strength"])}),layout:lp};const up=hs([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),hp=hs([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),dp=hs([{name:"a_centroid_pos",components:2,type:"Uint16"}]),pp=hs([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),fp=hs([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:mp}=up;var _p={},gp=m,yp=xp;function xp(e,t,r,i,n){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=n,e.readFields(vp,this,t)}function vp(e,t,r){1==e?t.id=r.readVarint():2==e?function(e,t){for(var r=e.readVarint()+e.pos;e.pos<r;){var i=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[i]=n}}(r,t):3==e?t.type=r.readVarint():4==e&&(t._geometry=r.pos)}function bp(e){for(var t,r,i=0,n=0,o=e.length,s=o-1;n<o;s=n++)i+=((r=e[s]).x-(t=e[n]).x)*(t.y+r.y);return i}xp.types=["Unknown","Point","LineString","Polygon"],xp.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,i=1,n=0,o=0,s=0,a=[];e.pos<r;){if(n<=0){var l=e.readVarint();i=7&l,n=l>>3}if(n--,1===i||2===i)o+=e.readSVarint(),s+=e.readSVarint(),1===i&&(t&&a.push(t),t=[]),t.push(new gp(o,s));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&a.push(t),a},xp.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,i=0,n=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;e.pos<t;){if(i<=0){var u=e.readVarint();r=7&u,i=u>>3}if(i--,1===r||2===r)(n+=e.readSVarint())<s&&(s=n),n>a&&(a=n),(o+=e.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==r)throw new Error("unknown command "+r)}return[s,l,a,c]},xp.prototype.toGeoJSON=function(e,t,r){var i,n,o=this.extent*Math.pow(2,r),s=this.extent*e,a=this.extent*t,l=this.loadGeometry(),c=xp.types[this.type];function u(e){for(var t=0;t<e.length;t++){var r=e[t];e[t]=[360*(r.x+s)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(r.y+a)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(i=0;i<l.length;i++)h[i]=l[i][0];u(l=h);break;case 2:for(i=0;i<l.length;i++)u(l[i]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var r,i,n=[],o=0;o<t;o++){var s=bp(e[o]);0!==s&&(void 0===i&&(i=s<0),i===s<0?(r&&n.push(r),r=[e[o]]):r.push(e[o]))}return r&&n.push(r),n}(l),i=0;i<l.length;i++)for(n=0;n<l[i].length;n++)u(l[i][n])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var wp=yp,Tp=Ep;function Ep(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Sp,this,t),this.length=this._features.length}function Sp(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(function(e){for(var t=null,r=e.readVarint()+e.pos;e.pos<r;){var i=e.readVarint()>>3;t=1===i?e.readString():2===i?e.readFloat():3===i?e.readDouble():4===i?e.readVarint64():5===i?e.readVarint():6===i?e.readSVarint():7===i?e.readBoolean():null}return t}(r))}Ep.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new wp(this._pbf,t,this.extent,this._keys,this._values)};var Mp=Tp;function Ap(e,t,r){if(3===e){var i=new Mp(r,r.readVarint()+r.pos);i.length&&(t[i.name]=i)}}var Ip=_p.VectorTile=function(e,t){this.layers=e.readFields(Ap,{},t)},Cp=_p.VectorTileFeature=yp;function Pp(e,t,r,i){const n=[],o=0===i?(e,t,r,i,n,o)=>{e.push(new g(o,r+(o-t)/(i-t)*(n-r)))}:(e,t,r,i,n,o)=>{e.push(new g(t+(o-r)/(n-r)*(i-t),o))};for(const s of e){const e=[];for(const n of s){if(n.length<=2)continue;const s=[];for(let e=0;e<n.length-1;e++){const a=n[e].x,l=n[e].y,c=n[e+1].x,u=n[e+1].y,h=0===i?a:l,d=0===i?c:u;h<t?d>t&&o(s,a,l,c,u,t):h>r?d<r&&o(s,a,l,c,u,r):s.push(n[e]),d<t&&h>=t&&o(s,a,l,c,u,t),d>r&&h<=r&&o(s,a,l,c,u,r)}let a=n[n.length-1];const l=0===i?a.x:a.y;l>=t&&l<=r&&s.push(a),s.length&&(a=s[s.length-1],s[0].x===a.x&&s[0].y===a.y||s.push(s[0]),e.push(s))}e.length&&n.push(e)}return n}function Lp(e,t){return e.x-t.x||e.y-t.y}function Rp(e,t){return 0===Lp(e.min,t.min)&&0===Lp(e.max,t.max)}function Dp(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function Op(e,t,r){const i=1/Lr,n=1/(1<<r.canonical.z),o=(t.x*i+r.canonical.x)*n+r.wrap,s=(t.y*i+r.canonical.y)*n;return{min:new g((e.x*i+r.canonical.x)*n+r.wrap,(e.y*i+r.canonical.y)*n),max:new g(o,s)}}function zp(e,t,r){const i=1<<r.canonical.z,n=((t.x-r.wrap)*i-r.canonical.x)*Lr,o=(t.y*i-r.canonical.y)*Lr;return{min:new g(((e.x-r.wrap)*i-r.canonical.x)*Lr,(e.y*i-r.canonical.y)*Lr),max:new g(n,o)}}function kp(e,t,r,i,n,o,s){const a=e.indices,l=e.vertices,c=[];for(let u=i;u<i+n;u+=3){const i=t[r[u+0]+o],n=t[r[u+1]+o],h=t[r[u+2]+o],d=Math.min(i.x,n.x,h.x),p=Math.max(i.x,n.x,h.x),f=Math.min(i.y,n.y,h.y),m=Math.max(i.y,n.y,h.y);c.length=0,e.grid.query(new g(d,f),new g(p,m),c);for(let e=0;e<c.length;e++){const t=c[e];if(Xl(l[a[3*t+0]],l[a[3*t+1]],l[a[3*t+2]],i,n,h,s))return!0}}return!1}function Fp(e,t,r,i){if(!e||!r)return!1;let n=e.vertices;if(!t.canonical.equals(i.canonical)||t.wrap!==i.wrap){if(r.vertices.length<e.vertices.length)return Fp(r,i,e,t);const o=t.canonical,s=i.canonical,a=Math.pow(2,s.z-o.z);n=e.vertices.map((e=>new g(e.x*o.x*Lr*a-s.x*Lr,e.y*o.y*Lr*a-s.y*Lr)))}return kp(r,n,e.indices,0,e.indices.length,0,0)}_p.VectorTileLayer=Tp;class Bp{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const r=this.toIdx(e,t);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Np(e,t,r,i){let n=0,o=Number.MAX_VALUE;for(let s=0;s<3;s++)if(Math.abs(i[s])<1e-15){if(r[s]<e[s]||r[s]>t[s])return null}else{const a=1/i[s];let l=(e[s]-r[s])*a,c=(t[s]-r[s])*a;if(l>c){const e=l;l=c,c=e}if(l>n&&(n=l),c<o&&(o=c),n>o)return null}return n}function Up(e,t,r,i,n,o,s,a,l,c,u){const h=i-e,d=n-t,p=o-r,f=s-e,m=a-t,_=l-r,g=u[1]*_-u[2]*m,y=u[2]*f-u[0]*_,x=u[0]*m-u[1]*f,v=h*g+d*y+p*x;if(Math.abs(v)<1e-15)return null;const b=1/v,w=c[0]-e,T=c[1]-t,E=c[2]-r,S=(w*g+T*y+E*x)*b;if(S<0||S>1)return null;const M=T*p-E*d,A=E*h-w*p,I=w*d-T*h,C=(u[0]*M+u[1]*A+u[2]*I)*b;return C<0||S+C>1?null:(f*M+m*A+_*I)*b}function Vp(e,t,r){return(e-t)/(r-t)}function jp(e,t,r,i,n,o,s,a,l){const c=1<<r,u=o-i,h=s-n,d=(e+1)/c*u+i,p=(t+0)/c*h+n,f=(t+1)/c*h+n;a[0]=(e+0)/c*u+i,a[1]=p,l[0]=d,l[1]=f}class Gp{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),r=[];let i=Math.ceil(Math.pow(2,t));const n=1/i,o=(e,t,r,i,n)=>{const o=i?1:0,s=(e+1)*r-o,a=t*r,l=(t+1)*r-o;n[0]=e*r,n[1]=a,n[2]=s,n[3]=l};let s=new Bp(i);const a=[];for(let l=0;l<i*i;l++){o(l%i,Math.floor(l/i),n,!1,a);const t=qp(a[0],a[1],e),r=qp(a[2],a[1],e),c=qp(a[2],a[3],e),u=qp(a[0],a[3],e);s.minimums.push(Math.min(t,r,c,u)),s.maximums.push(Math.max(t,r,c,u)),s.leaves.push(1)}for(r.push(s),i/=2;i>=1;i/=2){const e=r[r.length-1];s=new Bp(i);for(let t=0;t<i*i;t++){o(t%i,Math.floor(t/i),2,!0,a);const r=e.getElevation(a[0],a[1]),n=e.getElevation(a[2],a[1]),l=e.getElevation(a[2],a[3]),c=e.getElevation(a[0],a[3]),u=e.isLeaf(a[0],a[1]),h=e.isLeaf(a[2],a[1]),d=e.isLeaf(a[2],a[3]),p=e.isLeaf(a[0],a[3]),f=Math.min(r.min,n.min,l.min,c.min),m=Math.max(r.max,n.max,l.max,c.max),_=u&&h&&d&&p;s.maximums.push(m),s.minimums.push(f),s.leaves.push(m-f<=5&&_?1:0)}r.push(s)}return r}(this.dem),r=t.length-1,i=t[r];this._addNode(i.minimums[0],i.maximums[0],i.leaves[0]),this._construct(t,0,0,r,0)}raycastRoot(e,t,r,i,n,o,s=1){return Np([e,t,-100],[r,i,this.maximums[0]*s],n,o)}raycast(t,r,i,n,o,s,a=1){if(!this.nodeCount)return null;const l=this.raycastRoot(t,r,i,n,o,s,a);if(null==l)return null;const c=[],u=[],h=[],d=[],p=[{idx:0,t:l,nodex:0,nodey:0,depth:0}];for(;p.length>0;){const{idx:l,t:f,nodex:m,nodey:_,depth:g}=p.pop();if(this.leaves[l]){jp(m,_,g,t,r,i,n,h,d);const l=1<<g,c=(m+0)/l,u=(m+1)/l,p=(_+0)/l,y=(_+1)/l,x=qp(c,p,this.dem)*a,v=qp(u,p,this.dem)*a,b=qp(u,y,this.dem)*a,w=qp(c,y,this.dem)*a,T=Up(h[0],h[1],x,d[0],h[1],v,d[0],d[1],b,o,s),E=Up(d[0],d[1],b,h[0],d[1],w,h[0],h[1],x,o,s),S=Math.min(null!==T?T:Number.MAX_VALUE,null!==E?E:Number.MAX_VALUE);if(S!==Number.MAX_VALUE)return S;{const t=e.N.scaleAndAdd([],o,s,f);if($p(x,v,w,b,Vp(t[0],h[0],d[0]),Vp(t[1],h[1],d[1]))>=t[2])return f}continue}let y=0;for(let e=0;e<this._siblingOffset.length;e++){jp((m<<1)+this._siblingOffset[e][0],(_<<1)+this._siblingOffset[e][1],g+1,t,r,i,n,h,d),h[2]=-100,d[2]=this.maximums[this.childOffsets[l]+e]*a;const p=Np(h,d,o,s);if(null!=p){const t=p;c[e]=t;let r=!1;for(let i=0;i<y&&!r;i++)t>=c[u[i]]&&(u.splice(i,0,e),r=!0);r||(u[y]=e),y++}}for(let e=0;e<y;e++){const t=u[e];p.push({idx:this.childOffsets[l]+t,t:c[t],nodex:(m<<1)+this._siblingOffset[t][0],nodey:(_<<1)+this._siblingOffset[t][1],depth:g+1})}}return null}_addNode(e,t,r){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,r,i,n){if(1===e[i].isLeaf(t,r))return;this.childOffsets[n]||(this.childOffsets[n]=this.nodeCount);const o=i-1,s=e[o];let a=0,l=0;for(let c=0;c<this._siblingOffset.length;c++){const e=2*t+this._siblingOffset[c][0],i=2*r+this._siblingOffset[c][1],n=s.getElevation(e,i),o=s.isLeaf(e,i),u=this._addNode(n.min,n.max,o);o&&(a|=1<<c),l||(l=u)}for(let c=0;c<this._siblingOffset.length;c++)a&1<<c||this._construct(e,2*t+this._siblingOffset[c][0],2*r+this._siblingOffset[c][1],o,l+c)}}function $p(e,t,r,i,n,o){return ct(ct(e,r,o),ct(t,i,o),n)}function qp(e,t,r){const i=r.dim,n=M(e*i-.5,0,i-1),o=M(t*i-.5,0,i-1),s=Math.floor(n),a=Math.floor(o),l=Math.min(s+1,i-1),c=Math.min(a+1,i-1);return $p(r.get(s,a),r.get(l,a),r.get(s,c),r.get(l,c),n-s,o-a)}const Zp={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Wp(e,t,r){return(256*e*256+256*t+r)/10-1e4}function Hp(e,t,r){return 256*e+t+r/256-32768}class Xp{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,r,i=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return j(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const n=this.dim=t.height-2,o=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.floatView=new Float32Array(t.data.buffer),this.borderReady=i,this._modifiedForSources={},!i){for(let e=0;e<n;e++)o[this._idx(-1,e)]=o[this._idx(0,e)],o[this._idx(n,e)]=o[this._idx(n-1,e)],o[this._idx(e,-1)]=o[this._idx(e,0)],o[this._idx(e,n)]=o[this._idx(e,n-1)];o[this._idx(-1,-1)]=o[this._idx(0,0)],o[this._idx(n,-1)]=o[this._idx(n-1,0)],o[this._idx(-1,n)]=o[this._idx(0,n-1)],o[this._idx(n,n)]=o[this._idx(n-1,n-1)]}const s="terrarium"===r?Hp:Wp;for(let a=0;a<o.length;++a){const e=4*a;this.floatView[a]=s(this.pixels[e],this.pixels[e+1],this.pixels[e+2])}this._timestamp=se.now()}_buildQuadTree(){this._tree=new Gp(this)}get(e,t,r=!1){r&&(e=M(e,-1,this.dim),t=M(t,-1,this.dim));const i=this._idx(e,t);return this.floatView[i]}set(e,t,r){const i=this._idx(e,t),n=this.floatView[i];return this.floatView[i]=r,r-n}static getUnpackVector(e){return Zp[e]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}static pack(e,t){const r=[0,0,0,0],i=Xp.getUnpackVector(t);let n=Math.floor((e+i[3])/i[2]);return r[2]=n%256,n=Math.floor(n/256),r[1]=n%256,n=Math.floor(n/256),r[0]=n,r}getPixels(){return new bd({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let i=t*this.dim,n=t*this.dim+this.dim,o=r*this.dim,s=r*this.dim+this.dim;switch(t){case-1:i=n-1;break;case 1:n=i+1}switch(r){case-1:o=s-1;break;case 1:s=o+1}const a=-t*this.dim,l=-r*this.dim;for(let c=o;c<s;c++)for(let t=i;t<n;t++){const r=4*this._idx(t,c),i=4*this._idx(t+a,c+l);this.pixels[r+0]=e.pixels[i+0],this.pixels[r+1]=e.pixels[i+1],this.pixels[r+2]=e.pixels[i+2],this.pixels[r+3]=e.pixels[i+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ro(Xp,"DEMData"),ro(Gp,"DemMinMaxQuadTree",{omit:["dem"]});class Yp{constructor(e,t,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=r}static create(e,t,r){const i=r||e.findDEMTileFor(t);if(!i||!i.dem)return;const n=i.dem,o=i.tileID,s=1<<t.canonical.z-o.canonical.z;return new Yp(i,n.dim/Lr/s,[(t.canonical.x/s-o.canonical.x)*n.dim,(t.canonical.y/s-o.canonical.y)*n.dim])}tileCoordToPixel(e,t){const r=t*this._scale+this._offset[1],i=Math.floor(e*this._scale+this._offset[0]),n=Math.floor(r);return new g(i,n)}getElevationAt(e,t,r,i){const n=e*this._scale+this._offset[0],o=t*this._scale+this._offset[1],s=Math.floor(n),a=Math.floor(o),l=this._dem;return i=!!i,r?ct(ct(l.get(s,a,i),l.get(s,a+1,i),o-a),ct(l.get(s+1,a,i),l.get(s+1,a+1,i),o-a),n-s):l.get(s,a,i)}getElevationAtPixel(e,t,r){return this._dem.get(e,t,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*fl(1,e)*this._dem.stride}}const Kp=Cp.types,Jp=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],Qp=["fill-extrusion-flood-light-ground-radius"],ef=Math.pow(2,13),tf=Math.pow(2,15)-1,rf=new g(0,1),nf=2147483648;function of(e,t,r,i,n,o,s,a){e.emplaceBack((t<<1)+s,(r<<1)+o,(Math.floor(i*ef)<<1)+n,Math.round(a))}function sf(e,t,r,i,n,o){e.emplaceBack(t.x,t.y,(r.x<<1)+i,(r.y<<1)+n,o)}function af(e,t,r){const i=16384;e.emplaceBack(t.x,t.y,t.z,r[0]*i,r[1]*i,r[2]*i)}class lf{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class cf{constructor(){this.centroidXY=new g(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new g(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new g(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new g(this.max.x-this.min.x,this.max.y-this.min.y)}}class uf{constructor(){this.acc=new g(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,t){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=t.x,e.min.y=e.max.y=t.y)}appendEdge(e,t,r){this.accCount++,this.acc._add(t);let i=!!this.borders;t.x<e.min.x?(e.min.x=t.x,i=!0):t.x>e.max.x&&(e.max.x=t.x,i=!0),t.y<e.min.y?(e.min.y=t.y,i=!0):t.y>e.max.y&&(e.max.y=t.y,i=!0),((0===t.x||t.x===Lr)&&t.x===r.x)!=((0===t.y||t.y===Lr)&&t.y===r.y)&&this.processBorderOverlap(t,r),i&&this.checkBorderIntersection(t,r)}checkBorderIntersection(e,t){t.x<0!=e.x<0&&this.addBorderIntersection(0,ct(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>Lr!=e.x>Lr&&this.addBorderIntersection(1,ct(t.y,e.y,(Lr-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,ct(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>Lr!=e.y>Lr&&this.addBorderIntersection(3,ct(t.x,e.x,(Lr-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];t<r[0]&&(r[0]=t),t>r[1]&&(r[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const r=0===e.x?0:1;this.addBorderIntersection(r,t.y),this.addBorderIntersection(r,e.y)}else{const r=0===e.y?2:3;this.addBorderIntersection(r,t.x),this.addBorderIntersection(r,e.x)}}centroid(){return 0===this.accCount?new g(0,0):new g(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,t)=>e+ +(t[0]!==Number.MAX_VALUE)),0):0}}function hf(e,t){const r=e.add(t)._unit(),i=M(e.x*r.x+e.y*r.y,-1,1);var n,o,s;return n=Math.acos(i),Math.min(4,Math.max(-4,Math.tan(n)))/4*tf*((o=e).x*(s=t).y-o.y*s.x<0?-1:1)}const df=[e=>e.x<0,e=>e.x>Lr,e=>e.y<0,e=>e.y>Lr];function pf(e,t,r,i){const n=[4];if(0===i)return n;r._mult(i);const o=e.sub(r),s=t.sub(r),a=[e,t,o,s];for(let l=0;l<4;l++)for(const e of a)if(df[l](e)){n.push(l);break}return n}class ff{constructor(e){this.vertexArray=new _s,this.indexArray=new Ps,this.programConfigurations=new ka(e.layers,e.zoom,(e=>Qp.includes(e))),this._segments=new ra,this.hiddenByLandmarkVertexArray=new js,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ra}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(e,t,r,i=!1){const n=e.length;if(n>2){let o=Math.max(0,this._segments.get().length-1);const s=this._segments._prepareSegment(4*n,this.vertexArray.length,2*this._segmentToGroundQuads[o].length);let a;o!==this._segments.get().length-1&&(o++,this._segmentToGroundQuads[o]=[],this._segmentToRegionTriCounts[o]=[0,0,0,0,0]);{const t=e[0],r=e[1];a=hf(t.sub(e[n-1])._perp()._unit(),r.sub(t)._perp()._unit())}for(let l=0;l<n;l++){const c=l===n-1?0:l+1,u=e[l],h=e[c],d=e[c===n-1?0:c+1],p=h.sub(u)._perp()._unit(),f=hf(p,d.sub(h)._perp()._unit()),m=a,_=f;if(xf(u,h,t)||i&&vf(u,t)&&vf(h,t)){a=f;continue}const g=s.vertexLength;sf(this.vertexArray,u,h,1,1,m),sf(this.vertexArray,u,h,1,0,m),sf(this.vertexArray,u,h,0,1,_),sf(this.vertexArray,u,h,0,0,_),s.vertexLength+=4;const y=pf(u,h,p,r);for(const e of y)this._segmentToGroundQuads[o].push({id:g,region:e}),this._segmentToRegionTriCounts[o][e]+=2,s.primitiveLength+=2;a=f}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),t=e.length;for(let r=0;r<t;r++)this._segmentToGroundQuads[r].sort(((e,t)=>e.region-t.region));for(let r=0;r<t;r++){const t=this._segmentToGroundQuads[r],i=e[r],n=this._segmentToRegionTriCounts[r];n.reduce(((e,t)=>e+t),0);let o=0;for(let e=0;e<=4;e++){const t=n[e];if(0!==t){let r=this.regionSegments[e];r||(r=this.regionSegments[e]=new ra);const n={vertexOffset:i.vertexOffset,primitiveOffset:i.primitiveOffset+o,vertexLength:i.vertexLength,primitiveLength:t};r.get().push(n)}o+=t}for(let e=0;e<t.length;e++){const r=t[e].id;this.indexArray.emplaceBack(r,r+1,r+3),this.indexArray.emplaceBack(r,r+3,r+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,t,r,i,n,o){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,t,r,i,n,o)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,hp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,t,r,i,n,o){this.hasData()&&this.programConfigurations.updatePaintArrays(e,t,r,i,n,o)}updateHiddenByLandmark(e){if(!this.hasData())return;const t=e.groundVertexCount+e.groundVertexArrayOffset;if(0===e.groundVertexCount)return;const r=e.flags&nf?1:0;for(let i=e.groundVertexArrayOffset;i<t;++i)this.hiddenByLandmarkVertexArray.emplace(i,r);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,pp.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const t=this.regionSegments[e];t&&t.destroy()}}}}class mf{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ps,this.footprintVertices=new ps,this.footprintSegments=[],this.layoutVertexArray=new ms,this.centroidVertexArray=new Qs,this.indexArray=new Ps,this.programConfigurations=new ka(e.layers,e.zoom,(e=>Jp.includes(e))),this.segments=new ra,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.groundEffect=new ff(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,t,r,i){this.features=[],this.hasPattern=op("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=wl(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:n,id:o,index:s,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,l=Rl(n,e);if(!this.layers[0]._featureFilter.filter(new Co(this.zoom),l,r))continue;const c={id:o,sourceLayerIndex:a,index:s,geometry:e?l.geometry:Ll(n,r,i),properties:n.properties,type:n.type,patterns:{}},u=this.layoutVertexArray.length;this.hasPattern?this.features.push(sp("fill-extrusion",this.layers,c,this.zoom,t)):this.addFeature(c,c.geometry,s,r,{},t.availableImages,i,t.brightness),t.featureIndex.insert(n,c.geometry,s,a,this.index,u)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,t,r,i,n,o){for(const s of this.features){const{geometry:e}=s;this.addFeature(s,e,s.index,t,r,i,n,o)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(e,t,r,i,n){const o=0!==Object.keys(e).length;if(o&&!this.stateDependentLayers.length)return;const s=o?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,t,s,r,i,n),this.groundEffect.update(e,t,s,r,i,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mp),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,fp.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,dp.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,r,i,n,o,s,a){const l=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,c=[new g(0,0),new g(Lr,Lr)],u=s.projection,h="globe"===u.name,d="Polygon"===Kp[e.type],p=new uf;p.centroidDataIndex=this.centroidData.length;const f=new cf,m=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},i)<=0,_=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},i);f.height=_,f.vertexArrayOffset=this.layoutVertexArray.length,f.groundVertexArrayOffset=this.groundEffect.vertexArray.length,h&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new bs);const y=ip(t,500);for(let g=y.length-1;g>=0;g--){const e=y[g];(0===e.length||(x=e[0]).every((e=>e.x<=0))||x.every((e=>e.x>=Lr))||x.every((e=>e.y<=0))||x.every((e=>e.y>=Lr)))&&y.splice(g,1)}var x;let v;if(h)v=Ef(y,c,i);else{v=[];for(const e of y)v.push({polygon:e,bounds:c})}const b=d?this.edgeRadius:0,w=b>0&&this.zoom<17,T=(e,t)=>{if(0===e.length)return!1;const r=e[e.length-1];return t.x===r.x&&t.y===r.y};for(const{polygon:g,bounds:E}of v){let e=0,t=0;for(const i of g)d&&!i[0].equals(i[i.length-1])&&i.push(i[0]),t+=d?i.length-1:i.length;const r=this.segments.prepareSegment((d?5:4)*t,this.layoutVertexArray,this.indexArray);f.footprintSegIdx<0&&(f.footprintSegIdx=this.footprintSegments.length),f.polygonSegIdx<0&&(f.polygonSegIdx=this.polygonSegments.length);const n={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},o=new lf;if(o.vertexOffset=this.footprintVertices.length,o.indexOffset=3*this.footprintIndices.length,o.ringIndices=[],d){const t=[],n=[];e=r.vertexLength;for(let e=0;e<g.length;e++){const s=g[e];s.length&&0!==e&&n.push(t.length/2);const a=[];let c,d;c=s[1].sub(s[0])._perp()._unit(),o.ringIndices.push(s.length-1);for(let e=1;e<s.length;e++){const n=s[e],o=s[e===s.length-1?1:e+1],l=n.clone();if(b){d=o.sub(n)._perp()._unit();const e=c.add(d)._unit(),t=b*Math.min(4,1/(c.x*e.x+c.y*e.y));l.x+=t*e.x,l.y+=t*e.y,l.x=Math.round(l.x),l.y=Math.round(l.y),c=d}!m||0!==b&&!w||T(a,l)||a.push(l),of(this.layoutVertexArray,l.x,l.y,0,0,1,1,0),r.vertexLength++,this.footprintVertices.emplaceBack(n.x,n.y),t.push(n.x,n.y),h&&af(this.layoutVertexExtArray,u.projectTilePoint(l.x,l.y,i),u.upVector(i,l.x,l.y))}m&&(0===b||w)&&(0!==a.length&&T(a,a[0])&&a.pop(),this.groundEffect.addData(a,E,l))}const s=rp(t,n);for(let i=0;i<s.length;i+=3)this.footprintIndices.emplaceBack(o.vertexOffset+s[i+0],o.vertexOffset+s[i+1],o.vertexOffset+s[i+2]),this.indexArray.emplaceBack(e+s[i],e+s[i+2],e+s[i+1]),r.primitiveLength++;o.indexCount+=s.length,o.vertexCount+=this.footprintVertices.length-o.vertexOffset}for(let s=0;s<g.length;s++){const t=g[s];p.startRing(f,t[0]);let n=t.length>4&&bf(t[t.length-2],t[0],t[1]),o=b?gf(t[t.length-2],t[0],t[1],b):0;const a=[];let c,_,y;_=t[1].sub(t[0])._perp()._unit();let x=!0;for(let s=1,l=0;s<t.length;s++){let d=t[s-1],g=t[s];const v=t[s===t.length-1?1:s+1];if(p.appendEdge(f,g,d),xf(g,d,E)){b&&(_=v.sub(g)._perp()._unit(),x=!x);continue}const w=g.sub(d)._perp(),S=w.x/(Math.abs(w.x)+Math.abs(w.y)),M=w.y>0?1:0,A=d.dist(g);if(l+A>32768&&(l=0),b){y=v.sub(g)._perp()._unit();let e=yf(d,g,v,_f(_,y),b);isNaN(e)&&(e=0);const t=g.sub(d)._unit();d=d.add(t.mult(o))._round(),g=g.add(t.mult(-e))._round(),o=e,_=y,m&&this.zoom>=17&&(T(a,d)||a.push(d),T(a,g)||a.push(g))}const I=r.vertexLength,C=t.length>4&&bf(d,g,v);let P=wf(l,n,x);if(of(this.layoutVertexArray,d.x,d.y,S,M,0,0,P),of(this.layoutVertexArray,d.x,d.y,S,M,0,1,P),l+=A,P=wf(l,C,!x),n=C,of(this.layoutVertexArray,g.x,g.y,S,M,0,0,P),of(this.layoutVertexArray,g.x,g.y,S,M,0,1,P),r.vertexLength+=4,this.indexArray.emplaceBack(I+0,I+1,I+2),this.indexArray.emplaceBack(I+1,I+3,I+2),r.primitiveLength+=2,b){const i=e+(1===s?t.length-2:s-2),n=1===s?e:i+1;if(this.indexArray.emplaceBack(I+1,i,I+3),this.indexArray.emplaceBack(i,n,I+3),r.primitiveLength+=2,void 0===c&&(c=I),!xf(v,t[s],E)){const e=s===t.length-1?c:r.vertexLength;this.indexArray.emplaceBack(I+2,I+3,e),this.indexArray.emplaceBack(I+3,e+1,e),this.indexArray.emplaceBack(I+3,n,e+1),r.primitiveLength+=3}x=!x}if(h){const e=this.layoutVertexExtArray,t=u.projectTilePoint(d.x,d.y,i),r=u.projectTilePoint(g.x,g.y,i),n=u.upVector(i,d.x,d.y),o=u.upVector(i,g.x,g.y);af(e,t,n),af(e,t,n),af(e,r,o),af(e,r,o)}}d&&(e+=t.length-1),m&&b&&this.zoom>=17&&(0!==a.length&&T(a,a[0])&&a.pop(),this.groundEffect.addData(a,E,l,b>0))}this.footprintSegments.push(o),n.triangleCount=this.indexArray.length-n.triangleArrayOffset,this.polygonSegments.push(n),++f.footprintSegLen,++f.polygonSegLen}if(f.vertexCount=this.layoutVertexArray.length-f.vertexArrayOffset,f.groundVertexCount=this.groundEffect.vertexArray.length-f.groundVertexArrayOffset,0!==f.vertexCount){if(f.centroidXY=p.borders?rf:this.encodeCentroid(p,f),this.centroidData.push(f),p.borders){this.featuresOnBorder.push(p);const e=this.featuresOnBorder.length-1;for(let t=0;t<p.borders.length;t++)p.borders[t][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[t].push(e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,n,o,i,a),this.groundEffect.addPaintPropertiesData(e,r,n,o,i,a),this.maxHeight=Math.max(this.maxHeight,_)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((t,r)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[r].borders[e][0]))}splitToSubtiles(){const e=[];for(let s=0;s<this.centroidData.length;s++){const t=this.centroidData[s],r=+(t.min.y+t.max.y>Lr),i=2*r+(+(t.min.x+t.max.x>Lr)^r);for(let n=0;n<t.polygonSegLen;n++){const r=t.polygonSegIdx+n;e.push({centroidIdx:s,subtile:i,polygonSegmentIdx:r,triangleSegmentIdx:this.polygonSegments[r].triangleSegIdx})}}const t=new Ps;e.sort(((e,t)=>e.triangleSegmentIdx===t.triangleSegmentIdx?e.subtile-t.subtile:e.triangleSegmentIdx-t.triangleSegmentIdx));let r=0,i=0,n=0;for(const s of e){if(s.triangleSegmentIdx!==r)break;n++}const o=e.length;for(;i!==e.length;){r=e[i].triangleSegmentIdx;let s=0,a=i,l=i;for(let t=a;t<n&&e[t].subtile===s;t++)l++;for(;a!==n;){const i=e[a];s=i.subtile;const o=this.centroidData[i.centroidIdx].min.clone(),c=this.centroidData[i.centroidIdx].max.clone(),u={vertexOffset:this.segments.segments[r].vertexOffset,primitiveOffset:t.length,vertexLength:this.segments.segments[r].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let r=a;r<l;r++){const i=e[r],n=this.polygonSegments[i.polygonSegmentIdx],s=this.centroidData[i.centroidIdx].min,a=this.centroidData[i.centroidIdx].max,l=this.indexArray.uint16;for(let e=n.triangleArrayOffset;e<n.triangleArrayOffset+n.triangleCount;e++)t.emplaceBack(l[3*e],l[3*e+1],l[3*e+2]);u.primitiveLength+=n.triangleCount,o.x=Math.min(o.x,s.x),o.y=Math.min(o.y,s.y),c.x=Math.max(c.x,a.x),c.y=Math.max(c.y,a.y)}u.primitiveLength>0&&this.triangleSubSegments.push({segment:u,min:o,max:c}),a=l;for(let t=a;t<n&&e[t].subtile===e[a].subtile;t++)l++}i=n;for(let t=i;t<o&&e[t].triangleSegmentIdx===e[i].triangleSegmentIdx;t++)n++}t._trim(),this.indexArray=t}getVisibleSegments(e,t,r){let i=0,n=0;const o=1<<e.canonical.z;if(t){const r=t.getMinMaxForTile(e);r&&(i=r.min,n=r.max)}n+=this.maxHeight;const s=e.toUnwrapped();let a;const l=[s.canonical.x/o+s.wrap,s.canonical.y/o],c=[(s.canonical.x+1)/o+s.wrap,(s.canonical.y+1)/o],u=new ra,h=(e,t,r)=>[e[0]*(1-r[0])+t[0]*r[0],e[1]*(1-r[1])+t[1]*r[1]],d=[],p=[];for(const f of this.triangleSubSegments){d[0]=f.min.x/Lr,d[1]=f.min.y/Lr,p[0]=f.max.x/Lr,p[1]=f.max.y/Lr;const e=h(l,c,d),t=h(l,c,p);if(0===new Rh([e[0],e[1],i],[t[0],t[1],n]).intersectsPrecise(r)){a&&(u.segments.push(a),a=void 0);continue}const o=f.segment;a&&a.vertexOffset!==o.vertexOffset&&(u.segments.push(a),a=void 0),a?(a.vertexLength+=o.vertexLength,a.primitiveLength+=o.primitiveLength):a={vertexOffset:o.vertexOffset,primitiveLength:o.primitiveLength,vertexLength:o.vertexLength,primitiveOffset:o.primitiveOffset,sortKey:void 0,vaos:{}}}return a&&u.segments.push(a),u}encodeCentroid(e,t){const r=e.centroid(),i=t.span(),n=Math.min(7,Math.round(i.x*this.tileToMeter/10)),o=Math.min(7,Math.round(i.y*this.tileToMeter/10));return new g(M(r.x,1,Lr-1)<<3|n,M(r.y,1,Lr-1)<<3|o)}encodeBorderCentroid(e){if(!e.borders)return new g(0,0);const t=e.borders,r=Number.MAX_VALUE;if(t[0][0]!==r||t[1][0]!==r){const e=t[0][0]!==r?0:1;return new g(6|(t[0][0]!==r?0:65528),(t[e][0]+t[e][1])/2<<3|6)}{const e=t[2][0]!==r?2:3;return new g((t[e][0]+t[e][1])/2<<3|6,6|(t[2][0]!==r?0:65528))}}showCentroid(e){const t=this.centroidData[e.centroidDataIndex];t.flags&=nf,t.centroidXY.x=0,t.centroidXY.y=0,this.writeCentroidToBuffer(t)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const t=e.vertexArrayOffset,r=e.vertexCount+e.vertexArrayOffset,i=e.flags&nf?rf:e.centroidXY,n=this.centroidVertexArray.geta_centroid_pos0(t);if(this.centroidVertexArray.geta_centroid_pos1(t)!==i.y||n!==i.x){for(let e=t;e<r;++e)this.centroidVertexArray.emplace(e,i.x,i.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const r=t.getReplacementRegionsForTile(e.toUnwrapped());if(function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r].sourceId!==t[r].sourceId||!Rp(e[r],t[r]))return!1;return!0}(this.activeReplacements,r))return;if(this.activeReplacements=r,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const n of this.centroidData)n.flags&=2147483647;const i=[];for(const n of this.activeReplacements){const t=Math.pow(2,n.footprintTileId.canonical.z-e.canonical.z);for(const r of this.centroidData)if(!(r.flags&nf||n.min.x>r.max.x||r.min.x>n.max.x||n.min.y>r.max.y||r.min.y>n.max.y))for(let o=0;o<r.footprintSegLen;o++){const s=this.footprintSegments[r.footprintSegIdx+o];if(i.length=0,Sf(this.footprintVertices,s.vertexOffset,s.vertexCount,n.footprintTileId.canonical,e.canonical,i),kp(n.footprint,i,this.footprintIndices.uint16,s.indexOffset,s.indexCount,-s.vertexOffset,-t)){r.flags|=nf;break}}}for(const n of this.centroidData)this.writeCentroidToBuffer(n);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,t,r){let i=!1;for(let n=0;n<r.footprintSegLen;n++){const o=this.footprintSegments[r.footprintSegIdx+n];let s=0;for(const r of o.ringIndices){for(let n=s,a=r+s-1;n<r+s;a=n++){const r=this.footprintVertices.int16[2*(n+o.vertexOffset)+0],s=this.footprintVertices.int16[2*(n+o.vertexOffset)+1],l=this.footprintVertices.int16[2*(a+o.vertexOffset)+1];s>t!=l>t&&e<(this.footprintVertices.int16[2*(a+o.vertexOffset)+0]-r)*(t-s)/(l-s)+r&&(i=!i)}s=r}}return i}getHeightAtTileCoord(e,t){let r=Number.NEGATIVE_INFINITY,i=!0;const n=4*(e+Lr)*Lr+(t+Lr);if(this.partLookup.hasOwnProperty(n)){const e=this.partLookup[n];return e?{height:e.height,hidden:!!(e.flags&nf)}:void 0}for(const o of this.centroidData)e>o.max.x||o.min.x>e||t>o.max.y||o.min.y>t||this.footprintContainsPoint(e,t,o)&&o&&o.height>r&&(r=o.height,this.partLookup[n]=o,i=!!(o.flags&nf));if(r!==Number.NEGATIVE_INFINITY)return{height:r,hidden:i};this.partLookup[n]=void 0}}function _f(e,t){const r=e.add(t)._unit();return e.x*r.x+e.y*r.y}function gf(e,t,r,i){const n=t.sub(e)._perp()._unit(),o=r.sub(t)._perp()._unit();return yf(e,t,r,_f(n,o),i)}function yf(e,t,r,i,n){const o=Math.sqrt(1-i*i);return Math.min(e.dist(t)/3,t.dist(r)/3,n*o/i)}function xf(e,t,r){return e.x<r[0].x&&t.x<r[0].x||e.x>r[1].x&&t.x>r[1].x||e.y<r[0].y&&t.y<r[0].y||e.y>r[1].y&&t.y>r[1].y}function vf(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function bf(e,t,r){if(e.x<0||e.x>=Lr||t.x<0||t.x>=Lr||r.x<0||r.x>=Lr)return!1;const i=r.sub(t),n=i.perp(),o=e.sub(t);return(i.x*o.x+i.y*o.y)/Math.sqrt((i.x*i.x+i.y*i.y)*(o.x*o.x+o.y*o.y))>-.866&&n.x*o.x+n.y*o.y<0}function wf(e,t,r){const i=t?2|e:-3&e;return r?1|i:-2&i}function Tf(){const e=Math.PI/32,t=Math.tan(e),r=Ja;return r*Math.sqrt(1+2*t*t)-r}function Ef(e,t,r){const i=1<<r.z,n=ml(r.x/i),o=ml((r.x+1)/i),s=_l(r.y/i),a=_l((r.y+1)/i);return function(e,t,r,i,n=0,o){const s=[];if(!e.length||!r||!i)return s;const a=(e,t)=>{for(const r of e)s.push({polygon:r,bounds:t})},l=Math.ceil(Math.log2(r)),c=Math.ceil(Math.log2(i)),u=l-c,h=[];for(let f=0;f<Math.abs(u);f++)h.push(u>0?0:1);for(let f=0;f<Math.min(l,c);f++)h.push(0),h.push(1);let d=e;if(d=Pp(d,t[0].y-n,t[1].y+n,1),d=Pp(d,t[0].x-n,t[1].x+n,0),!d.length)return s;const p=[];for(h.length?p.push({polygons:d,bounds:t,depth:0}):a(d,t);p.length;){const e=p.pop(),t=e.depth,r=h[t],i=e.bounds[0],s=e.bounds[1],l=0===r?i.x:i.y,c=0===r?s.x:s.y,u=o?o(r,l,c):.5*(l+c),d=Pp(e.polygons,l-n,u+n,r),f=Pp(e.polygons,u-n,c+n,r);if(d.length){const e=[i,new g(0===r?u:s.x,1===r?u:s.y)];h.length>t+1?p.push({polygons:d,bounds:e,depth:t+1}):a(d,e)}if(f.length){const e=[new g(0===r?u:i.x,1===r?u:i.y),s];h.length>t+1?p.push({polygons:f,bounds:e,depth:t+1}):a(f,e)}}return s}(e,t,Math.ceil((o-n)/11.25),Math.ceil((s-a)/11.25),1,((e,t,n)=>{if(0===e)return.5*(t+n);{const e=_l((r.y+t/Lr)/i);return(pl(.5*(_l((r.y+n/Lr)/i)+e))*i-r.y)*Lr}}))}function Sf(e,t,r,i,n,o){const s=Math.pow(2,i.z-n.z);for(let a=0;a<r;a++){let r=e.int16[2*(a+t)+0],l=e.int16[2*(a+t)+1];r=(r+n.x*Lr)*s-i.x*Lr,l=(l+n.y*Lr)*s-i.y*Lr,o.push(new g(r,l))}}ro(mf,"FillExtrusionBucket",{omit:["layers","features"]}),ro(cf,"PartData"),ro(lf,"FootprintSegment"),ro(uf,"BorderCentroidData"),ro(ff,"GroundEffect");const Mf=new Vo({visibility:new Bo($o["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Bo($o["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Af={paint:new Vo({"fill-extrusion-opacity":new Bo($o["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new No($o["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Bo($o["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Bo($o["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new No($o["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new No($o["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new No($o["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Bo($o["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Bo($o["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Bo($o["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Bo($o["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Bo($o["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Bo($o["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Bo($o["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Bo($o["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new No($o["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new No($o["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Bo($o["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Bo($o["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Bo($o["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Bo($o["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Bo($o["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:Mf};class If extends g{constructor(e,t,r){super(e,t),this.z=r}}function Cf(e,t){return e.x*t.x+e.y*t.y}function Pf(e,t){if(1===e.length){let r=0;const i=t[r++];let n;for(;!n||i.equals(n);)if(n=t[r++],!n)return 1/0;for(;r<t.length;r++){const o=t[r],s=e[0],a=n.sub(i),l=o.sub(i),c=s.sub(i),u=Cf(a,a),h=Cf(a,l),d=Cf(l,l),p=Cf(c,a),f=Cf(c,l),m=u*d-h*h,_=(d*p-h*f)/m,g=(u*f-h*p)/m,y=i.z*(1-_-g)+n.z*_+o.z*g;if(isFinite(y))return y}return 1/0}{let e=1/0;for(const r of t)e=Math.min(e,r.z);return e}}function Lf(e,t,r,i,n,o,s,a){const l=s*n.getElevationAt(e,t,!0,!0),c=0!==o[0],u=c?0===o[1]?s*(o[0]/7-450):s*function(e,t,r){const i=Math.floor(t[0]/8),n=Math.floor(t[1]/8),o=10*(t[0]-8*i),s=10*(t[1]-8*n),a=e.getElevationAt(i,n,!0,!0),l=e.getMeterToDEM(r),c=Math.floor(.5*(o*l-1)),u=Math.floor(.5*(s*l-1)),h=e.tileCoordToPixel(i,n),d=2*c+1,p=2*u+1,f=function(e,t,r,i,n){return[e.getElevationAtPixel(t,r,!0),e.getElevationAtPixel(t+n,r,!0),e.getElevationAtPixel(t,r+n,!0),e.getElevationAtPixel(t+i,r+n,!0)]}(e,h.x-c,h.y-u,d,p),m=Math.abs(f[0]-f[1]),_=Math.abs(f[2]-f[3]),g=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),y=Math.min(.25,.5*l*(m+_)/d),x=Math.min(.25,.5*l*g/p);return a+Math.max(y*o,x*s)}(n,o,a):l;return{base:l+(0===r)?-1:r,top:c?Math.max(u+i,l+r+2):l+i}}const Rf=hs([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Df}=Rf,Of=hs([{name:"a_packed",components:4,type:"Float32"}]),{members:zf}=Of;class kf{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new xd({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const r=this.getKey(e,t);return this.positions[r]}trim(){const e=this.width,t=this.height=O(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,r){const i=[];let n=e.length%2==1?-e[e.length-1]*r:0,o=e[0]*r,s=!0;i.push({left:n,right:o,isDash:s,zeroLength:0===e[0]});let a=e[0];for(let l=1;l<e.length;l++){s=!s;const t=e[l];n=a*r,a+=t,o=a*r,i.push({left:n,right:o,isDash:s,zeroLength:0===t})}return i}addRoundDash(e,t,r){const i=t/2;for(let n=-r;n<=r;n++){const t=this.width*(this.nextRow+r+n);let o=0,s=e[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=e[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const d=n/r*(i+1);if(s.isDash){const e=i-Math.abs(d);h=Math.sqrt(u*u+e*e)}else h=i-Math.sqrt(u*u+d*d);this.image.data[t+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e,t){for(let a=e.length-1;a>=0;--a){const t=e[a],r=e[a+1];t.zeroLength?e.splice(a,1):r&&r.isDash===t.isDash&&(r.left=t.left,e.splice(a,1))}const r=e[0],i=e[e.length-1];r.isDash===i.isDash&&(r.left=i.left-this.width,i.right=r.right+this.width);const n=this.width*this.nextRow;let o=0,s=e[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=e[++o]);const r=Math.abs(a-s.left),i=Math.abs(a-s.right),l=Math.min(r,i);this.image.data[n+a]=Math.max(0,Math.min(255,(s.isDash?l:-l)+t+128))}}addDash(e,t){const r=this.getKey(e,t);if(this.positions[r])return this.positions[r];const i="round"===t,n=i?7:0,o=2*n+1;if(this.nextRow+o>this.height)return j("LineAtlas out of space"),null;0===e.length&&e.push(1);let s=0;for(let c=0;c<e.length;c++)e[c]<0&&(j("Negative value is found in line dasharray, replacing values with 0"),e[c]=0),s+=e[c];if(0!==s){const r=this.width/s,o=this.getDashRanges(e,this.width,r);i?this.addRoundDash(o,r,n):this.addRegularDash(o,"square"===t?.5*r:0)}const a=this.nextRow+n;this.nextRow+=o;const l={tl:[a,n],br:[s,0]};return this.positions[r]=l,l}}ro(kf,"LineAtlas");const Ff=Cp.types,Bf=Math.cos(Math.PI/180*37.5);class Nf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new gs,this.layoutVertexArray2=new ys,this.indexArray=new Ps,this.programConfigurations=new ka(e.layers,e.zoom),this.segments=new ra,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,r,i){this.hasPattern=op("line",this.layers,t);const n=this.layers[0].layout.get("line-sort-key"),o=[];for(const{feature:c,id:u,index:h,sourceLayerIndex:d}of e){const e=this.layers[0]._featureFilter.needGeometry,t=Rl(c,e);if(!this.layers[0]._featureFilter.filter(new Co(this.zoom),t,r))continue;const s=n?n.evaluate(t,{},r):void 0,a={id:u,properties:c.properties,type:c.type,sourceLayerIndex:d,index:h,geometry:e?t.geometry:Ll(c,r,i),patterns:{},sortKey:s};o.push(a)}n&&o.sort(((e,t)=>e.sortKey-t.sortKey));const{lineAtlas:s,featureIndex:a}=t,l=this.addConstantDashes(s);for(const c of o){const{geometry:i,index:n,sourceLayerIndex:o}=c;if(l&&this.addFeatureDashes(c,s),this.hasPattern){const e=sp("line",this.layers,c,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(c,i,n,r,s.positions,t.availableImages,t.brightness);a.insert(e[n].feature,i,n,o,this.index)}}addConstantDashes(e){let t=!1;for(const r of this.layers){const i=r.paint.get("line-dasharray").value,n=r.layout.get("line-cap").value;if("constant"!==i.kind||"constant"!==n.kind)t=!0;else{const t=n.value,r=i.value;if(!r)continue;e.addDash(r,t)}}return t}addFeatureDashes(e,t){const r=this.zoom;for(const i of this.layers){const n=i.paint.get("line-dasharray").value,o=i.layout.get("line-cap").value;if("constant"===n.kind&&"constant"===o.kind)continue;let s,a;if("constant"===n.kind){if(s=n.value,!s)continue}else s=n.evaluate({zoom:r},e);a="constant"===o.kind?o.value:o.evaluate({zoom:r},e),t.addDash(s,a),e.patterns[i.id]=t.getKey(s,a)}}update(e,t,r,i,n){const o=0!==Object.keys(e).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,o?this.stateDependentLayers:this.layers,r,i,n)}addFeatures(e,t,r,i,n,o){for(const s of this.patternFeatures)this.addFeature(s,s.geometry,s.index,t,r,i,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,zf)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Df),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,r,i,n,o,s){const a=this.layers[0].layout,l=a.get("line-join").evaluate(e,{}),c=a.get("line-cap").evaluate(e,{}),u=a.get("line-miter-limit"),h=a.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const d of t)this.addLine(d,e,l,c,u,h);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,n,o,i,s)}addLine(e,t,r,i,n,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===Ff[t.type];let a=e.length;for(;a>=2&&e[a-1].equals(e[a-2]);)a--;let l=0;for(;l<a-1&&e[l].equals(e[l+1]);)l++;if(a<(s?3:2))return;"bevel"===r&&(n=1.05);const c=this.overscaling<=16?15*Lr/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,s&&(h=e[a-2],m=e[l].sub(h)._unit()._perp());for(let _=l;_<a;_++){if(p=_===a-1?s?e[l+1]:void 0:e[_+1],p&&e[_].equals(p))continue;m&&(f=m),h&&(d=h),h=e[_],m=p?p.sub(h)._unit()._perp():f,f=f||m;let t=f.add(m);0===t.x&&0===t.y||t._unit();const g=f.x*m.x+f.y*m.y,y=t.x*m.x+t.y*m.y,x=0!==y?1/y:1/0,v=2*Math.sqrt(2-2*y),b=y<Bf&&d&&p,w=f.x*m.y-f.y*m.x>0;if(b&&_>l){const e=h.dist(d);if(e>2*c){const t=h.sub(h.sub(d)._mult(c/e)._round());this.updateDistance(d,t),this.addCurrentVertex(t,f,0,0,u),d=t}}const T=d&&p;let E=T?r:s?"butt":i;if(T&&"round"===E&&(x<o?E="miter":x<=2&&(E="fakeround")),"miter"===E&&x>n&&(E="bevel"),"bevel"===E&&(x>2&&(E="flipbevel"),x<n&&(E="miter")),d&&this.updateDistance(d,h),"miter"===E)t._mult(x),this.addCurrentVertex(h,t,0,0,u);else if("flipbevel"===E){if(x>100)t=m.mult(-1);else{const e=x*f.add(m).mag()/f.sub(m).mag();t._perp()._mult(e*(w?-1:1))}this.addCurrentVertex(h,t,0,0,u),this.addCurrentVertex(h,t.mult(-1),0,0,u)}else if("bevel"===E||"fakeround"===E){const e=-Math.sqrt(x*x-1),t=w?e:0,r=w?0:e;if(d&&this.addCurrentVertex(h,f,t,r,u),"fakeround"===E){const e=Math.round(180*v/Math.PI/20);for(let t=1;t<e;t++){let r=t/e;if(.5!==r){const e=r-.5;r+=r*e*(r-1)*((1.0904+g*(g*(3.55645-1.43519*g)-3.2452))*e*e+(.848013+g*(.215638*g-1.06021)))}const i=m.sub(f)._mult(r)._add(f)._unit()._mult(w?-1:1);this.addHalfVertex(h,i.x,i.y,!1,w,0,u)}}p&&this.addCurrentVertex(h,m,-t,-r,u)}else if("butt"===E)this.addCurrentVertex(h,t,0,0,u);else if("square"===E){const e=d?1:-1;d||this.addCurrentVertex(h,t,e,e,u),this.addCurrentVertex(h,t,0,0,u),d&&this.addCurrentVertex(h,t,e,e,u)}else"round"===E&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(b&&_<a-1){const e=h.dist(p);if(e>2*c){const t=h.add(p.sub(h)._mult(c/e)._round());this.updateDistance(h,t),this.addCurrentVertex(t,m,0,0,u),h=t}}}}addCurrentVertex(e,t,r,i,n,o=!1){const s=t.y*i-t.x,a=-t.y-t.x*i;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,o,!1,r,n),this.addHalfVertex(e,s,a,o,!0,-i,n)}addHalfVertex({x:e,y:t},r,i,n,o,s,a){this.layoutVertexArray.emplaceBack((e<<1)+(n?1:0),(t<<1)+(o?1:0),Math.round(63*r)+128,Math.round(63*i)+128,1+(0===s?0:s<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const l=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),a.primitiveLength++),o?this.e2=l:this.e1=l}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}ro(Nf,"LineBucket",{omit:["layers","patternFeatures"]});const Uf=new Vo({"line-cap":new No($o.layout_line["line-cap"]),"line-join":new No($o.layout_line["line-join"]),"line-miter-limit":new Bo($o.layout_line["line-miter-limit"]),"line-round-limit":new Bo($o.layout_line["line-round-limit"]),"line-sort-key":new No($o.layout_line["line-sort-key"]),visibility:new Bo($o.layout_line.visibility)});var Vf={paint:new Vo({"line-opacity":new No($o.paint_line["line-opacity"]),"line-color":new No($o.paint_line["line-color"]),"line-translate":new Bo($o.paint_line["line-translate"]),"line-translate-anchor":new Bo($o.paint_line["line-translate-anchor"]),"line-width":new No($o.paint_line["line-width"]),"line-gap-width":new No($o.paint_line["line-gap-width"]),"line-offset":new No($o.paint_line["line-offset"]),"line-blur":new No($o.paint_line["line-blur"]),"line-dasharray":new No($o.paint_line["line-dasharray"]),"line-pattern":new No($o.paint_line["line-pattern"]),"line-gradient":new Uo($o.paint_line["line-gradient"]),"line-trim-offset":new Bo($o.paint_line["line-trim-offset"]),"line-emissive-strength":new Bo($o.paint_line["line-emissive-strength"]),"line-border-width":new No($o.paint_line["line-border-width"]),"line-border-color":new No($o.paint_line["line-border-color"])}),layout:Uf};function jf(e,t,r){return t*(Lr/(e.tileSize*Math.pow(2,r-e.tileID.overscaledZ)))}function Gf(e,t){return 1/jf(e,1,t.tileZoom)}function $f(e,t,r,i){return e.translatePosMatrix(i||t.tileID.projMatrix,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const qf=e=>{const t=[];Zf(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const r=e.paint.get("line-trim-offset");return 0===r[0]&&0===r[1]||t.push("RENDER_LINE_TRIM_OFFSET"),0!==e.paint.get("line-border-width").constantOr(1)&&t.push("RENDER_LINE_BORDER"),t};function Zf(e){const t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const Wf=new class extends No{possiblyEvaluate(e,t){return t=new Co(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,r,i){return t=P({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,r,i)}}(Vf.paint.properties["line-width"].specification);function Hf(e,t){return t>0?t+2*e:e}Wf.useIntegerZoom=!0;const Xf=hs([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Yf=hs([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Kf=hs([{name:"a_projected_pos",components:4,type:"Float32"}],4);hs([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Jf=hs([{name:"a_z_offset",components:1,type:"Float32"}],4),Qf=hs([{name:"a_texb",components:2,type:"Uint16"}]),em=hs([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),tm=hs([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);hs([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const rm=hs([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),im=hs([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);hs([{name:"triangle",components:3,type:"Uint16"}]),hs([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),hs([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),hs([{type:"Float32",name:"offsetX"}]),hs([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var nm=24;const om=128;function sm(e,t){const{expression:r}=t;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new Co(e+1))};if("source"===r.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:i}=r;let n=0;for(;n<t.length&&t[n]<=e;)n++;n=Math.max(0,n-1);let o=n;for(;o<t.length&&t[o]<e+1;)o++;o=Math.min(t.length-1,o);const s=t[n],a=t[o];return"composite"===r.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:i}:{kind:"camera",minZoom:s,maxZoom:a,minSize:r.evaluate(new Co(s)),maxSize:r.evaluate(new Co(a)),interpolationType:i}}}function am(e,{uSize:t,uSizeT:r},{lowerSize:i,upperSize:n}){return"source"===e.kind?i/om:"composite"===e.kind?ct(i/om,n/om,r):t}function lm(e,t){let r=0,i=0;if("constant"===e.kind)i=e.layoutSize;else if("source"!==e.kind){const{interpolationType:n,minZoom:o,maxZoom:s}=e,a=n?M(qi.interpolationFactor(n,t,o,s),0,1):0;"camera"===e.kind?i=ct(e.minSize,e.maxSize,a):r=a}return{uSizeT:r,uSize:i}}var cm=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:om,evaluateSizeForFeature:am,evaluateSizeForZoom:lm,getSizeData:sm});function um(e,t,r){return e.sections.forEach((e=>{e.text=function(e,t,r){const i=t.layout.get("text-transform").evaluate(r,{});return"uppercase"===i?e=e.toLocaleUpperCase():"lowercase"===i&&(e=e.toLocaleLowerCase()),Io.applyArabicShaping&&(e=Io.applyArabicShaping(e)),e}(e.text,t,r)})),e}const hm={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function dm(e){return"︶"===e||"﹈"===e||"︸"===e||"﹄"===e||"﹂"===e||"︾"===e||"︼"===e||"︺"===e||"︘"===e||"﹀"===e||"︐"===e||"︓"===e||"︔"===e||"｀"===e||"￣"===e||"︑"===e||"︒"===e}function pm(e){return"︵"===e||"﹇"===e||"︷"===e||"﹃"===e||"﹁"===e||"︽"===e||"︻"===e||"︹"===e||"︗"===e||"︿"===e}var fm={/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */read:function(e,t,r,i,n){var o,s,a=8*n-i-1,l=(1<<a)-1,c=l>>1,u=-7,h=r?n-1:0,d=r?-1:1,p=e[t+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+e[t+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=i;u>0;s=256*s+e[t+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,i),o-=c}return(p?-1:1)*s*Math.pow(2,o-i)},write:function(e,t,r,i,n,o){var s,a,l,c=8*o-n-1,u=(1<<c)-1,h=u>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:o-1,f=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(t*l-1)*Math.pow(2,n),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,n),s=0));n>=8;e[r+p]=255&a,p+=f,a/=256,n-=8);for(s=s<<n|a,c+=n;c>0;e[r+p]=255&s,p+=f,s/=256,c-=8);e[r+p-f]|=128*m}},mm=gm,_m=fm;function gm(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}gm.Varint=0,gm.Fixed64=1,gm.Bytes=2,gm.Fixed32=5;var ym=4294967296,xm=1/ym,vm="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function bm(e){return e.type===gm.Bytes?e.readVarint()+e.pos:e.pos+1}function wm(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Tm(e,t,r){var i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(i);for(var n=r.pos-1;n>=e;n--)r.buf[n+i]=r.buf[n]}function Em(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function Sm(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function Mm(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function Am(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function Im(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function Cm(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function Pm(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function Lm(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function Rm(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function Dm(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Om(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function zm(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}gm.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),n=i>>3,o=this.pos;this.type=7&i,e(n,t,this),this.pos===o&&this.skip(i)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Dm(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=zm(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Dm(this.buf,this.pos)+Dm(this.buf,this.pos+4)*ym;return this.pos+=8,e},readSFixed64:function(){var e=Dm(this.buf,this.pos)+zm(this.buf,this.pos+4)*ym;return this.pos+=8,e},readFloat:function(){var e=_m.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=_m.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,i=this.buf;return t=127&(r=i[this.pos++]),r<128?t:(t|=(127&(r=i[this.pos++]))<<7,r<128?t:(t|=(127&(r=i[this.pos++]))<<14,r<128?t:(t|=(127&(r=i[this.pos++]))<<21,r<128?t:function(e,t,r){var i,n,o=r.buf;if(i=(112&(n=o[r.pos++]))>>4,n<128)return wm(e,i,t);if(i|=(127&(n=o[r.pos++]))<<3,n<128)return wm(e,i,t);if(i|=(127&(n=o[r.pos++]))<<10,n<128)return wm(e,i,t);if(i|=(127&(n=o[r.pos++]))<<17,n<128)return wm(e,i,t);if(i|=(127&(n=o[r.pos++]))<<24,n<128)return wm(e,i,t);if(i|=(1&(n=o[r.pos++]))<<31,n<128)return wm(e,i,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=i[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&vm?function(e,t,r){return vm.decode(e.subarray(t,r))}(this.buf,t,e):function(e,t,r){for(var i="",n=t;n<r;){var o,s,a,l=e[n],c=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u>r)break;1===u?l<128&&(c=l):2===u?128==(192&(o=e[n+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(s=e[n+2],128==(192&(o=e[n+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(s=e[n+2],a=e[n+3],128==(192&(o=e[n+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,i+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),i+=String.fromCharCode(c),n+=u}return i}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==gm.Bytes)return e.push(this.readVarint(t));var r=bm(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==gm.Bytes)return e.push(this.readSVarint());var t=bm(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==gm.Bytes)return e.push(this.readBoolean());var t=bm(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==gm.Bytes)return e.push(this.readFloat());var t=bm(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==gm.Bytes)return e.push(this.readDouble());var t=bm(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==gm.Bytes)return e.push(this.readFixed32());var t=bm(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==gm.Bytes)return e.push(this.readSFixed32());var t=bm(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==gm.Bytes)return e.push(this.readFixed64());var t=bm(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==gm.Bytes)return e.push(this.readSFixed64());var t=bm(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===gm.Varint)for(;this.buf[this.pos++]>127;);else if(t===gm.Bytes)this.pos=this.readVarint()+this.pos;else if(t===gm.Fixed32)this.pos+=4;else{if(t!==gm.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Om(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Om(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Om(this.buf,-1&e,this.pos),Om(this.buf,Math.floor(e*xm),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Om(this.buf,-1&e,this.pos),Om(this.buf,Math.floor(e*xm),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var r,i;if(e>=0?(r=e%4294967296|0,i=e/4294967296|0):(i=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,i=i+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,r){r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,r.buf[r.pos]=127&(e>>>=7)}(r,0,t),function(e,t){var r=(7&e)<<4;t.buf[t.pos++]|=r|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(i,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,r){for(var i,n,o=0;o<t.length;o++){if((i=t.charCodeAt(o))>55295&&i<57344){if(!n){i>56319||o+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):n=i;continue}if(i<56320){e[r++]=239,e[r++]=191,e[r++]=189,n=i;continue}i=n-55296<<10|i-56320|65536,n=null}else n&&(e[r++]=239,e[r++]=191,e[r++]=189,n=null);i<128?e[r++]=i:(i<2048?e[r++]=i>>6|192:(i<65536?e[r++]=i>>12|224:(e[r++]=i>>18|240,e[r++]=i>>12&63|128),e[r++]=i>>6&63|128),e[r++]=63&i|128)}return r}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&Tm(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),_m.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),_m.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var i=this.pos-r;i>=128&&Tm(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(e,t,r){this.writeTag(e,gm.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Em,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Sm,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Im,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Mm,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Am,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Cm,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Pm,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Lm,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Rm,t)},writeBytesField:function(e,t){this.writeTag(e,gm.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,gm.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,gm.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,gm.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,gm.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,gm.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,gm.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,gm.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,gm.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,gm.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var km=h(mm);const Fm=3;function Bm(e,t,r){t.glyphs=[],1===e&&r.readMessage(Nm,t)}function Nm(e,t,r){if(3===e){const{id:e,bitmap:i,width:n,height:o,left:s,top:a,advance:l}=r.readMessage(Um,{});t.glyphs.push({id:e,bitmap:new xd({width:n+2*Fm,height:o+2*Fm},i),metrics:{width:n,height:o,left:s,top:a,advance:l}})}else 4===e?t.ascender=r.readSVarint():5===e&&(t.descender=r.readSVarint())}function Um(e,t,r){1===e?t.id=r.readVarint():2===e?t.bitmap=r.readBytes():3===e?t.width=r.readVarint():4===e?t.height=r.readVarint():5===e?t.left=r.readSVarint():6===e?t.top=r.readSVarint():7===e&&(t.advance=r.readVarint())}const Vm=Fm,jm={horizontal:1,vertical:2,horizontalOnly:3};class Gm{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const r=new Gm;return r.scale=e||1,r.fontStack=t,r}static forImage(e){const t=new Gm;return t.imageName=e,t}}class $m{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const r=new $m;for(let i=0;i<e.sections.length;i++){const n=e.sections[i];n.image?r.addImageSection(n):r.addTextSection(n,t)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(e,t){let r="";for(let i=0;i<e.length;i++){const n=e.charCodeAt(i+1)||null,o=e.charCodeAt(i-1)||null;r+=!t&&(n&&po(n)&&!hm[e[i+1]]||o&&po(o)&&!hm[e[i-1]])||!hm[e[i]]?e[i]:hm[e[i]]}return r}(this.text,e)}trim(){let e=0;for(let r=0;r<this.text.length&&Zm[this.text.charCodeAt(r)];r++)e++;let t=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&Zm[this.text.charCodeAt(r)];r--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const r=new $m;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Gm.forText(e.scale,e.fontStack||t));const r=this.sections.length-1;for(let i=0;i<e.text.length;++i)this.sectionIndex.push(r)}addImageSection(e){const t=e.image?e.image.namePrimary:"";if(0===t.length)return void j("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCodePoint(r),this.sections.push(Gm.forImage(t)),this.sectionIndex.push(this.sections.length-1)):j("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function qm(e,t,r,i,n,o,s,a,l,c,u,h,d,p,f){const m=$m.fromFeature(e,n);h===jm.vertical&&m.verticalizePunctuation(d);let _=[];const g=function(e,t,r,i,n,o){if(!e)return[];const s=[],a=function(e,t,r,i,n,o){let s=0;for(let a=0;a<e.length();a++){const r=e.getSection(a);s+=Hm(e.getCodePoint(a),r,i,n,t,o)}return s/Math.max(1,Math.ceil(s/r))}(e,t,r,i,n,o),l=e.text.indexOf("​")>=0;let c=0;for(let h=0;h<e.length();h++){const r=e.getSection(h),d=e.getCodePoint(h);if(Zm[d]||(c+=Hm(d,r,i,n,t,o)),h<e.length()-1){const t=!((u=d)<11904||!(ao["Bopomofo Extended"](u)||ao.Bopomofo(u)||ao["CJK Compatibility Forms"](u)||ao["CJK Compatibility Ideographs"](u)||ao["CJK Compatibility"](u)||ao["CJK Radicals Supplement"](u)||ao["CJK Strokes"](u)||ao["CJK Symbols and Punctuation"](u)||ao["CJK Unified Ideographs Extension A"](u)||ao["CJK Unified Ideographs"](u)||ao["Enclosed CJK Letters and Months"](u)||ao["Halfwidth and Fullwidth Forms"](u)||ao.Hiragana(u)||ao["Ideographic Description Characters"](u)||ao["Kangxi Radicals"](u)||ao["Katakana Phonetic Extensions"](u)||ao.Katakana(u)||ao["Vertical Forms"](u)||ao["Yi Radicals"](u)||ao["Yi Syllables"](u)));(Wm[d]||t||r.imageName)&&s.push(Km(h+1,c,a,s,Ym(d,e.getCodePoint(h+1),t&&l),!1))}}var u;return Jm(Km(e.length(),c,a,s,0,!0))}(m,c,o,t,i,p),{processBidirectionalText:y,processStyledBidirectionalText:x}=Io;if(y&&1===m.sections.length){const e=y(m.toString(),g);for(const t of e){const e=new $m;e.text=t,e.sections=m.sections;for(let r=0;r<t.length;r++)e.sectionIndex.push(0);_.push(e)}}else if(x){const e=x(m.text,m.sectionIndex,g);for(const t of e){const e=new $m;e.text=t[0],e.sectionIndex=t[1],e.sections=m.sections,_.push(e)}}else _=function(e,t){const r=[],i=e.text;let n=0;for(const o of t)r.push(e.substring(n,o)),n=o;return n<i.length&&r.push(e.substring(n,i.length)),r}(m,g);const v=[],b={positionedLines:v,text:m.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(e,t,r,i,n,o,s,a,l,c,u,h){let d=0,p=0,f=0;const m="right"===a?1:"left"===a?0:.5;let _=!1;for(const w of n){const e=w.getSections();for(const r of e){if(r.imageName)continue;const e=t[r.fontStack];if(e&&(_=void 0!==e.ascender&&void 0!==e.descender,!_))break}if(!_)break}let g=0;for(const w of n){w.trim();const n=w.getMaxScale(),s=(n-1)*nm,a={positionedGlyphs:[],lineOffset:0};e.positionedLines[g]=a;const x=a.positionedGlyphs;let v=0;if(!w.length()){p+=o,++g;continue}let b=0,T=0;for(let o=0;o<w.length();o++){const s=w.getSection(o),a=w.getSectionIndex(o),f=w.getCodePoint(o);let m=s.scale,g=null,E=null,S=null,M=nm,A=0;const I=!(l===jm.horizontal||!u&&!ho(f)||u&&(Zm[f]||(y=f,ao.Arabic(y)||ao["Arabic Supplement"](y)||ao["Arabic Extended-A"](y)||ao["Arabic Presentation Forms-A"](y)||ao["Arabic Presentation Forms-B"](y))));if(s.imageName){const t=i[s.imageName];if(!t)continue;S=s.imageName,e.iconsInText=e.iconsInText||!0,E=t.paddedRect;const r=t.displaySize;m=m*nm/h,g={width:r[0],height:r[1],left:0,top:-Vm,advance:I?r[1]:r[0],localGlyph:!1},A=_?-g.height*m:n*nm-17-r[1]*m,M=g.advance;const o=(I?r[0]:r[1])*m-nm*n;o>0&&o>v&&(v=o)}else{const e=r[s.fontStack];if(!e)continue;e[f]&&(E=e[f]);const i=t[s.fontStack];if(!i)continue;const o=i.glyphs[f];if(!o)continue;if(g=o.metrics,M=8203!==f?nm:0,_){const e=void 0!==i.ascender?Math.abs(i.ascender):0,t=void 0!==i.descender?Math.abs(i.descender):0,r=(e+t)*m;b<r&&(b=r,T=(e-t)/2*m),A=-e*m}else A=(n-m)*nm-17}I?(e.verticalizable=!0,x.push({glyph:f,imageName:S,x:d,y:p+A,vertical:I,scale:m,localGlyph:g.localGlyph,fontStack:s.fontStack,sectionIndex:a,metrics:g,rect:E}),d+=M*m+c):(x.push({glyph:f,imageName:S,x:d,y:p+A,vertical:I,scale:m,localGlyph:g.localGlyph,fontStack:s.fontStack,sectionIndex:a,metrics:g,rect:E}),d+=g.advance*m+c)}0!==x.length&&(f=Math.max(d-c,f),_?e_(x,m,v,T,o*n/2):e_(x,m,v,0,o/2)),d=0;const E=o*n+v;a.lineOffset=Math.max(v,s),p+=E,++g}var y;const x=p,{horizontalAlign:v,verticalAlign:b}=Qm(s);(function(e,t,r,i,n,o){const s=(t-r)*n,a=-o*i;for(const l of e)for(const e of l.positionedGlyphs)e.x+=s,e.y+=a})(e.positionedLines,m,v,b,f,x),e.top+=-b*x,e.bottom=e.top+x,e.left+=-v*f,e.right=e.left+f,e.hasBaseline=_}(b,t,r,i,_,s,a,l,h,c,d,f),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(v)&&b}const Zm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Wm={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Hm(e,t,r,i,n,o){if(t.imageName){const e=i[t.imageName];return e?e.displaySize[0]*t.scale*nm/o+n:0}{const i=r[t.fontStack],o=i&&i.glyphs[e];return o?o.metrics.advance*t.scale+n:0}}function Xm(e,t,r,i){const n=Math.pow(e-t,2);return i?e<t?n/2:2*n:n+Math.abs(r)*r}function Ym(e,t,r){let i=0;return 10===e&&(i-=1e4),r&&(i+=150),40!==e&&65288!==e||(i+=50),41!==t&&65289!==t||(i+=50),i}function Km(e,t,r,i,n,o){let s=null,a=Xm(t,r,n,o);for(const l of i){const e=Xm(t-l.x,r,n,o)+l.badness;e<=a&&(s=l,a=e)}return{index:e,x:t,priorBreak:s,badness:a}}function Jm(e){return e?Jm(e.priorBreak).concat(e.index):[]}function Qm(e){let t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function e_(e,t,r,i,n){if(!(t||r||i||n))return;const o=e.length-1,s=e[o],a=(s.x+s.metrics.advance*s.scale)*t;for(let l=0;l<=o;l++)e[l].x-=a,e[l].y+=r+i+n}function t_(e,t,r,i){const{horizontalAlign:n,verticalAlign:o}=Qm(i),s=r[0]-e.displaySize[0]*n,a=r[1]-e.displaySize[1]*o;return{imagePrimary:e,imageSecondary:t,top:a,bottom:a+e.displaySize[1],left:s,right:s+e.displaySize[0]}}function r_(e,t,r,i,n,o){const s=e.imagePrimary;let a;if(s.content){const e=s.content,t=s.pixelRatio||1;a=[e[0]/t,e[1]/t,s.displaySize[0]-e[2]/t,s.displaySize[1]-e[3]/t]}const l=t.left*o,c=t.right*o;let u,h,d,p;"width"===r||"both"===r?(p=n[0]+l-i[3],h=n[0]+c+i[1]):(p=n[0]+(l+c-s.displaySize[0])/2,h=p+s.displaySize[0]);const f=t.top*o,m=t.bottom*o;return"height"===r||"both"===r?(u=n[1]+f-i[0],d=n[1]+m+i[2]):(u=n[1]+(f+m-s.displaySize[1])/2,d=u+s.displaySize[1]),{imagePrimary:s,imageSecondary:void 0,top:u,right:h,bottom:d,left:p,collisionPadding:a}}class i_ extends g{constructor(e,t,r,i,n){super(e,t),this.angle=i,this.z=r,void 0!==n&&(this.segment=n)}clone(){return new i_(this.x,this.y,this.z,this.angle,this.segment)}}function n_(e,t,r,i,n){if(void 0===t.segment)return!0;let o=t,s=t.segment+1,a=0;for(;a>-r/2;){if(s--,s<0)return!1;a-=e[s].dist(o),o=e[s]}a+=e[s].dist(e[s+1]),s++;const l=[];let c=0;for(;a<r/2;){const t=e[s],r=e[s+1];if(!r)return!1;let o=e[s-1].angleTo(t)-t.angleTo(r);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>i;)c-=l.shift().angleDelta;if(c>n)return!1;s++,a+=t.dist(r)}return!0}function o_(e){let t=0;for(let r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function s_(e,t,r){return e?.6*t*r:0}function a_(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function l_(e,t,r,i,n,o){const s=s_(r,n,o),a=a_(r,i)*o;let l=0;const c=o_(e)/2;for(let u=0;u<e.length-1;u++){const r=e[u],i=e[u+1],n=r.dist(i);if(l+n>c){const o=(c-l)/n,h=ct(r.x,i.x,o),d=ct(r.y,i.y,o),p=new i_(h,d,0,i.angleTo(r),u);return!s||n_(e,p,a,s,t)?p:void 0}l+=n}}function c_(e,t,r,i,n,o,s,a,l){const c=s_(i,o,s),u=a_(i,n),h=u*s,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),u_(e,d?t/2*a%t:(u/2+2*o)*s*a%t,t,c,r,h,d,!1,l)}function u_(e,t,r,i,n,o,s,a,l){const c=o/2,u=o_(e);let h=0,d=t-r,p=[];for(let f=0;f<e.length-1;f++){const t=e[f],s=e[f+1],a=t.dist(s),m=s.angleTo(t);for(;d+r<h+a;){d+=r;const _=(d-h)/a,g=ct(t.x,s.x,_),y=ct(t.y,s.y,_);if(g>=0&&g<l&&y>=0&&y<l&&d-c>=0&&d+c<=u){const t=new i_(g,y,0,m,f);i&&!n_(e,t,o,i,n)||p.push(t)}}h+=a}return a||p.length||s||(p=u_(e,h/2,r,i,n,o,s,!0,l)),p}function h_(e,t,r,i,n){const o=[];for(let s=0;s<e.length;s++){const a=e[s];let l;for(let e=0;e<a.length-1;e++){let s=a[e],c=a[e+1];s.x<t&&c.x<t||(s.x<t?s=new g(t,s.y+(t-s.x)/(c.x-s.x)*(c.y-s.y))._round():c.x<t&&(c=new g(t,s.y+(t-s.x)/(c.x-s.x)*(c.y-s.y))._round()),s.y<r&&c.y<r||(s.y<r?s=new g(s.x+(r-s.y)/(c.y-s.y)*(c.x-s.x),r)._round():c.y<r&&(c=new g(s.x+(r-s.y)/(c.y-s.y)*(c.x-s.x),r)._round()),s.x>=i&&c.x>=i||(s.x>=i?s=new g(i,s.y+(i-s.x)/(c.x-s.x)*(c.y-s.y))._round():c.x>=i&&(c=new g(i,s.y+(i-s.x)/(c.x-s.x)*(c.y-s.y))._round()),s.y>=n&&c.y>=n||(s.y>=n?s=new g(s.x+(n-s.y)/(c.y-s.y)*(c.x-s.x),n)._round():c.y>=n&&(c=new g(s.x+(n-s.y)/(c.y-s.y)*(c.x-s.x),n)._round()),l&&s.equals(l[l.length-1])||(l=[s],o.push(l)),l.push(c)))))}}return o}function d_(e){let t=0,r=0;for(const s of e)t+=s.w*s.h,r=Math.max(r,s.w);e.sort(((e,t)=>t.h-e.h));const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let n=0,o=0;for(const s of e)for(let e=i.length-1;e>=0;e--){const t=i[e];if(!(s.w>t.w||s.h>t.h)){if(s.x=t.x,s.y=t.y,o=Math.max(o,s.y+s.h),n=Math.max(n,s.x+s.w),s.w===t.w&&s.h===t.h){const t=i.pop();e<i.length&&(i[e]=t)}else s.h===t.h?(t.x+=s.w,t.w-=s.w):s.w===t.w?(t.y+=s.h,t.h-=s.h):(i.push({x:t.x+s.w,y:t.y,w:t.w-s.w,h:s.h}),t.y+=s.h,t.h-=s.h);break}}return{w:n,h:o,fill:t/(n*o)||0}}ro(i_,"Anchor");const p_=1;class f_{constructor(e,{pixelRatio:t,version:r,stretchX:i,stretchY:n,content:o}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=i,this.stretchY=n,this.content=o,this.version=r}get tl(){return[this.paddedRect.x+p_,this.paddedRect.y+p_]}get br(){return[this.paddedRect.x+this.paddedRect.w-p_,this.paddedRect.y+this.paddedRect.h-p_]}get displaySize(){return[(this.paddedRect.w-2*p_)/this.pixelRatio,(this.paddedRect.h-2*p_)/this.pixelRatio]}}class m_{constructor(e,t){const r={},i={};this.haveRenderCallbacks=[];const n=[];this.addImages(e,r,n),this.addImages(t,i,n);const{w:o,h:s}=d_(n),a=new vd({width:o||1,height:s||1});for(const l in e){const t=e[l],i=r[l].paddedRect;vd.copy(t.data,a,{x:0,y:0},{x:i.x+p_,y:i.y+p_},t.data,t.sdf)}for(const l in t){const e=t[l],r=i[l].paddedRect,n=r.x+p_,o=r.y+p_,s=e.data.width,c=e.data.height;vd.copy(e.data,a,{x:0,y:0},{x:n,y:o},e.data),vd.copy(e.data,a,{x:0,y:c-1},{x:n,y:o-1},{width:s,height:1}),vd.copy(e.data,a,{x:0,y:0},{x:n,y:o+c},{width:s,height:1}),vd.copy(e.data,a,{x:s-1,y:0},{x:n-1,y:o},{width:1,height:c}),vd.copy(e.data,a,{x:0,y:0},{x:n+s,y:o},{width:1,height:c})}this.image=a,this.iconPositions=r,this.patternPositions=i}addImages(e,t,r){for(const i in e){const n=e[i],o={x:0,y:0,w:n.data.width+2*p_,h:n.data.height+2*p_};r.push(o),t[i]=new f_(o,n),n.hasRenderCallback&&this.haveRenderCallbacks.push(i)}}patchUpdatedImages(e,t,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((t=>e.hasImage(t,r))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,r);for(const i in e.getUpdatedImages(r))this.patchUpdatedImage(this.iconPositions[i],e.getImage(i,r),t),this.patchUpdatedImage(this.patternPositions[i],e.getImage(i,r),t)}patchUpdatedImage(e,t,r){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[i,n]=e.tl,o=!!Object.keys(this.patternPositions).length;r.update(t.data,{useMipmap:o},{x:i,y:n})}}ro(f_,"ImagePosition"),ro(m_,"ImageAtlas");const __=1e20;function g_(e,t,r,i,n,o,s,a,l){for(let c=t;c<t+i;c++)y_(e,r*o+c,o,n,s,a,l);for(let c=r;c<r+n;c++)y_(e,c*o+t,1,i,s,a,l)}function y_(e,t,r,i,n,o,s){o[0]=0,s[0]=-__,s[1]=__,n[0]=e[t];for(let a=1,l=0,c=0;a<i;a++){n[a]=e[t+a*r];const i=a*a;do{const e=o[l];c=(n[a]-n[e]+i-e*e)/(a-e)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=__}for(let a=0,l=0;a<i;a++){for(;s[l+1]<a;)l++;const i=o[l],c=a-i;e[t+a*r]=n[i]+c*c}}const x_=2,v_={none:0,ideographs:1,all:2};class b_{constructor(e,t,r){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=r,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,t){this.urls[t]=e}getGlyphs(e,t,r){const n=[],o=this.urls[t]||i.GLYPHS_URL;for(const i in e)for(const t of e[i])n.push({stack:i,id:t});C(n,(({stack:e,id:t},r)=>{let i=this.entries[e];i||(i=this.entries[e]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let n=i.glyphs[t];if(void 0!==n)return void r(null,{stack:e,id:t,glyph:n});if(n=this._tinySDF(i,e,t),n)return i.glyphs[t]=n,void r(null,{stack:e,id:t,glyph:n});const s=Math.floor(t/256);if(256*s>65535)return void r(new Error("glyphs > 65535 not supported"));if(i.ranges[s])return void r(null,{stack:e,id:t,glyph:n});let a=i.requests[s];a||(a=i.requests[s]=[],b_.loadGlyphRange(e,s,o,this.requestManager,((e,t)=>{if(t){i.ascender=t.ascender,i.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(i.glyphs[+e]=t.glyphs[+e]);i.ranges[s]=!0}for(const r of a)r(e,t);delete i.requests[s]}))),a.push(((i,n)=>{i?r(i):n&&r(null,{stack:e,id:t,glyph:n.glyphs[t]||null})}))}),((e,t)=>{if(e)r(e);else if(t){const e={};for(const{stack:r,id:i,glyph:n}of t)void 0===e[r]&&(e[r]={}),void 0===e[r].glyphs&&(e[r].glyphs={}),e[r].glyphs[i]=n&&{id:n.id,bitmap:n.bitmap.clone(),metrics:n.metrics},e[r].ascender=this.entries[r].ascender,e[r].descender=this.entries[r].descender;r(null,e)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==v_.none&&(this.localGlyphMode===v_.all?!!this.localFontFamily:!!this.localFontFamily&&(ao["CJK Unified Ideographs"](e)||ao["Hangul Syllables"](e)||ao.Hiragana(e)||ao.Katakana(e)||ao["CJK Symbols and Punctuation"](e)||ao["CJK Unified Ideographs Extension A"](e)||ao["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,t,r){const i=this.localFontFamily;if(!i||!this._doesCharSupportLocalGlyph(r))return;let n=e.tinySDF;if(!n){let r="400";/bold/i.test(t)?r="900":/medium/i.test(t)?r="500":/light/i.test(t)&&(r="200"),n=e.tinySDF=new b_.TinySDF({fontFamily:i,fontWeight:r,fontSize:24*x_,buffer:3*x_,radius:8*x_}),n.fontWeight=r}if(this.localGlyphs[n.fontWeight][r])return this.localGlyphs[n.fontWeight][r];const o=String.fromCodePoint(r),{data:s,width:a,height:l,glyphWidth:c,glyphHeight:u,glyphLeft:h,glyphTop:d,glyphAdvance:p}=n.draw(o);return this.localGlyphs[n.fontWeight][r]={id:r,bitmap:new xd({width:a,height:l},s),metrics:{width:c/x_,height:u/x_,left:h/x_,top:d/x_-27,advance:p/x_,localGlyph:!0}}}}b_.loadGlyphRange=function(e,t,r,i,n){const o=256*t,s=o+255,a=i.transformRequest(i.normalizeGlyphsURL(r).replace("{fontstack}",e).replace("{range}",`${o}-${s}`),Ee.Glyphs);Ie(a,((e,t)=>{if(e)n(e);else if(t){const e={},r=function(e){return new km(e).readFields(Bm,{})}(t);for(const t of r.glyphs)e[t.id]=t;n(null,{glyphs:e,ascender:r.ascender,descender:r.descender})}}))},b_.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:r=8,cutoff:i=.25,fontFamily:n="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=t,this.cutoff=i,this.radius=r;const a=this.size=e+4*t,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${o} ${e}px ${n}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:i,actualBoundingBoxLeft:n,actualBoundingBoxRight:o}=this.ctx.measureText(e),s=Math.ceil(r),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-n))),l=Math.min(this.size-this.buffer,s+Math.ceil(i)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return p;const{ctx:f,buffer:m,gridInner:_,gridOuter:g}=this;f.clearRect(m,m,a,l),f.fillText(e,m,m+s);const y=f.getImageData(m,m,a,l);g.fill(__,0,h),_.fill(0,0,h);for(let x=0;x<l;x++)for(let e=0;e<a;e++){const t=y.data[4*(x*a+e)+3]/255;if(0===t)continue;const r=(x+m)*c+e+m;if(1===t)g[r]=0,_[r]=__;else{const e=.5-t;g[r]=e>0?e*e:0,_[r]=e<0?e*e:0}}g_(g,0,0,c,u,c,this.f,this.v,this.z),g_(_,m,m,a,l,c,this.f,this.v,this.z);for(let x=0;x<h;x++){const e=Math.sqrt(g[x])-Math.sqrt(_[x]);d[x]=Math.round(255-255*(e/this.radius+this.cutoff))}return p}};const w_=p_;function T_(e,t,r,i){const n=[],o=e.imagePrimary,s=o.pixelRatio,a=o.paddedRect.w-2*w_,l=o.paddedRect.h-2*w_,c=e.right-e.left,u=e.bottom-e.top,h=o.stretchX||[[0,a]],d=o.stretchY||[[0,l]],p=(e,t)=>e+t[1]-t[0],f=h.reduce(p,0),m=d.reduce(p,0),_=a-f,y=l-m;let x=0,v=f,b=0,w=m,T=0,E=_,S=0,M=y;if(o.content&&i){const e=o.content;x=E_(h,0,e[0]),b=E_(d,0,e[1]),v=E_(h,e[0],e[2]),w=E_(d,e[1],e[3]),T=e[0]-x,S=e[1]-b,E=e[2]-e[0]-v,M=e[3]-e[1]-w}const A=(i,n,a,l)=>{const h=M_(i.stretch-x,v,c,e.left),d=A_(i.fixed-T,E,i.stretch,f),p=M_(n.stretch-b,w,u,e.top),_=A_(n.fixed-S,M,n.stretch,m),y=M_(a.stretch-x,v,c,e.left),A=A_(a.fixed-T,E,a.stretch,f),I=M_(l.stretch-b,w,u,e.top),C=A_(l.fixed-S,M,l.stretch,m),P=new g(h,p),L=new g(y,p),R=new g(y,I),D=new g(h,I),O=new g(d/s,_/s),z=new g(A/s,C/s),k=t*Math.PI/180;if(k){const e=Math.sin(k),t=Math.cos(k),r=[t,-e,e,t];P._matMult(r),L._matMult(r),D._matMult(r),R._matMult(r)}const F=i.stretch+i.fixed,B=a.stretch+a.fixed,N=n.stretch+n.fixed,U=l.stretch+l.fixed,V=e.imageSecondary;return{tl:P,tr:L,bl:D,br:R,texPrimary:{x:o.paddedRect.x+w_+F,y:o.paddedRect.y+w_+N,w:B-F,h:U-N},texSecondary:V?{x:V.paddedRect.x+w_+F,y:V.paddedRect.y+w_+N,w:B-F,h:U-N}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:O,pixelOffsetBR:z,minFontScaleX:E/s/c,minFontScaleY:M/s/u,isSDF:r}};if(i&&(o.stretchX||o.stretchY)){const e=S_(h,_,f),t=S_(d,y,m);for(let r=0;r<e.length-1;r++){const i=e[r],o=e[r+1];for(let e=0;e<t.length-1;e++)n.push(A(i,t[e],o,t[e+1]))}}else n.push(A({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:a+1},{fixed:0,stretch:l+1}));return n}function E_(e,t,r){let i=0;for(const n of e)i+=Math.max(t,Math.min(r,n[1]))-Math.max(t,Math.min(r,n[0]));return i}function S_(e,t,r){const i=[{fixed:-w_,stretch:0}];for(const[n,o]of e){const e=i[i.length-1];i.push({fixed:n-e.stretch,stretch:e.stretch}),i.push({fixed:n-e.stretch,stretch:e.stretch+(o-n)})}return i.push({fixed:t+w_,stretch:r}),i}function M_(e,t,r,i){return e/t*r+i}function A_(e,t,r,i){return e-t*r/i}function I_(e,t,r,i){const n=t+e.positionedLines[i].lineOffset;return 0===i?r+n/2:r+(n+(t+e.positionedLines[i-1].lineOffset))/2}function C_(e,t=1,r=!1){let i=1/0,n=1/0,o=-1/0,s=-1/0;const a=e[0];for(let p=0;p<a.length;p++){const e=a[p];(!p||e.x<i)&&(i=e.x),(!p||e.y<n)&&(n=e.y),(!p||e.x>o)&&(o=e.x),(!p||e.y>s)&&(s=e.y)}const l=Math.min(o-i,s-n);let c=l/2;const u=new Pr([],P_);if(0===l)return new g(i,n);for(let p=i;p<o;p+=l)for(let t=n;t<s;t+=l)u.push(new L_(p+c,t+c,c,e));let h=function(e){let t=0,r=0,i=0;const n=e[0];for(let o=0,s=n.length,a=s-1;o<s;a=o++){const e=n[o],s=n[a],l=e.x*s.y-s.x*e.y;r+=(e.x+s.x)*l,i+=(e.y+s.y)*l,t+=3*l}return new L_(r/t,i/t,0,e)}(e),d=u.length;for(;u.length;){const i=u.pop();(i.d>h.d||!h.d)&&(h=i,r&&console.log("found best %d after %d probes",Math.round(1e4*i.d)/1e4,d)),i.max-h.d<=t||(c=i.h/2,u.push(new L_(i.p.x-c,i.p.y-c,c,e)),u.push(new L_(i.p.x+c,i.p.y-c,c,e)),u.push(new L_(i.p.x-c,i.p.y+c,c,e)),u.push(new L_(i.p.x+c,i.p.y+c,c,e)),d+=4)}return r&&(console.log(`num probes: ${d}`),console.log(`best distance: ${h.d}`)),h.p}function P_(e,t){return t.max-e.max}class L_{constructor(e,t,r,i){this.p=new g(e,t),this.h=r,this.d=function(e,t){let r=!1,i=1/0;for(let n=0;n<t.length;n++){const o=t[n];for(let t=0,n=o.length,s=n-1;t<n;s=t++){const n=o[t],a=o[s];n.y>e.y!=a.y>e.y&&e.x<(a.x-n.x)*(e.y-n.y)/(a.y-n.y)+n.x&&(r=!r),i=Math.min(i,Gl(e,n,a))}}return(r?1:-1)*Math.sqrt(i)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}}const R_=Number.POSITIVE_INFINITY,D_=Math.sqrt(2);function O_(e,[t,r]){let i=0,n=0;if(r===R_){t<0&&(t=0);const r=t/D_;switch(e){case"top-right":case"top-left":n=r-7;break;case"bottom-right":case"bottom-left":n=7-r;break;case"bottom":n=7-t;break;case"top":n=t-7}switch(e){case"top-right":case"bottom-right":i=-r;break;case"top-left":case"bottom-left":i=r;break;case"left":i=t;break;case"right":i=-t}}else{switch(t=Math.abs(t),r=Math.abs(r),e){case"top-right":case"top-left":case"top":n=r-7;break;case"bottom-right":case"bottom-left":case"bottom":n=7-r}switch(e){case"top-right":case"bottom-right":case"right":i=-t;break;case"top-left":case"bottom-left":case"left":i=t}}return[i,n]}function z_(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function k_(e,t,r,i,n,o,s,a,l,c,u,h,d,p,f){let m=o.textMaxSize.evaluate(t,{},h);void 0===m&&(m=s);const _=e.layers[0].layout,g=_.get("icon-offset").evaluate(t,{},h),y=U_(r.horizontal)||r.vertical,x="globe"===d.name,b=nm,w=s/b,T=e.tilePixelRatio*m/b,E=(R=e.overscaling,e.zoom>18&&R>2&&(R>>=1),Math.max(Lr/(512*R),1)*_.get("symbol-spacing")),S=_.get("text-padding")*e.tilePixelRatio,M=_.get("icon-padding")*e.tilePixelRatio,A=v(_.get("text-max-angle")),I="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement"),C="map"===_.get("icon-rotation-alignment")&&"point"!==_.get("symbol-placement"),P=_.get("symbol-placement"),L=E/2;var R;const D=_.get("icon-text-fit").evaluate(t,{},h),O=_.get("icon-text-fit-padding").evaluate(t,{},h),z="none"!==D;let k;!1===e.hasAnyIconTextFit&&z&&(e.hasAnyIconTextFit=!0),i&&z&&(e.allowVerticalPlacement&&r.vertical&&(k=r_(i,r.vertical,D,O,g,w)),y&&(i=r_(i,y,D,O,g,w)));const F=(s,a,m)=>{if(a.x<0||a.x>=Lr||a.y<0||a.y>=Lr)return;let _=null;if(x){const{x:e,y:t,z:r}=d.projectTilePoint(a.x,a.y,m);_={anchor:new i_(e,t,r,0,void 0),up:d.upVector(m,a.x,a.y)}}!function(e,t,r,i,n,o,s,a,l,c,u,h,d,p,f,m,_,g,y,x,v,b,w,T,E,S,M){const A=e.addToLineVertexArray(t,i);let I,C,P,L,R,D,O,z=0,k=0,F=0,B=0,N=-1,U=-1;const V={};let G=da("");const $=r?r.anchor:t,q="none"!==l.layout.get("icon-text-fit").evaluate(v,{},E);let Z=0,W=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[Z,W]=l.layout.get("text-offset").evaluate(v,{},E).map((e=>e*nm)):(Z=l.layout.get("text-radial-offset").evaluate(v,{},E)*nm,W=R_),e.allowVerticalPlacement&&n.vertical){const e=n.vertical;if(f)D=j_(e),a&&(O=j_(a));else{const r=l.layout.get("text-rotate").evaluate(v,{},E)+90;P=V_(c,$,t,u,h,d,e,p,r,m),a&&(L=V_(c,$,t,u,h,d,a,g,r))}}if(o){const i=l.layout.get("icon-rotate").evaluate(v,{},E),n=T_(o,i,w,q),s=a?T_(a,i,w,q):void 0;C=V_(c,$,t,u,h,d,o,g,i),z=4*n.length;const p=e.iconSizeData;let f=null;"source"===p.kind?(f=[om*l.layout.get("icon-size").evaluate(v,{},E)],f[0]>B_&&j(`${e.layerIds[0]}: Value for "icon-size" is >= ${F_}. Reduce your "icon-size".`)):"composite"===p.kind&&(f=[om*b.compositeIconSizes[0].evaluate(v,{},E),om*b.compositeIconSizes[1].evaluate(v,{},E)],(f[0]>B_||f[1]>B_)&&j(`${e.layerIds[0]}: Value for "icon-size" is >= ${F_}. Reduce your "icon-size".`)),e.addSymbols(e.icon,n,f,x,y,v,!1,r,t,A.lineStartIndex,A.lineLength,-1,T,E,S,M),N=e.icon.placedSymbolArray.length-1,s&&(k=4*s.length,e.addSymbols(e.icon,s,f,x,y,v,jm.vertical,r,t,A.lineStartIndex,A.lineLength,-1,T,E,S,M),U=e.icon.placedSymbolArray.length-1)}for(const j in n.horizontal){const i=n.horizontal[j];I||(G=da(i.text),f?R=j_(i):I=V_(c,$,t,u,h,d,i,p,l.layout.get("text-rotate").evaluate(v,{},E),m));const o=1===i.positionedLines.length;if(F+=N_(e,r,t,i,s,l,f,v,m,A,n.vertical?jm.horizontal:jm.horizontalOnly,o?Object.keys(n.horizontal):[j],V,N,b,T,E,S),o)break}n.vertical&&(B+=N_(e,r,t,n.vertical,s,l,f,v,m,A,jm.vertical,["vertical"],V,U,b,T,E,S));let H=-1;const X=(e,t)=>e?Math.max(e,t):t;H=X(R,H),H=X(D,H),H=X(O,H);const Y=H>-1?1:0;e.glyphOffsetArray.length>=65535&&j("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==v.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,v.sortKey),e.symbolInstances.emplaceBack(t.x,t.y,$.x,$.y,$.z,V.right>=0?V.right:-1,V.center>=0?V.center:-1,V.left>=0?V.left:-1,V.vertical>=0?V.vertical:-1,N,U,G,void 0!==I?I:e.collisionBoxArray.length,void 0!==I?I+1:e.collisionBoxArray.length,void 0!==P?P:e.collisionBoxArray.length,void 0!==P?P+1:e.collisionBoxArray.length,void 0!==C?C:e.collisionBoxArray.length,void 0!==C?C+1:e.collisionBoxArray.length,L||e.collisionBoxArray.length,L?L+1:e.collisionBoxArray.length,u,F,B,z,k,Y,0,Z,W,H,0,q?1:0)}(e,a,_,s,r,i,n,k,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,S,I,l,0,M,C,g,t,o,c,u,h,p,f)};if("line"===P)for(const v of h_(t.geometry,0,0,Lr,Lr)){const t=c_(v,E,A,r.vertical||y,i,b,T,e.overscaling,Lr);for(const r of t)y&&G_(e,y.text,L,r)||F(v,r,h)}else if("line-center"===P){for(const v of t.geometry)if(v.length>1){const e=l_(v,A,r.vertical||y,i,b,T);e&&F(v,e,h)}}else if("Polygon"===t.type)for(const v of ip(t.geometry,0)){const e=C_(v,16);F(v[0],new i_(e.x,e.y,0,0,void 0),h)}else if("LineString"===t.type)for(const v of t.geometry)F(v,new i_(v[0].x,v[0].y,0,0,void 0),h);else if("Point"===t.type)for(const v of t.geometry)for(const e of v)F([e],new i_(e.x,e.y,0,0,void 0),h)}const F_=255,B_=F_*om;function N_(e,t,r,i,n,o,s,a,l,c,u,h,d,p,f,m,_,y){const x=function(e,t,r,i,n,o,s,a){const l=[];if(0===t.positionedLines.length)return l;const c=i.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=function(e){const t=e[0],r=e[1],i=t*r;return i>0?[t,-r]:i<0?[-t,r]:0===t?[r,t]:[r,-t]}(r);let h=Math.abs(t.top-t.bottom);for(const m of t.positionedLines)h-=m.lineOffset;const d=t.positionedLines.length,p=h/d;let f=t.top-r[1];for(let m=0;m<d;++m){const e=t.positionedLines[m];f=I_(t,p,f,m);for(const i of e.positionedGlyphs){if(!i.rect)continue;const e=i.rect||{};let o=Vm+1,h=!0,d=1,p=0;if(i.imageName){const e=s[i.imageName];if(!e)continue;if(e.sdf){j("SDF images are not supported in formatted text and will be ignored.");continue}h=!1,d=e.pixelRatio,o=p_/d}const m=(n||a)&&i.vertical,_=i.metrics.advance*i.scale/2,y=i.metrics,x=i.rect;if(null===x)continue;a&&t.verticalizable&&(p=i.imageName?_-i.metrics.width*i.scale/2:0);const v=n?[i.x+_,i.y]:[0,0];let b=[0,0],w=[0,0],T=!1;n||(m?(w=[i.x+_+u[0],i.y+u[1]-p],T=!0):b=[i.x+_+r[0],i.y+r[1]-p]);const E=x.w*i.scale/(d*(i.localGlyph?x_:1)),S=x.h*i.scale/(d*(i.localGlyph?x_:1));let M,A,I,C;if(m){const e=i.y-f,t=new g(-_,_-e),r=-Math.PI/2,n=new g(...w);M=new g(-_+b[0],b[1]),M._rotateAround(r,t)._add(n),M.x+=-e+_,M.y-=(y.left-o)*i.scale;const s=i.imageName?y.advance*i.scale:nm*i.scale,a=String.fromCodePoint(i.glyph);dm(a)?M.x+=(1-o)*i.scale:pm(a)?M.x+=s-y.height*i.scale+(-o-1)*i.scale:M.x+=i.imageName||y.width+2*o===x.w&&y.height+2*o===x.h?(s-S)/2:(s-(y.height+2*o)*i.scale)/2,A=new g(M.x,M.y-E),I=new g(M.x+S,M.y),C=new g(M.x+S,M.y-E)}else{const e=(y.left-o)*i.scale-_+b[0],t=(-y.top-o)*i.scale+b[1],r=e+E,n=t+S;M=new g(e,t),A=new g(r,t),I=new g(e,n),C=new g(r,n)}if(c){let e;e=n?new g(0,0):T?new g(u[0],u[1]):new g(r[0],r[1]),M._rotateAround(c,e),A._rotateAround(c,e),I._rotateAround(c,e),C._rotateAround(c,e)}const P=new g(0,0),L=new g(0,0);l.push({tl:M,tr:A,bl:I,br:C,texPrimary:e,texSecondary:void 0,writingMode:t.writingMode,glyphOffset:v,sectionIndex:i.sectionIndex,isSDF:h,pixelOffsetTL:P,pixelOffsetBR:L,minFontScaleX:0,minFontScaleY:0})}}return l}(0,i,l,o,s,a,n,e.allowVerticalPlacement),v=e.textSizeData;let b=null;"source"===v.kind?(b=[om*o.layout.get("text-size").evaluate(a,{},_)],b[0]>B_&&j(`${e.layerIds[0]}: Value for "text-size" is >= ${F_}. Reduce your "text-size".`)):"composite"===v.kind&&(b=[om*f.compositeTextSizes[0].evaluate(a,{},_),om*f.compositeTextSizes[1].evaluate(a,{},_)],(b[0]>B_||b[1]>B_)&&j(`${e.layerIds[0]}: Value for "text-size" is >= ${F_}. Reduce your "text-size".`)),e.addSymbols(e.text,x,b,l,s,a,u,t,r,c.lineStartIndex,c.lineLength,p,m,_,y,!1);for(const g of h)d[g]=e.text.placedSymbolArray.length-1;return 4*x.length}function U_(e){for(const t in e)return e[t];return null}function V_(e,t,r,i,n,o,s,a,l,c){let u=s.top,h=s.bottom,d=s.left,p=s.right;const f=s.collisionPadding;if(f&&(d-=f[0],u-=f[1],p+=f[2],h+=f[3]),l){const e=new g(d,u),t=new g(p,u),r=new g(d,h),i=new g(p,h),n=v(l);let o=new g(0,0);c&&(o=new g(c[0],c[1])),e._rotateAround(n,o),t._rotateAround(n,o),r._rotateAround(n,o),i._rotateAround(n,o),d=Math.min(e.x,t.x,r.x,i.x),p=Math.max(e.x,t.x,r.x,i.x),u=Math.min(e.y,t.y,r.y,i.y),h=Math.max(e.y,t.y,r.y,i.y)}return e.emplaceBack(t.x,t.y,t.z,r.x,r.y,d,u,p,h,a,i,n,o),e.length-1}function j_(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function G_(e,t,r,i){const n=e.compareText;if(t in n){const e=n[t];for(let t=e.length-1;t>=0;t--)if(i.dist(e[t])<r)return!0}else n[t]=[];return n[t].push(i),!1}function $_(e,t){const r=e.fovAboveCenter,i=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,n=(e._camera.position[2]*e.worldSize-i)/Math.cos(e._pitch),o=Math.sin(r)*n/Math.sin(Math.max(Math.PI/2-e._pitch-r,.01)),s=Math.sin(e._pitch)*o+n;return Math.min(1.01*s,n*(1/e._horizonShift))}function q_(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const r=Math.pow(2,-e.z),i=e.x*r,n=(e.x+1)*r,o=e.y*r,s=(e.y+1)*r,a=ml(i),l=ml(n),c=_l(o),u=_l(s),h=t.project(a,c),d=t.project(l,c),p=t.project(l,u),f=t.project(a,u);let m=Math.min(h.x,d.x,p.x,f.x),_=Math.min(h.y,d.y,p.y,f.y),g=Math.max(h.x,d.x,p.x,f.x),y=Math.max(h.y,d.y,p.y,f.y);const x=r/16;function v(e,r,i,n,o,s){const a=(i+o)/2,l=(n+s)/2,c=t.project(ml(a),_l(l)),u=Math.max(0,m-c.x,_-c.y,c.x-g,c.y-y);m=Math.min(m,c.x),g=Math.max(g,c.x),_=Math.min(_,c.y),y=Math.max(y,c.y),u>x&&(v(e,c,i,n,a,l),v(c,r,a,l,o,s))}v(h,d,i,o,n,o),v(d,p,n,o,n,s),v(p,f,n,s,i,s),v(f,h,i,s,i,o),m-=x,_-=x,g+=x,y+=x;const b=1/Math.max(g-m,y-_);return{scale:b,x:m*b,y:_*b,x2:g*b,y2:y*b,projection:t}}function Z_(e,{x:t,y:r},i=0){return new g(((t-i)*e.scale-e.x)*Lr,(r*e.scale-e.y)*Lr)}const W_=e.a6.identity(new Float32Array(16));class H_{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new el(0,0)}projectTilePoint(e,t,r){return{x:e,y:t,z:0}}locationPoint(e,t,r=!0){return e._coordinatePoint(e.locationCoordinate(t),r)}pixelsPerMeter(e,t){return fl(1,e)*t}pixelSpaceConversion(e,t,r){return 1}farthestPixelDistance(e){return $_(e,e.pixelsPerMeter)}pointCoordinate(e,t,r,i){const n=e.horizonLineFromTop(!1),o=new g(t,Math.max(n,r));return e.rayIntersectionCoordinate(e.pointRayIntersection(o,i))}pointCoordinate3D(e,t,r){const i=new g(t,r);if(e.elevation)return e.elevation.pointCoordinate(i);{const t=this.pointCoordinate(e,i.x,i.y,0);return[t.x,t.y,t.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const r=e.horizonLineFromTop();return t.y<r}createInversionMatrix(e,t){return W_}createTileMatrix(t,r,i){let n,o,s;const a=i.canonical,l=e.a6.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const c=q_(a,this);n=1,o=c.x+i.wrap*c.scale,s=c.y,e.a6.scale(l,l,[n/c.scale,n/c.scale,t.pixelsPerMeter/r])}else n=r/t.zoomScale(a.z),o=(a.x+Math.pow(2,a.z)*i.wrap)*n,s=a.y*n;return e.a6.translate(l,l,[o,s,0]),e.a6.scale(l,l,[n/Lr,n/Lr,1]),l}upVector(e,t,r){return[0,0,1]}upVectorScale(e,t,r){return{metersToTile:1}}}class X_ extends H_{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,r]=this.parallels=e.parallels||[29.5,45.5],i=Math.sin(v(t));this.n=(i+Math.sin(v(r)))/2,this.c=1+i*(2*this.n-i),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:r,c:i,r0:n}=this,o=v(e-this.center[0]),s=v(t),a=Math.sqrt(i-2*r*Math.sin(s))/r;return{x:a*Math.sin(o*r),y:a*Math.cos(o*r)-n,z:0}}unproject(e,t){const{n:r,c:i,r0:n}=this,o=n+t;let s=Math.atan2(e,Math.abs(o))*Math.sign(o);o*r<0&&(s-=Math.PI*Math.sign(e)*Math.sign(o));const a=v(this.center[0])*r;s=I(s,-Math.PI-a,Math.PI-a);const l=M(b(s/r)+this.center[0],-180,180),c=Math.asin(M((i-(e*e+o*o)*r*r)/(2*r),-1,1)),u=M(b(c),-yl,yl);return new el(l,u)}}const Y_=1.340264,K_=-.081106,J_=893e-6,Q_=.003796,eg=Math.sqrt(3)/2;class tg extends H_{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const r=Math.asin(eg*Math.sin(t)),i=r*r,n=i*i*i;return{x:.5*(e*Math.cos(r)/(eg*(Y_+3*K_*i+n*(7*J_+9*Q_*i)))/Math.PI+.5),y:1-.5*(r*(Y_+K_*i+n*(J_+Q_*i))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let r=t=(2*(1-t)-1)*Math.PI,i=r*r,n=i*i*i;for(let c,u,h,d=0;d<12&&(u=r*(Y_+K_*i+n*(J_+Q_*i))-t,h=Y_+3*K_*i+n*(7*J_+9*Q_*i),c=u/h,r=M(r-c,-Math.PI/3,Math.PI/3),i=r*r,n=i*i*i,!(Math.abs(c)<1e-12));++d);const o=eg*e*(Y_+3*K_*i+n*(7*J_+9*Q_*i))/Math.cos(r),s=Math.asin(Math.sin(r)/eg),a=M(180*o/Math.PI,-180,180),l=M(180*s/Math.PI,-yl,yl);return new el(a,l)}}class rg extends H_{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const r=360*(e-.5),i=M(360*(.5-t),-yl,yl);return new el(r,i)}}const ig=Math.PI/2;function ng(e){return Math.tan((ig+e)/2)}class og extends H_{constructor(e){super(e),this.center=e.center||[0,30];const[t,r]=this.parallels=e.parallels||[30,30];let i=v(t),n=v(r);this.southernCenter=i+n<0,this.southernCenter&&(i=-i,n=-n);const o=Math.cos(i),s=ng(i);this.n=i===n?Math.sin(i):Math.log(o/Math.cos(n))/Math.log(ng(n)/s),this.f=o*Math.pow(ng(i),this.n)/this.n}project(e,t){t=v(t),this.southernCenter&&(t=-t),e=v(e-this.center[0]);const r=1e-6,{n:i,f:n}=this;n>0?t<-ig+r&&(t=-ig+r):t>ig-r&&(t=ig-r);const o=n/Math.pow(ng(t),i);let s=o*Math.sin(i*e),a=n-o*Math.cos(i*e);return s=.5*(s/Math.PI+.5),a=.5*(a/Math.PI+.5),{x:s,y:this.southernCenter?a:1-a,z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,this.southernCenter&&(t=1-t),t=(2*(1-t)-.5)*Math.PI;const{n:r,f:i}=this,n=i-t,o=Math.sign(n),s=Math.sign(r)*Math.sqrt(e*e+n*n);let a=Math.atan2(e,Math.abs(n))*o;n*r<0&&(a-=Math.PI*Math.sign(e)*o);const l=M(b(a/r)+this.center[0],-180,180),c=M(b(2*Math.atan(Math.pow(i/s,1/r))-ig),-yl,yl);return new el(l,this.southernCenter?-c:c)}}class sg extends H_{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:dl(e),y:pl(t),z:0}}unproject(e,t){const r=ml(e),i=_l(t);return new el(r,i)}}const ag=v(yl);class lg extends H_{project(e,t){const r=(t=v(t))*t,i=r*r;return{x:.5*((e=v(e))*(.8707-.131979*r+i*(i*(.003971*r-.001529*i)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+r*(.015085+i*(.028874*r-.044475-.005916*i)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let r=t=(2*(1-t)-1)*Math.PI,i=25,n=0,o=r*r;do{o=r*r;const e=o*o;n=(r*(1.007226+o*(.015085+e*(.028874*o-.044475-.005916*e)))-t)/(1.007226+o*(.045255+e*(.259866*o-.311325-.005916*11*e))),r=M(r-n,-ag,ag)}while(Math.abs(n)>1e-6&&--i>0);o=r*r;const s=M(b(e/(.8707+o*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),a=b(r);return new el(s,a)}}const cg=v(yl);class ug extends H_{project(e,t){t=v(t),e=v(e);const r=Math.cos(t),i=2/Math.PI,n=Math.acos(r*Math.cos(e/2)),o=Math.sin(n)/n,s=.5*(e*i+2*r*Math.sin(e/2)/o)||0,a=.5*(t+Math.sin(t)/o)||0;return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+1),z:0}}unproject(e,t){let r=e=(2*e-.5)*Math.PI,i=t=(2*(1-t)-1)*Math.PI,n=25;const o=1e-6;let s=0,a=0;do{const n=Math.cos(i),o=Math.sin(i),l=2*o*n,c=o*o,u=n*n,h=Math.cos(r/2),d=Math.sin(r/2),p=2*h*d,f=d*d,m=1-u*h*h,_=m?1/m:0,g=m?Math.acos(n*h)*Math.sqrt(1/m):0,y=.5*(2*g*n*d+2*r/Math.PI)-e,x=.5*(g*o+i)-t,v=.5*_*(u*f+g*n*h*c)+1/Math.PI,b=_*(p*l/4-g*o*d),w=.125*_*(l*d-g*o*u*p),T=.5*_*(c*h+g*f*n)+.5,E=b*w-T*v;s=(x*b-y*T)/E,a=(y*w-x*v)/E,r=M(r-s,-Math.PI,Math.PI),i=M(i-a,-cg,cg)}while((Math.abs(s)>o||Math.abs(a)>o)&&--n>0);return new el(b(r),b(i))}}class hg extends H_{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(v(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:r,cosPhi:i}=this;return{x:v(e)*i*r+.5,y:-Math.sin(v(t))/i*r+.5,z:0}}unproject(e,t){const{scale:r,cosPhi:i}=this,n=-(t-.5)/r,o=M(b((e-.5)/r)/i,-180,180),s=Math.asin(M(n*i,-1,1)),a=M(b(s),-yl,yl);return new el(o,a)}}class dg extends sg{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,r,i){const n=Hh(t,r,i),o=Kh(jh(i));return e.N.transformMat4(n,n,o),{x:n[0],y:n[1],z:n[2]}}locationPoint(t,r){const i=Ka(r.lat,r.lng),n=e.N.normalize([],i),o=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(r),t._centerAltitude):t._centerAltitude,s=fl(1,0)*Lr*o;e.N.scaleAndAdd(i,i,n,s);const a=e.a6.identity(new Float64Array(16));return e.a6.multiply(a,t.pixelMatrix,t.globeMatrix),e.N.transformMat4(i,i,a),new g(i[0],i[1])}pixelsPerMeter(e,t){return fl(1,0)*t}pixelSpaceConversion(e,t,r){const i=fl(1,e)*t,n=ct(fl(1,45)*t,i,r);return this.pixelsPerMeter(e,t)/n}createTileMatrix(t,r,i){const n=Jh(jh(i.canonical));return e.a6.multiply(new Float64Array(16),t.globeMatrix,n)}createInversionMatrix(t,r){const{center:i}=t,n=Kh(jh(r));return e.a6.rotateY(n,n,v(i.lng)),e.a6.rotateX(n,n,v(i.lat)),e.a6.scale(n,n,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(n)}pointCoordinate(e,t,r,i){return Nh(e,t,r,!0)||new Tl(0,0)}pointCoordinate3D(e,t,r){const i=this.pointCoordinate(e,t,r,0);return[i.x,i.y,i.z]}isPointAboveHorizon(e,t){return!Nh(e,t.x,t.y,!1)}farthestPixelDistance(t){const r=function(t,r){const i=t.cameraToCenterDistance,n=t._centerAltitude*r,o=t._camera,s=t._camera.forward(),a=e.N.add([],e.N.scale([],s,-i),[0,0,n]),l=t.worldSize/(2*Math.PI),c=[0,0,-l],u=t.width/t.height,h=Math.tan(t.fovAboveCenter),d=e.N.scale([],o.up(),h),p=e.N.scale([],o.right(),h*u),f=e.N.normalize([],e.N.add([],e.N.add([],s,d),p)),m=[];let _;if(new Sh(a,f).closestPointOnSphere(c,l,m)){const r=e.N.add([],m,c),i=e.N.sub([],r,a);_=Math.cos(t.fovAboveCenter)*e.N.length(i)}else{const t=e.N.sub([],a,c),r=e.N.sub([],c,a);e.N.normalize(r,r);const i=e.N.length(t)-l;_=Math.sqrt(i*(i+2*l));const n=Math.acos(_/(l+i))-Math.acos(e.N.dot(s,r));_*=Math.cos(n)}return 1.01*_}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),i=rd(t.zoom);if(i>0){const e=$_(t,fl(1,t.center.lat)*t.worldSize),n=t.worldSize/(2*Math.PI),o=Math.max(t.width,t.height)/t.worldSize*Math.PI;return ct(r,e+n*(1-Math.cos(o)),Math.pow(i,10))}return r}upVector(e,t,r){return Hh(t,r,e,1)}upVectorScale(e){return{metersToTile:Fh(Xh(jh(e)))}}}function pg(e){const t=e.parallels,r=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new sg(e);case"equirectangular":return new rg(e);case"naturalEarth":return new lg(e);case"equalEarth":return new tg(e);case"winkelTripel":return new ug(e);case"albers":return r?new hg(e):new X_(e);case"lambertConformalConic":return r?new hg(e):new og(e);case"globe":return new dg(e)}throw new Error(`Invalid projection name: ${e.name}`)}const fg=Cp.types,mg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function _g(e,t,r,i,n,o,s,a,l,c,u,h,d){const p=a?Math.min(B_,Math.round(a[0])):0,f=a?Math.min(B_,Math.round(a[1])):0;e.emplaceBack(t,r,Math.round(32*i),Math.round(32*n),o,s,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function gg(e,t,r){e.emplaceBack(t,r)}function yg(e,t,r,i,n,o,s){e.emplaceBack(t,r,i,n,o,s)}function xg(e,t,r,i,n){e.emplaceBack(t,r,i,n),e.emplaceBack(t,r,i,n),e.emplaceBack(t,r,i,n),e.emplaceBack(t,r,i,n)}function vg(e){for(const t of e.sections)if(_o(t.text))return!0;return!1}class bg{constructor(e){this.layoutVertexArray=new ws,this.indexArray=new Ps,this.programConfigurations=e,this.segments=new ra,this.dynamicLayoutVertexArray=new ys,this.opacityVertexArray=new Es,this.placedSymbolArray=new Zs,this.iconTransitioningVertexArray=new Ss,this.globeExtVertexArray=new Ts,this.zOffsetVertexArray=new Ds}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(e,t,r,i,n){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Kf.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,mg,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Qf.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Yf.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||n)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Jf.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||i)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}ro(bg,"SymbolBuffers");class wg{constructor(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new ra,this.collisionVertexArray=new Cs,this.collisionVertexArrayExt=new ys}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,em.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,tm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ro(wg,"CollisionBuffers");class Tg{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=e.a6.identity([]),this.placementViewportMatrix=e.a6.identity([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=sm(this.zoom,r["text-size"]),this.iconSizeData=sm(this.zoom,r["icon-size"]);const i=this.layers[0].layout,n=i.get("symbol-sort-key"),o=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==o&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===o||"auto"===o&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=i.get("text-writing-mode").map((e=>jm[e])),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=i.get("symbol-z-elevate")}createArrays(){this.text=new bg(new ka(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new bg(new ka(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new Xs,this.lineVertexArray=new Ys,this.symbolInstances=new Hs}calculateGlyphDependencies(e,t,r,i,n){for(let o=0;o<e.length;o++){const r=e.codePointAt(o);if(void 0===r)break;if(t[r]=!0,i&&n&&r<=65535){const r=hm[e.charAt(o)];r&&(t[r.charCodeAt(0)]=!0)}}}populate(t,r,i,n){const o=this.layers[0],s=o.layout,a="globe"===this.projection.name,l=s.get("text-font"),c=s.get("text-field"),u=s.get("icon-image"),h=("constant"!==c.value.kind||c.value.value instanceof zt&&!c.value.value.isEmpty()||c.value.value.toString().length>0)&&("constant"!==l.value.kind||l.value.value.length>0),d="constant"!==u.value.kind||!!u.value.value||Object.keys(u.parameters).length>0,p=s.get("symbol-sort-key");if(this.features=[],!h&&!d)return;const f=r.iconDependencies,m=r.glyphDependencies,_=r.availableImages,g=new Co(this.zoom);for(const{feature:y,id:x,index:v,sourceLayerIndex:b}of t){const t=o._featureFilter.needGeometry,r=Rl(y,t);if(!o._featureFilter.filter(g,r,i))continue;if(t||(r.geometry=Ll(y,i,n)),a&&1!==y.type&&i.z<=5){const t=r.geometry,n=.98078528056,o=(t,r)=>{const o=Hh(t.x,t.y,i,1),s=Hh(r.x,r.y,i,1);return e.N.dot(o,s)<n};for(let e=0;e<t.length;e++)t[e]=Al(t[e],o)}let c,u;if(h){const e=o.getValueAndResolveTokens("text-field",r,i,_),t=zt.factory(e);vg(t)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Mo()||this.hasRTLText&&Io.isParsed())&&(c=um(t,o,r))}if(d){const e=o.getValueAndResolveTokens("icon-image",r,i,_);u=e instanceof kt?e:kt.fromString(e)}if(!c&&!u)continue;const w=this.sortFeaturesByKey?p.evaluate(r,{},i):void 0;if(this.features.push({id:x,text:c,icon:u,index:v,sourceLayerIndex:b,geometry:r.geometry,properties:y.properties,type:fg[y.type],sortKey:w}),u&&(f[u.namePrimary]=!0,u.nameSecondary&&(f[u.nameSecondary]=!0)),c){const e=l.evaluate(r,{},i).join(","),t="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(jm.vertical)>=0;for(const r of c.sections)if(r.image)f[r.image.namePrimary]=!0;else{const i=lo(c.toString()),n=r.fontStack||e,o=m[n]=m[n]||{};this.calculateGlyphDependencies(r.text,o,t,this.allowVerticalPlacement,i)}}}"line"===s.get("symbol-placement")&&(this.features=function(e){const t={},r={},i=[];let n=0;function o(t){i.push(e[t]),n++}function s(e,t,n){const o=r[e];return delete r[e],r[t]=o,i[o].geometry[0].pop(),i[o].geometry[0]=i[o].geometry[0].concat(n[0]),o}function a(e,r,n){const o=t[r];return delete t[r],t[e]=o,i[o].geometry[0].shift(),i[o].geometry[0]=n[0].concat(i[o].geometry[0]),o}function l(e,t,r){const i=r?t[0][t[0].length-1]:t[0][0];return`${e}:${i.x}:${i.y}`}for(let c=0;c<e.length;c++){const u=e[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in r&&f in t&&r[p]!==t[f]){const e=a(p,f,h),n=s(p,f,i[e].geometry);delete t[p],delete r[f],r[l(d,i[n].geometry,!0)]=n,i[e].geometry=null}else p in r?s(p,f,h):f in t?a(p,f,h):(o(c),t[p]=n-1,r[f]=n-1)}return i.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,r,i,n){const o=0!==Object.keys(e).length;if(o&&!this.stateDependentLayers.length)return;const s=o?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,t,s,r,i,n),this.icon.programConfigurations.updatePaintArrays(e,t,s,r,i,n)}updateZOffset(){const e=(e,t,i)=>{r+=t,r>e.length&&e.resize(r);for(let n=-t;n<0;n++)e.emplace(n+r,i)},t=(e,t,r)=>{i+=t,i>e.length&&e.resize(i);for(let n=-t;n<0;n++)e.emplace(n+i,r)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let r=0,i=0;for(let n=0;n<this.symbolInstances.length;n++){const r=this.symbolInstances.get(n),{numHorizontalGlyphVertices:i,numVerticalGlyphVertices:o,numIconVertices:s}=r,a=r.zOffset,l=s>0;if((i>0||o>0)&&(e(this.text.zOffsetVertexArray,i,a),e(this.text.zOffsetVertexArray,o,a)),l){const{placedIconSymbolIndex:e,verticalPlacedIconSymbolIndex:i}=r;e>=0&&t(this.icon.zOffsetVertexArray,s,a),i>=0&&t(this.icon.zOffsetVertexArray,r.numVerticalIconVertices,a)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=pg(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const r=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:i,y:n}of t)this.lineVertexArray.emplaceBack(i,n);return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,t,r,i,n,o,s,a,l,c,u,h,d,p,f,m){const _=e.indexArray,g=e.layoutVertexArray,y=e.globeExtVertexArray,x=e.segments.prepareSegment(4*t.length,g,_,this.canOverlap?o.sortKey:void 0),v=this.glyphOffsetArray.length,b=x.vertexLength,w=this.allowVerticalPlacement&&s===jm.vertical?Math.PI/2:0,T=o.text&&o.text.sections;for(let S=0;S<t.length;S++){const{tl:i,tr:n,bl:s,br:c,texPrimary:u,texSecondary:h,pixelOffsetTL:v,pixelOffsetBR:b,minFontScaleX:E,minFontScaleY:M,glyphOffset:A,isSDF:I,sectionIndex:C}=t[S],P=x.vertexLength,L=A[1];if(_g(g,l.x,l.y,i.x,L+i.y,u.x,u.y,r,I,v.x,v.y,E,M),_g(g,l.x,l.y,n.x,L+n.y,u.x+u.w,u.y,r,I,b.x,v.y,E,M),_g(g,l.x,l.y,s.x,L+s.y,u.x,u.y+u.h,r,I,v.x,b.y,E,M),_g(g,l.x,l.y,c.x,L+c.y,u.x+u.w,u.y+u.h,r,I,b.x,b.y,E,M),a){const{x:t,y:r,z:i}=a.anchor,[n,o,s]=a.up;yg(y,t,r,i,n,o,s),yg(y,t,r,i,n,o,s),yg(y,t,r,i,n,o,s),yg(y,t,r,i,n,o,s),xg(e.dynamicLayoutVertexArray,t,r,i,w)}else xg(e.dynamicLayoutVertexArray,l.x,l.y,l.z,w);if(m){const t=h||u;gg(e.iconTransitioningVertexArray,t.x,t.y),gg(e.iconTransitioningVertexArray,t.x+t.w,t.y),gg(e.iconTransitioningVertexArray,t.x,t.y+t.h),gg(e.iconTransitioningVertexArray,t.x+t.w,t.y+t.h)}_.emplaceBack(P,P+1,P+2),_.emplaceBack(P+1,P+2,P+3),x.vertexLength+=4,x.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(A[0]),S!==t.length-1&&C===t[S+1].sectionIndex||e.programConfigurations.populatePaintArrays(g.length,o,o.index,{},d,p,f,T&&T[C])}const E=a?a.anchor:l;e.placedSymbolArray.emplaceBack(E.x,E.y,E.z,l.x,l.y,v,this.glyphOffsetArray.length-v,b,c,u,l.segment,r?r[0]:0,r?r[1]:0,i[0],i[1],s,0,!1,0,h,0)}_commitLayoutVertex(e,t,r,i,n,o,s){e.emplaceBack(t,r,i,n,o,Math.round(s.x),Math.round(s.y))}_addCollisionDebugVertices(e,t,r,i,n,o,s){const a=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),l=a.vertexLength,c=s.tileAnchorX,u=s.tileAnchorY;for(let d=0;d<4;d++)r.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(r.collisionVertexArrayExt,t,e.padding,s.zOffset),this._commitLayoutVertex(r.layoutVertexArray,i,n,o,c,u,new g(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,i,n,o,c,u,new g(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,i,n,o,c,u,new g(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,i,n,o,c,u,new g(e.x1,e.y2)),a.vertexLength+=4;const h=r.indexArray;h.emplaceBack(l,l+1),h.emplaceBack(l+1,l+2),h.emplaceBack(l+2,l+3),h.emplaceBack(l+3,l),a.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,r,i,n,o){for(let s=i;s<n;s++){const i=r.get(s),n=this.getSymbolInstanceTextSize(e,o,t,s);this._addCollisionDebugVertices(i,n,this.textCollisionBox,i.projectedAnchorX,i.projectedAnchorY,i.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(e,t,r,i,n,o){for(let s=i;s<n;s++){const i=r.get(s),n=this.getSymbolInstanceIconSize(e,t,o.placedIconSymbolIndex);this._addCollisionDebugVertices(i,n,this.iconCollisionBox,i.projectedAnchorX,i.projectedAnchorY,i.projectedAnchorZ,o)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new wg(As,rm.members,Ss),this.iconCollisionBox=new wg(As,rm.members,Ss);const r=lm(this.iconSizeData,e),i=lm(this.textSizeData,e);for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this._addTextDebugCollisionBoxes(i,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(i,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(r,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(r,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(e,t,r,i){const n=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:i),o=am(this.textSizeData,e,n)/nm;return this.tilePixelRatio*o}getSymbolInstanceIconSize(e,t,r){const i=this.icon.placedSymbolArray.get(r),n=am(this.iconSizeData,e,i);return this.tilePixelRatio*n}_commitDebugCollisionVertexUpdate(e,t,r,i){e.emplaceBack(t,-r,-r,i),e.emplaceBack(t,r,-r,i),e.emplaceBack(t,r,r,i),e.emplaceBack(t,-r,r,i)}_updateTextDebugCollisionBoxes(e,t,r,i,n,o){for(let s=i;s<n;s++){const i=r.get(s),n=this.getSymbolInstanceTextSize(e,o,t,s);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,n,i.padding,o.zOffset)}}_updateIconDebugCollisionBoxes(e,t,r,i,n,o){for(let s=i;s<n;s++){const i=r.get(s),n=this.getSymbolInstanceIconSize(e,t,o.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,n,i.padding,o.zOffset)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=lm(this.iconSizeData,e),i=lm(this.textSizeData,e);for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this._updateTextDebugCollisionBoxes(i,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(i,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(r,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._updateIconDebugCollisionBoxes(r,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,r,i,n,o,s,a,l){const c={};if(t<r){const{x1:r,y1:i,x2:n,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(t);c.textBox={x1:r,y1:i,x2:n,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.textFeatureIndex=p}if(i<n){const{x1:t,y1:r,x2:n,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(i);c.verticalTextBox={x1:t,y1:r,x2:n,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalTextFeatureIndex=p}if(o<s){const{x1:t,y1:r,x2:i,y2:n,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(o);c.iconBox={x1:t,y1:r,x2:i,y2:n,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.iconFeatureIndex=p}if(a<l){const{x1:t,y1:r,x2:i,y2:n,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(a);c.verticalIconBox={x1:t,y1:r,x2:i,y2:n,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalIconFeatureIndex=p}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,t){const r=e.placedSymbolArray.get(t),i=r.vertexStartIndex+4*r.numGlyphs;for(let n=r.vertexStartIndex;n<i;n+=4)e.indexArray.emplaceBack(n,n+1,n+2),e.indexArray.emplaceBack(n+1,n+2,n+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),r=Math.cos(e),i=[],n=[],o=[];for(let s=0;s<this.symbolInstances.length;++s){o.push(s);const e=this.symbolInstances.get(s);i.push(0|Math.round(t*e.tileAnchorX+r*e.tileAnchorY)),n.push(e.featureIndex)}return o.sort(((e,t)=>i[e]-i[t]||n[t]-n[e])),o}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,t)=>this.symbolInstances.get(t).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,t){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex);const{rightJustifiedTextSymbolIndex:r,centerJustifiedTextSymbolIndex:i,leftJustifiedTextSymbolIndex:n,verticalPlacedTextSymbolIndex:o,placedIconSymbolIndex:s,verticalPlacedIconSymbolIndex:a}=t;r>=0&&this.addIndicesForPlacedSymbol(this.text,r),i>=0&&i!==r&&this.addIndicesForPlacedSymbol(this.text,i),n>=0&&n!==i&&n!==r&&this.addIndicesForPlacedSymbol(this.text,n),o>=0&&this.addIndicesForPlacedSymbol(this.text,o),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ro(Tg,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Tg.addDynamicAttributes=xg;const Eg=new Vo({"symbol-placement":new Bo($o.layout_symbol["symbol-placement"]),"symbol-spacing":new Bo($o.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Bo($o.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new No($o.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Bo($o.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Bo($o.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Bo($o.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Bo($o.layout_symbol["icon-ignore-placement"]),"icon-optional":new Bo($o.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Bo($o.layout_symbol["icon-rotation-alignment"]),"icon-size":new No($o.layout_symbol["icon-size"]),"icon-text-fit":new No($o.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new No($o.layout_symbol["icon-text-fit-padding"]),"icon-image":new No($o.layout_symbol["icon-image"]),"icon-rotate":new No($o.layout_symbol["icon-rotate"]),"icon-padding":new Bo($o.layout_symbol["icon-padding"]),"icon-keep-upright":new Bo($o.layout_symbol["icon-keep-upright"]),"icon-offset":new No($o.layout_symbol["icon-offset"]),"icon-anchor":new No($o.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Bo($o.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Bo($o.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Bo($o.layout_symbol["text-rotation-alignment"]),"text-field":new No($o.layout_symbol["text-field"]),"text-font":new No($o.layout_symbol["text-font"]),"text-size":new No($o.layout_symbol["text-size"]),"text-max-width":new No($o.layout_symbol["text-max-width"]),"text-line-height":new No($o.layout_symbol["text-line-height"]),"text-letter-spacing":new No($o.layout_symbol["text-letter-spacing"]),"text-justify":new No($o.layout_symbol["text-justify"]),"text-radial-offset":new No($o.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Bo($o.layout_symbol["text-variable-anchor"]),"text-anchor":new No($o.layout_symbol["text-anchor"]),"text-max-angle":new Bo($o.layout_symbol["text-max-angle"]),"text-writing-mode":new Bo($o.layout_symbol["text-writing-mode"]),"text-rotate":new No($o.layout_symbol["text-rotate"]),"text-padding":new Bo($o.layout_symbol["text-padding"]),"text-keep-upright":new Bo($o.layout_symbol["text-keep-upright"]),"text-transform":new No($o.layout_symbol["text-transform"]),"text-offset":new No($o.layout_symbol["text-offset"]),"text-allow-overlap":new Bo($o.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Bo($o.layout_symbol["text-ignore-placement"]),"text-optional":new Bo($o.layout_symbol["text-optional"]),visibility:new Bo($o.layout_symbol.visibility)});var Sg={paint:new Vo({"icon-opacity":new No($o.paint_symbol["icon-opacity"]),"icon-emissive-strength":new No($o.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new No($o.paint_symbol["text-emissive-strength"]),"icon-color":new No($o.paint_symbol["icon-color"]),"icon-halo-color":new No($o.paint_symbol["icon-halo-color"]),"icon-halo-width":new No($o.paint_symbol["icon-halo-width"]),"icon-halo-blur":new No($o.paint_symbol["icon-halo-blur"]),"icon-translate":new Bo($o.paint_symbol["icon-translate"]),"icon-translate-anchor":new Bo($o.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new No($o.paint_symbol["icon-image-cross-fade"]),"text-opacity":new No($o.paint_symbol["text-opacity"]),"text-color":new No($o.paint_symbol["text-color"],{runtimeType:bt,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new No($o.paint_symbol["text-halo-color"]),"text-halo-width":new No($o.paint_symbol["text-halo-width"]),"text-halo-blur":new No($o.paint_symbol["text-halo-blur"]),"text-translate":new Bo($o.paint_symbol["text-translate"]),"text-translate-anchor":new Bo($o.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Bo($o.paint_symbol["icon-color-saturation"])}),layout:Eg};class Mg{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:gt,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ro(Mg,"FormatSectionOverride",{omit:["defaultValue"]});class Ag extends as{constructor(e,t,r){super(e,Sg,t,r)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const e=[];for(const t of r)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,r,i){const n=this.layout.get(e).evaluate(t,{},r,i),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||$n(o.value)||!n?n:function(e,t){return t.replace(/{([^{}]+)}/g,((t,r)=>r in e?String(e[r]):""))}(t.properties,n)}createBucket(e){return new Tg(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Sg.paint.overridableProperties){if(!Ag.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),r=new Mg(t),i=new Gn(r,t.property.specification,this.scope,this.options);let n=null;n="constant"===t.value.kind||"source"===t.value.kind?new Zn("source",i):new Wn("composite",i,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new ko(t.property,n,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven())&&Ag.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const r=e.get("text-field"),i=Sg.paint.properties[t];let n=!1;const o=e=>{for(const t of e)if(i.overrides&&i.overrides.hasOverride(t))return void(n=!0)};if("constant"===r.value.kind&&r.value.value instanceof zt)o(r.value.value.sections);else if("source"===r.value.kind){const e=t=>{n||(t instanceof jt&&Nt(t.value)===St?o(t.value.sections):t instanceof Wt?o(t.sections):t.eachChild(e))},t=r.value;t._styleExpression&&e(t._styleExpression.expression)}return n}getProgramIds(){const e=0!==this.paint.get("icon-opacity").constantOr(1),t=0!==this.paint.get("text-opacity").constantOr(1),r=[];return e&&r.push("symbolIcon"),t&&r.push("symbolSDF"),r}getDefaultProgramParams(e,t){return{config:new za(this,t),overrideFog:!1}}}const Ig=new Vo({visibility:new Bo($o.layout_background.visibility)});var Cg={paint:new Vo({"background-color":new Bo($o.paint_background["background-color"]),"background-pattern":new Bo($o.paint_background["background-pattern"]),"background-opacity":new Bo($o.paint_background["background-opacity"]),"background-emissive-strength":new Bo($o.paint_background["background-emissive-strength"])}),layout:Ig};const Pg=new Vo({visibility:new Bo($o.layout_raster.visibility)});var Lg={paint:new Vo({"raster-opacity":new Bo($o.paint_raster["raster-opacity"]),"raster-color":new Uo($o.paint_raster["raster-color"]),"raster-color-mix":new Bo($o.paint_raster["raster-color-mix"]),"raster-color-range":new Bo($o.paint_raster["raster-color-range"]),"raster-hue-rotate":new Bo($o.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Bo($o.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Bo($o.paint_raster["raster-brightness-max"]),"raster-saturation":new Bo($o.paint_raster["raster-saturation"]),"raster-contrast":new Bo($o.paint_raster["raster-contrast"]),"raster-resampling":new Bo($o.paint_raster["raster-resampling"]),"raster-fade-duration":new Bo($o.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Bo($o.paint_raster["raster-emissive-strength"]),"raster-array-band":new Bo($o.paint_raster["raster-array-band"]),"raster-elevation":new Bo($o.paint_raster["raster-elevation"])}),layout:Pg},Rg=hs([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Dg{constructor(e,t,r,i){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,i)}update(e,t,r){const{width:i,height:n}=e,{context:o}=this,{gl:s}=o;if(s.bindTexture(s.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!t||!1!==t.premultiply)),r||this.size&&this.size[0]===i&&this.size[1]===n){const{x:t,y:o}=r||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)s.texSubImage2D(s.TEXTURE_2D,0,t,o,s.RGBA,s.UNSIGNED_BYTE,e);else{let r=this.format,a=s.UNSIGNED_BYTE;this.format===s.R32F&&(r=s.RED,a=s.FLOAT),s.texSubImage2D(s.TEXTURE_2D,0,t,o,i,n,r,a,e.data)}}else if(this.size=[i,n],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let t=this.format;this.format===s.R8&&(t=s.RED),s.texImage2D(s.TEXTURE_2D,0,this.format,t,s.UNSIGNED_BYTE,e)}else{let t=this.format,r=this.format,o=s.UNSIGNED_BYTE;this.format===s.DEPTH_COMPONENT&&(t=s.DEPTH_COMPONENT16,o=s.UNSIGNED_SHORT),this.format===s.R8&&(r=s.RED),this.format===s.R32F&&(o=s.FLOAT,r=s.RED),s.texImage2D(s.TEXTURE_2D,0,t,i,n,0,r,o,e.data)}this.useMipmap=Boolean(t&&t.useMipmap),this.useMipmap&&s.generateMipmap(s.TEXTURE_2D)}bind(e,t,r=!1){const{context:i}=this,{gl:n}=i;n.bindTexture(n.TEXTURE_2D,this.texture),e!==this.minFilter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,this.useMipmap&&!r?e===n.NEAREST?n.NEAREST_MIPMAP_NEAREST:n.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),t!==this.wrapS&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,t),this.wrapS=t)}bindExtraParam(e,t,r,i){const{context:n}=this,{gl:o}=n;o.bindTexture(o.TEXTURE_2D,this.texture),t!==this.magFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,t),this.magFilter=t),e!==this.minFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,this.useMipmap?e===o.NEAREST?o.NEAREST_MIPMAP_NEAREST:o.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,r),this.wrapS=r),i!==this.wrapT&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,i),this.wrapT=i)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Og{constructor(e,t){this.context=e,this.texture=t}bind(e,t){const{context:r}=this,{gl:i}=r;i.bindTexture(i.TEXTURE_2D,this.texture),e!==this.minFilter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,t),this.wrapS=t)}}function zg(t,r,i,n,o,s,a,l){const c=[t,r,1,i,n,1,o,s,1],u=[a,l,1],h=e.co.adjoint([],c),[d,p,f]=e.N.transformMat3(u,u,h);return e.co.multiply(c,c,[d,0,0,0,p,0,0,0,f])}function kg(t,r,i,n,o,s,a,l){const c=function(t,r,i,n,o,s,a,l){const c=zg(0,0,1,0,1,1,0,1),u=zg(t,r,i,n,o,s,a,l),h=e.co.adjoint([],c);return e.co.multiply(u,u,h)}(t,r,i,n,o,s,a,l);return[c[2]/c[8]/Lr,c[5]/c[8]/Lr]}function Fg(e){return[e[0],Math.min(Math.max(e[1],-yl),yl)]}class Bg extends tt{constructor(e,t,r,i){super(),this.id=e,this.dispatcher=r,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(i),this.options=t,this._dirty=!1}load(e,t){if(this._loaded=t||!1,this.fire(new Qe("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=De(this.map._requestManager.transformRequest(this.url,Ee.Image),((t,r)=>{this._imageRequest=null,this._loaded=!0,t?this.fire(new et(t)):r&&(this.image=r instanceof HTMLImageElement?se.getImageData(r):r,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Og(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Qe("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Og||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let t=e[0][1],r=e[0][1];for(const n of e)n[1]>r&&(r=n[1]),n[1]<t&&(t=n[1]);const i=(r+t)/2;if(i>yl?this.onNorthPole=!0:i<-yl&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const t=e.map(Tl.fromLngLat);this.tileID=function(e){let t=1/0,r=1/0,i=-1/0,n=-1/0;for(const c of e)t=Math.min(t,c.x),r=Math.min(r,c.y),i=Math.max(i,c.x),n=Math.max(n,c.y);const o=Math.max(i-t,n-r),s=Math.max(0,Math.floor(-Math.log(o)/Math.LN2)),a=Math.pow(2,s);let l=Math.floor((t+i)/2*a);return l>1&&(l-=1),new nl(s,l,Math.floor((r+n)/2*a))}(t),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Qe("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const r=q_(new nl(0,0,0),this.map.transform.projection),i=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(e){const t=e[1].x-e[0].x,r=e[1].y-e[0].y,i=e[2].x-e[1].x,n=e[2].y-e[1].y,o=e[3].x-e[2].x,s=e[3].y-e[2].y,a=e[0].x-e[3].x,l=e[0].y-e[3].y,c=t*n-i*r,u=i*s-o*n,h=o*l-a*s,d=a*r-t*l;return c>0&&u>0&&h>0&&d>0||c<0&&u<0&&h<0&&d<0}(i))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const n=q_(this.tileID,this.map.transform.projection),[o,s,a,l]=this.coordinates.map((e=>{const t=n.projection.project(e[0],e[1]);return Z_(n,t)._round()}));this.perspectiveTransform=kg(o.x,o.y,s.x,s.y,a.x,a.y,l.x,l.y);const c=this._boundsArray=new ms;c.emplaceBack(o.x,o.y,0,0),c.emplaceBack(s.x,s.y,Lr,0),c.emplaceBack(l.x,l.y,0,Lr),c.emplaceBack(a.x,a.y,Lr,Lr),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(c,Rg.members),this.boundsSegments=ra.simpleSegment(0,0,4,2);const u=[],h=[Fg((d=this.coordinates)[0]),Fg(d[1]),Fg(d[2]),Fg(d[3])];var d;const[p,f,m,_]=function(e){let t=e[0][0],r=t,i=e[0][1],n=i;for(let o=1;o<e.length;o++)e[o][0]<t?t=e[o][0]:e[o][0]>r&&(r=e[o][0]),e[o][1]<i?i=e[o][1]:e[o][1]>n&&(n=e[o][1]);return[t,i,r-t,n-i]}(h);{const n=new ms,[o,s,a,l]=function(e){let t=e[0].x,r=t,i=e[0].y,n=i;for(let o=1;o<e.length;o++)e[o].x<t?t=e[o].x:e[o].x>r&&(r=e[o].x),e[o].y<i?i=e[o].y:e[o].y>n&&(n=e[o].y);return[t,i,r-t,n-i]}(i),c=e=>[(e.x-o)/a,(e.y-s)/l],[h,d,g,y]=i.map(c),x=function(t,r,i,n,o,s,a,l){const c=zg(0,0,1,0,1,1,0,1),u=zg(t,r,i,n,o,s,a,l),h=e.co.adjoint([],u);return e.co.multiply(c,c,h)}(h[0],h[1],d[0],d[1],g[0],g[1],y[0],y[1]);this.elevatedGlobePerspectiveTransform=kg(h[0],h[1],d[0],d[1],g[0],g[1],y[0],y[1]);const v=(t,r)=>{u.push(t.lng);const i=Math.round((t.lng-p)/m*Lr),o=Math.round((t.lat-f)/_*Lr),s=c(r),a=e.N.transformMat3([],[s[0],s[1],1],x),l=Math.round(a[0]/a[2]*Lr),h=Math.round(a[1]/a[2]*Lr);n.emplaceBack(i,o,l,h)},b=i[3].x-i[0].x,w=i[3].y-i[0].y,T=i[2].x-i[1].x,E=i[2].y-i[1].y;for(let e=0;e<65;e++){const t=e/64,n=[i[0].x+t*b,i[0].y+t*w],o=[i[1].x+t*T,i[1].y+t*E],s=o[0]-n[0],a=o[1]-n[1];for(let e=0;e<65;e++){const t=e/64,i={x:n[0]+s*t,y:n[1]+a*t,z:0};v(r.projection.unproject(i.x,i.y),i)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(n,Rg.members)}{this.maxLongitudeTriangleSize=0;let e=[],r=new Ps;const i=(t,i,n)=>{r.emplaceBack(t,i,n);const o=u[t],s=u[i],a=u[n],l=Math.min(Math.min(o,s),a),c=Math.max(Math.max(o,s),a)-l;c>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=c),e.push(l+c/2)};for(let t=0;t<64;t++)for(let e=0;e<64;e++){const r=65*t+e,n=r+1,o=r+65,s=o+1;i(r,o,n),i(n,o,s)}[e,r]=function(e,t){const r=Array.from({length:e.length},((e,t)=>t));r.sort(((t,r)=>e[t]-e[r]));const i=[],n=new Ps;for(let o=0;o<r.length;o++){const s=r[o];i.push(e[s]);const a=3*s,l=a+1;n.emplaceBack(t.uint16[a],t.uint16[l],t.uint16[l+1])}return[i,n]}(e,r),this.elevatedGlobeTrianglesCenterLongitudes=e,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(r)}this.elevatedGlobeSegments=ra.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,m/Lr,0,_/Lr,0,0,f,p,0])}prepare(){const e=0!==Object.keys(this.tiles).length;if(this.tileID&&!e)return;const t=this.map.painter.context,r=t.gl;!this._dirty||this.texture instanceof Og||(this.texture?this.texture.update(this.image):(this.texture=new Dg(t,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(t)}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const t=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!t)return null;const r=this.elevatedGlobeTrianglesCenterLongitudes;let i=((e,t)=>e+360*Math.round((t-e)/360))(e+180,r[0]);const n=new ra,o=(e,r)=>{n.segments.push({vertexOffset:0,primitiveOffset:e,vertexLength:t.segments[0].vertexLength,primitiveLength:r,sortKey:void 0,vaos:{}})},s=.51*this.maxLongitudeTriangleSize;if(Math.abs(r[0]-i)<=s){const e=ne(r,0,r.length,i+s);return e===r.length||o(e,ie(r,e+1,r.length,i+360-s)-e),n}i<r[0]&&(i+=360);const a=ie(r,0,r.length,i-s);if(a===r.length)return o(0,r.length),n;o(0,a-0);const l=ne(r,a+1,r.length,i+s);return l!==r.length&&o(l,r.length-l),n}}const Ng=(Math.pow(256,2)-1)/16907520;class Ug extends as{constructor(e,t,r){super(e,Lg,t,r),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isLayerDraped(e){return!(e&&e._source instanceof Bg&&(e._source.onNorthPole||e._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(e){"raster-color"!==e&&"raster-color-range"!==e||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap())return;if(!this._curRampRange)return;const t=this._transitionablePaint._values["raster-color"].value.expression,[r,i]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(r)&&isNaN(i)||r===this._curRampRange[0]&&i===this._curRampRange[1]||(this.colorRamp=Ed({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:r,end:i}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[r,i])}}const Vg=new Vo({visibility:new Bo($o["layout_raster-particle"].visibility)});var jg={paint:new Vo({"raster-particle-array-band":new Bo($o["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Bo($o["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Uo($o["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Bo($o["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Bo($o["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Bo($o["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Bo($o["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:Vg};class Gg extends as{constructor(e,t,r){super(e,jg,t,r),this._updateColorRamp(),this.onRemove=e=>{this.colorRampTexture&&this.colorRampTexture.destroy(),this.transformFeedbackObject&&e.painter.context.gl.deleteTransformFeedback(this.transformFeedbackObject),this.tileFramebuffer&&this.tileFramebuffer.destroy()},this.lastInvalidatedAt=se.now()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isLayerDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){"raster-particle-color"!==e&&"raster-particle-max-speed"!==e||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===e&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,t=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Ed({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:t}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=se.now()}}class $g extends as{constructor(e,t){super(e,{},t),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const qg=new Vo({visibility:new Bo($o.layout_sky.visibility)});var Zg={paint:new Vo({"sky-type":new Bo($o.paint_sky["sky-type"]),"sky-atmosphere-sun":new Bo($o.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Bo($o.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Bo($o.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Bo($o.paint_sky["sky-gradient-radius"]),"sky-gradient":new Uo($o.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Bo($o.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Bo($o.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Bo($o.paint_sky["sky-opacity"])}),layout:qg};function Wg(t,r,i){const n=[0,0,1],o=e.bi.identity([]);return e.bi.rotateY(o,o,i?-v(t)+Math.PI:v(t)),e.bi.rotateX(o,o,-v(r)),e.N.transformQuat(n,n,o),e.N.normalize(n,n)}var Hg={paint:new Vo({})};function Xg(t,r){const i=Kg(t.projection,t.zoom,t.width,t.height),n=function(t,r,i,n,o){const s=new el(i.lng-180*Jg,i.lat),a=new el(i.lng+180*Jg,i.lat),l=t.project(s.lng,s.lat),c=t.project(a.lng,a.lat),u=-Math.atan2(c.y-l.y,c.x-l.x),h=Tl.fromLngLat(i);h.y=M(h.y,-1+Jg,1-Jg);const d=h.toLngLat(),p=t.project(d.lng,d.lat),f=Tl.fromLngLat(d);f.x+=Jg;const m=f.toLngLat(),_=t.project(m.lng,m.lat),g=ey(_.x-p.x,_.y-p.y,u),y=Tl.fromLngLat(d);y.y+=Jg;const x=y.toLngLat(),v=t.project(x.lng,x.lat),b=ey(v.x-p.x,v.y-p.y,u),w=Math.abs(g.x)/Math.abs(b.y),T=e.a6.identity([]);e.a6.rotateZ(T,T,-u*(1-(o?0:n)));const E=e.a6.identity([]);return e.a6.scale(E,E,[1,1-(1-w)*n,1]),E[4]=-b.x/b.y*n,e.a6.rotateZ(E,E,u),e.a6.multiply(E,T,E),E}(t.projection,0,t.center,i,r),o=Yg(t);return e.a6.scale(n,n,[o,o,1]),n}function Yg(e){const t=e.projection,r=Kg(e.projection,e.zoom,e.width,e.height),i=Qg(t,e.center),n=Qg(t,el.convert(t.center));return Math.pow(2,i*r+(1-r)*n)}function Kg(e,t,r,i,n=1/0){const o=e.range;if(!o)return 0;const s=Math.min(n,Math.max(r,i)),a=Math.log(s/1024)/Math.LN2;return A(o[0]+a,o[1]+a,t)}const Jg=1/4e4;function Qg(e,t){const r=M(t.lat,-yl,yl),i=new el(t.lng-180*Jg,r),n=new el(t.lng+180*Jg,r),o=e.project(i.lng,r),s=e.project(n.lng,r),a=Tl.fromLngLat(i),l=Tl.fromLngLat(n),c=s.x-o.x,u=s.y-o.y,h=l.x-a.x,d=l.y-a.y,p=Math.sqrt((h*h+d*d)/(c*c+u*u));return Math.log(p)/Math.LN2}function ey(e,t,r){const i=Math.cos(r),n=Math.sin(r);return{x:e*i-t*n,y:e*n+t*i}}function ty(t,r,i){e.a6.identity(t),e.a6.rotateZ(t,t,v(r[2])),e.a6.rotateX(t,t,v(r[0])),e.a6.rotateY(t,t,v(r[1])),e.a6.scale(t,t,i),e.a6.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function ry(t,r,i,n,o,s,a,l){const c=[i[0]-r[0],i[1]-r[1],0],u=[n[0]-r[0],n[1]-r[1],0];if(e.N.length(c)<1e-12||e.N.length(u)<1e-12)return e.bi.identity(t);const h=e.N.cross([],c,u);e.N.normalize(h,h),e.N.subtract(u,n,r),c[2]=(s-o)*l,u[2]=(a-o)*l;const d=c;return e.N.cross(d,c,u),e.N.normalize(d,d),e.bi.rotationTo(t,h,d)}function iy(t,r,i=!1){const n=rd(r.zoom),o=function(t,r,i){const n=r.worldSize,o=[t[12],t[13],t[14]],s=_l(o[1]/n),a=ml(o[0]/n),l=e.a6.identity([]),c=fl(1,s)*n,u=fl(1,0)*n*vl(s,r.zoom),h=1/Qh(n);let d=u*h;if(i){const e=Kg(r.projection,r.zoom,r.width,r.height,1024);d=h*r.projection.pixelSpaceConversion(r.center.lat,n,e)}const p=Ka(s,a);e.N.add(p,p,e.N.scale([],e.N.normalize([],p),c*d*o[2]));const f=function(t){const r=[t[0],t[1],t[2]];let i=[0,1,0];const n=e.N.cross([],i,r);return e.N.cross(i,r,n),0===e.N.squaredLength(i)&&(i=[0,1,0],e.N.cross(n,r,i)),e.N.normalize(n,n),e.N.normalize(i,i),e.N.normalize(r,r),[n[0],n[1],n[2],0,i[0],i[1],i[2],0,r[0],r[1],r[2],0,t[0],t[1],t[2],1]}(p);e.a6.scale(l,l,[d,d,d*c]),e.a6.translate(l,l,[-o[0],-o[1],-o[2]]);const m=e.a6.multiply([],r.globeMatrix,f);return e.a6.multiply(m,m,l),e.a6.multiply(m,m,t),m}(t,r,i);if(n>0){const i=function(t,r){const i=r.worldSize,n=fl(1,0)*i*vl(r.center.lat,r.zoom)/Qh(i),o=fl(1,r.center.lat)*i,s=e.a6.identity([]);return e.a6.rotateY(s,s,v(r.center.lng)),e.a6.rotateX(s,s,v(r.center.lat)),e.a6.translate(s,s,[0,0,ja]),e.a6.scale(s,s,[n,n,n*o]),e.a6.translate(s,s,[r.point.x-.5*i,r.point.y-.5*i,0]),e.a6.multiply(s,s,t),e.a6.multiply(s,r.globeMatrix,s)}(t,r);return function(t,r,i){const n=(t,r,i)=>{const n=e.N.length(t),o=e.N.length(r),s=Gh(t,r,i);return e.N.scale(s,s,1/e.N.length(s)*ct(n,o,i))},o=n([t[0],t[1],t[2]],[r[0],r[1],r[2]],i),s=n([t[4],t[5],t[6]],[r[4],r[5],r[6]],i),a=n([t[8],t[9],t[10]],[r[8],r[9],r[10]],i),l=Gh([t[12],t[13],t[14]],[r[12],r[13],r[14]],i);return[o[0],o[1],o[2],0,s[0],s[1],s[2],0,a[0],a[1],a[2],0,l[0],l[1],l[2],1]}(o,i,n)}return o}function ny(e,t,r,i){const n=Rh.projectAabbCorners(i,r);let o=Number.MAX_VALUE,s=-1;for(let c=0;c<n.length;++c){const e=n[c];e[0]=(.5*e[0]+.5)*t.width,e[1]=(.5-.5*e[1])*t.height,e[2]<o&&(s=c,o=e[2])}const a=e=>new g(n[e][0],n[e][1]);let l;switch(s){case 0:case 6:l=[a(1),a(5),a(4),a(7),a(3),a(2),a(1)];break;case 1:case 7:l=[a(0),a(4),a(5),a(6),a(2),a(3),a(0)];break;case 3:case 5:l=[a(1),a(0),a(4),a(7),a(6),a(2),a(1)];break;default:l=[a(1),a(5),a(6),a(7),a(3),a(0),a(1)]}if(kl(e,l))return o}const oy=hs([{name:"a_pos_3f",components:3,type:"Float32"}]),sy=hs([{name:"a_color_3f",components:3,type:"Float32"}]),ay=hs([{name:"a_color_4f",components:4,type:"Float32"}]),ly=hs([{name:"a_uv_2f",components:2,type:"Float32"}]),cy=hs([{name:"a_normal_3f",components:3,type:"Float32"}]),uy=hs([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),hy=hs([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class dy{constructor(e,t){this.feature=e,this.instancedDataOffset=t,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class py{constructor(){this.instancedDataArray=new Us,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class fy{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,t,r,i){this.tileToMeter=wl(r);const n=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:o,id:s,index:a,sourceLayerIndex:l}of e){const e=Rl(o,n);if(!this.layers[0]._featureFilter.filter(new Co(this.zoom),e,r))continue;const c={id:s,sourceLayerIndex:l,index:a,geometry:n?e.geometry:Ll(o,r,i),properties:o.properties,type:o.type,patterns:{}},u=this.addFeature(c,c.geometry,e);u&&t.featureIndex.insert(o,c.geometry,a,l,this.index,this.instancesPerModel[u].instancedDataArray.length,Lr/32)}this.lookup=null}update(e,t,r,i){for(const n in this.instancesPerModel){const t=this.instancesPerModel[n];for(const r in e)t.idToFeaturesIndex.hasOwnProperty(r)&&this.evaluate(t.features[t.idToFeaturesIndex[r]],e[r],t,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const r in this.instancesPerModel){const i=this.instancesPerModel[r];for(const r of i.features){const n=this.layers[0],o=r.feature,s=this.canonical,a=n.paint.get("model-rotation").evaluate(o,{},s),l=n.paint.get("model-scale").evaluate(o,{},s),c=n.paint.get("model-translation").evaluate(o,{},s);e.N.exactEquals(r.rotation,a)&&e.N.exactEquals(r.scale,l)&&e.N.exactEquals(r.translation,c)||(this.evaluate(r,r.featureStates,i,!0),t=!0)}}return t}isEmpty(){for(const e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const t in this.instancesPerModel){const r=this.instancesPerModel[t];r.instancedDataArray.length<0||0===r.instancedDataArray.length||(r.instancedDataBuffer?r.instancedDataBuffer.updateData(r.instancedDataArray):r.instancedDataBuffer=e.createVertexBuffer(r.instancedDataArray,uy.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const t=this.instancesPerModel[e];0!==t.instancedDataArray.length&&t.instancedDataBuffer&&t.instancedDataBuffer.destroy()}}addFeature(e,t,r){const i=this.layers[0],n=i.layout.get("model-id").evaluate(r,{},this.canonical);if(!n)return j(`modelId is not evaluated for layer ${i.id} and it is not going to get rendered.`),n;this.instancesPerModel[n]||(this.instancesPerModel[n]=new py);const o=this.instancesPerModel[n],s=o.instancedDataArray,a=new dy(r,s.length);for(const l of t)for(const e of l){if(e.x<0||e.x>=Lr||e.y<0||e.y>=Lr)continue;const t=(this.lookupDim-1)/Lr,r=this.lookupDim*(e.y*t|0)+e.x*t|0;if(this.lookup){if(0!==this.lookup[r])continue;this.lookup[r]=1}this.instanceCount++;const i=s.length;s.resize(i+1),o.instancesEvaluatedElevation.push(0),s.float32[16*i]=e.x,s.float32[16*i+1]=e.y}return a.instancedDataCount=o.instancedDataArray.length-a.instancedDataOffset,a.instancedDataCount>0&&(e.id&&(o.idToFeaturesIndex[e.id]=o.features.length),o.features.push(a),this.evaluate(a,{},o,!1)),n}evaluate(e,t,r,i){const n=this.layers[0],o=e.feature,s=this.canonical,a=e.rotation=n.paint.get("model-rotation").evaluate(o,t,s),l=e.scale=n.paint.get("model-scale").evaluate(o,t,s),c=e.translation=n.paint.get("model-translation").evaluate(o,t,s),u=n.paint.get("model-color").evaluate(o,t,s);u.a=n.paint.get("model-color-mix-intensity").evaluate(o,t,s);const h=[];this.maxVerticalOffset<c[2]&&(this.maxVerticalOffset=c[2]),this.maxScale=Math.max(Math.max(this.maxScale,l[0]),Math.max(l[1],l[2])),ty(h,a,l);const d=Math.round(100*u.a)+u.b/1.05;for(let p=0;p<e.instancedDataCount;++p){const t=e.instancedDataOffset+p,n=16*t,o=r.instancedDataArray.float32;let a=0;i&&(a=o[n+6]-r.instancesEvaluatedElevation[t]);const l=0|o[n+1];o[n]=(0|o[n])+u.r/1.05,o[n+1]=l+u.g/1.05,o[n+2]=d,o[n+3]=1/(s.z>10?this.tileToMeter:wl(s,l)),o[n+4]=c[0],o[n+5]=c[1],o[n+6]=c[2]+a,o[n+7]=h[0],o[n+8]=h[1],o[n+9]=h[2],o[n+10]=h[4],o[n+11]=h[5],o[n+12]=h[6],o[n+13]=h[8],o[n+14]=h[9],o[n+15]=h[10],r.instancesEvaluatedElevation[t]=c[2]}}}ro(fy,"ModelBucket",{omit:["layers"]}),ro(py,"PerModelAttributes"),ro(dy,"ModelFeature");const my=new Vo({visibility:new Bo($o.layout_model.visibility),"model-id":new No($o.layout_model["model-id"])});var _y={paint:new Vo({"model-opacity":new Bo($o.paint_model["model-opacity"]),"model-rotation":new No($o.paint_model["model-rotation"]),"model-scale":new No($o.paint_model["model-scale"]),"model-translation":new No($o.paint_model["model-translation"]),"model-color":new No($o.paint_model["model-color"]),"model-color-mix-intensity":new No($o.paint_model["model-color-mix-intensity"]),"model-type":new Bo($o.paint_model["model-type"]),"model-cast-shadows":new Bo($o.paint_model["model-cast-shadows"]),"model-receive-shadows":new Bo($o.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Bo($o.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new No($o.paint_model["model-emissive-strength"]),"model-roughness":new No($o.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new No($o.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Bo($o.paint_model["model-cutoff-fade-range"])}),layout:my};const gy=64,yy={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function xy(t,r,i,n,o,s,a,l,c,u=!1){const h=i.zoom,d=i.project(n),p=vl(n.lat,h),f=1/p;e.a6.identity(t),e.a6.translate(t,t,[d.x+a[0]*f,d.y+a[1]*f,a[2]]);let m=1,_=1;const g=i.worldSize;if(u){if("mercator"===i.projection.name){let t=0;i.elevation&&(t=i.elevation.getAtPointOrZero(new Tl(d.x/g,d.y/g),0));const r=e.a7.transformMat4([],[d.x,d.y,t,1],i.projMatrix)[3]/i.cameraToCenterDistance;m=r,_=r*vl(i.center.lat,h)}else if("globe"===i.projection.name){const r=iy(t,i),o=e.a6.multiply([],i.projMatrix,r),s=[0,0,0,1];e.a7.transformMat4(s,s,o);const a=s[3]/i.cameraToCenterDistance,l=rd(h),c=i.projection.pixelsPerMeter(n.lat,g)*vl(n.lat,h),u=i.projection.pixelsPerMeter(i.center.lat,g)*vl(i.center.lat,h);m=a/ct(c,xl(i.center.lat),l),_=a*p/c,m*=u,_*=u}}else m=f;e.a6.scale(t,t,[m,m,_]);const y=[...t],x=r.orientation,v=[];if(ty(v,[x[0]+o[0],x[1]+o[1],x[2]+o[2]],s),e.a6.multiply(t,y,v),l&&i.elevation){let o=0;const s=[];if(c&&i.elevation){o=function(t,r,i,n,o){const s=r.elevation;if(!s)return 0;const a=Rh.projectAabbCorners(i,n),l=fl(1,o.lat)*r.worldSize,c=function(t,r){const i=[0,0,1],n=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const o of n){const n=t[o.corners[0]],s=t[o.corners[1]],a=t[o.corners[2]],l=[s[0]-n[0],s[1]-n[1],r*(s[2]-n[2])],c=e.N.cross(l,l,[a[0]-n[0],a[1]-n[1],r*(a[2]-n[2])]);e.N.normalize(c,c),o.dotProductWithUp=e.N.dot(c,i)}return n.sort(((e,t)=>e.dotProductWithUp-t.dotProductWithUp)),n[0].corners}(a,l),u=a[c[0]],h=a[c[1]],d=a[c[2]],p=a[c[3]],f=s.getAtPointOrZero(new Tl(u[0]/r.worldSize,u[1]/r.worldSize),0),m=s.getAtPointOrZero(new Tl(h[0]/r.worldSize,h[1]/r.worldSize),0),_=s.getAtPointOrZero(new Tl(d[0]/r.worldSize,d[1]/r.worldSize),0),g=s.getAtPointOrZero(new Tl(p[0]/r.worldSize,p[1]/r.worldSize),0),y=(f+g)/2,x=(m+_)/2;return y>x?m<_?ry(t,h,p,u,m,g,f,l):ry(t,d,u,p,_,f,g,l):f<g?ry(t,u,h,d,f,m,_,l):ry(t,p,d,h,g,_,m,l),Math.max(y,x)}(s,i,r.aabb,t,n);const a=e.a6.fromQuat([],s),l=e.a6.multiply([],a,v);e.a6.multiply(t,y,l)}else o=i.elevation.getAtPointOrZero(new Tl(d.x/g,d.y/g),0);0!==o&&(t[14]+=o)}}function vy(e,t,r=!1){e.uploaded||(e.gfxTexture=new Dg(t,e.image,r?t.gl.R8:t.gl.RGBA,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function by(e,t,r){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,oy.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,cy.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,ly.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(12===e.colorArray.bytesPerElement?sy:ay).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,hy.members,!0)),e.segments=ra.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);const i=e.material;i.pbrMetallicRoughness.baseColorTexture&&vy(i.pbrMetallicRoughness.baseColorTexture,t),i.pbrMetallicRoughness.metallicRoughnessTexture&&vy(i.pbrMetallicRoughness.metallicRoughnessTexture,t),i.normalTexture&&vy(i.normalTexture,t),i.occlusionTexture&&vy(i.occlusionTexture,t,r),i.emissionTexture&&vy(i.emissionTexture,t)}function wy(e,t,r){if(e.meshes)for(const i of e.meshes)by(i,t,r);if(e.children)for(const i of e.children)wy(i,t,r)}function Ty(e){if(e.meshes)for(const t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(const t of e.children)Ty(t)}function Ey(e){if(e.meshes)for(const r of e.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((t=r.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(const r of e.children)Ey(r)}class Sy{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class My{constructor(){this.tasks={},this.taskQueue=[],k(["process"],this),this.invoker=new Sy(this.process),this.nextId=0}add(e,t){const r=this.nextId++,i=function({type:e,isSymbolTile:t,zoom:r}){return r=r||0,"message"===e?0:"maybePrepare"!==e||t?"parseTile"!==e||t?"parseTile"===e&&t?300-r:"maybePrepare"===e&&t?400-r:500:200-r:100-r}(t);if(0===i){Z();try{e()}finally{}return null}return this.tasks[r]={fn:e,metadata:t,priority:i,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){Z();try{if(this.taskQueue=this.taskQueue.filter((e=>!!this.tasks[e])),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let i=0;i<this.taskQueue.length;i++){const r=this.tasks[this.taskQueue[i]];r.priority<t&&(t=r.priority,e=i)}if(null===e)return null;const r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}remove(){this.invoker.remove()}}class Ay{constructor(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.cancelCallbacks={},k(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new My}send(e,t,r,i,n=!1,o){const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=o,this.callbacks[s]=r);const a=new Set;return this.target.postMessage({id:s,type:e,hasCallback:!!r,targetMapId:i,mustQueue:n,sourceMapId:this.mapId,data:oo(t,a)},a),{cancel:()=>{r&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:i,sourceMapId:this.mapId})}}}receive(e){const t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[r];delete this.cancelCallbacks[r],e&&e.cancel()}else if(t.mustQueue||Z()){const e=this.callbacks[r],i=this.scheduler.add((()=>this.processTask(r,t)),e&&e.metadata||{type:"message"});i&&(this.cancelCallbacks[r]=i)}else this.processTask(r,t)}processTask(e,t){if(delete this.cancelCallbacks[e],"<response>"===t.type){const r=this.callbacks[e];delete this.callbacks[e],r&&(t.error?r(so(t.error)):r(null,so(t.data)))}else{const r=new Set,i=t.hasCallback?(t,i)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?oo(t):null,data:oo(i,r)},r)}:e=>{},n=so(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,n,i);else if(this.parent.getWorkerSource){const e=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,e[0],n.source,n.scope)[e[1]](n,i)}else i(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Iy{constructor(e,t){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=R();const r=this.workerPool.acquire(this.id);for(let i=0;i<r.length;i++){const e=new Iy.Actor(r[i],t,this.id);e.name=`Worker ${i}`,this.actors.push(e)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,t,r){C(this.actors,((r,i)=>{r.send(e,t,i)}),r=r||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}Iy.Actor=Ay;var Cy={workerUrl:"",workerClass:null,workerParams:void 0};function Py(){return null!=Cy.workerClass?new Cy.workerClass:new self.Worker(Cy.workerUrl,Cy.workerParams)}const Ly="mapboxgl_preloaded_worker_pool";class Ry{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Ry.workerCount;)this.workers.push(new Py);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Ly]}numActive(){return Object.keys(this.active).length}}let Dy;function Oy(){return Dy||(Dy=new Ry),Dy}Ry.workerCount=2;let zy,ky,Fy,By,Ny,Uy=null;function Vy(){return Z()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:ky||i.DRACO_URL}function jy(){if(Z()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(By)return By;const e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return By=WebAssembly.validate(e)?i.MESHOPT_SIMD_URL:i.MESHOPT_URL,By}const Gy={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},$y={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},qy={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Zy(e,t,r){const i=r.json.bufferViews.length,n=r.buffers.length;t.bufferView=i,r.json.bufferViews[i]={buffer:n,byteLength:e.byteLength},r.buffers[n]=e}const Wy="KHR_draco_mesh_compression";function Hy(e,t){const r=e.extensions&&e.extensions[Wy];if(!r)return;const i=new Fy.Decoder,n=tx(t,r.bufferView),o=new Fy.Mesh;if(!i.DecodeArrayToMesh(n,n.byteLength,o))throw new Error("Failed to decode Draco mesh");const s=t.json.accessors[e.indices],a=Gy[s.componentType],l=s.count*a.BYTES_PER_ELEMENT,c=Fy._malloc(l);a===Uint16Array?i.GetTrianglesUInt16Array(o,l,c):i.GetTrianglesUInt32Array(o,l,c),Zy(Fy.memory.buffer.slice(c,c+l),s,t),Fy._free(c);for(const u of Object.keys(r.attributes)){const n=i.GetAttributeByUniqueId(o,r.attributes[u]),s=t.json.accessors[e.attributes[u]],a=$y[s.componentType],l=s.count*qy[s.type]*Gy[s.componentType].BYTES_PER_ELEMENT,c=Fy._malloc(l);i.GetAttributeDataArrayForAllPoints(o,n,Fy[a],l,c),Zy(Fy.memory.buffer.slice(c,c+l),s,t),Fy._free(c)}i.destroy(),o.destroy(),delete e.extensions[Wy]}const Xy="EXT_meshopt_compression";function Yy(e,t){if(!e.extensions||!e.extensions[Xy])return;const r=e.extensions[Xy],i=new Uint8Array(t.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),n=new Uint8Array(r.count*r.byteStride);Ny.decodeGltfBuffer(n,r.count,r.byteStride,i,r.mode,r.filter),e.buffer=t.buffers.length,e.byteOffset=0,t.buffers[e.buffer]=n.buffer,delete e.extensions[Xy]}const Ky=1179937895,Jy=new TextDecoder("utf8");function Qy(e,t){return new URL(e,t).href}function ex(e,t,r,i){return fetch(Qy(e.uri,i)).then((e=>e.arrayBuffer())).then((e=>{t.buffers[r]=e}))}function tx(e,t){const r=e.json.bufferViews[t];return new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function rx(e,t,r,i){if(e.uri){const n=Qy(e.uri,i);return fetch(n).then((e=>e.blob())).then((e=>createImageBitmap(e))).then((e=>{t.images[r]=e}))}if(void 0!==e.bufferView){const i=tx(t,e.bufferView),n=new Blob([i],{type:e.mimeType});return createImageBitmap(n).then((e=>{t.images[r]=e}))}}function ix(e,t=0,r){const i={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===Ky){const r=new Uint32Array(e,t);let n=2;const o=(r[n++]>>2)-3,s=r[n++]>>2;if(n++,i.json=JSON.parse(Jy.decode(r.subarray(n,n+s))),n+=s,n<o){const o=r[n++];n++;const s=t+(n<<2);i.buffers[0]=e.slice(s,s+o)}}else i.json=JSON.parse(Jy.decode(new Uint8Array(e,t)));const{buffers:n,images:o,meshes:s,extensionsUsed:a,bufferViews:l}=i.json;let c=Promise.resolve();if(n){const e=[];for(let t=0;t<n.length;t++){const o=n[t];o.uri?e.push(ex(o,i,t,r)):i.buffers[t]||(i.buffers[t]=null)}c=Promise.all(e)}return c.then((()=>{const e=[],t=a&&a.includes(Wy),n=a&&a.includes(Xy);if(t&&e.push(function(){if(!Fy)return zy||(zy=function(e){let t,r=null;function i(){t=new Uint8Array(r.buffer)}function n(){throw new Error("Unexpected Draco error.")}const o={a:{a:n,d:function(e,r,i){return t.copyWithin(e,r,r+i)},c:function(e){const n=t.length,o=Math.max(e>>>0,Math.ceil(1.2*n)),s=Math.ceil((o-n)/65536);try{return r.grow(s),i(),!0}catch(e){return!1}},b:n}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,o):e.then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,o)))).then((e=>{const{Rb:n,Qb:o,P:s,T:a,X:l,Ja:c,La:u,Qa:h,Va:d,Wa:p,eb:f,jb:m,f:_,e:g,yb:y,zb:x,Ab:v,Bb:b,Db:w,Gb:T}=e.instance.exports;r=g;const E=(()=>{let e=0,r=0,i=0,s=0;return a=>{i&&(n(s),n(e),r+=i,i=e=0),e||(r+=128,e=o(r));const l=a.length+7&-8;let c=e;l>=r&&(i=l,c=s=o(l));for(let e=0;e<a.length;e++)t[c+e]=a[e];return c}})();return i(),_(),{memory:g,_free:n,_malloc:o,Mesh:class{constructor(){this.ptr=s()}destroy(){a(this.ptr)}},Decoder:class{constructor(){this.ptr=c()}destroy(){m(this.ptr)}DecodeArrayToMesh(e,t,r){const i=E(e),n=u(this.ptr,i,t,r.ptr);return!!l(n)}GetAttributeByUniqueId(e,t){return{ptr:h(this.ptr,e.ptr,t)}}GetTrianglesUInt16Array(e,t,r){d(this.ptr,e.ptr,t,r)}GetTrianglesUInt32Array(e,t,r){p(this.ptr,e.ptr,t,r)}GetAttributeDataArrayForAllPoints(e,t,r,i,n){f(this.ptr,e.ptr,t.ptr,r,i,n)}},DT_INT8:y(),DT_UINT8:x(),DT_INT16:v(),DT_UINT16:b(),DT_UINT32:w(),DT_FLOAT32:T()}}))}(fetch(Vy())),zy.then((e=>{Fy=e,zy=void 0})))}()),n&&e.push(function(){if(Ny)return;const e=function(e){let t;const r=WebAssembly.instantiateStreaming(e,{}).then((e=>{t=e.instance,t.exports.__wasm_call_ctors()})),i={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},n={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:r,supported:!0,decodeGltfBuffer(e,r,o,s,a,l){!function(e,t,r,i,n,o,s){const a=e.exports.sbrk,l=i+3&-4,c=a(l*n),u=a(o.length),h=new Uint8Array(e.exports.memory.buffer);h.set(o,u);const d=t(c,i,n,u,o.length);if(0===d&&s&&s(c,l,n),r.set(h.subarray(c,c+i*n)),a(c-a(0)),0!==d)throw new Error(`Malformed buffer data: ${d}`)}(t,t.exports[n[a]],e,r,o,s,t.exports[i[l]])}}}(fetch(jy()));return e.ready.then((()=>{Ny=e}))}()),o)for(let s=0;s<o.length;s++)e.push(rx(o[s],i,s,r));return(e.length?Promise.all(e):Promise.resolve()).then((()=>{if(t&&s)for(const{primitives:e}of s)for(const t of e)Hy(t,i);if(n&&s&&l)for(const e of l)Yy(e,i);return i}))}))}class nx{constructor(e,t,r){if(this.triangleCount=t.length/3,this.min=new g(0,0),this.max=new g(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===e.length||0===r)return;const i=e.map((e=>e.x)),n=e.map((e=>e.y));this.min=new g(Math.min(...i),Math.min(...n)),this.max=new g(Math.max(...i),Math.max(...n));const o=this.max.sub(this.min);o.x=Math.max(o.x,1),o.y=Math.max(o.y,1);const s=Math.max(o.x,o.y)/r;this.cellsX=Math.max(1,Math.ceil(o.x/s)),this.cellsY=Math.max(1,Math.ceil(o.y/s)),this.xScale=1/s,this.yScale=1/s;const a=[];for(let c=0;c<this.triangleCount;c++){const r=e[t[3*c+0]].sub(this.min),i=e[t[3*c+1]].sub(this.min),n=e[t[3*c+2]].sub(this.min),o=ox(Math.floor(Math.min(r.x,i.x,n.x)),this.xScale,this.cellsX),l=ox(Math.floor(Math.max(r.x,i.x,n.x)),this.xScale,this.cellsX),u=ox(Math.floor(Math.min(r.y,i.y,n.y)),this.yScale,this.cellsY),h=ox(Math.floor(Math.max(r.y,i.y,n.y)),this.yScale,this.cellsY),d=new g(0,0),p=new g(0,0),f=new g(0,0),m=new g(0,0);for(let e=u;e<=h;++e){d.y=p.y=e*s,f.y=m.y=(e+1)*s;for(let t=o;t<=l;++t)d.x=f.x=t*s,p.x=m.x=(t+1)*s,(Xl(r,i,n,d,p,m)||Xl(r,i,n,d,m,f))&&a.push({cellIdx:e*this.cellsX+t,triIdx:c})}}if(0===a.length)return;a.sort(((e,t)=>e.cellIdx-t.cellIdx||e.triIdx-t.triIdx));let l=0;for(;l<a.length;){const e=a[l].cellIdx,t={start:this.payload.length,len:0};for(;l<a.length&&a[l].cellIdx===e;)++t.len,this.payload.push(a[l++].triIdx);this.cells[e]=t}}query(e,t,r){if(0===this.triangleCount||0===this.cells.length)return;if(e.x>this.max.x||this.min.x>t.x)return;if(e.y>this.max.y||this.min.y>t.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let a=0;a<this.lookup.length;a++)this.lookup[a]=0;const i=ox(e.x-this.min.x,this.xScale,this.cellsX),n=ox(t.x-this.min.x,this.xScale,this.cellsX),o=ox(e.y-this.min.y,this.yScale,this.cellsY),s=ox(t.y-this.min.y,this.yScale,this.cellsY);for(let a=o;a<=s;a++)for(let e=i;e<=n;e++){const t=this.cells[a*this.cellsX+e];if(t)for(let e=0;e<t.len;e++){const i=this.payload[t.start+e],n=Math.floor(i/8),o=1<<i%8;if(!(this.lookup[n]&o)&&(this.lookup[n]|=o,r.push(i),r.length===this.triangleCount))return}}}}function ox(e,t,r){return Math.max(0,Math.min(r-1,Math.floor(e*t)))}function sx(e,t){const r=e.json.bufferViews[t.bufferView],i=Gy[t.componentType];return new i(e.buffers[r.buffer],(t.byteOffset||0)+(r.byteOffset||0),t.count*(r.byteStride&&r.byteStride!==qy[t.type]*i.BYTES_PER_ELEMENT?r.byteStride/i.BYTES_PER_ELEMENT:qy[t.type]))}function ax(e,t,r,i){const n=Gy[t.componentType],o=function(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(n),s=e.json.bufferViews[t.bufferView],a=s.byteStride?s.byteStride/n.BYTES_PER_ELEMENT:qy[t.type],l=r.float32,c=l.length/r.capacity;for(let u=0,h=0;u<t.count*a;u+=a,h+=c)for(let e=0;e<c;e++)l[h+e]=i[u+e]*o;r._trim()}function lx(e,t,r){const i=e.indices,n=e.attributes,o={};o.indexArray=new Ps;const s=t.json.accessors[i],a=s.count/3;o.indexArray.reserve(a);const l=sx(t,s);for(let d=0;d<a;d++)o.indexArray.emplaceBack(l[3*d],l[3*d+1],l[3*d+2]);o.indexArray._trim(),o.vertexArray=new Bs;const c=t.json.accessors[n.POSITION];o.vertexArray.reserve(c.count);const u=sx(t,c);for(let d=0;d<c.count;d++)o.vertexArray.emplaceBack(u[3*d],u[3*d+1],u[3*d+2]);if(o.vertexArray._trim(),o.aabb=new Rh(c.min,c.max),o.centroid=function(e,t){const r=[0,0,0],i=e.length;if(i>0){for(let n=0;n<i;n++){const i=3*e[n];r[0]+=t[i],r[1]+=t[i+1],r[2]+=t[i+2]}r[0]/=i,r[1]/=i,r[2]/=i}return r}(l,u),void 0!==n.COLOR_0){const e=t.json.accessors[n.COLOR_0],r=qy[e.type],i=sx(t,e);o.colorArray=3===r?new Bs:new ys,o.colorArray.resize(e.count),ax(t,e,o.colorArray,i)}if(void 0!==n.NORMAL){o.normalArray=new Bs;const e=t.json.accessors[n.NORMAL];o.normalArray.resize(e.count);const r=sx(t,e);ax(t,e,o.normalArray,r)}if(void 0!==n.TEXCOORD_0&&r.length>0){o.texcoordArray=new Ns;const e=t.json.accessors[n.TEXCOORD_0];o.texcoordArray.resize(e.count);const r=sx(t,e);ax(t,e,o.texcoordArray,r)}if(void 0!==n._FEATURE_ID_RGBA4444){const e=t.json.accessors[n._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(o.featureData=sx(t,e))}void 0!==n._FEATURE_RGBA4444&&(o.featureData=new Uint32Array(sx(t,t.json.accessors[n._FEATURE_RGBA4444]).buffer));const h=e.material;return o.material=function(e,t){const{emissiveFactor:r=[0,0,0],alphaMode:i="OPAQUE",alphaCutoff:n=.5,normalTexture:o,occlusionTexture:s,emissiveTexture:a,doubleSided:l}=e,{baseColorFactor:c=[1,1,1,1],metallicFactor:u=1,roughnessFactor:h=1,baseColorTexture:d,metallicRoughnessTexture:p}=e.pbrMetallicRoughness||{},f=s?t[s.index]:void 0;if(s&&s.extensions&&s.extensions.KHR_texture_transform&&f){const e=s.extensions.KHR_texture_transform;f.offsetScale=[e.offset[0],e.offset[1],e.scale[0],e.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new lt(...c),metallicFactor:u,roughnessFactor:h,baseColorTexture:d?t[d.index]:void 0,metallicRoughnessTexture:p?t[p.index]:void 0},doubleSided:l,emissiveFactor:r,alphaMode:i,alphaCutoff:n,normalTexture:o?t[o.index]:void 0,occlusionTexture:f,emissionTexture:a?t[a.index]:void 0,defined:void 0===e.defined}}(void 0!==h?t.json.materials[h]:{defined:!1},r),o}function cx(t,r,i){const{matrix:n,rotation:o,translation:s,scale:a,mesh:l,extras:c,children:u}=t,h={};if(h.matrix=n||e.a6.fromRotationTranslationScale([],o||[0,0,0,1],s||[0,0,0],a||[1,1,1]),void 0!==l){h.meshes=i[l];const e=h.anchor=[0,0];for(const t of h.meshes){const{min:r,max:i}=t.aabb;e[0]+=r[0]+i[0],e[1]+=r[1]+i[1]}e[0]=Math.floor(e[0]/h.meshes.length/2),e[1]=Math.floor(e[1]/h.meshes.length/2)}if(c&&(c.id&&(h.id=c.id),c.lights&&(h.lights=function(e){if(!e.length)return[];const t=function(e){const t=atob(e),r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.codePointAt(i);return r}(e),r=[],i=t.length/24,n=new Uint16Array(t.buffer),o=new Float32Array(t.buffer);for(let s=0;s<i;s++){const e=n[2*s*6]/30,t=n[2*s*6+1]/30,i=n[2*s*6+10]/100,a=o[6*s+1],l=o[6*s+2],c=o[6*s+3],u=o[6*s+4],h=c-a,d=u-l,p=Math.hypot(h,d);r.push({pos:[a+.5*h,l+.5*d,t],normal:[d/p,-h/p,0],width:p,height:e,depth:i,points:[a,l,c,u]})}return r}(c.lights))),u){const e=[];for(const t of u)e.push(cx(r.json.nodes[t],r,i));h.children=e}return h}function ux(e){if(0===e.vertices.length||0===e.indices.length)return null;const[t,r]=[e.vertices[0].clone(),e.vertices[0].clone()];for(let s=1;s<e.vertices.length;++s){const i=e.vertices[s];t.x=Math.min(t.x,i.x),t.y=Math.min(t.y,i.y),r.x=Math.max(r.x,i.x),r.y=Math.max(r.y,i.y)}const i=Math.ceil(Math.max(r.x-t.x,r.y-t.y)/256),n=Math.max(8,i),o=new nx(e.vertices,e.indices,n);return{vertices:e.vertices,indices:e.indices,grid:o,min:t,max:r}}function hx(e){if(!e.extras||!e.extras.ground)return null;const t=e.extras.ground;if(!t||!Array.isArray(t)||0===t.length)return null;const r=t[0];if(!r||!Array.isArray(r)||0===r.length)return null;const i=[];for(const s of r){if(!Array.isArray(s)||2!==s.length)continue;const e=s[0],t=s[1];"number"==typeof e&&"number"==typeof t&&i.push(new g(e,t))}if(i.length<3)return null;i.length>1&&i[i.length-1].equals(i[0])&&i.pop();let n=0;for(let s=0;s<i.length;s++){const e=i[s],t=i[(s+1)%i.length],r=i[(s+2)%i.length];n+=(e.x-t.x)*(r.y-t.y)-(r.x-t.x)*(e.y-t.y)}n>0&&i.reverse();const o=rp(i.flatMap((e=>[e.x,e.y])),[]);return 0===o.length?null:{vertices:i,indices:o}}function dx(e){const t=[],r=[];let i=0;for(const n of e){i=t.length;const e=n.vertexArray.float32,o=n.indexArray.uint16;for(let r=0;r<n.vertexArray.length;r++)t.push(new g(e[3*r+0],e[3*r+1]));for(let t=0;t<3*n.indexArray.length;t++)r.push(o[t]+i)}if(r.length%3!=0)return null;for(let n=0;n<r.length;n+=3){const e=t[r[n+0]],i=t[r[n+1]],o=t[r[n+2]];(e.x-i.x)*(o.y-i.y)-(o.x-i.x)*(e.y-i.y)>0&&([r[n+1],r[n+2]]=[r[n+2],r[n+1]])}return{vertices:t,indices:r}}function px(e){const t=function(e,t){const r=[],i=WebGL2RenderingContext;if(e.json.textures)for(const n of e.json.textures){const o={magFilter:i.LINEAR,minFilter:i.NEAREST,wrapS:i.REPEAT,wrapT:i.REPEAT};void 0!==n.sampler&&Object.assign(o,e.json.samplers[n.sampler]),r.push({image:t[n.source],sampler:o,uploaded:!1})}return r}(e,e.images),r=function(e,t){const r=[];for(const i of e.json.meshes){const n=[];for(const r of i.primitives)n.push(lx(r,e,t));r.push(n)}return r}(e,t),{scenes:i,scene:n,nodes:o}=e.json,s=i?i[n||0].nodes:o,a=[];for(const l of s)a.push(cx(o[l],e,r));return function(e,t,r){const i={},n=new Set;for(let o=0;o<e.length;o++){const e=r[t[o]];if(!e.extras)continue;const s=e.extras["mapbox:footprint:version"],a=e.extras["mapbox:footprint:id"];(s||a)&&n.add(o),"1.0.0"===s&&a&&(i[a]=o)}for(let o=0;o<e.length;o++){if(n.has(o))continue;const s=e[o],a=r[t[o]];if(!a.extras)continue;let l=null;s.id in i&&(l=dx(e[i[s.id]].meshes)),l||(l=hx(a)),l&&(s.footprint=ux(l))}if(n.size>0){const t=Array.from(n.values()).sort(((e,t)=>e-t));for(let r=t.length-1;r>=0;r--)e.splice(t[r],1)}}(a,s,e.json.nodes),a}function fx(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);const t=e.vertexArray.float32,r=e.aabb.min[0]-1,i=e.aabb.min[1]-1,n=gy/(e.aabb.max[0]-r+2),o=gy/(e.aabb.max[1]-i+2);for(let s=0;s<t.length;s+=3){const a=t[s+2],l=(t[s+0]-r)*n|0,c=(t[s+1]-i)*o|0;a>e.heightmap[c*gy+l]&&(e.heightmap[c*gy+l]=a)}}function mx(t,r){const i={};i.indexArray=new Ps,i.indexArray.reserve(4*t.length),i.vertexArray=new Bs,i.vertexArray.reserve(10*t.length),i.colorArray=new ys,i.vertexArray.reserve(10*t.length);let n=0;for(const a of t){const t=Math.min(10,Math.max(4,1.3*a.height))*r,o=[-a.normal[1],a.normal[0],0],s=Math.min(.29,.1*a.width/a.depth),l=a.width-2*a.depth*r*(s+.01),c=e.N.scaleAndAdd([],a.pos,o,l/2),u=e.N.scaleAndAdd([],a.pos,o,-l/2),h=[c[0],c[1],c[2]+a.height],d=[u[0],u[1],u[2]+a.height],p=e.N.scaleAndAdd([],a.normal,o,s);e.N.scale(p,p,t);const f=e.N.scaleAndAdd([],a.normal,o,-s);e.N.scale(f,f,t),e.N.add(p,c,p),e.N.add(f,u,f),c[2]+=.1,u[2]+=.1,i.vertexArray.emplaceBack(p[0],p[1],p[2]),i.vertexArray.emplaceBack(f[0],f[1],f[2]),i.vertexArray.emplaceBack(c[0],c[1],c[2]),i.vertexArray.emplaceBack(u[0],u[1],u[2]),i.vertexArray.emplaceBack(h[0],h[1],h[2]),i.vertexArray.emplaceBack(d[0],d[1],d[2]),i.vertexArray.emplaceBack(c[0],c[1],c[2]),i.vertexArray.emplaceBack(u[0],u[1],u[2]),i.vertexArray.emplaceBack(p[0],p[1],p[2]),i.vertexArray.emplaceBack(f[0],f[1],f[2]);const m=l/t/2;i.colorArray.emplaceBack(-m-s,-1,m,.8),i.colorArray.emplaceBack(m+s,-1,m,.8),i.colorArray.emplaceBack(-m,0,m,1.3),i.colorArray.emplaceBack(m,0,m,1.3),i.colorArray.emplaceBack(m+s,-.8,m,.7),i.colorArray.emplaceBack(m+s,-.8,m,.7),i.colorArray.emplaceBack(0,0,m,1.3),i.colorArray.emplaceBack(0,0,m,1.3),i.colorArray.emplaceBack(m+s,-1.2,m,.8),i.colorArray.emplaceBack(m+s,-1.2,m,.8),i.indexArray.emplaceBack(6+n,4+n,8+n),i.indexArray.emplaceBack(7+n,9+n,5+n),i.indexArray.emplaceBack(0+n,1+n,2+n),i.indexArray.emplaceBack(1+n,3+n,2+n),n+=10}const o={defined:!0,emissiveFactor:[0,0,0]},s={};return s.baseColorFactor=lt.white,o.pbrMetallicRoughness=s,i.material=o,i.aabb=new Rh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}ro(nx,"TriangleGridIndex");class _x{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const gx=["tile","layer","source","sourceLayer","state"];class yx{constructor(e,t,r,i,n){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=r,this._y=i,this.properties=e.properties,this.id=n}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const t of gx)void 0!==this[t]&&(e[t]=this[t]);return e}}class xx{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new eo(Lr,16,0),this.featureIndexArray=new Js,this.promoteId=t,this.is3DTile=!1}insert(e,t,r,i,n,o=0,s=0){const a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,i,n,o);const l=this.grid;for(let c=0;c<t.length;c++){const e=t[c],r=[1/0,1/0,-1/0,-1/0];for(let t=0;t<e.length;t++){const i=e[t];r[0]=Math.min(r[0],i.x),r[1]=Math.min(r[1],i.y),r[2]=Math.max(r[2],i.x),r[3]=Math.max(r[3],i.y)}0!==s&&(r[0]-=s,r[1]-=s,r[2]+=s,r[3]+=s),r[0]<Lr&&r[1]<Lr&&r[2]>=0&&r[3]>=0&&l.insert(a,r[0],r[1],r[2],r[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ip(new km(this.rawTileData)).layers,this.sourceLayerCoder=new _x(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,r,i){this.loadVTLayers();const n=e.params||{},o=Zo(n.filter),s=e.tileResult,a=e.transform,l=s.bufferedTilespaceBounds,c=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,((e,t,r,i)=>Zl(s.bufferedTilespaceGeometry,e,t,r,i)));c.sort(bx);let u=null;a.elevation&&c.length>0&&(u=Yp.create(a.elevation,this.tileID));const h={};let d;for(let p=0;p<c.length;p++){const l=c[p];if(l===d)continue;d=l;const f=this.featureIndexArray.get(l);let m=null;if(this.is3DTile){const e=this.bucketLayerIDs[0][0],r=t[e];if("model"!==r.type)continue;const{queryFeature:i,intersectionZ:n}=r.queryIntersectsMatchingFeature(s,f.featureIndex,o,a);i&&this.appendToResult(h,e,f.featureIndex,i,n)}else this.loadMatchingFeature(h,f,o,n.layers,n.availableImages,t,r,i,((t,r,i,n=0)=>(m||(m=Ll(t,this.tileID.canonical,e.tileTransform)),r.queryIntersectsFeature(s,t,i,m,this.z,e.transform,e.pixelPosMatrix,u,n))))}return h}loadMatchingFeature(e,t,r,i,n,o,s,a,l){const{featureIndex:c,bucketIndex:u,sourceLayerIndex:h,layoutVertexArrayOffset:d}=t,p=this.bucketLayerIDs[u];if(i&&!function(e,t){for(let r=0;r<e.length;r++)if(t.indexOf(e[r])>=0)return!0;return!1}(i,p))return;const f=this.sourceLayerCoder.decode(h),m=this.vtLayers[f].feature(c);if(r.needGeometry){const e=Rl(m,!0);if(!r.filter(new Co(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!r.filter(new Co(this.tileID.overscaledZ),m))return;const _=this.getId(m,f);for(let g=0;g<p.length;g++){const t=p[g];if(i&&i.indexOf(t)<0)continue;const r=o[t];if(!r)continue;let u={};void 0!==_&&a&&(u=a.getState(r.sourceLayer||"_geojsonTileLayer",_));const h=!l||l(m,r,u,d);if(!h)continue;const f=new yx(m,this.z,this.x,this.y,_),y=P({},s[t]);y.paint=vx(y.paint,r.paint,m,u,n),y.layout=vx(y.layout,r.layout,m,u,n),f.layer=y,this.appendToResult(e,t,c,f,h)}}appendToResult(e,t,r,i,n){let o=e[t];void 0===o&&(o=e[t]=[]),o.push({featureIndex:r,feature:i,intersectionZ:n})}lookupSymbolFeatures(e,t,r,i,n,o,s,a){const l={};this.loadVTLayers();const c=Zo(n);for(const u of e)this.loadMatchingFeature(l,{bucketIndex:r,sourceLayerIndex:i,featureIndex:u,layoutVertexArrayOffset:0},c,o,s,a,t);return l}loadFeature(e){const{featureIndex:t,sourceLayerIndex:r}=e;this.loadVTLayers();const i=this.sourceLayerCoder.decode(r),n=this.vtFeatures[i];if(n[t])return n[t];const o=this.vtLayers[i].feature(t);return n[t]=o,o}hasLayer(e){for(const t of this.bucketLayerIDs)for(const r of t)if(e===r)return!0;return!1}getId(e,t){let r=e.id;if(this.promoteId){const i="string"==typeof this.promoteId?this.promoteId:this.promoteId[t];null!=i&&(r=e.properties[i]),"boolean"==typeof r&&(r=Number(r))}return r}}function vx(e,t,r,i,n){return B(e,((e,o)=>{const s=t instanceof Fo?t.get(o):null;return s&&s.evaluate?s.evaluate(r,i,n):s}))}function bx(e,t){return t-e}ro(xx,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const wx=new Float32Array(262144),Tx=new Uint8Array(262144);function Ex(e){let t=0;if(e.meshes)for(const r of e.meshes)t=Math.max(t,r.aabb.max[2]);if(e.children)for(const r of e.children)t=Math.max(t,Ex(r));return t}function Sx(e,t,r){if(e.meshes)for(const i of e.meshes)i.aabb.min[0]!==1/0&&r.insert(t,i.aabb.min[0],i.aabb.min[1],i.aabb.max[0],i.aabb.max[1]);if(e.children)for(const i of e.children)Sx(i,t,r)}const Mx=["","wall","door","roof","window","lamp","logo"];class Ax{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Ex(e)}}}getLocalBounds(){if(!this.node.meshes)return new Rh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const t=new Rh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const r of this.node.meshes)this.node.lightMeshIndex!==e&&t.encapsulate(r.aabb),e++;this.aabb=t}return this.aabb}}class Ix{constructor(e,t,r,i,n,o){this.id=t,this.modelTraits|=yy.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,r&&(this.modelTraits|=yy.HasMapboxMeshFeatures),i&&(this.modelTraits|=yy.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=n,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const s of e)this.nodesInfo.push(new Ax(s)),Sx(s,o.featureIndexArray.length,o.grid),o.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,o.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const t=this.getNodesInfo();for(const r of t){const t=r.node;this.uploaded?this.updatePbrBuffer(t):wy(t,e,!0)}for(const r of t)Ty(r.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let t=!1;if(!e.meshes)return t;for(const r of e.meshes)r.pbrBuffer&&(r.pbrBuffer.updateData(r.featureArray),t=!0);return t}needsReEvaluation(e,t,r){const i=e.transform.projectionOptions,n=e.style.getBrightness(),o=this.brightness!==n;return!!(!this.uploaded||this.dirty||i.name!==this.projection.name||Cx(r.paint.get("model-color").value,o)||Cx(r.paint.get("model-color-mix-intensity").value,o)||Cx(r.paint.get("model-roughness").value,o)||Cx(r.paint.get("model-emissive-strength").value,o)||Cx(r.paint.get("model-height-based-emissive-strength-multiplier").value,o))&&(this.projection=i,this.brightness=n,!0)}evaluateScale(e,t){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const r=this.getNodesInfo(),i=this.id.canonical;for(const n of r){const e=n.feature;n.evaluatedScale=t.paint.get("model-scale").evaluate(e,{},i)}}evaluate(e){const t=this.getNodesInfo();for(const r of t){if(!r.node.meshes)continue;const t=r.feature,i=r.node.meshes&&r.node.meshes[0].featureData,n=r.evaluatedColor[2],o=r.evaluatedRMEA[2],s=this.id.canonical;if(r.hasTranslucentParts=!1,i){for(let i=0;i<Mx.length;i++){const n=Mx[i];n.length&&(t.properties.part=n);const o=e.paint.get("model-color").evaluate(t,{},s),a=e.paint.get("model-color-mix-intensity").evaluate(t,{},s);r.evaluatedColor[i]=[o.r,o.g,o.b,a],r.evaluatedRMEA[i][0]=e.paint.get("model-roughness").evaluate(t,{},s),r.evaluatedRMEA[i][2]=e.paint.get("model-emissive-strength").evaluate(t,{},s),r.evaluatedRMEA[i][3]=o.a,r.emissionHeightBasedParams[i]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(t,{},s),!r.hasTranslucentParts&&o.a<1&&(r.hasTranslucentParts=!0)}delete t.properties.part,Lx(r,n!==r.evaluatedColor[2]||o!==r.evaluatedRMEA[2],this.modelTraits)}else r.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(t,{},s);r.evaluatedScale=e.paint.get("model-scale").evaluate(t,{},s),this.updatePbrBuffer(r.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,t,r,i){const n=e.findDEMTileFor(r);if(n&&(n.tileID.canonical!==this.terrainTile||t!==this.terrainExaggeration)){if(n.dem&&n.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=n.tileID.overscaledZ;const t=Yp.create(e,r,n);if(!t)return;this.modelTraits&yy.HasMapboxMeshFeatures&&this.updateDEM(e,t,r,i);for(const e of this.getNodesInfo()){const r=e.node;if(!r.footprint||!r.footprint.vertices||!r.footprint.vertices.length)continue;const i=r.footprint.vertices;let n=t.getElevationAt(i[0].x,i[0].y,!0,!0);for(let e=1;e<i.length;e++)n=Math.min(n,t.getElevationAt(i[e].x,i[e].y,!0,!0));r.elevation=n}}this.terrainTile=n.tileID.canonical,this.terrainExaggeration=t}}updateDEM(e,t,r,i){let n=t._dem._modifiedForSources[i];if(void 0===n&&(t._dem._modifiedForSources[i]=[],n=t._dem._modifiedForSources[i]),n.includes(r.canonical))return;const o=t._dem.dim;n.push(r.canonical);let s=!1;for(const a of this.getNodesInfo()){const e=a.node;if(!e.footprint||!e.footprint.grid)continue;const r=e.footprint.grid,i=t.tileCoordToPixel(r.min.x,r.min.y),n=t.tileCoordToPixel(r.max.x,r.max.y),l=Math.min(Math.min(o-n.y,i.x),Math.min(i.y,o-n.x));if(l<0)continue;const c=M(l,2,5);let u=Math.max(0,i.x-c),h=Math.max(0,i.y-c),d=Math.min(n.x+c,o-1),p=Math.min(n.y+c,o-1);for(let t=h;t<=p;++t)for(let e=u;e<=d;++e)Tx[t*o+e]=255;let f=0,m=0;for(let s=0;s<r.cellsY;++s)for(let e=0;e<r.cellsX;++e){if(!r.cells[s*r.cellsX+e])continue;const i=t.tileCoordToPixel(r.min.x+e/r.xScale,r.min.y+s/r.yScale),n=t.tileCoordToPixel(r.min.x+(e+1)/r.xScale,r.min.y+(s+1)/r.yScale);for(let e=i.y;e<=Math.min(n.y+1,o-1);++e)for(let r=i.x;r<=Math.min(n.x+1,o-1);++r)255===Tx[e*o+r]&&(Tx[e*o+r]=0,f+=t.getElevationAtPixel(r,e),m++)}const _=f/m;u=Math.max(1,i.x-c),h=Math.max(1,i.y-c),d=Math.min(n.x+c,o-2),p=Math.min(n.y+c,o-2),s=!0;for(let s=h;s<=p;++s)for(let e=u;e<=d;++e)0===Tx[s*o+e]&&(wx[s*o+e]=t._dem.set(e,s,_));for(let s=1;s<c;++s){u=Math.max(1,i.x-s),h=Math.max(1,i.y-s),d=Math.min(n.x+s,o-2),p=Math.min(n.y+s,o-2);for(let e=h;e<=p;++e)for(let r=u;r<=d;++r){const i=e*o+r;if(255===Tx[i]){let n=0,a=0,l=-1,u=-1;for(let t=-1;t<=1;++t)for(let i=-1;i<=1;++i){const c=(e+t)*o+r+i;if(Tx[c]>=s)continue;const h=wx[c],d=Math.abs(h);d>a&&(n=h,a=d,l=i,u=t)}if(a>.1){const o=1-(s+.5*Math.abs(l*u))/c;let a=t._dem.get(r,e)+n*o;const h=t._dem.get(r+l,e+u),d=t._dem.get(r-l,e-u,!0);(a-h)*(a-d)>0&&(a=(h+d)/2),wx[i]=t._dem.set(r,e,a),Tx[i]=s}}}}}s&&(t._demTile.needsDEMTextureUpload=!0,t._dem._timestamp=se.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const t of e)Ty(t.node),Ey(t.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const r=t.getReplacementRegionsForTile(e.toUnwrapped()),i=this.getNodesInfo();for(let n=0;n<this.nodesInfo.length;n++){const e=i[n].node;i[n].hiddenByReplacement=!!e.footprint&&!r.find((t=>t.footprint===e.footprint))}}getHeightAtTileCoord(e,t){const r=this.getNodesInfo(),i=[];for(let n=0;n<this.nodesInfo.length;n++){const o=r[n],s=o.node.meshes[0];if(e<s.aabb.min[0]||t<s.aabb.min[1]||e>s.aabb.max[0]||t>s.aabb.max[1])continue;const a=(e-s.aabb.min[0])/(s.aabb.max[0]-s.aabb.min[0])*gy|0,l=Math.min(63,(t-s.aabb.min[1])/(s.aabb.max[1]-s.aabb.min[1])*gy|0)*gy+Math.min(63,a);if(!(s.heightmap[l]<0&&o.node.footprint)){if(o.hiddenByReplacement)return;return{height:s.heightmap[l],maxHeight:o.feature.properties.height,hidden:!1,verticalScale:o.evaluatedScale[2]}}if(o.node.footprint.grid.query(new g(e,t),new g(e,t),i),i.length>0)return{height:void 0,maxHeight:o.feature.properties.height,hidden:o.hiddenByReplacement,verticalScale:o.evaluatedScale[2]}}}}function Cx(e,t){return!e.isLightConstant&&t}function Px(e,t,r,i,n,o,s,a){let l=(61440&t|(61440&t)>>4)>>8,c=(3840&t|(3840&t)>>4)>>4,u=240&t|(240&t)>>4;r[3]>0&&(l=ct(l,255*r[0],r[3]),c=ct(c,255*r[1],r[3]),u=ct(u,255*r[2],r[3]));const h=l<<8|c,d=u<<8|Math.floor(255*i[3]),p=function(e){const t=M(e,0,2);return Math.min(Math.round(.5*t*255),255)}(i[2])<<8|15*i[0]<<4|15*i[1],f=M(n[0],0,1),m=M(n[1],0,1),_=M(n[2],0,1),g=M(n[3],0,1);let y,x,v,b;if(f!==m&&s!==o&&m!==f){const e=s-o;x=1/(e*(m-f)),v=-(o+e*f)/(e*(m-f));const t=M(n[4],-1,1);b=Math.pow(10,t),y=255*_<<8|255*g}else y=65535,x=0,v=1,b=1;if(e.emplaceBack(h,d,p,y,x,v,b),a){const e=a.length;a.clear();for(let t=0;t<e;t++)a.emplaceBack(h,d,p,y,x,v,b)}}function Lx(e,t,r){const i=e.node;let n=0;const o=r&yy.HasMeshoptCompression;for(const s of i.meshes){if(i.lights&&i.lightMeshIndex===n)continue;if(!s.featureData)continue;s.featureArray=new Vs,s.featureArray.reserve(s.featureData.length);let r=t;for(const t of s.featureData){const n=o?65535&t:t>>16&65535,a=o?t>>16&65535:65535&t,l=(15&a)<8?15&a:0,c=e.evaluatedRMEA[l],u=e.evaluatedColor[l],h=e.emissionHeightBasedParams[l];let d;if(r&&2===l&&i.lights&&(d=new Vs,d.resize(10*i.lights.length)),Px(s.featureArray,n,u,c,h,s.aabb.min[2],s.aabb.max[2],d),d&&r){r=!1;const e=i.meshes[i.lightMeshIndex];e.featureArray=d,e.featureArray._trim()}}s.featureArray._trim(),n++}}function Rx(e,t,r,i){const n=1<<e.z;t.lat=_l((i/Lr+e.y)/n),t.lng=ml((r/Lr+e.x)/n)}ro(Ix,"Tiled3dModelBucket",{omit:["layers"]}),ro(Ax,"Tiled3dModelFeature");const Dx={circle:class extends as{constructor(e,t,r){super(e,tc,t,r)}createBucket(e){return new zl(e)}queryRadius(e){const t=e;return Yl("circle-radius",this,t)+Yl("circle-stroke-width",this,t)+Kl(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,r,i,n,o,s,a){const l=Ql(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,r)+this.paint.get("circle-stroke-width").evaluate(t,r);return ud(e,i,o,s,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t){const r=cd(this);return{config:new za(this,t),defines:r,overrideFog:!1}}},heatmap:class extends as{createBucket(e){return new md(e)}constructor(e,t,r){super(e,Td,t,r),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ed({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return Yl("heatmap-radius",this,e)}queryIntersectsFeature(e,t,r,i,n,o,s,a){const l=this.paint.get("heatmap-radius").evaluate(t,r);return ud(e,i,o,s,a,!0,!0,new g(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t){return"heatmap"===e?{config:new za(this,t),overrideFog:!1}:{}}},hillshade:class extends as{constructor(e,t,r){super(e,Md,t,r)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},fill:class extends as{constructor(e,t,r){super(e,cp,t,r)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),r=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(e,t){return{config:new za(this,t),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);const r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new ap(e)}queryRadius(){return Kl(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,r,i,n,o){return!e.queryGeometry.isAboveHorizon&&Bl(Jl(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),i)}isTileClipped(){return!0}},"fill-extrusion":class extends as{constructor(e,t,r){super(e,Af,t,r),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new mf(e)}queryRadius(){return Kl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,r,i,n,o,s,a,l,c){const u=Ql(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,t.pixelToTileUnitsFactor),h=this.paint.get("fill-extrusion-height").evaluate(r,i),d=this.paint.get("fill-extrusion-base").evaluate(r,i),p=[0,0],f=l&&s.elevation,m=s.elevation?s.elevation.exaggeration():1,_=t.tile.getBucket(this);if(f&&_ instanceof mf){const e=_.centroidVertexArray,t=c+1;t<e.length&&(p[0]=e.geta_centroid_pos0(t),p[1]=e.geta_centroid_pos1(t))}if(0===p[0]&&1===p[1])return!1;"globe"===s.projection.name&&(n=Ef([n],[new g(0,0),new g(Lr,Lr)],t.tileID.canonical).map((e=>e.polygon)).flat());const y=f?l:null,[x,v]=function(t,r,i,n,o,s,a,l,c,u,h){return"globe"===t.projection.name?function(t,r,i,n,o,s,a,l,c,u,h){const d=[],p=[],f=t.projection.upVectorScale(h,t.center.lat,t.worldSize).metersToTile,m=[0,0,0,1],_=[0,0,0,1],g=(e,t,r,i)=>{e[0]=t,e[1]=r,e[2]=i,e[3]=1},y=Tf();i>0&&(i+=y),n+=y;for(const x of r){const r=[],y=[];for(const d of x){const p=d.x+o.x,x=d.y+o.y,v=t.projection.projectTilePoint(p,x,h),b=t.projection.upVector(h,d.x,d.y);let w=i,T=n;if(a){const e=Lf(p,x,i,n,a,l,c,u);w+=e.base,T+=e.top}0!==i?g(m,v.x+b[0]*f*w,v.y+b[1]*f*w,v.z+b[2]*f*w):g(m,v.x,v.y,v.z),g(_,v.x+b[0]*f*T,v.y+b[1]*f*T,v.z+b[2]*f*T),e.N.transformMat4(m,m,s),e.N.transformMat4(_,_,s),r.push(new If(m[0],m[1],m[2])),y.push(new If(_[0],_[1],_[2]))}d.push(r),p.push(y)}return[d,p]}(t,r,i,n,o,s,a,l,c,u,h):a?function(t,r,i,n,o,s,a,l,c){const u=[],h=[],d=[0,0,0,1];for(const p of t){const t=[],f=[];for(const u of p){const h=u.x+n.x,p=u.y+n.y,m=Lf(h,p,r,i,s,a,l,c);d[0]=h,d[1]=p,d[2]=m.base,d[3]=1,e.a7.transformMat4(d,d,o),d[3]=Math.max(d[3],1e-5);const _=new If(d[0]/d[3],d[1]/d[3],d[2]/d[3]);d[0]=h,d[1]=p,d[2]=m.top,d[3]=1,e.a7.transformMat4(d,d,o),d[3]=Math.max(d[3],1e-5);const g=new If(d[0]/d[3],d[1]/d[3],d[2]/d[3]);t.push(_),f.push(g)}u.push(t),h.push(f)}return[u,h]}(r,i,n,o,s,a,l,c,u):function(e,t,r,i,n){const o=[],s=[],a=n[8]*t,l=n[9]*t,c=n[10]*t,u=n[11]*t,h=n[8]*r,d=n[9]*r,p=n[10]*r,f=n[11]*r;for(const m of e){const e=[],t=[];for(const r of m){const o=r.x+i.x,s=r.y+i.y,m=n[0]*o+n[4]*s+n[12],_=n[1]*o+n[5]*s+n[13],g=n[2]*o+n[6]*s+n[14],y=n[3]*o+n[7]*s+n[15],x=m+a,v=_+l,b=g+c,w=Math.max(y+u,1e-5),T=m+h,E=_+d,S=g+p,M=Math.max(y+f,1e-5);e.push(new If(x/w,v/w,b/w)),t.push(new If(T/M,E/M,S/M))}o.push(e),s.push(t)}return[o,s]}(r,i,n,o,s)}(s,n,d,h,u,a,y,p,m,s.center.lat,t.tileID.canonical),b=t.queryGeometry;return function(e,t,r){let i=1/0;Bl(r,t)&&(i=Pf(r,t[0]));for(let n=0;n<t.length;n++){const o=t[n],s=e[n];for(let e=0;e<o.length-1;e++){const t=o[e],n=[t,o[e+1],s[e+1],s[e],t];kl(r,n)&&(i=Math.min(i,Pf(r,n)))}}return i!==1/0&&i}(x,v,b.isPointQuery()?b.screenBounds:b.screenGeometry)}},line:class extends as{constructor(e,t,r){super(e,Vf,t,r),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ei,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Wf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Nf(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t){const r=qf(this);return{config:new za(this,t),defines:r,overrideFog:!1}}queryRadius(e){const t=e,r=Hf(Yl("line-width",this,t),Yl("line-gap-width",this,t)),i=Yl("line-offset",this,t);return r/2+Math.abs(i)+Kl(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,r,i,n,o){if(e.queryGeometry.isAboveHorizon)return!1;const s=Jl(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),a=e.pixelToTileUnitsFactor/2*Hf(this.paint.get("line-width").evaluate(t,r),this.paint.get("line-gap-width").evaluate(t,r)),l=this.paint.get("line-offset").evaluate(t,r);return l&&(i=function(e,t){const r=[],i=new g(0,0);for(let n=0;n<e.length;n++){const o=e[n],s=[];for(let e=0;e<o.length;e++){const r=o[e],n=o[e+1],a=0===e?i:r.sub(o[e-1])._unit()._perp(),l=e===o.length-1?i:n.sub(r)._unit()._perp(),c=a._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),s.push(c._mult(t)._add(r))}r.push(s)}return r}(i,l*e.pixelToTileUnitsFactor)),function(e,t,r){for(let i=0;i<t.length;i++){const n=t[i];if(e.length>=3)for(let t=0;t<n.length;t++)if(ql(e,n[t]))return!0;if(Nl(e,n,r))return!0}return!1}(s,i,a)}isTileClipped(){return!0}},symbol:Ag,background:class extends as{constructor(e,t,r){super(e,Cg,t,r)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},raster:Ug,"raster-particle":Gg,sky:class extends as{constructor(e,t,r){super(e,Zg,t,r),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ed({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const r=this.paint.get("sky-atmosphere-sun"),i=!r,n=e.style.light,o=n.properties.get("position");return i&&"viewport"===n.properties.get("anchor")&&j("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),i?Wg(o.azimuthal,90-o.polar,t):Wg(r[0],90-r[1],t)}const r=this.paint.get("sky-gradient-center");return Wg(r[0],90-r[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}},slot:class extends as{constructor(e,t,r){super(e,Hg,t)}},model:class extends as{constructor(e,t,r){super(e,_y,t,r),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new fy(e)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(e){return e instanceof Ix?Lr-1:0}queryIntersectsFeature(t,r,i,n,o,s){if(!this.modelManager)return!1;const a=this.modelManager,l=t.tile.getBucket(this);if(!(l&&l instanceof fy))return!1;const c=l;for(const u in c.instancesPerModel){const i=c.instancesPerModel[u];if(i.idToFeaturesIndex.hasOwnProperty(r.id)){const n=i.features[i.idToFeaturesIndex[r.id]],o=a.getModel(u,this.scope);if(!o)return!1;let l=e.a6.create();const h=new el(0,0),d=c.canonical;let p=Number.MAX_VALUE;for(let r=0;r<n.instancedDataCount;++r){const a=16*(n.instancedDataOffset+r),c=i.instancedDataArray.float32,u=[c[a+4],c[a+5],c[a+6]];Rx(d,h,c[a],0|c[a+1]),xy(l,o,s,h,n.rotation,n.scale,u,!1,!1,!1),"globe"===s.projection.name&&(l=iy(l,s));const f=e.a6.multiply([],s.projMatrix,l),m=t.queryGeometry,_=ny(m.isPointQuery()?m.screenBounds:m.screenGeometry,s,f,o.aabb);null!=_&&(p=Math.min(_,p))}return p!==Number.MAX_VALUE&&p}}return!1}_handleOverridablePaintPropertyUpdate(e,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven()||"model-color"!==e&&"model-color-mix-intensity"!==e&&"model-rotation"!==e&&"model-scale"!==e&&"model-translation"!==e&&"model-emissive-strength"!==e)}_isPropertyZoomDependent(e){const t=this._transitionablePaint._values[e];return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof Wn}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,r,i,n){const o=t.tile,s=o.getBucket(this);let a=null,l=Number.MAX_VALUE;if(!(s&&s instanceof Ix))return{queryFeature:a,intersectionZ:l};const c=s.getNodesInfo()[r];if(c.hiddenByReplacement||!c.node.meshes||!i.filter(new Co(o.tileID.overscaledZ),c.feature,o.tileID.canonical))return{queryFeature:a,intersectionZ:l};const u=c.node,h=n.calculatePosMatrix(o.tileID.toUnwrapped(),n.worldSize),d=c.evaluatedScale;let p=0;n.elevation&&u.elevation&&(p=u.elevation*n.elevation.exaggeration()),e.a6.translate(h,h,[(u.anchor?u.anchor[0]:0)*(d[0]-1),(u.anchor?u.anchor[1]:0)*(d[1]-1),p]),e.a6.scale(h,h,d),e.a6.multiply(h,h,u.matrix);const f=t.queryGeometry,m=f.isPointQuery()?f.screenBounds:f.screenGeometry,_=function(t){const r=e.a6.multiply([],h,t.matrix),i=e.a6.multiply(r,n.expandedFarZProjMatrix,r);for(let e=0;e<t.meshes.length;++e){const r=t.meshes[e];if(e===t.lightMeshIndex)continue;const o=ny(m,n,i,r.aabb);null!=o&&(l=Math.min(o,l))}if(t.children)for(const e of t.children)_(e)};if(_(u),l===Number.MAX_VALUE)return{queryFeature:a,intersectionZ:l};const g=new el(0,0);return Rx(o.tileID.canonical,g,c.node.anchor[0],c.node.anchor[1]),a={type:"Feature",geometry:{type:"Point",coordinates:[g.lng,g.lat]},properties:c.feature.properties,id:c.feature.id,state:{},layer:this.serialize()},{queryFeature:a,intersectionZ:l}}}},Ox={read:function(e,t){return e.readFields(Ox._readField,{header_length:0,x:0,y:0,z:0,layers:[]},t)},_readField:function(e,t,r){1===e?t.header_length=r.readFixed32():2===e?t.x=r.readVarint():3===e?t.y=r.readVarint():4===e?t.z=r.readVarint():5===e&&t.layers.push(Ox.Layer.read(r,r.readVarint()+r.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};Ox.Filter.read=function(e,t){return e.readFields(Ox.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},t)},Ox.Filter._readField=function(e,t,r){1===e?(t.delta_filter=Ox.Filter.Delta.read(r,r.readVarint()+r.pos),t.filter="delta_filter"):2===e?(t.zigzag_filter=Ox.Filter.Zigzag.read(r,r.readVarint()+r.pos),t.filter="zigzag_filter"):3===e?(t.bitshuffle_filter=Ox.Filter.BitShuffle.read(r,r.readVarint()+r.pos),t.filter="bitshuffle_filter"):4===e&&(t.byteshuffle_filter=Ox.Filter.ByteShuffle.read(r,r.readVarint()+r.pos),t.filter="byteshuffle_filter")},Ox.Filter.Delta={},Ox.Filter.Delta.read=function(e,t){return e.readFields(Ox.Filter.Delta._readField,{block_size:0},t)},Ox.Filter.Delta._readField=function(e,t,r){1===e&&(t.block_size=r.readVarint())},Ox.Filter.Zigzag={},Ox.Filter.Zigzag.read=function(e,t){return e.readFields(Ox.Filter.Zigzag._readField,{},t)},Ox.Filter.Zigzag._readField=function(e,t,r){},Ox.Filter.BitShuffle={},Ox.Filter.BitShuffle.read=function(e,t){return e.readFields(Ox.Filter.BitShuffle._readField,{},t)},Ox.Filter.BitShuffle._readField=function(e,t,r){},Ox.Filter.ByteShuffle={},Ox.Filter.ByteShuffle.read=function(e,t){return e.readFields(Ox.Filter.ByteShuffle._readField,{},t)},Ox.Filter.ByteShuffle._readField=function(e,t,r){},Ox.Codec={},Ox.Codec.read=function(e,t){return e.readFields(Ox.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},t)},Ox.Codec._readField=function(e,t,r){1===e?(t.gzip_data=Ox.Codec.GzipData.read(r,r.readVarint()+r.pos),t.codec="gzip_data"):2===e?(t.jpeg_image=Ox.Codec.JpegImage.read(r,r.readVarint()+r.pos),t.codec="jpeg_image"):3===e?(t.webp_image=Ox.Codec.WebpImage.read(r,r.readVarint()+r.pos),t.codec="webp_image"):4===e&&(t.png_image=Ox.Codec.PngImage.read(r,r.readVarint()+r.pos),t.codec="png_image")},Ox.Codec.GzipData={},Ox.Codec.GzipData.read=function(e,t){return e.readFields(Ox.Codec.GzipData._readField,{},t)},Ox.Codec.GzipData._readField=function(e,t,r){},Ox.Codec.JpegImage={},Ox.Codec.JpegImage.read=function(e,t){return e.readFields(Ox.Codec.JpegImage._readField,{},t)},Ox.Codec.JpegImage._readField=function(e,t,r){},Ox.Codec.WebpImage={},Ox.Codec.WebpImage.read=function(e,t){return e.readFields(Ox.Codec.WebpImage._readField,{},t)},Ox.Codec.WebpImage._readField=function(e,t,r){},Ox.Codec.PngImage={},Ox.Codec.PngImage.read=function(e,t){return e.readFields(Ox.Codec.PngImage._readField,{},t)},Ox.Codec.PngImage._readField=function(e,t,r){},Ox.DataIndexEntry={},Ox.DataIndexEntry.read=function(e,t){return e.readFields(Ox.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},t)},Ox.DataIndexEntry._readField=function(e,t,r){1===e?t.first_byte=r.readFixed64():2===e?t.last_byte=r.readFixed64():3===e?t.filters.push(Ox.Filter.read(r,r.readVarint()+r.pos)):4===e?t.codec=Ox.Codec.read(r,r.readVarint()+r.pos):5===e?t.offset=r.readFloat():6===e?t.scale=r.readFloat():7===e&&t.bands.push(r.readString())},Ox.Layer={},Ox.Layer.read=function(e,t){return e.readFields(Ox.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},t)},Ox.Layer._readField=function(e,t,r){1===e?t.version=r.readVarint():2===e?t.name=r.readString():3===e?t.units=r.readString():4===e?t.tilesize=r.readVarint():5===e?t.buffer=r.readVarint():6===e?t.pixel_format=r.readVarint():7===e&&t.data_index.push(Ox.DataIndexEntry.read(r,r.readVarint()+r.pos))};const zx={read:function(e,t){return e.readFields(zx._readField,{uint32_values:null,values:null,fixed32_values:null},t)},_readField:function(e,t,r){2===e?(t.uint32_values=zx.Uint32Values.read(r,r.readVarint()+r.pos),t.values="uint32_values"):3===e&&(t.fixed32_values=zx.Fixed32Values.read(r,r.readVarint()+r.pos),t.values="fixed32_values")},Uint32Values:{}};zx.Uint32Values.read=function(e,t){return e.readFields(zx.Uint32Values._readField,{values:[]},t)},zx.Uint32Values._readField=function(e,t,r){1===e&&(t.readValuesInto=function(e){if(2!==e.type)throw new Error(`Unsupported pbf type "${e.type}"`);const t=function(e){return 2===e.type?e.readVarint()+e.pos:e.pos+1}(e),r=e.pos;return e.pos=t,function(i){e.pos=r;let n=0;for(;e.pos<t;){const t=e.readVarint();i[n++]=t}return i}}(r))},zx.Fixed32Values={},zx.Fixed32Values.read=function(e,t){return e.readFields(zx.Fixed32Values._readField,{values:[]},t)},zx.Fixed32Values._readField=function(e,t,r){throw new Error("Not implemented")};
/**
 * tiny-lru
 *
 * @copyright 2023 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 11.2.5
 */
class kx{constructor(e=0,t=0,r=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=r,this.size=0,this.ttl=t}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){const t=this.items[e];delete this.items[e],this.size--,null!==t.prev&&(t.prev.next=t.next),null!==t.next&&(t.next.prev=t.prev),this.first===t&&(this.first=t.next),this.last===t&&(this.last=t.prev)}return this}entries(e=this.keys()){return e.map((e=>[e,this.get(e)]))}evict(e=!1){if(e||this.size>0){const e=this.first;delete this.items[e.key],0==--this.size?(this.first=null,this.last=null):(this.first=e.next,this.first.prev=null)}return this}expiresAt(e){let t;return this.has(e)&&(t=this.items[e].expiry),t}get(e){let t;if(this.has(e)){const r=this.items[e];this.ttl>0&&r.expiry<=Date.now()?this.delete(e):(t=r.value,this.set(e,t,!0))}return t}has(e){return e in this.items}keys(){const e=[];let t=this.first;for(;null!==t;)e.push(t.key),t=t.next;return e}set(e,t,r=!1,i=this.resetTtl){let n;if(r||this.has(e)){if(n=this.items[e],n.value=t,!1===r&&i&&(n.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==n){const e=this.last,t=n.next,r=n.prev;this.first===n&&(this.first=n.next),n.next=null,n.prev=this.last,e.next=n,null!==r&&(r.next=t),null!==t&&(t.prev=r)}}else this.max>0&&this.size===this.max&&this.evict(!0),n=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:t},1==++this.size?this.first=n:this.last.next=n;return this.last=n,this}values(e=this.keys()){return e.map((e=>this.get(e)))}}function Fx(e,t){if(4!==t.length)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let r=t[3];for(let i=2;i>=1;i--){const n=1===i?1:0,o=2===i?1:0;for(let i=0;i<t[0];i++){const s=t[1]*i;for(let i=n;i<t[1];i++){const n=t[2]*(i+s);for(let i=o;i<t[2];i++){const o=t[3]*(i+n);for(let i=0;i<t[3];i++){const t=o+i;e[t]+=e[t-r]}}}}r*=t[i]}return e}function Bx(e){for(let t=0,r=e.length;t<r;t++)e[t]=e[t]>>>1^-(1&e[t]);return e}function Nx(e,t){switch(t){case"uint32":return e;case"uint16":for(let t=0;t<e.length;t+=2){const r=e[t],i=e[t+1];e[t]=(240&r)>>4|(61440&r)>>8|(240&i)<<4|61440&i,e[t+1]=15&r|(3840&r)>>4|(15&i)<<8|(3840&i)<<4}return e;case"uint8":for(let t=0;t<e.length;t+=4){const r=e[t],i=e[t+1],n=e[t+2],o=e[t+3];e[t+0]=(192&r)>>6|(192&i)>>4|(192&n)>>2|192&o,e[t+1]=(48&r)>>4|(48&i)>>2|48&n|(48&o)<<2,e[t+2]=(12&r)>>2|12&i|(12&n)<<2|(12&o)<<4,e[t+3]=3&r|(3&i)<<2|(3&n)<<4|(3&o)<<6}return e;default:throw new Error(`Invalid pixel format, "${t}"`)}}class Ux extends Error{constructor(e){super(e),this.name="MRTError"}}var Vx=Uint8Array,jx=Uint16Array,Gx=Int32Array,$x=new Vx([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),qx=new Vx([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Zx=new Vx([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Wx=function(e,t){for(var r=new jx(31),i=0;i<31;++i)r[i]=t+=1<<e[i-1];var n=new Gx(r[30]);for(i=1;i<30;++i)for(var o=r[i];o<r[i+1];++o)n[o]=o-r[i]<<5|i;return{b:r,r:n}},Hx=Wx($x,2),Xx=Hx.b,Yx=Hx.r;Xx[28]=258,Yx[258]=28;for(var Kx=Wx(qx,0).b,Jx=new jx(32768),Qx=0;Qx<32768;++Qx){var ev=(43690&Qx)>>1|(21845&Qx)<<1;Jx[Qx]=((65280&(ev=(61680&(ev=(52428&ev)>>2|(13107&ev)<<2))>>4|(3855&ev)<<4))>>8|(255&ev)<<8)>>1}var tv=function(e,t,r){for(var i=e.length,n=0,o=new jx(t);n<i;++n)e[n]&&++o[e[n]-1];var s,a=new jx(t);for(n=1;n<t;++n)a[n]=a[n-1]+o[n-1]<<1;if(r){s=new jx(1<<t);var l=15-t;for(n=0;n<i;++n)if(e[n])for(var c=n<<4|e[n],u=t-e[n],h=a[e[n]-1]++<<u,d=h|(1<<u)-1;h<=d;++h)s[Jx[h]>>l]=c}else for(s=new jx(i),n=0;n<i;++n)e[n]&&(s[n]=Jx[a[e[n]-1]++]>>15-e[n]);return s},rv=new Vx(288);for(Qx=0;Qx<144;++Qx)rv[Qx]=8;for(Qx=144;Qx<256;++Qx)rv[Qx]=9;for(Qx=256;Qx<280;++Qx)rv[Qx]=7;for(Qx=280;Qx<288;++Qx)rv[Qx]=8;var iv=new Vx(32);for(Qx=0;Qx<32;++Qx)iv[Qx]=5;var nv=tv(rv,9,1),ov=tv(iv,5,1),sv=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},av=function(e,t,r){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&r},lv=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},cv=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],uv=function(e,t,r){var i=new Error(t||cv[e]);if(i.code=e,Error.captureStackTrace&&Error.captureStackTrace(i,uv),!r)throw i;return i},hv=new Vx(0),dv="undefined"!=typeof TextDecoder&&new TextDecoder;try{dv.decode(hv,{stream:!0})}catch(e){}const pv={gzip_data:"gzip"},fv={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},mv={uint32:1,uint16:2,uint8:4},_v={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class gv{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){const t=new Uint8Array(e),r=new DataView(e);if(13!==t[0])throw new Ux("File is not a valid MRT.");return r.getUint32(1,!0)}parseHeader(e){const t=new Uint8Array(e),r=this.getHeaderLength(e);if(t.length<r)throw new Ux(`Expected header with length >= ${r} but got buffer of length ${t.length}`);const i=new km(t.subarray(0,r)),n=Ox.read(i);if(!isNaN(this.x)&&(this.x!==n.x||this.y!==n.y||this.z!==n.z))throw new Ux(`Invalid attempt to parse header ${n.z}/${n.x}/${n.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=n.x,this.y=n.y,this.z=n.z;for(const o of n.layers)this.layers[o.name]=new yv(o,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const t=[],r=this.getLayer(e.layerName);for(let i=0;i<r.dataIndex.length;i++){const n=r.dataIndex[i],o=n.first_byte-e.firstByte,s=n.last_byte+1-e.firstByte;if(i<e.firstBlock||i>e.lastBlock)continue;if(r._blocksInProgress.has(i))continue;const a={layerName:r.name,firstByte:o,lastByte:s,pixelFormat:r.pixelFormat,blockIndex:i,blockShape:[n.bands.length].concat(r.bandShape),buffer:r.buffer,codec:n.codec.codec,filters:n.filters.map((e=>e.filter))};r._blocksInProgress.add(i),t.push(a)}return new xv(t,(()=>{t.forEach((e=>r._blocksInProgress.delete(e.blockIndex)))}),((e,i)=>{if(t.forEach((e=>r._blocksInProgress.delete(e.blockIndex))),e)throw e;i.forEach((e=>{this.getLayer(e.layerName).processDecodedData(e)}))}))}}class yv{constructor({version:e,name:t,units:r,tilesize:i,pixel_format:n,buffer:o,data_index:s},a){if(this.version=e,1!==this.version)throw new Ux(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=t,this.units=r,this.tileSize=i,this.buffer=o,this.pixelFormat=fv[n],this.dataIndex=s,this.bandShape=[i+2*o,i+2*o,mv[this.pixelFormat]],this._decodedBlocks=function(e=1e3,t=0,r=!1){if(isNaN(e)||e<0)throw new TypeError("Invalid max value");if(isNaN(t)||t<0)throw new TypeError("Invalid ttl value");if("boolean"!=typeof r)throw new TypeError("Invalid resetTtl value");return new kx(e,t,r)}(a?a.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){const t=e.blockIndex.toString();this._decodedBlocks.get(t)||this._decodedBlocks.set(t,e.data)}getBlockForBand(e){let t=0;switch(typeof e){case"string":for(const[r,i]of this.dataIndex.entries()){for(const[n,o]of i.bands.entries())if(o===e)return{bandIndex:t+n,blockIndex:r,blockBandIndex:n};t+=i.bands.length}break;case"number":for(const[r,i]of this.dataIndex.entries()){if(e>=t&&e<t+i.bands.length)return{bandIndex:e,blockIndex:r,blockBandIndex:e-t};t+=i.bands.length}break;default:throw new Ux(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Ux(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let t=1/0,r=-1/0,i=1/0,n=-1/0;for(const o of e){const{blockIndex:e}=this.getBlockForBand(o);if(e<0)throw new Ux(`Invalid band: ${JSON.stringify(o)}`);const s=this.dataIndex[e];i=Math.min(i,e),n=Math.max(n,e),t=Math.min(t,s.first_byte),r=Math.max(r,s.last_byte)}return{layerName:this.name,firstByte:t,lastByte:r,firstBlock:i,lastBlock:n}}hasBand(e){const{blockIndex:t}=this.getBlockForBand(e);return t>=0}hasDataForBand(e){const{blockIndex:t}=this.getBlockForBand(e);return t>=0&&!!this._decodedBlocks.get(t.toString())}getBandView(e){const{blockIndex:t,blockBandIndex:r}=this.getBlockForBand(e),i=this._decodedBlocks.get(t.toString());if(!i)throw new Ux(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const n=this.dataIndex[t],o=this.bandShape.reduce(((e,t)=>e*t),1),s=r*o,a=i.subarray(s,s+o);return{data:a,bytes:new Uint8Array(a.buffer).subarray(a.byteOffset,a.byteOffset+a.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:n.offset,scale:n.scale}}}class xv{constructor(e,t,r){this.tasks=e,this._onCancel=t,this._onComplete=r,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,t){this._finalized||(this._onComplete(e,t),this._finalized=!0)}}gv.performDecoding=function(e,t){return Promise.all(t.tasks.map((t=>{const{layerName:r,firstByte:i,lastByte:n,pixelFormat:o,blockShape:s,blockIndex:a,filters:l,codec:c}=t,u=new Uint8Array(e).subarray(i,n+1),h=new Uint32Array(s[0]*s[1]*s[2]);let d;if("gzip_data"!==c)throw new Error(`Unhandled codec: ${c}`);return d=function(e,t){if(!globalThis.DecompressionStream&&"gzip_data"===t)return Promise.resolve(((o=function(e){31==e[0]&&139==e[1]&&8==e[2]||uv(6,"invalid gzip data");var t=e[3],r=10;4&t&&(r+=2+(e[10]|e[11]<<8));for(var i=(t>>3&1)+(t>>4&1);i>0;i-=!e[r++]);return r+(2&t)}(n=e))+8>n.length&&uv(6,"invalid gzip data"),function(e,t,r,i){var n=e.length;if(!n||t.f&&!t.l)return r||new Vx(0);var o=!r,s=o||2!=t.i,a=t.i;o&&(r=new Vx(3*n));var l=function(e){var t=r.length;if(e>t){var i=new Vx(Math.max(2*t,e));i.set(r),r=i}},c=t.f||0,u=t.p||0,h=t.b||0,d=t.l,p=t.d,f=t.m,m=t.n,_=8*n;do{if(!d){c=av(e,u,1);var g=av(e,u+1,3);if(u+=3,!g){var y=e[(C=4+((u+7)/8|0))-4]|e[C-3]<<8,x=C+y;if(x>n){a&&uv(0);break}s&&l(h+y),r.set(e.subarray(C,x),h),t.b=h+=y,t.p=u=8*x,t.f=c;continue}if(1==g)d=nv,p=ov,f=9,m=5;else if(2==g){var v=av(e,u,31)+257,b=av(e,u+10,15)+4,w=v+av(e,u+5,31)+1;u+=14;for(var T=new Vx(w),E=new Vx(19),S=0;S<b;++S)E[Zx[S]]=av(e,u+3*S,7);u+=3*b;var M=sv(E),A=(1<<M)-1,I=tv(E,M,1);for(S=0;S<w;){var C,P=I[av(e,u,A)];if(u+=15&P,(C=P>>4)<16)T[S++]=C;else{var L=0,R=0;for(16==C?(R=3+av(e,u,3),u+=2,L=T[S-1]):17==C?(R=3+av(e,u,7),u+=3):18==C&&(R=11+av(e,u,127),u+=7);R--;)T[S++]=L}}var D=T.subarray(0,v),O=T.subarray(v);f=sv(D),m=sv(O),d=tv(D,f,1),p=tv(O,m,1)}else uv(1);if(u>_){a&&uv(0);break}}s&&l(h+131072);for(var z=(1<<f)-1,k=(1<<m)-1,F=u;;F=u){var B=(L=d[lv(e,u)&z])>>4;if((u+=15&L)>_){a&&uv(0);break}if(L||uv(2),B<256)r[h++]=B;else{if(256==B){F=u,d=null;break}var N=B-254;B>264&&(N=av(e,u,(1<<(j=$x[S=B-257]))-1)+Xx[S],u+=j);var U=p[lv(e,u)&k],V=U>>4;if(U||uv(3),u+=15&U,O=Kx[V],V>3){var j=qx[V];O+=lv(e,u)&(1<<j)-1,u+=j}if(u>_){a&&uv(0);break}s&&l(h+131072);var G=h+N;if(h<O){var $=0-O,q=Math.min(O,G);for($+h<0&&uv(3);h<q;++h)r[h]=i[$+h]}for(;h<G;++h)r[h]=r[h-O]}}t.l=d,t.p=F,t.b=h,t.f=c,d&&(c=1,t.m=f,t.d=p,t.n=m)}while(!c);return h!=r.length&&o?function(e,t,r){return(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length),new Vx(e.subarray(t,r))}(r,0,h):r.subarray(0,h)}(n.subarray(o,-8),{i:2},new Vx(((r=n)[(i=r.length)-4]|r[i-3]<<8|r[i-2]<<16|r[i-1]<<24)>>>0),void 0)));var r,i,n,o;const s=pv[t];if(!s)throw new Error(`Unhandled codec: ${t}`);const a=new globalThis.DecompressionStream(s);return new Response(new Blob([e]).stream().pipeThrough(a)).arrayBuffer().then((e=>new Uint8Array(e)))}(u,c).then((e=>{const t=zx.read(new km(e));if("uint32_values"===t.values)return t.uint32_values.readValuesInto(h),new(0,_v[o])(h.buffer);throw new Error(`Unhandled numeric data "${t.values}"`)})),d.then((e=>{for(let t=l.length-1;t>=0;t--)switch(l[t]){case"delta_filter":Fx(e,s);break;case"zigzag_filter":Bx(e);break;case"bitshuffle_filter":Nx(e,o);break;default:throw new Error(`Unhandled filter "${l[t]}"`)}return{layerName:r,blockIndex:a,data:e}})).catch((e=>{throw e}))})))},ro(xv,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const vv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class bv{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,r]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const i=r>>4;if(1!==i)throw new Error(`Got v${i} data when expected v1.`);const n=vv[15&r];if(!n)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(e,2,1),[s]=new Uint32Array(e,4,1);return new bv(s,o,n,e)}constructor(e,t=64,r=Float64Array,i){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const n=vv.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,s=e*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(n<0)throw new Error(`Unexpected typed array class: ${r}.`);i&&i instanceof ArrayBuffer?(this.data=i,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+n]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=t,r}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return wv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,r,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:o,nodeSize:s}=this,a=[0,n.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const a=o[2*s],c=o[2*s+1];a>=e&&a<=r&&c>=t&&c<=i&&l.push(n[s])}continue}const d=h+u>>1,p=o[2*d],f=o[2*d+1];p>=e&&p<=r&&f>=t&&f<=i&&l.push(n[d]),(0===c?e<=p:t<=f)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?r>=p:i>=f)&&(a.push(d+1),a.push(u),a.push(1-c))}return l}within(e,t,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:n,nodeSize:o}=this,s=[0,i.length-1,0],a=[],l=r*r;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let r=h;r<=u;r++)Mv(n[2*r],n[2*r+1],e,t)<=l&&a.push(i[r]);continue}const d=h+u>>1,p=n[2*d],f=n[2*d+1];Mv(p,f,e,t)<=l&&a.push(i[d]),(0===c?e-r<=p:t-r<=f)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?e+r>=p:t+r>=f)&&(s.push(d+1),s.push(u),s.push(1-c))}return a}}function wv(e,t,r,i,n,o){if(n-i<=r)return;const s=i+n>>1;Tv(e,t,s,i,n,o),wv(e,t,r,i,s-1,1-o),wv(e,t,r,s+1,n,1-o)}function Tv(e,t,r,i,n,o){for(;n>i;){if(n-i>600){const s=n-i+1,a=r-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);Tv(e,t,r,Math.max(i,Math.floor(r-a*c/s+u)),Math.min(n,Math.floor(r+(s-a)*c/s+u)),o)}const s=t[2*r+o];let a=i,l=n;for(Ev(e,t,i,r),t[2*n+o]>s&&Ev(e,t,i,n);a<l;){for(Ev(e,t,a,l),a++,l--;t[2*a+o]<s;)a++;for(;t[2*l+o]>s;)l--}t[2*i+o]===s?Ev(e,t,i,l):(l++,Ev(e,t,l,n)),l<=r&&(i=l+1),r<=l&&(n=l-1)}}function Ev(e,t,r,i){Sv(e,r,i),Sv(t,2*r,2*i),Sv(t,2*r+1,2*i+1)}function Sv(e,t,r){const i=e[t];e[t]=e[r],e[r]=i}function Mv(e,t,r,i){const n=e-r,o=t-i;return n*n+o*o}e.$=Z_,e.A=zn,e.B=Rn,e.C=ir,e.D=$o,e.E=tt,e.F=Vo,e.G=Bo,e.H=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return q(e.expression.evaluate(t))}interpolate(e,t,r){return{x:ct(e.x,t.x,r),y:ct(e.y,t.y,r),z:ct(e.z,t.z,r),azimuthal:ct(e.azimuthal,t.azimuthal,r),polar:ct(e.polar,t.polar,r)}}},e.I=f_,e.J=Ro,e.K=Co,e.L=Tl,e.M=class{constructor(e,t,r,i){this.id=e,this.position=null!=t?new el(t[0],t[1]):new el(0,0),this.orientation=null!=r?r:[0,0,0],this.nodes=i,this.uploaded=!1,this.aabb=new Rh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,r){if(e.a6.multiply(t.matrix,r,t.matrix),t.meshes)for(const e of t.meshes){const r=Rh.applyTransform(e.aabb,t.matrix);this.aabb.encapsulate(r)}if(t.children)for(const e of t.children)this._applyTransformations(e,t.matrix)}computeBoundsAndApplyParent(){const t=e.a6.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(e,t,r,i,n,o,s=!1){xy(this.matrix,this,e.transform,this.position,t,r,i,n,o,s)}upload(e){if(!this.uploaded){for(const t of this.nodes)wy(t,e);for(const e of this.nodes)Ty(e);this.uploaded=!0}}destroy(){for(const e of this.nodes)Ey(e)}},e.O=A,e.P=g,e.Q=Fo,e.R=Ee,e.S=rd,e.T=Dg,e.U=ct,e.V=Lr,e.W=ut,e.X=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function([e,t]){const r=q([1,e,t]);return{x:r.x,y:r.y,z:r.z}}(e.expression.evaluate(t))}interpolate(e,t,r){return{x:ct(e.x,t.x,r),y:ct(e.y,t.y,r),z:ct(e.z,t.z,r)}}},e.Y=function(e,t,r=0,i=!0){const n=new g(r,r),o=e.sub(n),s=t.add(n),a=[o,new g(s.x,o.y),s,new g(o.x,s.y)];return i&&a.push(o.clone()),a},e.Z=Wn,e._=function(e,t){const r=[];for(let i=0;i<e.length;i++){const n=I(i-1,-1,e.length-1),o=I(i+1,-1,e.length-1),s=e[i],a=e[o],l=e[n].sub(s).unit(),c=a.sub(s).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*t/Math.sin(u/2));r.push(s.add(h))}return r},e.a=et,e.a$=function(e){const t=[];for(const r in e)t.push(e[r]);return t},e.a0=Zl,e.a1=function(t,r,i=0){return e.N.fromValues(((r.x-i)*t.scale-t.x)*Lr,(r.y*t.scale-t.y)*Lr,gl(r.z,r.y))},e.a2=Sh,e.a3=jf,e.a4=function(e){let t=1/0,r=1/0,i=-1/0,n=-1/0;for(const o of e)t=Math.min(t,o.x),r=Math.min(r,o.y),i=Math.max(i,o.x),n=Math.max(n,o.y);return{min:new g(t,r),max:new g(i,n)}},e.a5=dl,e.a8=ql,e.a9=Sl,e.aA=vn,e.aB=ra,e.aC=R,e.aD=$s,e.aE=Tg,e.aF=function(){Io.isLoading()||Io.isLoaded()||"deferred"!==Mo()||Ao()},e.aG=Zo,e.aH=Rl,e.aI=yx,e.aJ=W,e.aK=Nf,e.aL=ap,e.aM=Ll,e.aN=ps,e.aO=Fs,e.aP=kh,e.aQ=rp,e.aR=Rg,e.aS=function(t,r){const i=rd(r.zoom);if(0===i)return jh(t);const n=Zh(t),o=Wh(n),s=dl(n.getWest())*r.worldSize,a=dl(n.getEast())*r.worldSize,l=pl(n.getNorth())*r.worldSize,c=pl(n.getSouth())*r.worldSize,u=[s,l,0],h=[a,l,0],d=[s,c,0],p=[a,c,0],f=e.a6.invert([],r.globeMatrix);return e.N.transformMat4(u,u,f),e.N.transformMat4(h,h,f),e.N.transformMat4(d,d,f),e.N.transformMat4(p,p,f),o[0]=Gh(o[0],d,i),o[1]=Gh(o[1],p,i),o[2]=Gh(o[2],h,i),o[3]=Gh(o[3],u,i),Rh.fromPoints(o)},e.aT=Kh,e.aU=Hh,e.aV=Gh,e.aW=fs,e.aX=zh,e.aY=k,e.aZ=gv,e.a_=Ie,e.aa=M,e.ab=ja,e.ac=function(e,t){const r={};for(let i=0;i<t.length;i++){const n=t[i];n in e&&(r[n]=e[n])}return r},e.ad=tl,e.ae=pl,e.af=class{constructor(e){this.entries={},this.scheduler=e}request(e,t,r,i){const n=this.entries[e]=this.entries[e]||{callbacks:[]};if(n.result){const[e,r]=n.result;return this.scheduler?this.scheduler.add((()=>{i(e,r)}),t):i(e,r),()=>{}}return n.callbacks.push(i),n.cancel||(n.cancel=r(((r,i)=>{n.result=[r,i];for(const e of n.callbacks)this.scheduler?this.scheduler.add((()=>{e(r,i)}),t):e(r,i);setTimeout((()=>delete this.entries[e]),3e3)}))),()=>{n.result||(n.callbacks=n.callbacks.filter((e=>e!==i)),n.callbacks.length||(n.cancel(),delete this.entries[e]))}}},e.ag=os,e.ah=function(e,t,r){const i=JSON.stringify(e.request);return e.data&&(this.deduped.entries[i]={result:[null,e.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},(t=>{const i=Ie(e.request,((e,i,n,o)=>{e?t(e):i&&t(null,{vectorTile:r?void 0:new Ip(new km(i)),rawData:i,cacheControl:n,expires:o})}));return()=>{i.cancel(),t()}}),t)},e.ai=function(e){_e++,_e>he&&(e.getActor().send("enforceCacheSizeLimit",ue),_e=0)},e.aj=Ge,e.ak=oe,e.al=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.am=sl,e.an=Ug,e.ao=Gg,e.ap=Bg,e.aq=function(e,t){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){t(null,r)};for(let i=0;i<e.length;i++){const t=document.createElement("source");Ce(e[i])||(r.crossOrigin="Anonymous"),t.src=e[i],r.appendChild(t)}return{cancel:()=>{}}},e.ar=Og,e.as=q_,e.at=ml,e.au=_l,e.av=ms,e.aw=Ps,e.ax=lt,e.ay=hs,e.az=Bs,e.b=Qe,e.b$=To,e.b0=function(e,t){const r=[];for(const i in e)i in t||r.push(i);return r},e.b1=C,e.b2=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.b3=function(t,r){const{x:i,y:n}=t.point,o=td(i,n,t.worldSize/t._pixelsPerMercatorPixel,0,0);return e.a6.multiply(o,o,Jh(jh(r)))},e.b5=lm,e.b6=jm,e.b7=am,e.b8=function(e,t,r,i,n){const o=5*t+2;e.float32[o+0]=r,e.float32[o+1]=i,e.float32[o+2]=n},e.b9=xg,e.bA=Kg,e.bB=Xg,e.bC=function(t){const r=Xg(t,!0);return e.b4.invert([],[r[0],r[1],r[4],r[5]])},e.bD=Mh,e.bE=function(e){const{x:t,y:r}=e.point,{lng:i,lat:n}=e._center;return td(t,r,e.worldSize,i,n)},e.bF=b,e.bG=Ga,e.bH=function(e){const t=Math.round((e+45+360)%360/90)%4;return w[t]},e.bI=45,e.bJ=hl,e.bK=Sa,e.bL=va,e.bM=ba,e.bN=xa,e.bO=ya,e.bP=wa,e.bQ=function(e,t,r){const i=Math.sqrt(e*e+t*t+r*r),n=i>0?Math.acos(r/i)*x:0;let o=0!==e||0!==t?Math.atan2(-t,-e)*x+90:0;return o<0&&(o+=360),[i,o,n]},e.bR=wl,e.bS=Rh,e.bT=q,e.bU=function(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]},e.bV=function(e){return e({pluginStatus:bo,pluginURL:wo}),So.on("pluginStateChange",e),e},e.bW=Iy,e.bX=Oy,e.bY=b_,e.bZ=v_,e.b_=Me,e.ba=h_,e.bb=kl,e.bc=nm,e.bd=O_,e.be=z_,e.bf=Qm,e.bg=bv,e.bh=I,e.bj=v,e.bk=re,e.bl=fl,e.bm=function(e,t,r){e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]},e.bn=el,e.bo=pg,e.bp=ol,e.bq=Lh,e.br=Yg,e.bs=nl,e.bt=qh,e.bu=function(e,t,r,i,n,o,s,a,l){if("globe"===l.name)return qh(e,t,new nl(r,i,n),!1);const c=q_({z:r,x:i,y:n},l);return new Rh([(o+c.x/c.scale)*t,t*(c.y/c.scale),s],[(o+c.x2/c.scale)*t,t*(c.y2/c.scale),a])},e.bv=function(e,t,r){let i=0;for(let n=0;n<2;++n){const o=r?r[n]:0;e[n]>o&&(i+=(e[n]-o)*(e[n]-o)),t[n]<o&&(i+=(o-t[n])*(o-t[n]))}return i},e.bw=yl,e.bx=$a,e.by=function(t){const r=e.a6.identity(new Float64Array(16));e.a6.multiply(r,t.pixelMatrix,t.globeMatrix);const i=[0,Ha,0],n=[0,Xa,0];return e.N.transformMat4(i,i,r),e.N.transformMat4(n,n,r),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!nd(t,new el(t.center.lat,90)),n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!nd(t,new el(t.center.lat,-90))]},e.bz=function(t,r){const{scale:i}=t.tileTransform,n=i*Lr/(t.tileSize*Math.pow(2,r.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return e.b4.scale(new Float32Array(4),r.inverseAdjustmentMatrix,[n,n])},e.c=px,e.c$=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},e.c0=o,e.c1=U,e.c2=function(e,t,r){return"custom"===e.type?new $g(e,t):new Dx[e.type](e,t,r)},e.c3=function(e){const t=e.indexOf(ns);return t>=0?e.slice(0,t):e},e.c4=function(e){return e.indexOf(ns)>=0},e.c5=function(e){const t=e.indexOf(ns);return t>=0?e.slice(t+1):""},e.c6=function(e){const t=[],r=e.id;return void 0===r&&t.push({message:`layers.${r}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${r}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},e.c7=N,e.c8=So,e.c9=Ae,e.cA=qf,e.cB=(e,t,r,i,n,o)=>{const s=e.transform;return{u_matrix:$f(e,t,r,i),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:s.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:n,u_image:0,u_tile_units_to_pixels:Gf(t,s),u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:o}},e.cC=(e,t,r,i,n,o,s)=>{const a=e.transform,l=a.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:$f(e,t,r,i),u_pixels_to_tile_units:l,u_device_pixel_ratio:o,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:n,u_texsize:Zf(r)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Gf(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:s,u_emissive_strength:r.paint.get("line-emissive-strength")}},e.cD=O,e.cE=Ed,e.cF=Tf,e.cG=ll,e.cH=mf,e.cI=nf,e.cJ=450,e.cK=7,e.cL=Ng,e.cM=256,e.cN=Jh,e.cO=Os,e.cP=zs,e.cQ=function(e,t,r,i,n){return M((e-t)/(r-t)*(n-i)+i,i,n)},e.cR=vl,e.cS=iy,e.cT=[1,1,1],e.cU=Yp,e.cV=yy,e.cW=Ss,e.cX=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){const t=Op(new g(0,0),new g(Lr,Lr),e),r=[];for(const i of this._activeRegions){if(i.hiddenByOverlap)continue;if(!Dp(t,i))continue;const n=zp(i.min,i.max,e);r.push({min:n.min,max:n.max,sourceId:this._sourceIds[i.priority],footprint:i.footprint,footprintTileId:i.tileId})}return r}setSources(e){this._setSources(e.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const t=[];for(const r of e.cache.getVisibleCoordinates()){const i=e.cache.getTile(r).buckets[e.layer];if(i)for(const e of i.getNodesInfo()){const i=e.node;i.footprint&&t.push({footprint:i.footprint,id:r.toUnwrapped()})}}return t}}))))}_addSource(e){const t=e.getFootprints();if(0!==t.length){for(const e of t){if(!e.footprint)continue;const t=Op(e.footprint.min,e.footprint.max,e.id);this._activeRegions.push({min:t.min,max:t.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:e.id,footprint:e.footprint})}this._sourceIds.push(e.getSourceId())}}_computeReplacement(){this._activeRegions.sort(((e,t)=>e.priority-t.priority||Lp(e.min,t.min)||Lp(e.max,t.max)));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let t=0,r=0;for(;!e&&t!==this._activeRegions.length;){const i=this._activeRegions[t],n=this._prevRegions[r];e=i.priority!==n.priority||!Rp(i,n),++t,++r}}if(e){++this._updateTime;const e=e=>{const t=this._activeRegions;if(e>=t.length)return e;const r=t[e].priority;for(;e<t.length&&t[e].priority===r;)++e;return e};if(this._sourceIds.length>1){let t=0,r=e(t);for(;t!==r;){let i=t;const n=t;for(;i!==r;){const e=this._activeRegions[i];e.hiddenByOverlap=!1;for(let t=0;t<n;t++){const r=this._activeRegions[t];if(!r.hiddenByOverlap&&Dp(e,r)&&(e.hiddenByOverlap=Fp(e.footprint,e.tileId,r.footprint,r.tileId),e.hiddenByOverlap))break}++i}t=r,r=e(t)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=e.length-1;t>=0;t--)this._addSource(e[t]);this._computeReplacement()}},e.cY=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,t){const r=new ps,i=new Ps,n=[],o=e+1+2,s=t[0]+1,a=t[0]+1+(1+t.length),l=(e,t,r)=>{let i=e===o-1?e-2:0===e?e:e-1;return i+=r?24575:0,[i,t]};for(let c=0;c<o;++c)r.emplaceBack(...l(c,0,!0));for(let c=0;c<s;++c)for(let e=0;e<o;++e)r.emplaceBack(...l(e,c,(0===e||e===o-1)&&!0));for(let c=0;c<t.length;++c){const e=t[c];for(let t=0;t<o;++t)r.emplaceBack(...l(t,e,!0))}for(let c=0;c<t.length;++c){const e=i.length,s=t[c]+1+2,l=new Ps;for(let r=0;r<s-1;r++){const e=r===s-2,n=e?o*(a-t.length+c-r):o;for(let t=0;t<o-1;t++){const s=r*o+t;0===r||e||0===t||t===o-2?(l.emplaceBack(s+1,s,s+n),l.emplaceBack(s+n,s+n+1,s+1)):(i.emplaceBack(s+1,s,s+n),i.emplaceBack(s+n,s+n+1,s+1))}}const u=ra.simpleSegment(0,e,r.length,i.length-e);for(let t=0;t<l.uint16.length;t+=3)i.emplaceBack(l.uint16[t],l.uint16[t+1],l.uint16[t+2]);const h=ra.simpleSegment(0,e,r.length,i.length-e);n.push({withoutSkirts:u,withSkirts:h})}return{vertices:r,indices:i,segments:n}}_createGrid(e){const t=this._fillGridMeshWithLods(Za,Wa);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,kh.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const t=new Ps;for(let s=0;s<=Za;s++)t.emplaceBack(0,s+1,s+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const r=new Os,i=new Os,n=new Os,o=new Os;this._poleSegments=[];for(let s=0,a=0;s<Ga;s++){const e=360/(1<<s);r.emplaceBack(0,-ja,0,.5,0),i.emplaceBack(0,-ja,0,.5,1),n.emplaceBack(0,-ja,0,.5,.5),o.emplaceBack(0,-ja,0,.5,.5);for(let t=0;t<=Za;t++){let s=t/Za,a=0;const l=ct(0,e,s),[c,u,h]=Ya(sd,ad,l,ja);r.emplaceBack(c,u,h,s,a),i.emplaceBack(c,u,h,s,1-a);const d=v(l);s=.5+.5*Math.sin(d),a=.5+.5*Math.cos(d),n.emplaceBack(c,u,h,s,a),o.emplaceBack(c,u,h,s,1-a)}this._poleSegments.push(ra.simpleSegment(a,0,66,64)),a+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(r,Oh,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(i,Oh,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(n,Oh,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(o,Oh,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}},e.cZ=function(e){return Ye.has(e)},e.c_=E,e.ca=Ta,e.cb=class extends ga{constructor(e){super(e),this.current=Ma}set(e,t,r){if(this.fetchUniformLocation(e,t))for(let i=0;i<9;i++)if(r[i]!==this.current[i]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}},e.cc=T,e.cd=function(e,t,r){const i=rd(r.zoom),n=e.style.map._antialias,o=t.options.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return 0===i&&!n&&!o},e.ce=function(t){const r=t.pixelsPerMeter,i=r/fl(1,t.center.lat),n=e.a6.identity(new Float64Array(16));return e.a6.translate(n,n,[t.point.x,t.point.y,0]),e.a6.scale(n,n,[i,i,r]),Float32Array.from(n)},e.cf=Zh,e.cg=function(e){const t=yl-5;e=M(e,-t,t)/t*90;const r=Math.pow(Math.abs(Math.sin(v(e))),3);return Math.round(r*(Wa.length-1))},e.ch=function(t,r,i,n){const o=r.getNorth(),s=r.getSouth(),a=r.getWest(),l=r.getEast(),c=1<<t.z,u=l-a,h=o-s,d=u/Za,p=-h/Wa[i],f=[0,d,0,p,0,0,o,a,0];if(t.z>0){const t=180/n;e.co.multiply(f,f,[t/u+1,0,0,0,t/h+1,0,-.5*t/d,.5*t/p,1])}return f[2]=c,f[5]=t.x,f[8]=t.y,f},e.ci=jh,e.cj=function(t,r,i){const n=e.a6.identity(new Float64Array(16)),o=(r/(1<<t)-.5)*Math.PI*2;return e.a6.rotateY(n,i.globeMatrix,o),Float32Array.from(n)},e.ck=class{isDataAvailableAtPoint(e){const t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;const r=t.getSource().maxzoom,i=1<<r,n=Math.floor(e.x),o=Math.floor((e.x-n)*i),s=Math.floor(e.y*i),a=this.findDEMTileFor(new sl(r,n,r,o,s));return!(!a||!a.dem)}getAtPointOrZero(e,t=0){return this.getAtPoint(e,t)||0}getAtPoint(e,t,r=!0){if(this.isUsingMockSource())return null;null==t&&(t=null);const i=this._source();if(!i)return t;if(e.y<0||e.y>1)return t;const n=i.getSource().maxzoom,o=1<<n,s=Math.floor(e.x),a=e.x-s,l=new sl(n,s,n,Math.floor(a*o),Math.floor(e.y*o)),c=this.findDEMTileFor(l);if(!c||!c.dem)return t;const u=c.dem,h=1<<c.tileID.canonical.z,d=(a*h-c.tileID.canonical.x)*u.dim,p=(e.y*h-c.tileID.canonical.y)*u.dim,f=Math.floor(d),m=Math.floor(p);return(r?this.exaggeration():1)*ct(ct(u.get(f,m),u.get(f,m+1),p-m),ct(u.get(f+1,m),u.get(f+1,m+1),p-m),d-f)}getAtTileOffset(e,t,r){const i=1<<e.canonical.z;return this.getAtPointOrZero(new Tl(e.wrap+(e.canonical.x+t/Lr)/i,(e.canonical.y+r/Lr)/i))}getAtTileOffsetFunc(t,r,i,n){return o=>{const s=this.getAtTileOffset(t,o.x,o.y),a=n.upVector(t.canonical,o.x,o.y),l=n.upVectorScale(t.canonical,r,i).metersToTile;return e.N.scale(a,a,s*l),a}}getForTilePoints(e,t,r,i){if(this.isUsingMockSource())return!1;const n=Yp.create(this,e,i);return!!n&&(t.forEach((e=>{e[2]=this.exaggeration()*n.getElevationAt(e[0],e[1],r)})),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const r=t.dem.tree,i=t.tileID,n=1<<e.canonical.z-i.canonical.z;let o=e.canonical.x/n-i.canonical.x,s=e.canonical.y/n-i.canonical.y,a=0;for(let l=0;l<e.canonical.z-i.canonical.z&&!r.leaves[a];l++){o*=2,s*=2;const e=2*Math.floor(s)+Math.floor(o);a=r.childOffsets[a]+e,o%=1,s%=1}return{min:this.exaggeration()*r.minimums[a],max:this.exaggeration()*r.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,r){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const e=this.visibleDemTiles;if(0===e.length)return null;let t=!1,r=Number.MAX_VALUE,i=Number.MIN_VALUE;for(const n of e){const e=this.getMinMaxForTile(n.tileID);e&&(r=Math.min(r,e.min),i=Math.max(i,e.max),t=!0)}return t?{min:r,max:i}:null}},e.cl=Fh,e.cm=bd,e.cn=function(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]},e.cp=ed,e.cq=256,e.cr=function(t,r){const i=[0,0,0],n=Kh(jh(r.canonical));return e.N.transformMat4(i,i,n),e.N.transformMat4(i,i,t),i},e.cs=e=>({u_camera_to_center_distance:new xa(e),u_extrude_scale:new Ia(e),u_device_pixel_ratio:new xa(e),u_matrix:new Sa(e),u_inv_rot_matrix:new Sa(e),u_merc_center:new va(e),u_tile_id:new ba(e),u_zoom_transition:new xa(e),u_up_dir:new ba(e),u_emissive_strength:new xa(e)}),e.ct=e=>({u_matrix:new Sa(e),u_pixels_to_tile_units:new Ia(e),u_device_pixel_ratio:new xa(e),u_units_to_pixels:new va(e),u_dash_image:new ya(e),u_gradient_image:new ya(e),u_image_height:new xa(e),u_texsize:new va(e),u_tile_units_to_pixels:new xa(e),u_alpha_discard_threshold:new xa(e),u_trim_offset:new va(e),u_emissive_strength:new xa(e)}),e.cu=e=>({u_matrix:new Sa(e),u_texsize:new va(e),u_pixels_to_tile_units:new Ia(e),u_device_pixel_ratio:new xa(e),u_image:new ya(e),u_units_to_pixels:new va(e),u_tile_units_to_pixels:new xa(e),u_alpha_discard_threshold:new xa(e),u_trim_offset:new va(e)}),e.cv=Is,e.cw=im,e.cx=cm,e.cy=cd,e.cz=(e,t,r,i,n,o)=>{const s=e.transform,a="globe"===s.projection.name;let l;if("map"===o.paint.get("circle-pitch-alignment"))if(a){const e=ed(s.zoom,t.canonical)*s._pixelsPerMercatorPixel;l=Float32Array.from([e,0,0,e])}else l=s.calculatePixelsToTileUnitsMatrix(r);else l=new Float32Array([s.pixelsToGLUnits[0],0,0,s.pixelsToGLUnits[1]]);const c={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(s.projection),u_matrix:e.translatePosMatrix(t.projMatrix,r,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_device_pixel_ratio:se.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:ld,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:o.paint.get("circle-emissive-strength")};if(a){c.u_inv_rot_matrix=i,c.u_merc_center=n,c.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],c.u_zoom_transition=rd(s.zoom);const e=n[0]*Lr,r=n[1]*Lr;c.u_up_dir=s.projection.upVector(new nl(0,0,0),e,r)}return c},e.d=De,e.d0=S,e.d1=bl,e.d2=Ka,e.d3=function([e,t,r]){const i=Math.hypot(e,t,r),n=Math.atan2(e,r),o=.5*Math.PI-Math.acos(-t/i);return new el(b(n),b(o))},e.d4=Ja,e.d5=i,e.d6=nd,e.d7=id,e.d8=function(t){const r=[0,0,0],i=e.a6.identity(new Float64Array(16));return e.a6.multiply(i,t.pixelMatrix,t.globeMatrix),e.N.transformMat4(r,r,i),new g(r[0],r[1])},e.d9=function(e){const t=e.navigator?e.navigator.userAgent:null;return!!function(e){if(null==ee){const t=e.navigator?e.navigator.userAgent:null;ee=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return ee}(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},e.dA=x_,e.dB=_x,e.dC=xx,e.dD=kf,e.dE=B,e.dF=m_,e.dG=function(e,t,r,i,n,o,s,a,l,c,u){e.createArrays(),e.tilePixelRatio=Lr/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const h=e.layers[0].layout,d=e.layers[0]._unevaluatedLayout._values,p={};if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:r}=e.textSizeData;p.compositeTextSizes=[d["text-size"].possiblyEvaluate(new Co(t),a),d["text-size"].possiblyEvaluate(new Co(r),a)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:r}=e.iconSizeData;p.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new Co(t),a),d["icon-size"].possiblyEvaluate(new Co(r),a)]}p.layoutTextSize=d["text-size"].possiblyEvaluate(new Co(l+1),a),p.layoutIconSize=d["icon-size"].possiblyEvaluate(new Co(l+1),a),p.textMaxSize=d["text-size"].possiblyEvaluate(new Co(18),a);const f="map"===h.get("text-rotation-alignment")&&"point"!==h.get("symbol-placement"),m=h.get("text-size");let _=!1;for(const g of e.features)if(g.icon&&g.icon.nameSecondary){_=!0;break}for(const g of e.features){const o=h.get("text-font").evaluate(g,{},a).join(","),l=m.evaluate(g,{},a),d=p.layoutTextSize.evaluate(g,{},a),y=(p.layoutIconSize.evaluate(g,{},a),{horizontal:{},vertical:void 0}),x=g.text;let v,b=[0,0];if(x){const i=x.toString(),s=h.get("text-letter-spacing").evaluate(g,{},a)*nm,c=h.get("text-line-height").evaluate(g,{},a)*nm,u=co(i)?s:0,p=h.get("text-anchor").evaluate(g,{},a),m=h.get("text-variable-anchor");if(!m){const e=h.get("text-radial-offset").evaluate(g,{},a);b=e?O_(p,[e*nm,R_]):h.get("text-offset").evaluate(g,{},a).map((e=>e*nm))}let _=f?"center":h.get("text-justify").evaluate(g,{},a);const v="point"===h.get("symbol-placement"),w=v?h.get("text-max-width").evaluate(g,{},a)*nm:1/0,T=s=>{e.allowVerticalPlacement&&lo(i)&&(y.vertical=qm(x,t,r,n,o,w,c,p,s,u,b,jm.vertical,!0,d,l))};if(!f&&m){const e="auto"===_?m.map((e=>z_(e))):[_];let i=!1;for(let s=0;s<e.length;s++){const a=e[s];if(!y.horizontal[a])if(i)y.horizontal[a]=y.horizontal[0];else{const e=qm(x,t,r,n,o,w,c,"center",a,u,b,jm.horizontal,!1,d,l);e&&(y.horizontal[a]=e,i=1===e.positionedLines.length)}}T("left")}else{if("auto"===_&&(_=z_(p)),v||h.get("text-writing-mode").indexOf("horizontal")>=0||!lo(i)){const e=qm(x,t,r,n,o,w,c,p,_,u,b,jm.horizontal,!1,d,l);e&&(y.horizontal[_]=e)}T(v?"left":_)}}let w=!1;if(g.icon&&g.icon.namePrimary){const t=i[g.icon.namePrimary];t&&(v=t_(n[g.icon.namePrimary],g.icon.nameSecondary?n[g.icon.nameSecondary]:void 0,h.get("icon-offset").evaluate(g,{},a),h.get("icon-anchor").evaluate(g,{},a)),w=t.sdf,void 0===e.sdfIcons?e.sdfIcons=t.sdf:e.sdfIcons!==t.sdf&&j("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.pixelRatio||0!==h.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const T=U_(y.horizontal)||y.vertical;e.iconsInText||(e.iconsInText=!!T&&T.iconsInText),(T||v)&&k_(e,g,y,v,i,p,d,0,b,w,s,a,c,u,_)}o&&e.generateCollisionDebugBuffers(l,e.collisionBoxArray)},e.dH=Ip,e.dI=km,e.dJ=Xp,e.dK=h,e.dL=Cp,e.dM=_p,e.dN=m,e.dO=mm,e.dP=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==Ky){const r=new Uint32Array(e,0,7),[,,i,n,o,s]=r;t=r.byteLength+n+o+s+o,(i!==e.byteLength||t>=e.byteLength)&&j("Invalid b3dm header information.")}return ix(e,t)},e.dQ=function(e,t){const r=px(e);for(const i of r){for(const e of i.meshes)fx(e);i.lights&&(i.lightMeshIndex=i.meshes.length,i.meshes.push(mx(i.lights,t)))}return r},e.dR=Ix,e.dS=Ay,e.dT=Io,e.dU=function(e){pe(),le&&le.then((t=>{t.keys().then((r=>{for(let i=0;i<r.length-e;i++)t.delete(r[i])}))}))},e.da=class{constructor(e,t,r){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Oe,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,r){if(!o(e))return e;const i=Fe(e);return i.params.push(`sdk=js-${t}`),i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||r)}normalizeGlyphsURL(e,t){if(!o(e))return e;const r=Fe(e);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||t)}normalizeModelURL(e,t){if(!o(e))return e;const r=Fe(e);return r.path=`/models/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||t)}normalizeSourceURL(e,t,r,i){if(!o(e))return e;const n=Fe(e);return n.path=`/v4/${n.authority}.json`,n.params.push("secure"),r&&n.params.push(`language=${r}`),i&&n.params.push(`worldview=${i}`),this._makeAPIURL(n,this._customAccessToken||t)}normalizeSpriteURL(e,t,r,i){const n=Fe(e);return o(e)?(n.path=`/styles/v1${n.path}/sprite${t}${r}`,this._makeAPIURL(n,this._customAccessToken||i)):(n.path+=`${t}${r}`,Be(n))}normalizeTileURL(e,t,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!o(e))return e;const n=Fe(e);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||r&&"raster"!==n.authority&&512===r?"@2x":""}${ge.supported?".webp":"$1"}`),"raster"===n.authority?n.path=`/${i.RASTER_URL_PREFIX}${n.path}`:"rasterarrays"===n.authority?n.path=`/${i.RASTERARRAYS_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${i.TILE_URL_VERSION}${n.path}`);const s=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(n.params)||i.ACCESS_TOKEN;return i.REQUIRE_ACCESS_TOKEN&&s&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,s)}canonicalizeTileURL(e,t){const r=Fe(e);if(!r.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!r.path.match(/\.[\w]+$/))return e;let n="mapbox://";r.path.match(/^\/raster\/v1\//)?n+=`raster/${r.path.replace(`/${i.RASTER_URL_PREFIX}/`,"")}`:r.path.match(/^\/rasterarrays\/v1\//)?n+=`rasterarrays/${r.path.replace(`/${i.RASTERARRAYS_URL_PREFIX}/`,"")}`:n+=`tiles/${r.path.replace(`/${i.TILE_URL_VERSION}/`,"")}`;let o=r.params;return t&&(o=o.filter((e=>!e.match(/^access_token=/)))),o.length&&(n+=`?${o.join("&")}`),n}canonicalizeTileset(e,t){const r=!!t&&o(t),i=[];for(const o of e.tiles||[])n(o)?i.push(this.canonicalizeTileURL(o,r)):i.push(o);return i}_makeAPIURL(e,t){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",n=Fe(i.API_URL);if(e.protocol=n.protocol,e.authority=n.authority,"http"===e.protocol){const t=e.params.indexOf("secure");t>=0&&e.params.splice(t,1)}if("/"!==n.path&&(e.path=`${n.path}${e.path}`),!i.REQUIRE_ACCESS_TOKEN)return Be(e);if(t=t||i.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return e.params=e.params.filter((e=>-1===e.indexOf("access_token"))),e.params.push(`access_token=${t||""}`),Be(e)}},e.db=function(e,t){t?Ye.add(e):Ye.delete(e)},e.dc=ge,e.dd=We,e.de=Xe,e.df=ze,e.dg=qe,e.dh=function(e){Ye.delete(e)},e.di=He,e.dj=$e,e.dk=t,e.dl=function(e,t){ue=e,he=t},e.dm=function(e,t,r=!1){if(bo===go||bo===yo||bo===xo)throw new Error("setRTLTextPlugin cannot be called multiple times.");wo=se.resolveURL(e),bo=go,vo=t,Eo(),r||Ao()},e.dn=Mo,e.dp=function(){Oy().acquire(Ly)},e.dq=function(){const e=Dy;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(Ly),Dy=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},e.dr=Ry,e.ds=function(e){const t=de();if(!t)return;const r=t.delete(ae);e&&r.catch(e).then((()=>e()))},e.dt=Cy,e.du=Vy,e.dv=function(e){ky=se.resolveURL(e),Uy||(Uy=new Iy(Oy(),new tt)),Uy.broadcast("setDracoUrl",ky)},e.dw=jy,e.dx=function(e){By=se.resolveURL(e),Uy||(Uy=new Iy(Oy(),new tt)),Uy.broadcast("setMeshoptUrl",By)},e.dy=ro,e.dz=xd,e.e=P,e.f=se,e.g=function(e,t){return Ae(P(e,{type:"json"}),t)},e.h=vd,e.i=Xt,e.j=dt,e.k=Ln,e.l=function(e){return fetch(e).then((e=>e.arrayBuffer())).then((t=>ix(t,0,e)))},e.m=Dn,e.n=$n,e.o=Go,e.p=d_,e.q=Hn,e.r=qn,e.s=On,e.t=fi,e.u=jo,e.v=_i,e.w=j,e.x=pi,e.z=qo})),i(["./shared"],(function(e){function t(e){const t=e?e.url.toString():void 0;return t?performance.getEntriesByName(t):[]}function r(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let t="[";for(const i of e)t+=`${r(i)},`;return`${t}]`}let t="{";for(const i of Object.keys(e).sort())t+=`${i}:${r(e[i])},`;return`${t}}`}function i(t){let i="";for(const n of e.b2)i+=`/${r(t[n])}`;return i}class n{constructor(e){this.keyCache={},this._layers={},this._layerConfigs={},e&&this.replace(e)}replace(e,t){this._layerConfigs={},this._layers={},this.update(e,[],t)}update(t,r,n){this._options=n;for(const i of t)this._layerConfigs[i.id]=i,(this._layers[i.id]=e.c2(i,this.scope,this._options)).compileFilter(),this.keyCache[i.id]&&delete this.keyCache[i.id];for(const e of r)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const o=function(e,t){const r={};for(let o=0;o<e.length;o++){const n=t&&t[e[o].id]||i(e[o]);t&&(t[e[o].id]=n);let s=r[n];s||(s=r[n]=[]),s.push(e[o])}const n=[];for(const i in r)n.push(r[i]);return n}(e.a$(this._layerConfigs),this.keyCache);for(const e of o){const t=e.map((e=>this._layers[e.id])),r=t[0];if("none"===r.visibility)continue;const i=r.source||"";let n=this.familiesBySource[i];n||(n=this.familiesBySource[i]={});const o=r.sourceLayer||"_geojsonTileLayer";let s=n[o];s||(s=n[o]=[]),s.push(t)}}}const o=1*e.dA;class s{constructor(t){const r={},i=[];for(const e in t){const n=t[e],s=r[e]={};for(const e in n.glyphs){const t=n.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const r=t.metrics.localGlyph?o:1,a={x:0,y:0,w:t.bitmap.width+2*r,h:t.bitmap.height+2*r};i.push(a),s[e]=a}}const{w:n,h:s}=e.p(i),a=new e.dz({width:n||1,height:s||1});for(const l in t){const i=t[l];for(const t in i.glyphs){const n=i.glyphs[+t];if(!n||0===n.bitmap.width||0===n.bitmap.height)continue;const s=r[l][t],c=n.metrics.localGlyph?o:1;e.dz.copy(n.bitmap,a,{x:0,y:0},{x:s.x+c,y:s.y+c},n.bitmap)}}this.image=a,this.positions=r}}e.dy(s,"GlyphAtlas");class a{constructor(t){this.tileID=new e.am(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=e.as(t.tileID.canonical,t.projection),this.projection=t.projection,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster}parse(t,r,i,n,o){this.status="parsing",this.data=t,this.collisionBoxArray=new e.aD;const a=new e.dB(Object.keys(t.layers).sort()),c=new e.dC(this.tileID,this.promoteId);c.bucketLayerIDs=[];const u={},h=new e.dD(256,256),d={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:h,availableImages:i,brightness:this.brightness},p=r.familiesBySource[this.source];for(const s in p){const r=t.layers[s];if(!r)continue;let n=!1,o=!1,h=!1;for(const e of p[s])"symbol"===e[0].type?n=!0:o=!0,e[0].is3D()&&"model"!==e[0].type&&(h=!0);if(this.extraShadowCaster&&!h)continue;if(!0===this.isSymbolTile&&!n)continue;if(!1===this.isSymbolTile&&!o)continue;1===r.version&&e.w(`Vector tile source "${this.source}" layer "${s}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const f=a.encode(s),m=[];for(let e=0;e<r.length;e++){const t=r.feature(e),i=c.getId(t,s);m.push({feature:t,id:i,index:e,sourceLayerIndex:f})}for(const e of p[s]){const t=e[0];(!this.extraShadowCaster||t.is3D()&&"model"!==t.type)&&(void 0!==this.isSymbolTile&&"symbol"===t.type!==this.isSymbolTile||t.minzoom&&this.zoom<Math.floor(t.minzoom)||t.maxzoom&&this.zoom>=t.maxzoom||"none"!==t.visibility&&(l(e,this.zoom,d.brightness,i),(u[t.id]=t.createBucket({index:c.bucketLayerIDs.length,layers:e,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:f,sourceID:this.source,projection:this.projection.spec})).populate(m,d,this.tileID.canonical,this.tileTransform),c.bucketLayerIDs.push(e.map((e=>e.id)))))}}let f,m,_,g;h.trim();const y={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},x=()=>{if(f)return this.status="done",o(f);if(this.extraShadowCaster)this.status="done",o(null,{buckets:e.a$(u).filter((e=>!e.isEmpty())),featureIndex:c,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:d.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(m&&_&&g){const t=new s(m),r=new e.dF(_,g);for(const n in u){const o=u[n];o instanceof e.aE?(l(o.layers,this.zoom,d.brightness,i),e.dG(o,m,t.positions,_,r.iconPositions,this.showCollisionBoxes,i,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):o.hasPattern&&(o instanceof e.aK||o instanceof e.aL||o instanceof e.cH)&&(l(o.layers,this.zoom,d.brightness,i),o.addFeatures(d,this.tileID.canonical,r.patternPositions,i,this.tileTransform,this.brightness))}this.status="done",o(null,{buckets:e.a$(u).filter((e=>!e.isEmpty())),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,lineAtlas:h,imageAtlas:r,brightness:d.brightness})}};if(!this.extraShadowCaster){const t=e.dE(d.glyphDependencies,(e=>Object.keys(e).map(Number)));Object.keys(t).length?n.send("getGlyphs",{uid:this.uid,stacks:t,scope:this.scope},((e,t)=>{f||(f=e,m=t,x())}),void 0,!1,y):m={};const r=Object.keys(d.iconDependencies);r.length?n.send("getImages",{icons:r,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((e,t)=>{f||(f=e,_=t,x())}),void 0,!1,y):_={};const i=Object.keys(d.patternDependencies);i.length?n.send("getImages",{icons:i,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((e,t)=>{f||(f=e,g=t,x())}),void 0,!1,y):g={}}x()}}function l(t,r,i,n){const o=new e.K(r,{brightness:i});for(const e of t)e.recalculate(o,n)}class c extends e.E{constructor(t,r,i,n,o,s){super(),this.actor=t,this.layerIndex=r,this.availableImages=i,this.loadVectorData=o||e.ah,this.loading={},this.loaded={},this.deduped=new e.af(t.scheduler),this.isSpriteLoaded=n,this.scheduler=t.scheduler,this.brightness=s}loadTile(r,i){const n=r.uid,o=r&&r.request,s=o&&o.collectResourceTiming,l=this.loading[n]=new a(r);l.abort=this.loadVectorData(r,((a,c)=>{const u=!this.loading[n];if(delete this.loading[n],u||a||!c)return l.status="done",u||(this.loaded[n]=l),i(a);const h=c.rawData,d={};c.expires&&(d.expires=c.expires),c.cacheControl&&(d.cacheControl=c.cacheControl),l.vectorTile=c.vectorTile||new e.dH(new e.dI(h));const p=()=>{l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.actor,((r,n)=>{if(r||!n)return i(r);const a={};if(s){const e=t(o);e.length>0&&(a.resourceTiming=JSON.parse(JSON.stringify(e)))}i(null,e.e({rawTileData:h.slice(0)},n,d,a))}))};this.isSpriteLoaded?p():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(p,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom}):p()})),this.loaded=this.loaded||{},this.loaded[n]=l}))}reloadTile(t,r){const i=this.loaded,n=t.uid,o=this;if(i&&i[n]){const s=i[n];s.showCollisionBoxes=t.showCollisionBoxes,s.projection=t.projection,s.brightness=t.brightness,s.tileTransform=e.as(t.tileID.canonical,t.projection),s.extraShadowCaster=t.extraShadowCaster;const a=(e,t)=>{const i=s.reloadCallback;i&&(delete s.reloadCallback,s.parse(s.vectorTile,o.layerIndex,this.availableImages,o.actor,i)),r(e,t)};"parsing"===s.status?s.reloadCallback=a:"done"===s.status&&(s.vectorTile?s.parse(s.vectorTile,this.layerIndex,this.availableImages,this.actor,a):a())}else r(null,void 0)}abortTile(e,t){const r=e.uid,i=this.loading[r];i&&(i.abort&&i.abort(),delete this.loading[r]),t()}removeTile(e,t){const r=this.loaded,i=e.uid;r&&r[i]&&delete r[i],t()}}class u{loadTile(t,r){const{uid:i,encoding:n,rawImageData:o,padding:s}=t,a=ImageBitmap&&o instanceof ImageBitmap?this.getImageData(o,s):o;r(null,new e.dJ(i,a,n,s<1))}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const r=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),r}}class h{decodeRasterArray({task:t,buffer:r},i){e.aZ.performDecoding(r,t).then((e=>{i(null,e)}),(e=>{i(e)}))}}function d(e,t){if(0!==e.length){p(e[0],t);for(var r=1;r<e.length;r++)p(e[r],!t)}}function p(e,t){for(var r=0,i=0,n=0,o=e.length,s=o-1;n<o;s=n++){var a=(e[n][0]-e[s][0])*(e[s][1]+e[n][1]),l=r+a;i+=Math.abs(r)>=Math.abs(a)?r-l+a:a-l+r,r=l}r+i>=0!=!!t&&e.reverse()}var f=e.dK((function e(t,r){var i,n=t&&t.type;if("FeatureCollection"===n)for(i=0;i<t.features.length;i++)e(t.features[i],r);else if("GeometryCollection"===n)for(i=0;i<t.geometries.length;i++)e(t.geometries[i],r);else if("Feature"===n)e(t.geometry,r);else if("Polygon"===n)d(t.coordinates,r);else if("MultiPolygon"===n)for(i=0;i<t.coordinates.length;i++)d(t.coordinates[i],r);return t}));const m=e.dL.prototype.toGeoJSON;let _=class{constructor(t){this._feature=t,this.extent=e.V,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const r of this._feature.geometry)t.push([new e.P(r[0],r[1])]);return t}{const t=[];for(const r of this._feature.geometry){const i=[];for(const t of r)i.push(new e.P(t[0],t[1]));t.push(i)}return t}}toGeoJSON(e,t,r){return m.call(this,e,t,r)}},g=class{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.V,this.length=t.length,this._features=t}feature(e){return new _(this._features[e])}};var y={exports:{}},x=e.dN,v=e.dM.VectorTileFeature,b=w;function w(e,t){this.options=t||{},this.features=e,this.length=e.length}function T(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}w.prototype.feature=function(e){return new T(this.features[e],this.options.extent)},T.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var r=e[t],i=[],n=0;n<r.length;n++)i.push(new x(r[n][0],r[n][1]));this.geometry.push(i)}return this.geometry},T.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,r=-1/0,i=1/0,n=-1/0,o=0;o<e.length;o++)for(var s=e[o],a=0;a<s.length;a++){var l=s[a];t=Math.min(t,l.x),r=Math.max(r,l.x),i=Math.min(i,l.y),n=Math.max(n,l.y)}return[t,i,r,n]},T.prototype.toGeoJSON=v.prototype.toGeoJSON;var E=e.dO,S=b;function M(e){var t=new E;return function(e,t){for(var r in e.layers)t.writeMessage(3,A,e.layers[r])}(e,t),t.finish()}function A(e,t){var r;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var i={keys:[],values:[],keycache:{},valuecache:{}};for(r=0;r<e.length;r++)i.feature=e.feature(r),t.writeMessage(2,I,i);var n=i.keys;for(r=0;r<n.length;r++)t.writeStringField(3,n[r]);var o=i.values;for(r=0;r<o.length;r++)t.writeMessage(4,D,o[r])}function I(e,t){var r=e.feature;void 0!==r.id&&t.writeVarintField(1,r.id),t.writeMessage(2,C,e),t.writeVarintField(3,r.type),t.writeMessage(4,R,r)}function C(e,t){var r=e.feature,i=e.keys,n=e.values,o=e.keycache,s=e.valuecache;for(var a in r.properties){var l=r.properties[a],c=o[a];if(null!==l){void 0===c&&(i.push(a),o[a]=c=i.length-1),t.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,d=s[h];void 0===d&&(n.push(l),s[h]=d=n.length-1),t.writeVarint(d)}}}function P(e,t){return(t<<3)+(7&e)}function L(e){return e<<1^e>>31}function R(e,t){for(var r=e.loadGeometry(),i=e.type,n=0,o=0,s=r.length,a=0;a<s;a++){var l=r[a],c=1;1===i&&(c=l.length),t.writeVarint(P(1,c));for(var u=3===i?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==i&&t.writeVarint(P(2,u-1));var d=l[h].x-n,p=l[h].y-o;t.writeVarint(L(d)),t.writeVarint(L(p)),n+=d,o+=p}3===i&&t.writeVarint(P(7,1))}}function D(e,t){var r=typeof e;"string"===r?t.writeStringField(1,e):"boolean"===r?t.writeBooleanField(7,e):"number"===r&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}y.exports=M,y.exports.fromVectorTileJs=M,y.exports.fromGeojsonVt=function(e,t){t=t||{};var r={};for(var i in e)r[i]=new S(e[i].features,t),r[i].name=i,r[i].version=t.version,r[i].extent=t.extent;return M({layers:r})},y.exports.GeoJSONWrapper=S;var O=e.dK(y.exports);const z={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},k=Math.fround||(F=new Float32Array(1),e=>(F[0]=+e,F[0]));var F;const B=3,N=5,U=6;class V{constructor(e){this.options=Object.assign(Object.create(z),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:r,maxZoom:i}=this.options;t&&console.time("total time");const n=`prepare ${e.length} points`;t&&console.time(n),this.points=e;const o=[];for(let a=0;a<e.length;a++){const t=e[a];if(!t.geometry)continue;const[r,i]=t.geometry.coordinates,n=k($(r)),s=k(q(i));o.push(n,s,1/0,a,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[i+1]=this._createTree(o);t&&console.timeEnd(n);for(let a=i;a>=r;a--){const e=+Date.now();s=this.trees[a]=this._createTree(this._cluster(s,a)),t&&console.log("z%d: %d clusters in %dms",a,s.numItems,+Date.now()-e)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let r=((e[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,e[1]));let n=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)r=-180,n=180;else if(r>n){const e=this.getClusters([r,i,180,o],t),s=this.getClusters([-180,i,n,o],t);return e.concat(s)}const s=this.trees[this._limitZoom(t)],a=s.range($(r),q(o),$(n),q(i)),l=s.data,c=[];for(const u of a){const e=this.stride*u;c.push(l[e+N]>1?j(l,e,this.clusterProps):this.points[l[e+B]])}return c}getChildren(e){const t=this._getOriginId(e),r=this._getOriginZoom(e),i="No cluster with the specified id.",n=this.trees[r];if(!n)throw new Error(i);const o=n.data;if(t*this.stride>=o.length)throw new Error(i);const s=this.options.radius/(this.options.extent*Math.pow(2,r-1)),a=n.within(o[t*this.stride],o[t*this.stride+1],s),l=[];for(const c of a){const t=c*this.stride;o[t+4]===e&&l.push(o[t+N]>1?j(o,t,this.clusterProps):this.points[o[t+B]])}if(0===l.length)throw new Error(i);return l}getLeaves(e,t,r){const i=[];return this._appendLeaves(i,e,t=t||10,r=r||0,0),i}getTile(e,t,r){const i=this.trees[this._limitZoom(e)],n=Math.pow(2,e),{extent:o,radius:s}=this.options,a=s/o,l=(r-a)/n,c=(r+1+a)/n,u={features:[]};return this._addTileFeatures(i.range((t-a)/n,l,(t+1+a)/n,c),i.data,t,r,n,u),0===t&&this._addTileFeatures(i.range(1-a/n,l,1,c),i.data,n,r,n,u),t===n-1&&this._addTileFeatures(i.range(0,l,a/n,c),i.data,-1,r,n,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const r=this.getChildren(e);if(t++,1!==r.length)break;e=r[0].properties.cluster_id}return t}_appendLeaves(e,t,r,i,n){const o=this.getChildren(t);for(const s of o){const t=s.properties;if(t&&t.cluster?n+t.point_count<=i?n+=t.point_count:n=this._appendLeaves(e,t.cluster_id,r,i,n):n<i?n++:e.push(s),e.length===r)break}return n}_createTree(t){const r=new e.bg(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)r.add(t[e],t[e+1]);return r.finish(),r.data=t,r}_addTileFeatures(e,t,r,i,n,o){for(const s of e){const e=s*this.stride,a=t[e+N]>1;let l,c,u;if(a)l=G(t,e,this.clusterProps),c=t[e],u=t[e+1];else{const r=this.points[t[e+B]];l=r.properties;const[i,n]=r.geometry.coordinates;c=$(i),u=q(n)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*n-r)),Math.round(this.options.extent*(u*n-i))]],tags:l};let d;d=a||this.options.generateId?t[e+B]:this.points[t[e+B]].id,void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:r,extent:i,reduce:n,minPoints:o}=this.options,s=r/(i*Math.pow(2,t)),a=e.data,l=[],c=this.stride;for(let u=0;u<a.length;u+=c){if(a[u+2]<=t)continue;a[u+2]=t;const r=a[u],i=a[u+1],h=e.within(a[u],a[u+1],s),d=a[u+N];let p=d;for(const e of h){const r=e*c;a[r+2]>t&&(p+=a[r+N])}if(p>d&&p>=o){let e,o=r*d,s=i*d,f=-1;const m=(u/c<<5)+(t+1)+this.points.length;for(const r of h){const i=r*c;if(a[i+2]<=t)continue;a[i+2]=t;const l=a[i+N];o+=a[i]*l,s+=a[i+1]*l,a[i+4]=m,n&&(e||(e=this._map(a,u,!0),f=this.clusterProps.length,this.clusterProps.push(e)),n(e,this._map(a,i)))}a[u+4]=m,l.push(o/p,s/p,1/0,m,-1,p),n&&l.push(f)}else{for(let e=0;e<c;e++)l.push(a[u+e]);if(p>1)for(const e of h){const r=e*c;if(!(a[r+2]<=t)){a[r+2]=t;for(let e=0;e<c;e++)l.push(a[r+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,r){if(e[t+N]>1){const i=this.clusterProps[e[t+U]];return r?Object.assign({},i):i}const i=this.points[e[t+B]].properties,n=this.options.map(i);return r&&n===i?Object.assign({},n):n}}function j(e,t,r){return{type:"Feature",id:e[t+B],properties:G(e,t,r),geometry:{type:"Point",coordinates:[(i=e[t],360*(i-.5)),Z(e[t+1])]}};var i}function G(e,t,r){const i=e[t+N],n=i>=1e4?`${Math.round(i/1e3)}k`:i>=1e3?Math.round(i/100)/10+"k":i,o=e[t+U],s=-1===o?{}:Object.assign({},r[o]);return Object.assign(s,{cluster:!0,cluster_id:e[t+B],point_count:i,point_count_abbreviated:n})}function $(e){return e/360+.5}function q(e){const t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function Z(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}var W={exports:{}};W.exports=function(){function e(r,i,n,o){for(var s,a=o,l=n-i>>1,c=n-i,u=r[i],h=r[i+1],d=r[n],p=r[n+1],f=i+3;f<n;f+=3){var m=t(r[f],r[f+1],u,h,d,p);if(m>a)s=f,a=m;else if(m===a){var _=Math.abs(f-l);_<c&&(s=f,c=_)}}a>o&&(s-i>3&&e(r,i,s,o),r[s+2]=a,n-s>3&&e(r,s,n,o))}function t(e,t,r,i,n,o){var s=n-r,a=o-i;if(0!==s||0!==a){var l=((e-r)*s+(t-i)*a)/(s*s+a*a);l>1?(r=n,i=o):l>0&&(r+=s*l,i+=a*l)}return(s=e-r)*s+(a=t-i)*a}function r(e,t,r,n){var o={id:void 0===e?null:e,type:t,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,r=e.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)i(e,t);else if("Polygon"===r||"MultiLineString"===r)for(var n=0;n<t.length;n++)i(e,t[n]);else if("MultiPolygon"===r)for(n=0;n<t.length;n++)for(var o=0;o<t[n].length;o++)i(e,t[n][o])}(o),o}function i(e,t){for(var r=0;r<t.length;r+=3)e.minX=Math.min(e.minX,t[r]),e.minY=Math.min(e.minY,t[r+1]),e.maxX=Math.max(e.maxX,t[r]),e.maxY=Math.max(e.maxY,t[r+1])}function n(e,t,i,l){if(t.geometry){var c=t.geometry.coordinates,u=t.geometry.type,h=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),d=[],p=t.id;if(i.promoteId?p=t.properties[i.promoteId]:i.generateId&&(p=l||0),"Point"===u)o(c,d);else if("MultiPoint"===u)for(var f=0;f<c.length;f++)o(c[f],d);else if("LineString"===u)s(c,d,h,!1);else if("MultiLineString"===u){if(i.lineMetrics){for(f=0;f<c.length;f++)s(c[f],d=[],h,!1),e.push(r(p,"LineString",d,t.properties));return}a(c,d,h,!1)}else if("Polygon"===u)a(c,d,h,!0);else{if("MultiPolygon"!==u){if("GeometryCollection"===u){for(f=0;f<t.geometry.geometries.length;f++)n(e,{id:p,geometry:t.geometry.geometries[f],properties:t.properties},i,l);return}throw new Error("Input data is not a valid GeoJSON object.")}for(f=0;f<c.length;f++){var m=[];a(c[f],m,h,!0),d.push(m)}}e.push(r(p,u,d,t.properties))}}function o(e,t){t.push(l(e[0])),t.push(c(e[1])),t.push(0)}function s(t,r,i,n){for(var o,s,a=0,u=0;u<t.length;u++){var h=l(t[u][0]),d=c(t[u][1]);r.push(h),r.push(d),r.push(0),u>0&&(a+=n?(o*d-h*s)/2:Math.sqrt(Math.pow(h-o,2)+Math.pow(d-s,2))),o=h,s=d}var p=r.length-3;r[2]=1,e(r,0,p,i),r[p+2]=1,r.size=Math.abs(a),r.start=0,r.end=r.size}function a(e,t,r,i){for(var n=0;n<e.length;n++){var o=[];s(e[n],o,r,i),t.push(o)}}function l(e){return e/360+.5}function c(e){var t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function u(e,t,i,n,o,s,a,l){if(n/=t,s>=(i/=t)&&a<n)return e;if(a<i||s>=n)return null;for(var c=[],u=0;u<e.length;u++){var p=e[u],m=p.geometry,_=p.type,g=0===o?p.minX:p.minY,y=0===o?p.maxX:p.maxY;if(g>=i&&y<n)c.push(p);else if(!(y<i||g>=n)){var x=[];if("Point"===_||"MultiPoint"===_)h(m,x,i,n,o);else if("LineString"===_)d(m,x,i,n,o,!1,l.lineMetrics);else if("MultiLineString"===_)f(m,x,i,n,o,!1);else if("Polygon"===_)f(m,x,i,n,o,!0);else if("MultiPolygon"===_)for(var v=0;v<m.length;v++){var b=[];f(m[v],b,i,n,o,!0),b.length&&x.push(b)}if(x.length){if(l.lineMetrics&&"LineString"===_){for(v=0;v<x.length;v++)c.push(r(p.id,_,x[v],p.tags));continue}"LineString"!==_&&"MultiLineString"!==_||(1===x.length?(_="LineString",x=x[0]):_="MultiLineString"),"Point"!==_&&"MultiPoint"!==_||(_=3===x.length?"Point":"MultiPoint"),c.push(r(p.id,_,x,p.tags))}}}return c.length?c:null}function h(e,t,r,i,n){for(var o=0;o<e.length;o+=3){var s=e[o+n];s>=r&&s<=i&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function d(e,t,r,i,n,o,s){for(var a,l,c=p(e),u=0===n?_:g,h=e.start,d=0;d<e.length-3;d+=3){var f=e[d],y=e[d+1],x=e[d+2],v=e[d+3],b=e[d+4],w=0===n?f:y,T=0===n?v:b,E=!1;s&&(a=Math.sqrt(Math.pow(f-v,2)+Math.pow(y-b,2))),w<r?T>r&&(l=u(c,f,y,v,b,r),s&&(c.start=h+a*l)):w>i?T<i&&(l=u(c,f,y,v,b,i),s&&(c.start=h+a*l)):m(c,f,y,x),T<r&&w>=r&&(l=u(c,f,y,v,b,r),E=!0),T>i&&w<=i&&(l=u(c,f,y,v,b,i),E=!0),!o&&E&&(s&&(c.end=h+a*l),t.push(c),c=p(e)),s&&(h+=a)}var S=e.length-3;f=e[S],y=e[S+1],x=e[S+2],(w=0===n?f:y)>=r&&w<=i&&m(c,f,y,x),S=c.length-3,o&&S>=3&&(c[S]!==c[0]||c[S+1]!==c[1])&&m(c,c[0],c[1],c[2]),c.length&&t.push(c)}function p(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function f(e,t,r,i,n,o){for(var s=0;s<e.length;s++)d(e[s],t,r,i,n,o,!1)}function m(e,t,r,i){e.push(t),e.push(r),e.push(i)}function _(e,t,r,i,n,o){var s=(o-t)/(i-t);return e.push(o),e.push(r+(n-r)*s),e.push(1),s}function g(e,t,r,i,n,o){var s=(o-r)/(n-r);return e.push(t+(i-t)*s),e.push(o),e.push(1),s}function y(e,t){for(var i=[],n=0;n<e.length;n++){var o,s=e[n],a=s.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)o=x(s.geometry,t);else if("MultiLineString"===a||"Polygon"===a){o=[];for(var l=0;l<s.geometry.length;l++)o.push(x(s.geometry[l],t))}else if("MultiPolygon"===a)for(o=[],l=0;l<s.geometry.length;l++){for(var c=[],u=0;u<s.geometry[l].length;u++)c.push(x(s.geometry[l][u],t));o.push(c)}i.push(r(s.id,a,o,s.tags))}return i}function x(e,t){var r=[];r.size=e.size,void 0!==e.start&&(r.start=e.start,r.end=e.end);for(var i=0;i<e.length;i+=3)r.push(e[i]+t,e[i+1],e[i+2]);return r}function v(e,t){if(e.transformed)return e;var r,i,n,o=1<<e.z,s=e.x,a=e.y;for(r=0;r<e.features.length;r++){var l=e.features[r],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(i=0;i<c.length;i+=2)l.geometry.push(b(c[i],c[i+1],t,o,s,a));else for(i=0;i<c.length;i++){var h=[];for(n=0;n<c[i].length;n+=2)h.push(b(c[i][n],c[i][n+1],t,o,s,a));l.geometry.push(h)}}return e.transformed=!0,e}function b(e,t,r,i,n,o){return[Math.round(r*(e*i-n)),Math.round(r*(t*i-o))]}function w(e,t,r,i,n){for(var o=t===n.maxZoom?0:n.tolerance/((1<<t)*n.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:i,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){s.numFeatures++,T(s,e[a],o,n);var l=e[a].minX,c=e[a].minY,u=e[a].maxX,h=e[a].maxY;l<s.minX&&(s.minX=l),c<s.minY&&(s.minY=c),u>s.maxX&&(s.maxX=u),h>s.maxY&&(s.maxY=h)}return s}function T(e,t,r,i){var n=t.geometry,o=t.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<n.length;a+=3)s.push(n[a]),s.push(n[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)E(s,n,e,r,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<n.length;a++)E(s,n[a],e,r,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var l=0;l<n.length;l++){var c=n[l];for(a=0;a<c.length;a++)E(s,c[a],e,r,!0,0===a)}if(s.length){var u=t.tags||null;if("LineString"===o&&i.lineMetrics){for(var h in u={},t.tags)u[h]=t.tags[h];u.mapbox_clip_start=n.start/n.size,u.mapbox_clip_end=n.end/n.size}var d={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==t.id&&(d.id=t.id),e.features.push(d)}}function E(e,t,r,i,n,o){var s=i*i;if(i>0&&t.size<(n?s:i))r.numPoints+=t.length/3;else{for(var a=[],l=0;l<t.length;l+=3)(0===i||t[l+2]>s)&&(r.numSimplified++,a.push(t[l]),a.push(t[l+1])),r.numPoints++;n&&function(e,t){for(var r=0,i=0,n=e.length,o=n-2;i<n;o=i,i+=2)r+=(e[i]-e[o])*(e[i+1]+e[o+1]);if(r>0===t)for(i=0,n=e.length;i<n/2;i+=2){var s=e[i],a=e[i+1];e[i]=e[n-2-i],e[i+1]=e[n-1-i],e[n-2-i]=s,e[n-1-i]=a}}(a,o),e.push(a)}}function S(e,t){var r=(t=this.options=function(e,t){for(var r in t)e[r]=t[r];return e}(Object.create(this.options),t)).debug;if(r&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=function(e,t){var r=[];if("FeatureCollection"===e.type)for(var i=0;i<e.features.length;i++)n(r,e.features[i],t,i);else n(r,"Feature"===e.type?e:{geometry:e},t);return r}(e,t);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(i=function(e,t){var r=t.buffer/t.extent,i=e,n=u(e,1,-1-r,r,0,-1,2,t),o=u(e,1,1-r,2+r,0,-1,2,t);return(n||o)&&(i=u(e,1,-r,1+r,0,-1,2,t)||[],n&&(i=y(n,1).concat(i)),o&&(i=i.concat(y(o,-1)))),i}(i,t)).length&&this.splitTile(i,0,0,0),r&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function M(e,t,r){return 32*((1<<e)*r+t)+e}return S.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},S.prototype.splitTile=function(e,t,r,i,n,o,s){for(var a=[e,t,r,i],l=this.options,c=l.debug;a.length;){i=a.pop(),r=a.pop(),t=a.pop(),e=a.pop();var h=1<<t,d=M(t,r,i),p=this.tiles[d];if(!p&&(c>1&&console.time("creation"),p=this.tiles[d]=w(e,t,r,i,l),this.tileCoords.push({z:t,x:r,y:i}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,r,i,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+t;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=e,n){if(t===l.maxZoom||t===n)continue;var m=1<<n-t;if(r!==Math.floor(o/m)||i!==Math.floor(s/m))continue}else if(t===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==e.length){c>1&&console.time("clipping");var _,g,y,x,v,b,T=.5*l.buffer/l.extent,E=.5-T,S=.5+T,A=1+T;_=g=y=x=null,v=u(e,h,r-T,r+S,0,p.minX,p.maxX,l),b=u(e,h,r+E,r+A,0,p.minX,p.maxX,l),e=null,v&&(_=u(v,h,i-T,i+S,1,p.minY,p.maxY,l),g=u(v,h,i+E,i+A,1,p.minY,p.maxY,l),v=null),b&&(y=u(b,h,i-T,i+S,1,p.minY,p.maxY,l),x=u(b,h,i+E,i+A,1,p.minY,p.maxY,l),b=null),c>1&&console.timeEnd("clipping"),a.push(_||[],t+1,2*r,2*i),a.push(g||[],t+1,2*r,2*i+1),a.push(y||[],t+1,2*r+1,2*i),a.push(x||[],t+1,2*r+1,2*i+1)}}},S.prototype.getTile=function(e,t,r){var i=this.options,n=i.extent,o=i.debug;if(e<0||e>24)return null;var s=1<<e,a=M(e,t=(t%s+s)%s,r);if(this.tiles[a])return v(this.tiles[a],n);o>1&&console.log("drilling down to z%d-%d-%d",e,t,r);for(var l,c=e,u=t,h=r;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[M(c,u,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,u,h),o>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,e,t,r),o>1&&console.timeEnd("drilling down"),this.tiles[a]?v(this.tiles[a],n):null):null},function(e,t){return new S(e,t)}}();var H=e.dK(W.exports);function X(e,t){const r=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);const i=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!i)return t(null,null);const n=new g(i.features);let o=O(n);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),t(null,{vectorTile:n,rawData:o.buffer})}class Y extends c{constructor(e,t,r,i,n,o){super(e,t,r,i,X,o),n&&(this.loadGeoJSON=n)}loadData(r,i){const n=r&&r.request,o=n&&n.collectResourceTiming;this.loadGeoJSON(r,((s,a)=>{if(s||!a)return i(s);if("object"!=typeof a)return i(new Error(`Input data given to '${r.source}' is not a valid GeoJSON object.`));{f(a,!0);try{if(r.filter){const t=e.r(r.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===t.result)throw new Error(t.value.map((e=>`${e.key}: ${e.message}`)).join(", "));const i=a.features.filter((e=>t.value.evaluate({zoom:0},e)));a={type:"FeatureCollection",features:i}}this._geoJSONIndex=r.cluster?new V(function({superclusterOptions:t,clusterProperties:r}){if(!r||!t)return t;const i={},n={},o={accumulated:null,zoom:0},s={properties:null},a=Object.keys(r);for(const l of a){const[t,o]=r[l],s=e.r(o),a=e.r("string"==typeof t?[t,["accumulated"],["get",l]]:t);i[l]=s.value,n[l]=a.value}return t.map=e=>{s.properties=e;const t={};for(const r of a)t[r]=i[r].evaluate(o,s);return t},t.reduce=(e,t)=>{s.properties=t;for(const r of a)o.accumulated=e[r],e[r]=n[r].evaluate(o,s)},t}(r)).load(a.features):H(a,r.geojsonVtOptions)}catch(s){return i(s)}this.loaded={};const l={};if(o){const e=t(n);e&&(l.resourceTiming={},l.resourceTiming[r.source]=JSON.parse(JSON.stringify(e)))}i(null,l)}}))}reloadTile(e,t){const r=this.loaded;return r&&r[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,r){if(t.request)e.g(t.request,r);else{if("string"!=typeof t.data)return r(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));try{return r(null,JSON.parse(t.data))}catch(e){return r(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class K{constructor(t,r){this.tileID=new e.am(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=t.projection,this.brightness=r}parse(t,r,i,n){this.status="parsing";const o=new e.am(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),s={},a=r.familiesBySource[i.source],l=new e.dC(o,i.promoteId);return l.bucketLayerIDs=[],l.is3DTile=!0,e.dP(t).then((t=>{if(!t)return n(new Error("Could not parse tile"));const r=e.dQ(t,1/e.bR(i.tileID.canonical)),c=t.json.extensionsUsed&&t.json.extensionsUsed.includes("MAPBOX_mesh_features")||t.json.asset.extras&&t.json.asset.extras.MAPBOX_mesh_features,u=t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression"),h=new e.K(this.zoom,{brightness:this.brightness});for(const i in a)for(const t of a[i]){const i=t[0];l.bucketLayerIDs.push(t.map((e=>e.id))),i.recalculate(h,[]);const n=new e.dR(r,o,c,u,this.brightness,l);c||(n.needsUpload=!0),s[i.fqid]=n,n.evaluate(i)}this.status="done",n(null,{buckets:s,featureIndex:l})})).catch((e=>n(new Error(e.message))))}}class J{constructor(e,t,r,i,n,o){this.actor=e,this.layerIndex=t,this.brightness=o,this.loading={},this.loaded={}}loadTile(t,r){const i=t.uid,n=this.loading[i]=new K(t,this.brightness);e.a_(t.request,((e,o)=>{const s=!this.loading[i];return delete this.loading[i],s||e?(n.status="done",s||(this.loaded[i]=n),r(e)):o&&0!==o.byteLength?void n.parse(o,this.layerIndex,t,((e,t)=>{n.status="done",this.loaded=this.loaded||{},this.loaded[i]=n,e||!t?r(e):r(null,t)})):(n.status="done",this.loaded[i]=n,r())}))}reloadTile(e,t){const r=this.loaded,i=e.uid;if(r&&r[i]){const n=r[i];n.projection=e.projection,n.brightness=e.brightness;const o=(r,i)=>{n.reloadCallback&&(delete n.reloadCallback,this.loadTile(e,t)),t(r,i)};"parsing"===n.status?n.reloadCallback=o:"done"===n.status&&this.loadTile(e,t)}}abortTile(e,t){const r=e.uid;this.loading[r]&&delete this.loading[r],t()}removeTile(e,t){const r=this.loaded,i=e.uid;r&&r[i]&&delete r[i],t()}}class Q{constructor(t){this.self=t,this.actor=new e.dS(t,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=e.bo({name:"mercator"}),this.workerSourceTypes={vector:c,geojson:Y,"batched-model":J},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.dT.isParsed())throw new Error("RTL text plugin already registered.");e.dT.applyArabicShaping=t.applyArabicShaping,e.dT.processBidirectionalText=t.processBidirectionalText,e.dT.processStyledBidirectionalText=t.processStyledBidirectionalText}}clearCaches(e,t,r){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e],delete this.rasterArrayWorkerSource,r()}checkIfReady(e,t,r){r()}setReferrer(e,t){this.referrer=t}spriteLoaded(t,{scope:r,isLoaded:i}){if(this.isSpriteLoaded[t]||(this.isSpriteLoaded[t]={}),this.isSpriteLoaded[t][r]=i,this.workerSources[t]&&this.workerSources[t][r])for(const n in this.workerSources[t][r]){const o=this.workerSources[t][r][n];for(const t in o)o[t]instanceof c&&(o[t].isSpriteLoaded=i,o[t].fire(new e.b("isSpriteLoaded")))}}setImages(e,{scope:t,images:r},i){if(this.availableImages[e]||(this.availableImages[e]={}),this.availableImages[e][t]=r,this.workerSources[e]&&this.workerSources[e][t]){for(const i in this.workerSources[e][t]){const n=this.workerSources[e][t][i];for(const e in n)n[e].availableImages=r}i()}else i()}setProjection(t,r){this.projections[t]=e.bo(r)}setBrightness(e,t,r){this.brightness=t,r()}setLayers(e,t,r){this.getLayerIndex(e,t.scope).replace(t.layers,t.options),r()}updateLayers(e,t,r){this.getLayerIndex(e,t.scope).update(t.layers,t.removedIds,t.options),r()}loadTile(e,t,r){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).loadTile(t,r)}loadDEMTile(e,t,r){this.getDEMWorkerSource(e,t.source,t.scope).loadTile(t,r)}decodeRasterArray(e,t,r){this.getRasterArrayWorkerSource().decodeRasterArray(t,r)}reloadTile(e,t,r){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).reloadTile(t,r)}abortTile(e,t,r){this.getWorkerSource(e,t.type,t.source,t.scope).abortTile(t,r)}removeTile(e,t,r){this.getWorkerSource(e,t.type,t.source,t.scope).removeTile(t,r)}removeSource(e,t,r){if(!(this.workerSources[e]&&this.workerSources[e][t.scope]&&this.workerSources[e][t.scope][t.type]&&this.workerSources[e][t.scope][t.type][t.source]))return;const i=this.workerSources[e][t.scope][t.type][t.source];delete this.workerSources[e][t.scope][t.type][t.source],void 0!==i.removeSource?i.removeSource(t,r):r()}loadWorkerSource(e,t,r){try{this.self.importScripts(t.url),r()}catch(e){r(e.toString())}}syncRTLPluginState(t,r,i){try{e.dT.setState(r);const t=e.dT.getPluginURL();if(e.dT.isLoaded()&&!e.dT.isParsed()&&null!=t){this.self.importScripts(t);const r=e.dT.isParsed();i(r?void 0:new Error(`RTL Text Plugin failed to import scripts from ${t}`),r)}}catch(e){i(e.toString())}}setDracoUrl(e,t){this.dracoUrl=t}getAvailableImages(e,t){this.availableImages[e]||(this.availableImages[e]={});let r=this.availableImages[e][t];return r||(r=[]),r}getLayerIndex(e,t){this.layerIndexes[e]||(this.layerIndexes[e]={});let r=this.layerIndexes[e][t];return r||(r=this.layerIndexes[e][t]=new n,r.scope=t),r}getWorkerSource(e,t,r,i){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][i]||(this.workerSources[e][i]={}),this.workerSources[e][i][t]||(this.workerSources[e][i][t]={}),this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),!this.workerSources[e][i][t][r]){const n={send:(t,r,i,n,o,s)=>{this.actor.send(t,r,i,e,o,s)},scheduler:this.actor.scheduler};this.workerSources[e][i][t][r]=new this.workerSourceTypes[t](n,this.getLayerIndex(e,i),this.getAvailableImages(e,i),this.isSpriteLoaded[e][i],void 0,this.brightness)}return this.workerSources[e][i][t][r]}getDEMWorkerSource(e,t,r){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][r]||(this.demWorkerSources[e][r]={}),this.demWorkerSources[e][r][t]||(this.demWorkerSources[e][r][t]=new u),this.demWorkerSources[e][r][t]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new h),this.rasterArrayWorkerSource}enforceCacheSizeLimit(t,r){e.dU(r)}getWorkerPerformanceMetrics(e,t,r){r(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Q(self)),Q})),i(["./shared"],(function(e){function t(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(!t(e[i],r[i]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==r){if("object"!=typeof r)return!1;if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const i in e)if(!t(e[i],r[i]))return!1;return!0}return e===r}var r=i;function i(e){return!function(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,r=new Blob([""],{type:"text/javascript"}),i=URL.createObjectURL(r);try{t=new Worker(i),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(i),e}()?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var r=t.getImageData(0,0,1,1);return r&&r.width===e.width}()?(void 0===n[t=e&&e.failIfMajorPerformanceCaveat]&&(n[t]=function(e){var t,r=function(e){var t=document.createElement("canvas"),r=Object.create(i.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=e,t.getContext("webgl2",r)}(e);if(!r)return!1;try{t=r.createShader(r.VERTEX_SHADER)}catch(e){return!1}return!(!t||r.isContextLost())&&(r.shaderSource(t,"void main() {}"),r.compileShader(t),!0===r.getShaderParameter(t,r.COMPILE_STATUS))}(t)),n[t]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var t}(e)}var n={};function o(e,t,r){const i=document.createElement(e);return null!=t&&(i.className=t),r&&r.appendChild(i),i}function s(e,t,r){const i=document.createElementNS("http://www.w3.org/2000/svg",e);for(const n of Object.keys(t))i.setAttributeNS(null,n,String(t[n]));return r&&r.appendChild(i),i}i.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const a="undefined"!=typeof document?document.documentElement&&document.documentElement.style:null,l=a&&void 0!==a.userSelect?"userSelect":"WebkitUserSelect";let c;function u(){a&&l&&(c=a[l],a[l]="none")}function h(){a&&l&&(a[l]=c)}function d(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",d,!0)}function p(){window.addEventListener("click",d,!0),window.setTimeout((()=>{window.removeEventListener("click",d,!0)}),0)}function f(e,t){const r=e.getBoundingClientRect();return g(e,r,t)}function m(e,t){const r=e.getBoundingClientRect(),i=[];for(let n=0;n<t.length;n++)i.push(g(e,r,t[n]));return i}function _(e){return void 0!==window.InstallTrigger&&2===e.button&&e.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}function g(t,r,i){const n=t.offsetWidth===r.width?1:t.offsetWidth/r.width;return new e.P((i.clientX-r.left)*n,(i.clientY-r.top)*n)}class y{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(e,t){this._updatedSourceCaches[e]=t,this.setDirty()}discardSourceCacheUpdate(e){delete this._updatedSourceCaches[e]}updateLayer(e){const t=e.scope;this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._updatedLayers[t].add(e.id),this.setDirty()}removeLayer(e){const t=e.scope;this._removedLayers[t]=this._removedLayers[t]||{},this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._removedLayers[t][e.id]=e,this._updatedLayers[t].delete(e.id),this._updatedPaintProps.delete(e.fqid),this.setDirty()}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){const e={};for(const t in this._updatedLayers)e[t]=e[t]||{},e[t].updatedIds=Array.from(this._updatedLayers[t].values());for(const t in this._removedLayers)e[t]=e[t]||{},e[t].removedIds=Object.keys(this._removedLayers[t]);return e}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(e){this._updatedPaintProps.add(e.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(e){this._updatedImages.add(e),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class x extends e.E{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.numModelsLoading={}}loadModel(t,r){return e.l(this.requestManager.transformRequest(r,e.R.Model).url).then((r=>{if(!r)return;const i=e.c(r),n=new e.M(t,void 0,void 0,i);return n.computeBoundsAndApplyParent(),n})).catch((i=>{this.fire(new e.a(new Error(`Could not load model ${t} from ${r}: ${i.message}`)))}))}load(t,r){this.models[r]||(this.models[r]={});const i=Object.keys(t);this.numModelsLoading[r]=(this.numModelsLoading[r]||0)+i.length;const n=[];for(const e of i)n.push(this.loadModel(e,t[e]));Promise.allSettled(n).then((t=>{for(let e=0;e<t.length;e++){const{status:n,value:o}=t[e];"fulfilled"===n&&o&&(this.models[r][i[e]]=o)}this.numModelsLoading[r]-=i.length,this.fire(new e.b("data",{dataType:"style"}))})).catch((t=>{this.fire(new e.a(new Error(`Could not load models: ${t.message}`)))}))}isLoaded(){for(const e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,t){return!!this.getModel(e,t)}getModel(e,t){return this.models[t]||(this.models[t]={}),this.models[t][e]}addModel(e,t,r){this.models[r]||(this.models[r]={}),this.hasModel(e,r)&&this.removeModel(e,r),this.load({[e]:this.requestManager.normalizeModelURL(t)},r)}addModels(e,t){const r={};for(const i in e)r[i]=this.requestManager.normalizeModelURL(e[i]);this.load(r,t)}removeModel(e,t){this.models[t]||(this.models[t]={});const r=this.models[t][e];delete this.models[t][e],r.destroy()}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,t){this.models[t]||(this.models[t]={});for(const r in this.models[t])this.models[t][r].upload(e.context)}}class v{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,i){const n=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][n]=this.stateChanges[t][n]||{},e.e(this.stateChanges[t][n],i),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==n&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][n]){this.deletedStates[t][n]={};for(const e in this.state[t][n])i[e]||(this.deletedStates[t][n][e]=null)}else for(const e in i)this.deletedStates[t]&&this.deletedStates[t][n]&&null===this.deletedStates[t][n][e]&&delete this.deletedStates[t][n][e]}removeFeatureState(e,t,r){if(null===this.deletedStates[e])return;const i=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&void 0!==t)null!==this.deletedStates[e][i]&&(this.deletedStates[e][i]=this.deletedStates[e][i]||{},this.deletedStates[e][i][r]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][i])for(r in this.deletedStates[e][i]={},this.stateChanges[e][i])this.deletedStates[e][i][r]=null;else this.deletedStates[e][i]=null;else this.deletedStates[e]=null}getState(t,r){const i=String(r),n=e.e({},(this.state[t]||{})[i],(this.stateChanges[t]||{})[i]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const e=this.deletedStates[t][r];if(null===e)return{};for(const t in e)delete n[t]}return n}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(t,r){const i={};for(const n in this.stateChanges){this.state[n]=this.state[n]||{};const t={};for(const r in this.stateChanges[n])this.state[n][r]||(this.state[n][r]={}),e.e(this.state[n][r],this.stateChanges[n][r]),t[r]=this.state[n][r];i[n]=t}for(const n in this.deletedStates){this.state[n]=this.state[n]||{};const t={};if(null===this.deletedStates[n])for(const e in this.state[n])t[e]={},this.state[n][e]={};else for(const e in this.deletedStates[n]){if(null===this.deletedStates[n][e])this.state[n][e]={};else if(this.state[n][e])for(const t of Object.keys(this.deletedStates[n][e]))delete this.state[n][e][t];t[e]=this.state[n][e]}i[n]=i[n]||{},e.e(i[n],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const e in t)t[e].setFeatureState(i,r)}}function b(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class w extends e.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new e.h({width:1,height:1})}isLoaded(){for(const e in this.loaded)if(!this.loaded[e])return!1;return!0}setLoaded(e,t){if(this.loaded[t]!==e&&(this.loaded[t]=e,e)){for(const{ids:e,callback:r}of this.requestors)this._notify(e,t,r);this.requestors=[]}}hasImage(e,t){return!!this.getImage(e,t)}getImage(e,t){return this.images[t][e]}addImage(e,t,r){this._validate(e,r)&&(this.images[t][e]=r)}_validate(t,r){let i=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new e.a(new Error(`Image "${t}" has invalid "stretchX" value`))),i=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new e.a(new Error(`Image "${t}" has invalid "stretchY" value`))),i=!1),this._validateContent(r.content,r)||(this.fire(new e.a(new Error(`Image "${t}" has invalid "content" value`))),i=!1),i}_validateStretch(e,t){if(!e)return!0;let r=0;for(const i of e){if(i[0]<r||i[1]<i[0]||t<i[1])return!1;r=i[1]}return!0}_validateContent(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t,r){r.version=this.images[t][e].version+1,this.images[t][e]=r,this.updatedImages[t][e]=!0}removeImage(e,t){const r=this.images[t][e];delete this.images[t][e],delete this.patterns[t][e],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(e){return Object.keys(this.images[e])}getImages(e,t,r){let i=!0;const n=!!this.loaded[t];if(!n)for(const o of e)this.images[t][o]||(i=!1);n||i?this._notify(e,t,r):this.requestors.push({ids:e,scope:t,callback:r})}getUpdatedImages(e){return this.updatedImages[e]}_notify(t,r,i){const n={};for(const o of t){this.images[r][o]||this.fire(new e.b("styleimagemissing",{id:o}));const t=this.images[r][o];t?n[o]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:e.w(`Image "${o}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}i(null,n)}getPixelSize(e){const{width:t,height:r}=this.atlasImage[e];return{width:t,height:r}}getPattern(t,r){const i=this.patterns[r][t],n=this.getImage(t,r);if(!n)return null;if(i&&i.position.version===n.version)return i.position;if(i)i.position.version=n.version;else{const i={w:n.data.width+2,h:n.data.height+2,x:0,y:0},o=new e.I(i,n);this.patterns[r][t]={bin:i,position:o}}return this._updatePatternAtlas(r),this.patterns[r][t].position}bind(t,r){const i=t.gl;let n=this.atlasTexture[r];n?this.dirty&&(n.update(this.atlasImage[r]),this.dirty=!1):(n=new e.T(t,this.atlasImage[r],i.RGBA),this.atlasTexture[r]=n),n.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(t){const r=[];for(const e in this.patterns[t])r.push(this.patterns[t][e].bin);const{w:i,h:n}=e.p(r),o=this.atlasImage[t];o.resize({width:i||1,height:n||1});for(const s in this.patterns[t]){const{bin:r}=this.patterns[t][s],i=r.x+1,n=r.y+1,a=this.images[t][s].data,l=a.width,c=a.height;e.h.copy(a,o,{x:0,y:0},{x:i,y:n},{width:l,height:c}),e.h.copy(a,o,{x:0,y:c-1},{x:i,y:n-1},{width:l,height:1}),e.h.copy(a,o,{x:0,y:0},{x:i,y:n+c},{width:l,height:1}),e.h.copy(a,o,{x:l-1,y:0},{x:i-1,y:n},{width:1,height:c}),e.h.copy(a,o,{x:0,y:0},{x:i+l,y:n},{width:1,height:c})}this.dirty=!0}beginFrame(){for(const e in this.images)this.callbackDispatchedThisFrame[e]={}}dispatchRenderCallbacks(e,t){for(const r of e){if(this.callbackDispatchedThisFrame[t][r])continue;this.callbackDispatchedThisFrame[t][r]=!0;const e=this.images[t][r];b(e)&&this.updateImage(r,t,e)}}}class T{constructor(e,t,r,i){this.message=(e?`${e}: `:"")+r,i&&(this.identifier=i),null!=t&&t.__line__&&(this.line=t.__line__)}}class E extends T{}function S(t){const r=t.key,i=t.value,n=t.valueSpec||{},o=t.objectElementValidators||{},s=t.style,a=t.styleSpec;let l=[];const c=e.i(i);if("object"!==c)return[new T(r,i,`object expected, ${c} found`)];for(const e in i){const t=e.split(".")[0];let c;o[t]?c=o[t]:n[t]?c=H:o["*"]?c=o["*"]:n["*"]&&(c=H),c?l=l.concat(c({key:(r?`${r}.`:r)+e,value:i[e],valueSpec:n[t]||n["*"],style:s,styleSpec:a,object:i,objectKey:e},i)):l.push(new E(r,i[e],`unknown property "${e}"`))}for(const e in n)o[e]||n[e].required&&void 0===n[e].default&&void 0===i[e]&&l.push(new T(r,i,`missing required property "${e}"`));return l}function M(t){const r=t.value,i=t.valueSpec,n=t.style,o=t.styleSpec,s=t.key,a=t.arrayElementValidator||H;if("array"!==e.i(r))return[new T(s,r,`array expected, ${e.i(r)} found`)];if(i.length&&r.length!==i.length)return[new T(s,r,`array length ${i.length} expected, length ${r.length} found`)];if(i["min-length"]&&r.length<i["min-length"])return[new T(s,r,`array length at least ${i["min-length"]} expected, length ${r.length} found`)];let l={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};o.$version<7&&(l.function=i.function),"object"===e.i(i.value)&&(l=i.value);let c=[];for(let e=0;e<r.length;e++)c=c.concat(a({array:r,arrayIndex:e,value:r[e],valueSpec:l,style:n,styleSpec:o,key:`${s}[${e}]`},!0));return c}function A(t){const r=t.key,i=t.value,n=t.valueSpec;let o=e.i(i);if("number"===o&&i!=i&&(o="NaN"),"number"!==o)return[new T(r,i,`number expected, ${o} found`)];if("minimum"in n){let o=n.minimum;if("array"===e.i(n.minimum)&&(o=n.minimum[t.arrayIndex]),i<o)return[new T(r,i,`${i} is less than the minimum value ${o}`)]}if("maximum"in n){let o=n.maximum;if("array"===e.i(n.maximum)&&(o=n.maximum[t.arrayIndex]),i>o)return[new T(r,i,`${i} is greater than the maximum value ${o}`)]}return[]}function I(t){const r=t.valueSpec,i=e.u(t.value.type);let n,o,s,a={};const l="categorical"!==i&&void 0===t.value.property,c=!l,u="array"===e.i(t.value.stops)&&"array"===e.i(t.value.stops[0])&&"object"===e.i(t.value.stops[0][0]),h=S({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===i)return[new T(t.key,t.value,'identity function may not have a "stops" property')];let r=[];const n=t.value;return r=r.concat(M({key:t.key,value:n,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:d})),"array"===e.i(n)&&0===n.length&&r.push(new T(t.key,n,"array must have at least one stop")),r},default:function(e){return H({key:e.key,value:e.value,valueSpec:r,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===i&&l&&h.push(new T(t.key,t.value,'missing required property "property"')),"identity"===i||t.value.stops||h.push(new T(t.key,t.value,'missing required property "stops"')),"exponential"===i&&t.valueSpec.expression&&!e.s(t.valueSpec)&&h.push(new T(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(c&&!e.k(t.valueSpec)?h.push(new T(t.key,t.value,"property functions not supported")):l&&!e.m(t.valueSpec)&&h.push(new T(t.key,t.value,"zoom functions not supported"))),"categorical"!==i&&!u||void 0!==t.value.property||h.push(new T(t.key,t.value,'"property" property is required')),h;function d(t){let i=[];const n=t.value,l=t.key;if("array"!==e.i(n))return[new T(l,n,`array expected, ${e.i(n)} found`)];if(2!==n.length)return[new T(l,n,`array length 2 expected, length ${n.length} found`)];if(u){if("object"!==e.i(n[0]))return[new T(l,n,`object expected, ${e.i(n[0])} found`)];if(void 0===n[0].zoom)return[new T(l,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new T(l,n,"object stop key must have value")];const r=e.u(n[0].zoom);if("number"!=typeof r)return[new T(l,n[0].zoom,"stop zoom values must be numbers")];if(s&&s>r)return[new T(l,n[0].zoom,"stop zoom values must appear in ascending order")];r!==s&&(s=r,o=void 0,a={}),i=i.concat(S({key:`${l}[0]`,value:n[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:A,value:p}}))}else i=i.concat(p({key:`${l}[0]`,value:n[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},n));return e.n(e.o(n[1]))?i.concat([new T(`${l}[1]`,n[1],"expressions are not allowed in function stops.")]):i.concat(H({key:`${l}[1]`,value:n[1],valueSpec:r,style:t.style,styleSpec:t.styleSpec}))}function p(t,s){const l=e.i(t.value),c=e.u(t.value),u=null!==t.value?t.value:s;if(n){if(l!==n)return[new T(t.key,u,`${l} stop domain type must match previous stop domain type ${n}`)]}else n=l;if("number"!==l&&"string"!==l&&"boolean"!==l&&"number"!=typeof c&&"string"!=typeof c&&"boolean"!=typeof c)return[new T(t.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==l&&"categorical"!==i){let n=`number expected, ${l} found`;return e.k(r)&&void 0===i&&(n+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new T(t.key,u,n)]}return"categorical"!==i||"number"!==l||"number"==typeof c&&isFinite(c)&&Math.floor(c)===c?"categorical"!==i&&"number"===l&&"number"==typeof c&&"number"==typeof o&&void 0!==o&&c<o?[new T(t.key,u,"stop domain values must appear in ascending order")]:(o=c,"categorical"===i&&c in a?[new T(t.key,u,"stop domain values must be unique")]:(a[c]=!0,[])):[new T(t.key,u,`integer expected, found ${String(c)}`)]}}function C(t){const r=("property"===t.expressionContext?e.q:e.r)(e.o(t.value),t.valueSpec);if("error"===r.result)return r.value.map((e=>new T(`${t.key}${e.key}`,t.value,e.message)));const i=r.value.expression||r.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!i.outputDefined())return[new T(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!e.t(i))return[new T(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return P(i,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!e.v(i,["zoom","feature-state"]))return[new T(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!e.x(i))return[new T(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function P(t,r){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const e of r.valueSpec.expression.parameters)i.delete(e);if(0===i.size)return[];const n=[];return t instanceof e.C&&i.has(t.name)?[new T(r.key,r.value,`["${t.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(t.eachChild((e=>{n.push(...P(e,r))})),n)}function L(t){const r=t.key,i=t.value,n=t.valueSpec,o=[];return Array.isArray(n.values)?-1===n.values.indexOf(e.u(i))&&o.push(new T(r,i,`expected one of [${n.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(n.values).indexOf(e.u(i))&&o.push(new T(r,i,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(i)} found`)),o}function R(t){return e.z(e.o(t.value))?C(e.j({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):D(t)}function D(t){const r=t.value,i=t.key;if("array"!==e.i(r))return[new T(i,r,`array expected, ${e.i(r)} found`)];const n=t.styleSpec;let o,s=[];if(r.length<1)return[new T(i,r,"filter array must have at least 1 element")];switch(s=s.concat(L({key:`${i}[0]`,value:r[0],valueSpec:n.filter_operator,style:t.style,styleSpec:t.styleSpec})),e.u(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===e.u(r[1])&&s.push(new T(i,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&s.push(new T(i,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(o=e.i(r[1]),"string"!==o&&s.push(new T(`${i}[1]`,r[1],`string expected, ${o} found`)));for(let a=2;a<r.length;a++)o=e.i(r[a]),"$type"===e.u(r[1])?s=s.concat(L({key:`${i}[${a}]`,value:r[a],valueSpec:n.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==o&&"number"!==o&&"boolean"!==o&&s.push(new T(`${i}[${a}]`,r[a],`string, number, or boolean expected, ${o} found`));break;case"any":case"all":case"none":for(let e=1;e<r.length;e++)s=s.concat(D({key:`${i}[${e}]`,value:r[e],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":o=e.i(r[1]),2!==r.length?s.push(new T(i,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==o&&s.push(new T(`${i}[1]`,r[1],`string expected, ${o} found`))}return s}function O(t,r){const i=t.key,n=t.style,o=t.layer,s=t.styleSpec,a=t.value,l=t.objectKey,c=s[`${r}_${t.layerType}`];if(!c)return[];const u=l.match(/^(.*)-transition$/);if("paint"===r&&u&&c[u[1]]&&c[u[1]].transition)return H({key:i,value:a,valueSpec:s.transition,style:n,styleSpec:s});const h=t.valueSpec||c[l];if(!h)return[new E(i,a,`unknown property "${l}"`)];let d;if("string"===e.i(a)&&e.k(h)&&!h.tokens&&(d=/^{([^}]+)}$/.exec(a))){const e=`\`{ "type": "identity", "property": ${d?JSON.stringify(d[1]):'"_"'} }\``;return[new T(i,a,`"${l}" does not support interpolation syntax\nUse an identity property function instead: ${e}.`)]}const p=[];if("symbol"===t.layerType)"text-field"!==l||!n||n.glyphs||n.imports||p.push(new T(i,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===l&&e.A(e.o(a))&&"identity"===e.u(a.type)&&p.push(new T(i,a,'"text-font" does not support identity functions'));else if("model"===t.layerType&&"paint"===r&&o&&o.layout&&o.layout.hasOwnProperty("model-id")&&e.k(h)&&(e.B(h)||e.m(h))){const t=e.q(e.o(a),h),r=t.value.expression||t.value._styleExpression.expression;r&&!e.v(r,["measure-light"])&&("model-emissive-strength"===l&&e.x(r)&&e.t(r)||p.push(new T(i,a,`${l} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return p.concat(H({key:t.key,value:a,valueSpec:h,style:n,styleSpec:s,expressionContext:"property",propertyType:r,propertyKey:l}))}function z(e){return O(e,"paint")}function k(e){return O(e,"layout")}function F(t){let r=[];const i=t.value,n=t.key,o=t.style,s=t.styleSpec;i.type||i.ref||r.push(new T(n,i,'either "type" or "ref" is required'));let a=e.u(i.type);const l=e.u(i.ref);if(i.id){const s=e.u(i.id);for(let a=0;a<t.arrayIndex;a++){const t=o.layers[a];e.u(t.id)===s&&r.push(new T(n,i.id,`duplicate layer id "${i.id}", previously used at line ${t.id.__line__}`))}}if("ref"in i){let t;["type","source","source-layer","filter","layout"].forEach((e=>{e in i&&r.push(new T(n,i[e],`"${e}" is prohibited for ref layers`))})),o.layers.forEach((r=>{e.u(r.id)===l&&(t=r)})),t?t.ref?r.push(new T(n,i.ref,"ref cannot reference another ref layer")):a=e.u(t.type):"string"==typeof l&&r.push(new T(n,i.ref,`ref layer "${l}" not found`))}else if("background"!==a&&"sky"!==a&&"slot"!==a)if(i.source){const t=o.sources&&o.sources[i.source],s=t&&e.u(t.type);t?"vector"===s&&"raster"===a?r.push(new T(n,i.source,`layer "${i.id}" requires a raster source`)):"raster"===s&&"raster"!==a?r.push(new T(n,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==s||i["source-layer"]?"raster-dem"===s&&"hillshade"!==a?r.push(new T(n,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==s||["raster","raster-particle"].includes(a)?"line"!==a||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||"geojson"===s&&t.lineMetrics?"raster-particle"===a&&"raster-array"!==s&&r.push(new T(n,i.source,`layer "${i.id}" requires a 'raster-array' source.`)):r.push(new T(n,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new T(n,i.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new T(n,i,`layer "${i.id}" must specify a "source-layer"`)):r.push(new T(n,i.source,`source "${i.source}" not found`))}else r.push(new T(n,i,'missing required property "source"'));return r=r.concat(S({key:n,value:i,valueSpec:s.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>H({key:`${n}.type`,value:i.type,valueSpec:s.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:t=>R(e.j({layerType:a},t)),layout:t=>S({layer:i,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>k(e.j({layerType:a},t))}}),paint:t=>S({layer:i,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>z(e.j({layerType:a,layer:i},t))}})}})),r}function B(t){const r=t.value,i=t.key,n=e.i(r);return"string"!==n?[new T(i,r,`string expected, ${n} found`)]:[]}const N={promoteId:function({key:t,value:r}){if("string"===e.i(r))return B({key:t,value:r});{const e=[];for(const i in r)e.push(...B({key:`${t}.${i}`,value:r[i]}));return e}}};function U(t){const r=t.value,i=t.key,n=t.styleSpec,o=t.style;if(!r.type)return[new T(i,r,'"type" is required')];const s=e.u(r.type);let a=[];switch(["vector","raster","raster-dem","raster-array"].includes(s)&&(r.url||r.tiles||a.push(new E(i,r,'Either "url" or "tiles" is required.'))),s){case"vector":case"raster":case"raster-dem":case"raster-array":return a=a.concat(S({key:i,value:r,valueSpec:n[`source_${s.replace("-","_")}`],style:t.style,styleSpec:n,objectElementValidators:N})),a;case"geojson":if(a=S({key:i,value:r,valueSpec:n.source_geojson,style:o,styleSpec:n,objectElementValidators:N}),r.cluster)for(const e in r.clusterProperties){const[t,n]=r.clusterProperties[e],o="string"==typeof t?[t,["accumulated"],["get",e]]:t;a.push(...C({key:`${i}.${e}.map`,value:n,expressionContext:"cluster-map"})),a.push(...C({key:`${i}.${e}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return a;case"video":return S({key:i,value:r,valueSpec:n.source_video,style:o,styleSpec:n});case"image":return S({key:i,value:r,valueSpec:n.source_image,style:o,styleSpec:n});case"canvas":return[new T(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return L({key:`${i}.type`,value:r.type,valueSpec:{values:V(n)},style:o,styleSpec:n})}}function V(e){return e.source.reduce(((t,r)=>{const i=e[r];return"enum"===i.type.type&&(t=t.concat(Object.keys(i.type.values))),t}),[])}function j(t){const r=t.value;let i=[];if(!r)return i;const n=e.i(r);return"string"!==n?(i=i.concat([new T(t.key,r,`string expected, "${n}" found`)]),i):(function(e){const t=-1===e.indexOf("://");try{return new URL(e,t?"http://example.com":void 0),!0}catch(e){return!1}}(r)||(i=i.concat([new T(t.key,r,`invalid url "${r}"`)])),i)}function G(t){const r=t.value,i=t.styleSpec,n=i.light,o=t.style;let s=[];const a=e.i(r);if(void 0===r)return s;if("object"!==a)return s=s.concat([new T("light",r,`object expected, ${a} found`)]),s;for(const e in r){const t=e.match(/^(.*)-transition$/);s=s.concat(t&&n[t[1]]&&n[t[1]].transition?H({key:e,value:r[e],valueSpec:i.transition,style:o,styleSpec:i}):n[e]?H({key:e,value:r[e],valueSpec:n[e],style:o,styleSpec:i}):[new T(e,r[e],`unknown property "${e}"`)])}return s}function $(t){const r=t.value;let i=[];if(!r)return i;const n=e.i(r);if("object"!==n)return i=i.concat([new T("light-3d",r,`object expected, ${n} found`)]),i;const o=t.styleSpec,s=o["light-3d"],a=t.key,l=t.style,c=t.style.lights;for(const e of["type","id"])if(!(e in r))return i=i.concat([new T("light-3d",r,`missing property ${e} on light`)]),i;if(r.type&&c)for(let d=0;d<t.arrayIndex;d++){const t=e.u(r.type),n=c[d];e.u(n.type)===t&&i.push(new T(a,r.id,`duplicate light type "${r.type}", previously defined at line ${n.id.__line__}`))}const u=`properties_light_${r.type}`;if(!(u in o))return i=i.concat([new T("light-3d",r,`Invalid light type ${r.type}`)]),i;const h=o[u];for(const d in r)if("properties"===d){const n=r[d],s=e.i(n);if("object"!==s)return i=i.concat([new T("properties",n,`object expected, ${s} found`)]),i;for(const e in n)i=i.concat(h[e]?H({key:e,value:n[e],valueSpec:h[e],style:l,styleSpec:o}):[new E(t.key,n[e],`unknown property "${e}"`)])}else{const e=d.match(/^(.*)-transition$/);i=i.concat(e&&s[e[1]]&&s[e[1]].transition?H({key:d,value:r[d],valueSpec:o.transition,style:l,styleSpec:o}):s[d]?H({key:d,value:r[d],valueSpec:s[d],style:l,styleSpec:o}):[new E(d,r[d],`unknown property "${d}"`)])}return i}function q(t){const r=t.value,i=t.key,n=t.style,o=t.styleSpec,s=o.terrain;let a=[];const l=e.i(r);if(void 0===r)return a;if("null"===l)return a;if("object"!==l)return a=a.concat([new T("terrain",r,`object expected, ${l} found`)]),a;for(const e in r){const t=e.match(/^(.*)-transition$/);a=a.concat(t&&s[t[1]]&&s[t[1]].transition?H({key:e,value:r[e],valueSpec:o.transition,style:n,styleSpec:o}):s[e]?H({key:e,value:r[e],valueSpec:s[e],style:n,styleSpec:o}):[new E(e,r[e],`unknown property "${e}"`)])}if(r.source){const t=n.sources&&n.sources[r.source],o=t&&e.u(t.type);t?"raster-dem"!==o&&a.push(new T(i,r.source,`terrain cannot be used with a source of type ${String(o)}, it only be used with a "raster-dem" source type`)):a.push(new T(i,r.source,`source "${r.source}" not found`))}else a.push(new T(i,r,'terrain is missing required property "source"'));return a}function Z(t){const r=t.value,i=t.style,n=t.styleSpec,o=n.fog;let s=[];const a=e.i(r);if(void 0===r)return s;if("object"!==a)return s=s.concat([new T("fog",r,`object expected, ${a} found`)]),s;for(const e in r){const t=e.match(/^(.*)-transition$/);s=s.concat(t&&o[t[1]]&&o[t[1]].transition?H({key:e,value:r[e],valueSpec:n.transition,style:i,styleSpec:n}):o[e]?H({key:e,value:r[e],valueSpec:o[e],style:i,styleSpec:n}):[new E(e,r[e],`unknown property "${e}"`)])}return s}const W={"*":()=>[],array:M,boolean:function(t){const r=t.value,i=t.key,n=e.i(r);return"boolean"!==n?[new T(i,r,`boolean expected, ${n} found`)]:[]},number:A,color:function(t){const r=t.key,i=t.value,n=e.i(i);return"string"!==n?[new T(r,i,`color expected, ${n} found`)]:null===e.y(i)?[new T(r,i,`color expected, "${i}" found`)]:[]},enum:L,filter:R,function:I,layer:F,object:S,source:U,model:j,light:G,"light-3d":$,terrain:q,fog:Z,string:B,formatted:function(e){return 0===B(e).length?[]:C(e)},resolvedImage:function(e){return 0===B(e).length?[]:C(e)},projection:function(t){const r=t.value,i=t.styleSpec,n=i.projection,o=t.style;let s=[];const a=e.i(r);if("object"===a)for(const e in r)s=s.concat(H({key:e,value:r[e],valueSpec:n[e],style:o,styleSpec:i}));else"string"!==a&&(s=s.concat([new T("projection",r,`object or string expected, ${a} found`)]));return s},import:function(t){const{value:r,styleSpec:i}=t,{data:n,...o}=r;Object.defineProperty(o,"__line__",{value:r.__line__,enumerable:!1});let s=S(e.j({},t,{value:o,valueSpec:i.import}));return""===e.u(o.id)&&s.push(new T(`${t.key}.id`,o,"import id can't be an empty string")),n&&(s=s.concat(Y(n,i,{key:`${t.key}.data`}))),s}};function H(t,r=!1){const i=t.value,n=t.valueSpec,o=t.styleSpec;if(n.expression&&e.A(e.u(i)))return I(t);if(n.expression&&e.n(e.o(i)))return C(t);if(n.type&&W[n.type]){const i=W[n.type](t);return!0===r&&i.length>0&&"array"===e.i(t.value)?C(t):i}return S(e.j({},t,{valueSpec:n.type?o[n.type]:n}))}function X(e){const t=e.value,r=e.key,i=B(e);return i.length||(-1===t.indexOf("{fontstack}")&&i.push(new T(r,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&i.push(new T(r,t,'"glyphs" url must include a "{range}" token'))),i}function Y(t,r=e.D,i={}){return H({key:i.key||"",value:t,valueSpec:r.$root,styleSpec:r,style:t,objectElementValidators:{glyphs:X,"*":()=>[]}})}function K(t,r=e.D){return le(Y(t,r))}const J=e=>le(U(e)),Q=e=>le(G(e)),ee=e=>le($(e)),te=e=>le(q(e)),re=e=>le(Z(e)),ie=e=>le(F(e)),ne=e=>le(R(e)),oe=e=>le(z(e)),se=e=>le(k(e)),ae=e=>le(j(e));function le(e){return e.slice().sort(((e,t)=>e.line&&t.line?e.line-t.line:0))}function ce(t,r){let i=!1;if(r&&r.length)for(const n of r)n instanceof E?e.w(n.message):(t.fire(new e.a(new Error(n.message))),i=!0);return i}const ue=new e.F({anchor:new e.G(e.D.light.anchor),position:new e.H(e.D.light.position),color:new e.G(e.D.light.color),intensity:new e.G(e.D.light.intensity)});class he extends e.E{constructor(t,r="flat"){super(),this._transitionable=new e.J(ue),this.setLight(t,r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,t,r={}){this._validate(Q,e,r)||(this._transitionable.setTransitionOrValue(e),this.id=t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,r,i){return(!i||!1!==i.validate)&&ce(this,t.call(K,e.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:e.D})))}}const de=new e.F({source:new e.G(e.D.terrain.source),exaggeration:new e.G(e.D.terrain.exaggeration)});let pe=class extends e.E{constructor(t,r,i,n){super(),this.scope=i,this._transitionable=new e.J(de,i,n),this._transitionable.setTransitionOrValue(t,n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(e,t){this._transitionable.setTransitionOrValue(e,t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(t){return this._transitioning.possiblyEvaluate(new e.K(t)).get("exaggeration")}isZoomDependent(){const t=this._transitionable._values.exaggeration;return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof e.Z}};const fe=45,me=65,_e=.05;function ge(t,r,i,n){const o=e.O(fe,me,i),[s,a]=ye(t,n);let l=1-Math.min(1,Math.exp((r-s)/(a-s)*-6));return l*=l*l,l=Math.min(1,1.00747*l),l*o*t.alpha}function ye(e,t){const r=.5/Math.tan(.5*t);return[e.range[0]+r,e.range[1]+r]}function xe(t,r,i,n,o){const s=e.N.transformMat4([],[r,i,n],o.mercatorFogMatrix);return ge(t,e.N.length(s),o.pitch,o._fov)}function ve(t,r,i,n,o,s,a){const l=[[i,n,0],[o,n,0],[o,s,0],[i,s,0]];let c=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(const h of l){const t=e.N.transformMat4([],h,r),i=e.N.length(t);c=Math.min(c,i),u=Math.max(u,i)}return[ge(t,c,a.pitch,a._fov),ge(t,u,a.pitch,a._fov)]}const be=new e.F({range:new e.G(e.D.fog.range),color:new e.G(e.D.fog.color),"high-color":new e.G(e.D.fog["high-color"]),"space-color":new e.G(e.D.fog["space-color"]),"horizon-blend":new e.G(e.D.fog["horizon-blend"]),"star-intensity":new e.G(e.D.fog["star-intensity"]),"vertical-range":new e.G(e.D.fog["vertical-range"])});class we extends e.E{constructor(t,r,i,n){super(),this._transitionable=new e.J(be,i,new Map(n)),this.set(t,n),this._transitioning=this._transitionable.untransitioned(),this._transform=r,this.properties=new e.Q(be)}get state(){const t=this._transform,r="globe"===t.projection.name,i=e.S(t.zoom),n=this.properties.get("range"),o=[.5,3];return{range:r?[e.U(o[0],n[0],i),e.U(o[1],n[1],i)]:n,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,r,i={}){if(this._validate(re,t,i))return;const n=e.e({},t);for(const o of Object.keys(e.D.fog))void 0===n[o]&&(n[o]=e.D.fog[o].default);this._options=n,this._transitionable.setTransitionOrValue(this._options,r)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const r=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:e.O(fe,me,t))*r.a}getOpacityAtLatLng(t,r){return this._transform.projection.supportsFog?function(t,r,i){const n=e.L.fromLngLat(r),o=i.elevation?i.elevation.getAtPointOrZero(n):0;return xe(t,n.x,n.y,o,i)}(this.state,t,r):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const r=this._transform.calculateFogTileMatrix(t.toUnwrapped());return ve(this.state,r,0,0,e.V,e.V,this._transform)}getOpacityForBounds(e,t,r,i,n){return this._transform.projection.supportsFog?ve(this.state,e,t,r,i,n,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?ye(this.state,e):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const r=[4,5,6,7];for(const i of r){const r=t.points[i];let n;if(r[2]>=0)n=r;else{const o=t.points[i-4];n=e.W(o,r,o[2]/(o[2]-r[2]))}if(xe(this.state,n[0],n[1],0,this._transform)>=_e)return!0}return!1}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,r,i){return(!i||!1!==i.validate)&&ce(this,t.call(K,e.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:e.D})))}}class Te extends e.E{constructor(t,r,i,n){super(),this.scope=i,this._options=t,this.properties=new e.Q(r),this._transitionable=new e.J(r,i,new Map(n)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,t){this._options=e,this._transitionable.setTransitionOrValue(e.properties,t)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const Ee=new e.F({color:new e.G(e.D.properties_light_ambient.color),intensity:new e.G(e.D.properties_light_ambient.intensity)}),Se=new e.F({direction:new e.X(e.D.properties_light_directional.direction),color:new e.G(e.D.properties_light_directional.color),intensity:new e.G(e.D.properties_light_directional.intensity),"cast-shadows":new e.G(e.D.properties_light_directional["cast-shadows"]),"shadow-intensity":new e.G(e.D.properties_light_directional["shadow-intensity"])});class Me{constructor(e,t,r,i){this.screenBounds=e,this.cameraPoint=t,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=r,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,i)}static createFromScreenPoints(t,r){let i,n;if(t instanceof e.P||"number"==typeof t[0]){const o=e.P.convert(t);i=[o],n=r.isPointAboveHorizon(o)}else{const o=e.P.convert(t[0]),s=e.P.convert(t[1]);i=[o,s],n=e.Y(o,s).every((e=>r.isPointAboveHorizon(e)))}return new Me(i,r.getCameraPoint(),n,r)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return e.Y(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const r=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],n=e.Y(r,i,0,!1);return this.cameraPoint.y>i.y&&(this.cameraPoint.x>r.x&&this.cameraPoint.x<i.x?n.splice(3,0,this.cameraPoint):this.cameraPoint.x>=i.x?n[2]=this.cameraPoint:this.cameraPoint.x<=r.x&&(n[3]=this.cameraPoint)),e._(n,t)}bufferedCameraGeometryGlobe(t){const r=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],n=e.Y(r,i,t),o=this.cameraPoint.clone();switch(3*((o.y>r.y)+(o.y>i.y))+((o.x>r.x)+(o.x>i.x))){case 0:n[0]=o,n[4]=o.clone();break;case 1:n.splice(1,0,o);break;case 2:n[1]=o;break;case 3:n.splice(4,0,o);break;case 5:n.splice(2,0,o);break;case 6:n[3]=o;break;case 7:n.splice(3,0,o);break;case 8:n[2]=o}return n}containsTile(t,r,i,n=0){const o=t.queryPadding/r._pixelsPerMercatorPixel+1,s=i?this._bufferedCameraMercator(o,r):this._bufferedScreenMercator(o,r);let a=t.tileID.wrap+(s.unwrapped?n:0);const l=s.polygon.map((r=>e.$(t.tileTransform,r,a)));if(!e.a0(l,0,0,e.V,e.V))return;a=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?n:0);const c=this.screenGeometryMercator.polygon.map((r=>e.a1(t.tileTransform,r,a))),u=c.map((t=>new e.P(t[0],t[1]))),h=r.getFreeCameraOptions().position||new e.L(0,0,0),d=e.a1(t.tileTransform,h,a),p=c.map((t=>{const r=e.N.sub(t,t,d);return e.N.normalize(r,r),new e.a2(d,r)})),f=e.a3(t,1,r.zoom)*r._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:u,tilespaceRays:p,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(m=e.a4(l),m.min.x=e.aa(m.min.x,0,e.V),m.min.y=e.aa(m.min.y,0,e.V),m.max.x=e.aa(m.max.x,0,e.V),m.max.y=e.aa(m.max.y,0,e.V),m),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:f};var m}_bufferedScreenMercator(e,t){const r=Ce(e);if(this._screenRaycastCache[r])return this._screenRaycastCache[r];{let i;return i="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._screenRaycastCache[r]=i,i}}_bufferedCameraMercator(e,t){const r=Ce(e);if(this._cameraRaycastCache[r])return this._cameraRaycastCache[r];{let i;return i="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._cameraRaycastCache[r]=i,i}}_projectAndResample(t,r){const i=function(t,r){const i=e.a6.multiply([],r.pixelMatrix,r.globeMatrix),n=[0,-e.ab,0,1],o=[0,e.ab,0,1],s=[0,0,0,1];e.a7.transformMat4(n,n,i),e.a7.transformMat4(o,o,i),e.a7.transformMat4(s,s,i);const a=new e.P(n[0]/n[3],n[1]/n[3]),l=new e.P(o[0]/o[3],o[1]/o[3]),c=e.a8(t,a)&&n[3]<s[3],u=e.a8(t,l)&&o[3]<s[3];if(!c&&!u)return null;const h=function(e,t,r){for(let i=1;i<e.length;i++){const n=Ie(t.pointCoordinate3D(e[i-1]).x),o=Ie(t.pointCoordinate3D(e[i]).x);if(r<0){if(n<o)return{idx:i,t:-n/(o-1-n)}}else if(o<n)return{idx:i,t:(1-n)/(o+1-n)}}return null}(t,r,c?-1:1);if(!h)return null;const{idx:d,t:p}=h;let f=d>1?Ae(t.slice(0,d),r):[],m=d<t.length?Ae(t.slice(d),r):[];f=f.map((t=>new e.P(Ie(t.x),t.y))),m=m.map((t=>new e.P(Ie(t.x),t.y)));const _=[...f];0===_.length&&_.push(m[m.length-1]);const g=e.U(_[_.length-1].y,(0===m.length?f[0]:m[0]).y,p);let y;return y=c?[new e.P(0,g),new e.P(0,0),new e.P(1,0),new e.P(1,g)]:[new e.P(1,g),new e.P(1,1),new e.P(0,1),new e.P(0,g)],_.push(...y),0===m.length?_.push(f[0]):_.push(...m),{polygon:_.map((t=>new e.L(t.x,t.y))),unwrapped:!1}}(t,r);if(i)return i;const n=function(t,r){let i=!1,n=-1/0,o=0;for(let e=0;e<t.length-1;e++)t[e].x>n&&(n=t[e].x,o=e);for(let e=0;e<t.length-1;e++){const r=(o+e)%(t.length-1),n=t[r],s=t[r+1];Math.abs(n.x-s.x)>.5&&(n.x<s.x?(n.x+=1,0===r&&(t[t.length-1].x+=1)):(s.x+=1,r+1===t.length-1&&(t[0].x+=1)),i=!0)}const s=e.a5(r.center.lng);return i&&s<Math.abs(s-1)&&t.forEach((e=>{e.x-=1})),{polygon:t,unwrapped:i}}(Ae(t,r).map((t=>new e.P(Ie(t.x),t.y))),r);return{polygon:n.polygon.map((t=>new e.L(t.x,t.y))),unwrapped:n.unwrapped}}}function Ae(t,r){return e.a9(t,(e=>{const t=r.pointCoordinate3D(e);e.x=t.x,e.y=t.y}),1/256)}function Ie(e){return e<0?1+e%1:e%1}function Ce(e){return 100*e|0}function Pe(t,r,i,n,o){const s=function(i,n){if(i)return o(i);if(n){t.url&&n.tiles&&t.tiles&&delete t.tiles;const i=e.ac(e.e(n,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);n.vector_layers&&(i.vectorLayers=n.vector_layers,i.vectorLayerIds=i.vectorLayers.map((e=>e.id))),n.raster_layers&&(i.rasterLayers=n.raster_layers,i.rasterLayerIds=i.rasterLayers.map((e=>e.id))),i.tiles=r.canonicalizeTileset(i,t.url),o(null,i)}};return t.url?e.g(r.transformRequest(r.normalizeSourceURL(t.url,null,i,n),e.R.Source),s):e.f.frame((()=>s(null,t)))}class Le{constructor(t,r,i){this.bounds=e.ad.convert(this.validateBounds(t)),this.minzoom=r||0,this.maxzoom=i||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(t){const r=Math.pow(2,t.z),i=Math.floor(e.a5(this.bounds.getWest())*r),n=Math.floor(e.ae(this.bounds.getNorth())*r),o=Math.ceil(e.a5(this.bounds.getEast())*r),s=Math.ceil(e.ae(this.bounds.getSouth())*r);return t.x>=i&&t.x<o&&t.y>=n&&t.y<s}}class Re extends e.E{constructor(t,r,i,n){if(super(),this.id=t,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.e(this,e.ac(r,["url","scheme","tileSize","promoteId"])),this._options=e.e({type:"vector"},r),this._collectResourceTiming=!!r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(n),this._tileWorkers={},this._deduped=new e.af}load(t){this._loaded=!1,this.fire(new e.b("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map._worldview;this._tileJSONRequest=Pe(this._options,this.map._requestManager,r,i,((n,o)=>{this._tileJSONRequest=null,this._loaded=!0,n?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),i&&2!==i.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${i}`),this.fire(new e.a(n))):o&&(e.e(this,o),o.bounds&&(this.tileBounds=new Le(o.bounds,this.minzoom,this.maxzoom)),e.aj(o.tiles,this.map._requestManager._customAccessToken),this.fire(new e.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.b("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.ag(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return e.e({},this._options)}loadTile(t,r){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(i,e.R.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:e.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster};if(n.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=r:t.request=t.actor.send("reloadTile",n,o.bind(this));else if(t.actor=this._tileWorkers[i]=this._tileWorkers[i]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",n,o.bind(this),void 0,!0);else{const r=e.ah.call({deduped:this._deduped},n,((e,r)=>{e||!r?o.call(this,e):(n.data={cacheControl:r.cacheControl,expires:r.expires,rawData:r.rawData.slice(0)},t.actor&&t.actor.send("loadTile",n,o.bind(this),void 0,!0))}),!0);t.request={cancel:r}}function o(i,n){return delete t.request,t.aborted?r(null):i&&404!==i.status?r(i):(n&&n.resourceTiming&&(t.resourceTiming=n.resourceTiming),this.map._refreshExpiredTiles&&n&&t.setExpiryData(n),t.loadVectorData(n,this.map.painter),e.ai(this.dispatcher),r(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e){e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class De extends e.E{constructor(t,r,i,n){super(),this.id=t,this.dispatcher=i,this.setEventedParent(n),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.e({type:"raster"},r),e.e(this,e.ac(r,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new e.b("dataloading",{dataType:"source"})),this._tileJSONRequest=Pe(this._options,this.map._requestManager,null,null,((r,i)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new e.a(r)):i&&(e.e(this,i),i.bounds&&(this.tileBounds=new Le(i.bounds,this.minzoom,this.maxzoom)),e.aj(i.tiles),this.fire(new e.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.b("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.ag(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return e.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,r){const i=e.f.devicePixelRatio>=2,n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),i,this.tileSize);t.request=e.d(this.map._requestManager.transformRequest(n,e.R.Tile),((i,n,o,s)=>(delete t.request,t.aborted?(t.state="unloaded",r(null)):i?(t.state="errored",r(i)):n?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:o,expires:s}),t.setTexture(n,this.map.painter),t.state="loaded",e.ai(this.dispatcher),void r(null)):r(null))))}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t()}unloadTile(t,r){t.texture&&t.texture instanceof e.T?(t.destroy(!0),t.texture&&t.texture instanceof e.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),r()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Oe extends De{constructor(t,r,i,n){super(t,r,i,n),this.type="raster-array",this.maxzoom=22,this._options=e.e({type:"raster-array"},r)}triggerRepaint(e){const t=this.map.painter._terrain,r=this.map.style.getSourceCache(this.id);t&&t.enabled&&r&&t._clearRenderCacheForTile(r.id,e.tileID),this.map.triggerRepaint()}loadTile(t,r){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),n=this.map._requestManager.transformRequest(i,e.R.Tile);t.requestParams=n,t.actor||(t.actor=this.dispatcher.getActor()),t.request=t.fetchHeader(void 0,((e,i,n,o)=>{if(delete t.request,t.aborted)return t.state="unloaded",r(null);if(e){if(20===e.code)return;return t.state="errored",r(e)}this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:n,expires:o}),t.state="empty",r(null)}))}unloadTile(t){const r=t.texture;r&&r instanceof e.T?(t.destroy(!0),this.map.painter.saveTileTexture(r)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,r,i){t._isHeaderLoaded&&("empty"!==t.state&&(t.state="reloading"),t.fetchBand(r,i,((r,i)=>{if(r)return t.state="errored",this.fire(new e.a(r)),void this.triggerRepaint(t);i&&(t.setTexture(i,this.map.painter),t.state="loaded",this.triggerRepaint(t))})))}getInitialBand(e){if(!this.rasterLayers)return 0;const t=this.rasterLayers.find((({id:t})=>t===e)),r=t&&t.fields,i=r&&r.bands&&r.bands;return i?i[0]:0}getTextureDescriptor(t,r,i){if(!t)return;const n=r.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!n)return;let o=null;r instanceof e.an?o=r.paint.get("raster-array-band"):r instanceof e.ao&&(o=r.paint.get("raster-particle-array-band"));const s=o||this.getInitialBand(n);if(null!=s)if(t.textureDescriptor){if(!t.updateNeeded(n,s)||i)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,n,s)}}const ze=32,ke=33,Fe=new Uint16Array(8184);for(let wa=0;wa<2046;wa++){let e=wa+2,t=0,r=0,i=0,n=0,o=0,s=0;for(1&e?i=n=o=ze:t=r=s=ze;(e>>=1)>1;){const a=t+i>>1,l=r+n>>1;1&e?(i=t,n=r,t=o,r=s):(t=i,r=n,i=o,n=s),o=a,s=l}const a=4*wa;Fe[a+0]=t,Fe[a+1]=r,Fe[a+2]=i,Fe[a+3]=n}const Be=new Uint16Array(2178),Ne=new Uint8Array(1089),Ue=new Uint16Array(1089);function Ve(e){return 0===e?-.03125:32===e?.03125:0}class je{constructor(e,t,r,i){this.id=je.uniqueIdxCounter,je.uniqueIdxCounter++,this.context=e;const n=e.gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(r),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||i||t.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=je.uniqueIdxCounter,je.uniqueIdxCounter++;const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}je.uniqueIdxCounter=0;const Ge={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class $e{constructor(e,t,r,i,n,o){this.length=t.length,this.attributes=r,this.itemSize=t.bytesPerElement,this.dynamicDraw=i,this.instanceCount=o,this.context=e;const s=e.gl;this.buffer=s.createBuffer(),e.bindVertexBuffer.set(this.buffer),s.bufferData(s.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||n||t.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let r=0;r<this.attributes.length;r++){const i=t.attributes[this.attributes[r].name];void 0!==i&&e.enableVertexAttribArray(i)}}setVertexAttribPointers(e,t,r){for(let i=0;i<this.attributes.length;i++){const n=this.attributes[i],o=t.attributes[n.name];void 0!==o&&e.vertexAttribPointer(o,n.components,e[Ge[n.type]],!1,this.itemSize,n.offset+this.itemSize*(r||0))}}setVertexAttribDivisor(e,t,r){for(let i=0;i<this.attributes.length;i++){const n=t.attributes[this.attributes[i].name];void 0!==n&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(n,r)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class qe{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ze extends qe{getDefault(){return e.ax.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class We extends qe{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class He extends qe{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Xe extends qe{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ye extends qe{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Ke extends qe{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Je extends qe{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Qe extends qe{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class et extends qe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class tt extends qe{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class rt extends qe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class it extends qe{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class nt extends qe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class ot extends qe{getDefault(){const e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class st extends qe{getDefault(){return e.ax.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class at extends qe{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class lt extends qe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class ct extends qe{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class ut extends qe{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let ht=class extends qe{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class dt extends qe{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class pt extends qe{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ft extends qe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class mt extends qe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class _t extends qe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class gt extends qe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class yt extends qe{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class xt extends qe{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class vt extends qe{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class bt extends qe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class wt extends qe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Tt extends qe{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class Et extends Tt{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class St extends Tt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Mt extends Tt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,this.attachment(),t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class At extends St{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class It{constructor(e,t,r,i,n){this.context=e,this.width=t,this.height=r;const o=this.framebuffer=e.gl.createFramebuffer();i&&(this.colorAttachment=new Et(e,o)),n&&(this.depthAttachmentType=n,this.depthAttachment="renderbuffer"===n?new St(e,o):new Mt(e,o))}destroy(){const e=this.context.gl;if(this.colorAttachment){const t=this.colorAttachment.get();t&&e.deleteTexture(t)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}else{const t=this.depthAttachment.get();t&&e.deleteTexture(t)}e.deleteFramebuffer(this.framebuffer)}}class Ct{constructor(e,t,r){this.func=e,this.mask=t,this.range=r}}Ct.ReadOnly=!1,Ct.ReadWrite=!0,Ct.disabled=new Ct(519,Ct.ReadOnly,[0,1]);const Pt=7680;class Lt{constructor(e,t,r,i,n,o){this.test=e,this.ref=t,this.mask=r,this.fail=i,this.depthFail=n,this.pass=o}}Lt.disabled=new Lt({func:519,mask:0},0,0,Pt,Pt,Pt);const Rt=771;class Dt{constructor(e,t,r,i){this.blendFunction=e,this.blendColor=t,this.mask=r,this.blendEquation=i}}Dt.Replace=[1,0,1,0],Dt.disabled=new Dt(Dt.Replace,e.ax.transparent,[!1,!1,!1,!1]),Dt.unblended=new Dt(Dt.Replace,e.ax.transparent,[!0,!0,!0,!0]),Dt.alphaBlended=new Dt([1,Rt,1,Rt],e.ax.transparent,[!0,!0,!0,!0]),Dt.multiply=new Dt([774,0,774,0],e.ax.transparent,[!0,!0,!0,!0]);const Ot=1029,zt=2305;class kt{constructor(e,t,r){this.enable=e,this.mode=t,this.frontFace=r}}kt.disabled=new kt(!1,Ot,zt),kt.backCCW=new kt(!0,Ot,zt),kt.backCW=new kt(!0,Ot,2304),kt.frontCW=new kt(!0,1028,2304),kt.frontCCW=new kt(!0,1028,zt);class Ft{constructor(e,t){this.gl=e,this.clearColor=new Ze(this),this.clearDepth=new We(this),this.clearStencil=new He(this),this.colorMask=new Xe(this),this.depthMask=new Ye(this),this.stencilMask=new Ke(this),this.stencilFunc=new Je(this),this.stencilOp=new Qe(this),this.stencilTest=new et(this),this.depthRange=new tt(this),this.depthTest=new rt(this),this.depthFunc=new it(this),this.blend=new nt(this),this.blendFunc=new ot(this),this.blendColor=new st(this),this.blendEquation=new at(this),this.cullFace=new lt(this),this.cullFaceSide=new ct(this),this.frontFace=new ut(this),this.program=new ht(this),this.activeTexture=new dt(this),this.viewport=new pt(this),this.bindFramebuffer=new ft(this),this.bindRenderbuffer=new mt(this),this.bindTexture=new _t(this),this.bindVertexBuffer=new gt(this),this.bindElementBuffer=new yt(this),this.bindVertexArrayOES=new xt(this),this.pixelStoreUnpack=new vt(this),this.pixelStoreUnpackPremultiplyAlpha=new bt(this),this.pixelStoreUnpackFlipY=new wt(this),this.options=t?{...t}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxPointSize=e.getParameter(e.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t,r){return new je(this,e,t,r)}createVertexBuffer(e,t,r,i,n){return new $e(this,e,t,r,i,n)}createRenderbuffer(e,t,r){const i=this.gl,n=i.createRenderbuffer();return this.bindRenderbuffer.set(n),i.renderbufferStorage(i.RENDERBUFFER,e,t,r),this.bindRenderbuffer.set(null),n}createFramebuffer(e,t,r,i){return new It(this,e,t,r,i)}clear({color:e,depth:t,stencil:r,colorMask:i}){const n=this.gl;let o=0;e&&(o|=n.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set(i||[!0,!0,!0,!0])),void 0!==t&&(o|=n.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==r&&(o|=n.STENCIL_BUFFER_BIT,this.clearStencil.set(r),this.stencilMask.set(255)),n.clear(o)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){t(e.blendFunction,Dt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor),e.blendEquation?this.blendEquation.set(e.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(e.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var Bt=e.ay([{name:"a_pos",type:"Float32",components:3}]);class Nt{constructor(t,r,i,n){const o={width:i[0],height:i[1],data:null},s=t.gl;this.targetColorTexture=new e.T(t,o,s.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new e.T(t,o,s.RGBA,{useMipmap:!1}),this.context=t,this.setNumParticles(r,n),this.lastInvalidatedAt=0}setNumParticles(t,r){if(this.numParticles===r)return;(this.particleVertices0||this.particleVertices1||this.particleSegment)&&(this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy());const i=new e.az;i.reserve(Math.round(r));const n=e.aA(t.key);for(let e=0;e<r;e++)i.emplaceBack(n(),n(),n());this.particleVertices0=this.context.createVertexBuffer(i,Bt.members,!0),this.particleVertices1=this.context.createVertexBuffer(i,Bt.members,!0),this.particleSegment=e.aB.simpleSegment(0,0,this.particleVertices0.length,0),this.numParticles=r}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=e.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy()}}const Ut={type:2,extent:e.V,loadGeometry:()=>[[new e.P(0,0),new e.P(e.V+1,0),new e.P(e.V+1,e.V+1),new e.P(0,e.V+1),new e.P(0,0)]]};class Vt{constructor(t,r,i,n,o){this.tileID=t,this.uid=e.aC(),this.uses=0,this.tileSize=r,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=o,n&&n.style&&(this._lastUpdatedBrightness=n.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",n&&n.transform&&(this.projection=n.transform.projection)}registerFadeDuration(t){const r=t+this.timeAdded;r<e.f.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=e.as(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,r,i){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(e,t){const r={};if(!t)return r;for(const i of e){const e=i.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){i.layers=e,i.stateDependentLayerIds&&(i.stateDependentLayers=i.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)r[t.fqid]=i}}return r}(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const r=this.buckets[t];if(r instanceof e.aE){if(this.hasSymbolBuckets=!0,!i)break;r.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const r=this.buckets[t];if(r instanceof e.aE&&r.hasRTLText){this.hasRTLText=!0,e.aF();break}}this.queryPadding=0;for(const e in this.buckets){const t=this.buckets[e],i=r.style.getOwnLayer(e);if(!i)continue;const n=i.queryRadius(t);this.queryPadding=Math.max(this.queryPadding,n)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new e.aD}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(t){for(const e in this.buckets){const r=this.buckets[e];r.uploadPending()&&r.upload(t)}const r=t.gl,i=this.imageAtlas;if(i&&!i.uploaded){const n=!!Object.keys(i.patternPositions).length;this.imageAtlasTexture=new e.T(t,i.image,r.RGBA,{useMipmap:n}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new e.T(t,this.glyphAtlasImage,r.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new e.T(t,this.lineAtlas.image,r.R8),this.lineAtlas.uploaded=!0)}prepare(e,t,r){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,r),!t||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const i=t.style.getBrightness();(this._lastUpdatedBrightness||i)&&(this._lastUpdatedBrightness&&i&&Math.abs(this._lastUpdatedBrightness-i)<.001||(this._lastUpdatedBrightness=i,this.updateBuckets(void 0,t)))}queryRenderedFeatures(e,t,r,i,n,o,s,a){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:i,pixelPosMatrix:s,transform:o,params:n,tileTransform:this.tileTransform},e,t,r):{}}querySourceFeatures(t,r){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const n=i.loadVTLayers(),o=r?r.sourceLayer:"",s=n._geojsonTileLayer||n[o];if(!s)return;const a=e.aG(r&&r.filter),{z:l,x:c,y:u}=this.tileID.canonical,h={z:l,x:c,y:u};for(let d=0;d<s.length;d++){const r=s.feature(d);if(a.needGeometry){const t=e.aH(r,!0);if(!a.filter(new e.K(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!a.filter(new e.K(this.tileID.overscaledZ),r))continue;const n=i.getId(r,o),p=new e.aI(r,l,c,u,n);p.tile=h,t.push(p)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const r=e.aJ(t.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const e=Date.now();let t=!1;if(this.expirationTime>e)t=!1;else if(r)if(this.expirationTime<r)t=!0;else{const i=this.expirationTime-r;i?this.expirationTime=e+Math.max(i,3e4):t=!0}else t=!0;t?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length&&t&&this.updateBuckets(e,t)}updateBuckets(t,r){if(!this.latestFeatureIndex)return;const i=this.latestFeatureIndex.loadVTLayers(),n=r.style.listImages(),o=r.style.getBrightness();for(const s in this.buckets){if(!r.style.hasLayer(s))continue;const a=this.buckets[s],l=a.layers[0].sourceLayer||"_geojsonTileLayer",c=i[l];let u={};if(t&&(u=t[l],!c||!u||0===Object.keys(u).length))continue;if(a.update(u,c,n,this.imageAtlas&&this.imageAtlas.patternPositions||{},o),a instanceof e.aK||a instanceof e.aL){const e=r.style.getOwnSourceCache(a.layers[0].source);r._terrain&&r._terrain.enabled&&e&&a.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(e.id,this.tileID)}const h=r&&r.style&&r.style.getOwnLayer(s);h&&(this.queryPadding=Math.max(this.queryPadding,h.queryRadius(a)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<e.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=e.f.now()+t}setTexture(t,r){const i=r.context,n=i.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof e.T?this.texture.update(t,{useMipmap:!0}):(this.texture=new e.T(i,t,n.RGBA,{useMipmap:!0}),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE))}setDependencies(e,t){const r={};for(const i of t)r[i]=!0;this.dependencies[e]=r}hasDependency(e,t){for(const r of e){const e=this.dependencies[r];if(e)for(const r of t)if(e[r])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,r){if(!r||"mercator"===r.name||this._tileDebugBuffer)return;const i=e.aM(Ut,this.tileID.canonical,this.tileTransform)[0],n=new e.aN,o=new e.aO;for(let e=0;e<i.length;e++){const{x:t,y:r}=i[e];n.emplaceBack(t,r),o.emplaceBack(e)}o.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(o),this._tileDebugBuffer=t.createVertexBuffer(n,e.aP.members),this._tileDebugSegments=e.aB.simpleSegment(0,0,n.length,o.length)}_makeTileBoundsBuffers(t,r){if(this._tileBoundsBuffer||!r||"mercator"===r.name)return;const i=e.aM(Ut,this.tileID.canonical,this.tileTransform)[0];let n,o;if(this.isRaster){const t=function(t,r){const i=e.as(t,r),n=Math.pow(2,t.z);for(let u=0;u<ke;u++)for(let o=0;o<ke;o++){const s=e.at((t.x+(o+Ve(o))/ze)/n),a=e.au((t.y+(u+Ve(u))/ze)/n),l=r.project(s,a),c=u*ke+o;Be[2*c+0]=Math.round((l.x*i.scale-i.x)*e.V),Be[2*c+1]=Math.round((l.y*i.scale-i.y)*e.V)}Ne.fill(0),Ue.fill(0);for(let e=2045;e>=0;e--){const t=4*e,r=Fe[t+0],i=Fe[t+1],n=Fe[t+2],o=Fe[t+3],s=r+n>>1,a=i+o>>1,l=s+a-i,c=a+r-s,u=i*ke+r,h=o*ke+n,d=a*ke+s,p=Math.hypot((Be[2*u+0]+Be[2*h+0])/2-Be[2*d+0],(Be[2*u+1]+Be[2*h+1])/2-Be[2*d+1])>=16;Ne[d]=Ne[d]||(p?1:0),e<1022&&(Ne[d]=Ne[d]||Ne[(i+c>>1)*ke+(r+l>>1)]||Ne[(o+c>>1)*ke+(n+l>>1)])}const o=new e.av,s=new e.aw;let a=0;function l(t,r){const i=r*ke+t;return 0===Ue[i]&&(o.emplaceBack(Be[2*i+0],Be[2*i+1],t*e.V/ze,r*e.V/ze),Ue[i]=++a),Ue[i]-1}function c(e,t,r,i,n,o){const a=e+r>>1,u=t+i>>1;if(Math.abs(e-n)+Math.abs(t-o)>1&&Ne[u*ke+a])c(n,o,e,t,a,u),c(r,i,n,o,a,u);else{const a=l(e,t),c=l(r,i),u=l(n,o);s.emplaceBack(a,c,u)}}return c(0,0,ze,ze,ze,0),c(ze,ze,0,0,0,ze),{vertices:o,indices:s}}(this.tileID.canonical,r);n=t.vertices,o=t.indices}else{n=new e.av,o=new e.aw;for(const{x:e,y:r}of i)n.emplaceBack(e,r,0,0);const t=e.aQ(n.int16,void 0,4);for(let e=0;e<t.length;e+=3)o.emplaceBack(t[e],t[e+1],t[e+2])}this._tileBoundsBuffer=t.createVertexBuffer(n,e.aR.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(o),this._tileBoundsSegments=e.aB.simpleSegment(0,0,n.length,o.length)}_makeGlobeTileDebugBuffers(t,r){const i=r.projection;if(!i||"globe"!==i.name||r.freezeTileCoverage)return;const n=this.tileID.canonical,o=e.aS(n,r),s=e.aT(o),a=e.S(r.zoom);let l;a>0&&(l=e.a6.invert(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,n,r,s,l,a),this._makeGlobeTileDebugTextBuffer(t,n,r,s,l,a)}_globePoint(t,r,i,n,o,s,a){let l=e.aU(t,r,i);if(s){const o=1<<i.z,c=e.a5(n.center.lng),u=e.ae(n.center.lat),h=(i.x+.5)/o-c;let d=0;h>.5?d=-1:h<-.5&&(d=1);let p=(t/e.V+i.x)/o+d,f=(r/e.V+i.y)/o;p=(p-c)*n._pixelsPerMercatorPixel+c,f=(f-u)*n._pixelsPerMercatorPixel+u;const m=[p*n.worldSize,f*n.worldSize,0];e.N.transformMat4(m,m,s),l=e.aV(l,m,a)}return e.N.transformMat4(l,l,o)}_makeGlobeTileDebugBorderBuffer(t,r,i,n,o,s){const a=new e.aN,l=new e.aO,c=new e.aW,u=(e,t,u,h,d)=>{const p=(u-e)/(d-1),f=(h-t)/(d-1),m=a.length;for(let _=0;_<d;_++){const u=e+_*p,h=t+_*f;a.emplaceBack(u,h);const d=this._globePoint(u,h,r,i,n,o,s);c.emplaceBack(d[0],d[1],d[2]),l.emplaceBack(m+_)}},h=e.V;u(0,0,h,0,16),u(h,0,h,h,16),u(h,h,0,h,16),u(0,h,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(l),this._tileDebugBuffer=t.createVertexBuffer(a,e.aP.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(c,e.aX.members),this._tileDebugSegments=e.aB.simpleSegment(0,0,a.length,l.length)}_makeGlobeTileDebugTextBuffer(t,r,i,n,o,s){const a=e.V/4,l=new e.aN,c=new e.aw,u=new e.aW,h=25;c.reserve(32),l.reserve(h),u.reserve(h);const d=(e,t)=>h*e+t;for(let e=0;e<h;e++){const t=e*a;for(let e=0;e<h;e++){const c=e*a;l.emplaceBack(c,t);const h=this._globePoint(c,t,r,i,n,o,s);u.emplaceBack(h[0],h[1],h[2])}}for(let e=0;e<4;e++)for(let t=0;t<4;t++){const r=d(e,t),i=d(e,t+1),n=d(e+1,t),o=d(e+1,t+1);c.emplaceBack(r,i,n),c.emplaceBack(n,i,o)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(c),this._tileDebugTextBuffer=t.createVertexBuffer(l,e.aP.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(u,e.aX.members),this._tileDebugTextSegments=e.aB.simpleSegment(0,0,h,32)}destroy(t=!1){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof e.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}const jt={vector:Re,raster:De,"raster-dem":class extends De{constructor(t,r,i,n){super(t,r,i,n),this.type="raster-dem",this.maxzoom=22,this._options=e.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(t,r){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function n(e,i){e&&(t.state="errored",r(e)),i&&(t.dem=i,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",r(null))}t.request=e.d(this.map._requestManager.transformRequest(i,e.R.Tile),function(i,o,s,a){if(delete t.request,t.aborted)t.state="unloaded",r(null);else if(i)t.state="errored",r(i);else if(o){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:s,expires:a});const r=ImageBitmap&&o instanceof ImageBitmap&&e.ak(),i=1-(o.width-e.al(o.width))/2;i<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const l=r?o:e.f.getImageData(o,i),c={uid:t.uid,coord:t.tileID,source:this.id,scope:this.scope,rawImageData:l,encoding:this.encoding,padding:i};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",c,n.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(t){const r=t.canonical,i=Math.pow(2,r.z),n=(r.x-1+i)%i,o=0===r.x?t.wrap-1:t.wrap,s=(r.x+1+i)%i,a=r.x+1===i?t.wrap+1:t.wrap,l={};return l[new e.am(t.overscaledZ,o,r.z,n,r.y).key]={backfilled:!1},l[new e.am(t.overscaledZ,a,r.z,s,r.y).key]={backfilled:!1},r.y>0&&(l[new e.am(t.overscaledZ,o,r.z,n,r.y-1).key]={backfilled:!1},l[new e.am(t.overscaledZ,t.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},l[new e.am(t.overscaledZ,a,r.z,s,r.y-1).key]={backfilled:!1}),r.y+1<i&&(l[new e.am(t.overscaledZ,o,r.z,n,r.y+1).key]={backfilled:!1},l[new e.am(t.overscaledZ,t.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},l[new e.am(t.overscaledZ,a,r.z,s,r.y+1).key]={backfilled:!1}),l}},"raster-array":Oe,geojson:class extends e.E{constructor(t,r,i,n){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(n),this._data=r.data,this._options=e.e({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const o=e.V/this.tileSize;this.workerOptions=e.e({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*o,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*o,extent:e.V,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:e.V,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*o,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,r,i){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:r},i),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new e.b("dataloading",{dataType:"source"})),this._loaded=!1;const t=e.e({},this.workerOptions);t.scope=this.scope;const r=this._data;"string"==typeof r?(t.request=this.map._requestManager.transformRequest(e.f.resolveURL(r),e.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,((t,r)=>{if(this._loaded=!0,this._pendingLoad=null,t)this.fire(new e.a(t));else{const t={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&r&&r.resourceTiming&&r.resourceTiming[this.id]&&(t.resourceTiming=r.resourceTiming[this.id]),this.fire(new e.b("data",t)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(t,r){const i=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const n={type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:e.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};t.request=this.actor.send(i,n,((e,n)=>(delete t.request,t.destroy(),t.aborted?r(null):e?r(e):(t.loadVectorData(n,this.map.painter,"reloadTile"===i),r(null)))),void 0,"loadTile"===i)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return e.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends e.ap{constructor(e,t,r,i){super(e,t,r,i),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const r of t.urls)this.urls.push(this.map._requestManager.transformRequest(r,e.R.Source).url);e.aq(this.urls,((t,r)=>{this._loaded=!0,t?this.fire(new e.a(t)):r&&(this.video=r,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const r=this.video.seekable;t<r.start(0)||t>r.end(0)?this.fire(new e.a(new T(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,r=t.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new e.T(t,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:e.ap,model:class extends e.E{constructor(e,t,r,i){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const t=[];for(const r in this._options.models){const i=this._options.models[r],n=e.l(this.map._requestManager.transformRequest(i.uri,e.R.Model).url).then((t=>{if(!t)return;const n=e.c(t),o=new e.M(r,i.position,i.orientation,n);o.computeBoundsAndApplyParent(),this.models.push(o)})).catch((t=>{this.fire(new e.a(new Error(`Could not load model ${r} from ${i.uri}: ${t.message}`)))}));t.push(n)}return Promise.allSettled(t).then((()=>{this._loaded=!0,this.fire(new e.b("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((t=>{this.fire(new e.a(new Error(`Could not load models: ${t.message}`)))}))}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return{type:"model"}}},"batched-model":class extends e.E{constructor(e,t,r,i){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=r,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(i)}onAdd(e){this.map=e,this.load()}load(t){this._loaded=!1,this.fire(new e.b("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map._worldview;this._tileJSONRequest=Pe(this._options,this.map._requestManager,r,i,((n,o)=>{this._tileJSONRequest=null,this._loaded=!0,n?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),i&&2!==i.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${i}`),this.fire(new e.a(n))):o&&(e.e(this,o),o.bounds&&(this.tileBounds=new Le(o.bounds,this.minzoom,this.maxzoom)),e.aj(o.tiles,this.map._requestManager._customAccessToken),this.fire(new e.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.b("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)}))}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(t,r){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(i,e.R.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(t.actor&&"expired"!==t.state)if("loading"===t.state)t.reloadCallback=r;else{if(t.buckets){const e=Object.values(t.buckets);for(const t of e)t.dirty=!0;return void(t.state="loaded")}t.request=t.actor.send("reloadTile",n,o.bind(this))}else t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",n,o.bind(this),void 0,!0);function o(e,i){return t.aborted?r(null):e&&404!==e.status?r(e):(i&&(i.resourceTiming&&(t.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&t.setExpiryData(i),t.buckets={...t.buckets,...i.buckets},i.featureIndex&&(t.latestFeatureIndex=i.featureIndex)),t.state="loaded",void r(null))}}serialize(){return e.e({},this._options)}},canvas:class extends e.ap{constructor(t,r,i,n){super(t,r,i,n),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new e.a(new T(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.a(new T(`sources.${t}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new e.a(new T(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof HTMLCanvasElement||this.fire(new e.a(new T(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.a(new T(`sources.${t}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const r=this.map.painter.context;this.texture?!t&&!this._playing||this.texture instanceof e.ar||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.T(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends e.E{constructor(t,r,i,n){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=i,this._implementation=r,this.setEventedParent(n),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new e.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new e.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Le(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),e.e(this,e.ac(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return e.ac(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new e.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this._map=t,this._loaded=!1,this.fire(new e.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:r,z:i}=e.canonical;return this._implementation.hasTile({x:t,y:r,z:i})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){const{x:r,y:i,z:n}=e.tileID.canonical,o=new AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:r,y:i,z:n},{signal:o.signal})).then(function(r){return delete e.request,e.aborted?(e.state="unloaded",t(null)):void 0===r?(e.state="errored",t(null)):null===r?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",t(null)):function(e){return e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof ImageBitmap||e instanceof HTMLImageElement}(r)?(this.loadTileData(e,r),e.state="loaded",void t(null)):(e.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch((r=>{20!==r.code&&(e.state="errored",t(r))})),e.request.cancel=()=>o.abort()}loadTileData(e,t){e.setTexture(t,this._map.painter)}unloadTile(t,r){if(t.texture&&t.texture instanceof e.T?(t.destroy(!0),t.texture&&t.texture instanceof e.T&&this._map.painter.saveTileTexture(t.texture)):t.destroy(),this._implementation.unloadTile){const{x:e,y:r,z:i}=t.tileID.canonical;this._implementation.unloadTile({x:e,y:r,z:i})}r()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z})))}_clearTiles(){const t=e.ag(this.id,this.scope);this._map.style.clearSource(t)}_update(){this.fire(new e.b("data",{dataType:"source",sourceDataType:"content"}))}}},Gt=function(t,r,i,n){const o=new jt[r.type](t,r,i,n);if(o.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${o.id}`);return e.aY(["load","abort","unload","serialize","prepare"],o),o};function $t(t,r){const i=e.a6.identity([]);return e.a6.scale(i,i,[.5*t.width,.5*-t.height,1]),e.a6.translate(i,i,[1,-1,0]),e.a6.multiply(i,i,t.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(i)}function qt(e,t,r,i,n,o,s,a=!1){const l=e.tilesIn(i,s,a);l.sort(Wt);const c=[];for(const h of l)c.push({wrappedTileID:h.tile.tileID.wrapped().key,queryResults:h.tile.queryRenderedFeatures(t,r,e._state,h,n,o,$t(e.transform,h.tile.tileID),a)});const u=function(e){const t={},r={};for(const i of e){const e=i.queryResults,n=i.wrappedTileID,o=r[n]=r[n]||{};for(const r in e){const i=e[r],n=o[r]=o[r]||{},s=t[r]=t[r]||[];for(const e of i)n[e.featureIndex]||(n[e.featureIndex]=!0,s.push(e))}}return t}(c);for(const h in u)u[h].forEach((t=>{const r=t.feature,i=r.layer;i&&"background"!==i.type&&"sky"!==i.type&&"slot"!==i.type&&(r.source=i.source,i["source-layer"]&&(r.sourceLayer=i["source-layer"]),r.state=void 0!==r.id?e.getFeatureState(i["source-layer"],r.id):{})}));return u}function Zt(e,t){const r=e.getRenderableIds().map((t=>e.getTileByID(t))),i=[],n={};for(let o=0;o<r.length;o++){const e=r[o],s=e.tileID.canonical.key;n[s]||(n[s]=!0,e.querySourceFeatures(i,t))}return i}function Wt(e,t){const r=e.tileID,i=t.tileID;return r.overscaledZ-i.overscaledZ||r.canonical.y-i.canonical.y||r.wrap-i.wrap||r.canonical.x-i.canonical.x}class Ht extends Vt{constructor(e,t,r,i,n){super(e,t,r,i,n),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(t,r){const i=r.context,n=i.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof e.T?this.texture.update(t,{useMipmap:!1,premultiply:!1}):this.texture=new e.T(i,t,n.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,r){const i=this._mrt=new e.aZ(30),n=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=e.a_(n,((e,n,o,s)=>{if(e)r(e);else try{const e=i.getHeaderLength(n);if(e>t)return void(this.request=this.fetchHeader(e,r));i.parseHeader(n),this._isHeaderLoaded=!0;let a=0;for(const t of Object.values(i.layers))a=Math.max(a,t.dataIndex[t.dataIndex.length-1].last_byte);n.byteLength>=a&&(this.entireBuffer=n),r(null,this.entireBuffer||n,o,s)}catch(e){r(e)}})),this.request}fetchBand(t,r,i){const n=this._mrt;if(!this._isHeaderLoaded||!n)return void i(new Error("Tile header is not ready"));const o=this.actor;if(!o)return void i(new Error("Can't fetch tile band without an actor"));let s;const a=(e,n)=>{s.complete(e,n),e?i(e):(this.updateTextureDescriptor(t,r),i(null,this.textureDescriptor&&this.textureDescriptor.img))},l=(e,t)=>{if(e)return i(e);const r=o.send("decodeRasterArray",{buffer:t,task:s},a,void 0,!0);this._workQueue.push((()=>{r&&r.cancel(),s.cancel()}))},c=n.getLayer(t);if(!c)return void i(new Error(`Unknown sourceLayer "${t}"`));if(c.hasDataForBand(r))return this.updateTextureDescriptor(t,r),void i(null,this.textureDescriptor?this.textureDescriptor.img:null);const u=c.getDataRange([r]);if(s=n.createDecodingTask(u),!s||s.tasks.length)if(this.flushQueues(),this.entireBuffer)l(null,this.entireBuffer.slice(u.firstByte,u.lastByte+1));else{const t=Object.assign({},this.requestParams,{headers:{Range:`bytes=${u.firstByte}-${u.lastByte}`}}),r=e.a_(t,l);this._fetchQueue.push((()=>{r.cancel(),s.cancel()}))}else i(null)}updateNeeded(e,t){return(!this.textureDescriptor||this.textureDescriptor.band!==t||this.textureDescriptor.layer!==e)&&"errored"!==this.state}updateTextureDescriptor(t,r){if(!this._mrt)return;const i=this._mrt.getLayer(t);if(!i||!i.hasBand(r)||!i.hasDataForBand(r))return;const{bytes:n,tileSize:o,buffer:s,offset:a,scale:l}=i.getBandView(r),c=o+2*s,u={data:n,width:c,height:c},h=this.texture;h&&h instanceof e.T&&h.update(u,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:t,band:r,img:u,buffer:s,offset:a,tileSize:o,format:i.pixelFormat,mix:[l,256*l,65536*l,16777216*l]}}}class Xt{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,r){const i=e.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);const n={value:t,timeout:void 0};if(void 0!==r&&(n.timeout=setTimeout((()=>{this.remove(e,n)}),r)),this.data[i].push(n),this.order.push(i),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const r=e.wrapped().key,i=void 0===t?0:this.data[r].indexOf(t),n=this.data[r][i];return this.data[r].splice(i,1),n.timeout&&clearTimeout(n.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(n.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const r in this.data)for(const i of this.data[r])e(i.value)||t.push(i);for(const r of t)this.remove(r.value.tileID,r)}}class Yt extends e.E{constructor(e,t,r){super(),this.id=e,this._onlySymbols=r,t.on("data",(e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),t.on("error",(()=>{this._sourceErrored=!0})),this._source=t,this._tiles={},this._cache=new Xt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new v,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if("errored"!==t.state&&("loaded"!==t.state||!t.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,(()=>{}))}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,(()=>{}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const r=this._tiles[t];r.upload(e),r.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return e.a$(this._tiles).map((e=>e.tileID)).sort(Kt).map((e=>e.key))}getRenderableIds(t,r){const i=[];for(const e in this._tiles)this._isIdRenderable(+e,t,r)&&i.push(this._tiles[e]);return t?i.sort(((t,r)=>{const i=t.tileID,n=r.tileID,o=new e.P(i.canonical.x,i.canonical.y)._rotate(this.transform.angle),s=new e.P(n.canonical.x,n.canonical.y)._rotate(this.transform.angle);return i.overscaledZ-n.overscaledZ||s.y-o.y||s.x-o.x})).map((e=>e.tileID.key)):i.map((e=>e.tileID)).sort(Kt).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())&&(r||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const r=this._tiles[e];r&&("loading"!==r.state&&(r.state=t),this._loadTile(r,this._tileLoaded.bind(this,r,e,t)))}_tileLoaded(t,r,i,n){if(n)if(t.state="errored",404!==n.status)this._source.fire(new e.a(n,{tile:t}));else{if(!(t.tileID.key in this._loadedParentTiles))return void this._source.fire(new e.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=e.f.now(),"expired"===i&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new e.b("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let i=0;i<t.length;i++){const n=t[i];if(e.neighboringTiles&&e.neighboringTiles[n]){const t=this.getTileByID(n);r(e,t),r(t,e)}}function r(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let r=t.tileID.canonical.x-e.tileID.canonical.x;const i=t.tileID.canonical.y-e.tileID.canonical.y,n=Math.pow(2,e.tileID.canonical.z),o=t.tileID.key;0===r&&0===i||Math.abs(i)>1||(Math.abs(r)>1&&(1===Math.abs(r+n)?r+=n:1===Math.abs(r-n)&&(r-=n)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,r,i),e.neighboringTiles&&e.neighboringTiles[o]&&(e.neighboringTiles[o].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,r,i){for(const n in this._tiles){let o=this._tiles[n];if(i[n]||!o.hasData()||o.tileID.overscaledZ<=t||o.tileID.overscaledZ>r)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>t+1;){const e=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[e.key],o&&o.hasData()&&(s=e)}let a=s;for(;a.overscaledZ>t;)if(a=a.scaledTo(a.overscaledZ-1),e[a.key]){i[s.key]=s;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const r=this._loadedParentTiles[e.key];return r&&r.tileID.overscaledZ>=t?r:null}for(let r=e.overscaledZ-1;r>=t;r--){const t=e.scaledTo(r),i=this._getLoadedTile(t);if(i)return i}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const r=Math.ceil(e.width/t)+1,i=Math.ceil(e.height/t)+1,n=Math.floor(r*i*5),o="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,n):n,s="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(s)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const r in this._tiles){const i=this._tiles[r];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),e[i.tileID.key]=i}this._tiles=e;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(+t,this._tiles[t])}}update(t,r,i,n){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!i)return;let o;if(this.updateCacheSize(t,r),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)o=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((t=>new e.am(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)));else if(0!==this.tileCoverLift){const n=t.clone();n.tileCoverLift=this.tileCoverLift,o=n.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&"globe"===t.projection.name&&(o.push(new e.am(1,0,1,0,0)),o.push(new e.am(1,0,1,1,0)),o.push(new e.am(1,0,1,0,1)),o.push(new e.am(1,0,1,1,1)))}else o=t.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(o=o.filter((e=>this._source.hasTile(e))));else o=[];if(o.length>0&&this.castsShadows&&n&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!Jt(this._source.type)){const e=t.coveringZoomLevel({tileSize:r||this._source.tileSize,roundZoom:this._source.roundZoom&&!i}),s=Math.min(e,this._source.maxzoom),a=t.extendTileCoverForShadows(o,n,s);for(const t of a)this._shadowCasterTiles[t.key]=!0,o.push(t)}const s=this._updateRetainedTiles(o);if(Jt(this._source.type)&&0!==o.length){const t={},r={},i=Object.keys(s);for(const o of i){const i=s[o],n=this._tiles[o];if(!n||n.fadeEndTime&&n.fadeEndTime<=e.f.now())continue;const a=this.findLoadedParent(i,Math.max(i.overscaledZ-Yt.maxOverzooming,this._source.minzoom));a&&(this._addTile(a.tileID),t[a.tileID.key]=a.tileID),r[o]=i}const n=o[o.length-1].overscaledZ;for(const e in this._tiles){const t=this._tiles[e];if(s[e]||!t.hasData())continue;let i=t.tileID;for(;i.overscaledZ>n;){i=i.scaledTo(i.overscaledZ-1);const n=this._tiles[i.key];if(n&&n.hasData()&&r[i.key]){s[e]=t.tileID;break}}}for(const e in t)s[e]||(this._coveredTiles[e]=!0,s[e]=t[e])}for(const e in s)this._tiles[e].clearFadeHold();const a=e.b0(this._tiles,s);for(const e of a){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+e)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const r={},i=e.reduce(((e,t)=>Math.min(e,t.overscaledZ)),1/0),n=e[0].overscaledZ,o=Math.max(n-Yt.maxOverzooming,this._source.minzoom),s=Math.max(n+Yt.maxUnderzooming,this._source.minzoom),a={};for(const l of e){const e=this._addTile(l);t[l.key]=l,e.hasData()||i<this._source.maxzoom&&(a[l.key]=l)}this._retainLoadedChildren(a,i,s,t);for(const l of e){let e=this._tiles[l.key];if(e.hasData())continue;if(l.canonical.z>=this._source.maxzoom){const e=l.children(this._source.maxzoom)[0],r=this.getTile(e);if(r&&r.hasData()){t[e.key]=e;continue}}else{const e=l.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let i=e.wasRequested();for(let n=l.overscaledZ-1;n>=o;--n){const o=l.scaledTo(n);if(r[o.key])break;if(r[o.key]=!0,e=this.getTile(o),!e&&i&&(e=this._addTile(o)),e&&(t[o.key]=o,i=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let r,i=this._tiles[e].tileID;for(;i.overscaledZ>0;){if(i.key in this._loadedParentTiles){r=this._loadedParentTiles[i.key];break}t.push(i.key);const e=i.scaledTo(i.overscaledZ-1);if(r=this._getLoadedTile(e),r)break;i=e}for(const e of t)this._loadedParentTiles[e]=r}}_addTile(t){let r=this._tiles[t.key];if(r)return!0!==r.isExtraShadowCaster||!!this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const i=Boolean(r);if(!i){const e=this.map?this.map.painter:null,i=this._source.tileSize*t.overscaleFactor();r="raster-array"===this._source.type?new Ht(t,i,this.transform.tileZoom,e,this._isRaster):new Vt(t,i,this.transform.tileZoom,e,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))}return r?(r.uses++,this._tiles[t.key]=r,i||this._source.fire(new e.b("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const r=t.getExpiryTimeout();r&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),r))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state||"empty"===t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,r,i){const n=[],o=this.transform;if(!o)return n;const s="globe"===o.projection.name,a=e.a5(o.center.lng);for(const l in this._tiles){const c=this._tiles[l];if(i&&c.clearQueryDebugViz(),c.holdingForFade())continue;let u;if(s){const t=c.tileID.canonical;if(0===t.z){const r=[Math.abs(e.aa(a,...Qt(t,-1))-a),Math.abs(e.aa(a,...Qt(t,1))-a)];u=[0,2*r.indexOf(Math.min(...r))-1]}else{const r=[Math.abs(e.aa(a,...Qt(t,-1))-a),Math.abs(e.aa(a,...Qt(t,0))-a),Math.abs(e.aa(a,...Qt(t,1))-a)];u=[r.indexOf(Math.min(...r))-1]}}else u=[0];for(const e of u){const i=t.containsTile(c,o,r,e);i&&n.push(i)}}return n}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,t){const r=this.getRenderableIds(e,t).map((e=>this._tiles[e].tileID)),i="globe"===this.transform.projection.name;for(const n of r)n.projMatrix=this.transform.calculateProjMatrix(n.toUnwrapped()),n.expandedProjMatrix=i?this.transform.calculateProjMatrix(n.toUnwrapped(),!1,!0):n.projMatrix;return r}sortCoordinatesByDistance(e){const t=e.slice(),r=this.transform._camera.position,i=this.transform._camera.forward(),n={};for(const o of t){const e=1/(1<<o.canonical.z);n[o.key]=((o.canonical.x+.5)*e+o.wrap-r[0])*i[0]+((o.canonical.y+.5)*e-r[1])*i[1]-r[2]*i[2]}return t.sort(((e,t)=>n[e.key]-n[t.key])),t}hasTransition(){if(this._source.hasTransition())return!0;if(Jt(this._source.type))for(const t in this._tiles){const r=this._tiles[t];if(void 0!==r.fadeEndTime&&r.fadeEndTime>=e.f.now())return!0}return!1}setFeatureState(e,t,r){this._state.updateState(e=e||"_geojsonTileLayer",t,r)}removeFeatureState(e,t,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,r)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,r){const i=this._tiles[e];i&&i.setDependencies(t,r)}reloadTilesForDependencies(e,t){for(const r in this._tiles)this._tiles[r].hasDependency(e,t)&&this._reloadTile(+r,"reloading");this._cache.filter((r=>!r.hasDependency(e,t)))}_preloadTiles(t,r){if(!this._sourceLoaded){const e=()=>{this._sourceLoaded&&(this._source.off("data",e),this._preloadTiles(t,r))};return void this._source.on("data",e)}const i=new Map,n=Array.isArray(t)?t:[t],o=this.map.painter.terrain,s=this.usedForTerrain&&o?o.getScaledDemTileSize():this._source.tileSize;for(const e of n){const t=e.coveringTiles({tileSize:s,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const e of t)i.set(e.key,e);this.usedForTerrain&&e.updateElevation(!1)}const a=Array.from(i.values());e.b1(a,((e,t)=>{const r=new Vt(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(r,(e=>{"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),t(e,r)}))}),r)}}function Kt(e,t){const r=Math.abs(2*e.wrap)-+(e.wrap<0),i=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||i-r||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Jt(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function Qt(e,t){const r=1<<e.z;return[e.x/r+t,(e.x+1)/r+t]}Yt.maxOverzooming=10,Yt.maxUnderzooming=3;class er{constructor(e){this.style=e,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const e=!1,t=!1;for(const r in this.style._mergedLayers){const i=this.style._mergedLayers[r];if("fill-extrusion"===i.type)this.layers.push({layer:i,visible:e,visibilityChanged:t});else if("model"===i.type){const r=this.style.getLayerSource(i);r&&"batched-model"===r.type&&this.layers.push({layer:i,visible:e,visibilityChanged:t})}}}onNewFrame(e){this.layersGotHidden=!1;for(const t of this.layers){const r=t.layer;let i=!1;"fill-extrusion"===r.type?i=!r.isHidden(e)&&r.paint.get("fill-extrusion-opacity")>0:"model"===r.type&&(i=!r.isHidden(e)&&r.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!i&&t.visible,t.visible=i}}updateZOffset(e,t){this.currentBuildingBuckets=[];for(const i of this.layers){const e=i.layer,r=this.style.getLayerSourceCache(e);let n=1;"fill-extrusion"===e.type&&(n=i.visible?e.paint.get("fill-extrusion-vertical-scale"):0);let o=r?r.getTile(t):null;if(!o&&r&&t.canonical.z>r.getSource().minzoom){let e=t.scaledTo(Math.min(r.getSource().maxzoom,t.overscaledZ-1));for(;e.overscaledZ>=r.getSource().minzoom&&(o=r.getTile(e),!o&&0!==e.overscaledZ);)e=e.scaledTo(e.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:o?o.getBucket(e):null,tileID:o?o.tileID:t,verticalScale:n})}e.hasAnyZOffset=!1;let r=!1;for(let i=0;i<e.symbolInstances.length;i++){const n=e.symbolInstances.get(i),o=n.zOffset,s=this._getHeightAtTileOffset(t,n.tileAnchorX,n.tileAnchorY);n.zOffset=s!==Number.NEGATIVE_INFINITY?s:o,r||o===n.zOffset||(r=!0),e.hasAnyZOffset||0===n.zOffset||(e.hasAnyZOffset=!0)}r&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,r,i,n){let o=r,s=i;if(t.canonical.z!==n.canonical.z){const a=n.canonical,l=1/(1<<t.canonical.z-a.z);o=(r+t.canonical.x*e.V)*l-a.x*e.V|0,s=(i+t.canonical.y*e.V)*l-a.y*e.V|0}return{tileX:o,tileY:s}}_getHeightAtTileOffset(e,t,r){let i,n;for(let o=0;o<this.layers.length;++o){if("fill-extrusion"!==this.layers[o].layer.type)continue;const{bucket:s,tileID:a,verticalScale:l}=this.currentBuildingBuckets[o];if(!s)continue;const{tileX:c,tileY:u}=this._mapCoordToOverlappingTile(e,t,r,a),h=s.getHeightAtTileCoord(c,u);h&&void 0!==h.height&&(h.hidden?i=h.height:n=Math.max(h.height*l,n||0))}if(void 0!==n)return n;for(let o=0;o<this.layers.length;++o){const n=this.layers[o];if("model"!==n.layer.type||!n.visible)continue;const{bucket:s,tileID:a}=this.currentBuildingBuckets[o];if(!s)continue;const{tileX:l,tileY:c}=this._mapCoordToOverlappingTile(e,t,r,a),u=s.getHeightAtTileCoord(l,c);if(u&&!u.hidden)return void 0===u.height&&void 0!==i?Math.min(u.maxHeight,i)*u.verticalScale:(u.height||0)*u.verticalScale}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function tr(t,r){const i={};for(const e in t)"ref"!==e&&(i[e]=t[e]);return e.b2.forEach((e=>{e in r&&(i[e]=r[e])})),i}function rr(e){e=e.slice();const t=Object.create(null);for(let r=0;r<e.length;r++)t[e[r].id]=e[r];for(let r=0;r<e.length;r++)"ref"in e[r]&&(e[r]=tr(e[r],t[e[r].ref]));return e}const ir={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function nr(e,t,r){r.push({command:ir.addSource,args:[e,t[e]]})}function or(e,t,r){t.push({command:ir.removeSource,args:[e]}),r[e]=!0}function sr(e,t,r,i){or(e,r,i),nr(e,t,r)}function ar(e,r,i){let n;for(n in e[i])if(e[i].hasOwnProperty(n)&&"data"!==n&&!t(e[i][n],r[i][n]))return!1;for(n in r[i])if(r[i].hasOwnProperty(n)&&"data"!==n&&!t(e[i][n],r[i][n]))return!1;return!0}function lr(e,r,i,n,o,s){let a;for(a in r=r||{},e=e||{})e.hasOwnProperty(a)&&(t(e[a],r[a])||i.push({command:s,args:[n,a,r[a],o]}));for(a in r)r.hasOwnProperty(a)&&!e.hasOwnProperty(a)&&(t(e[a],r[a])||i.push({command:s,args:[n,a,r[a],o]}))}function cr(e){return e.id}function ur(e,t){return e[t.id]=t,e}class hr{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let r=1;r<this.points.length;r++)this._distances[r]=this._distances[r-1]+this.points[r].dist(this.points[r-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.aa(t,0,1);let r=1,i=this._distances[r];const n=t*this.paddedLength+this.padding;for(;i<n&&r<this._distances.length;)i=this._distances[++r];const o=r-1,s=this._distances[o],a=i-s,l=a>0?(n-s)/a:0;return this.points[o].mult(1-l).add(this.points[r].mult(l))}}class dr{constructor(e,t,r){const i=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(e/r),this.yCellCount=Math.ceil(t/r);for(let o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,r,i,n){this._forEachCell(t,r,i,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(n)}insertCircle(e,t,r,i){this._forEachCell(t-i,r-i,t+i,r+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(r),this.circles.push(i)}_insertBoxCell(e,t,r,i,n,o){this.boxCells[n].push(o)}_insertCircleCell(e,t,r,i,n,o){this.circleCells[n].push(o)}_query(e,t,r,i,n,o){if(r<0||e>this.width||i<0||t>this.height)return!n&&[];const s=[];if(e<=0&&t<=0&&this.width<=r&&this.height<=i){if(n)return!0;for(let e=0;e<this.boxKeys.length;e++)s.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],r=this.circles[3*e+1],i=this.circles[3*e+2];s.push({key:this.circleKeys[e],x1:t-i,y1:r-i,x2:t+i,y2:r+i})}return o?s.filter(o):s}return this._forEachCell(e,t,r,i,this._queryCell,s,{hitTest:n,seenUids:{box:{},circle:{}}},o),n?s.length>0:s}_queryCircle(e,t,r,i,n){const o=e-r,s=e+r,a=t-r,l=t+r;if(s<0||o>this.width||l<0||a>this.height)return!i&&[];const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:i,circle:{x:e,y:t,radius:r},seenUids:{box:{},circle:{}}},n),i?c.length>0:c}query(e,t,r,i,n){return this._query(e,t,r,i,!1,n)}hitTest(e,t,r,i,n){return this._query(e,t,r,i,!0,n)}hitTestCircle(e,t,r,i){return this._queryCircle(e,t,r,!0,i)}_queryCell(e,t,r,i,n,o,s,a){const l=s.seenUids,c=this.boxCells[n];if(null!==c){const n=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(e<=n[c+2]&&t<=n[c+3]&&r>=n[c+0]&&i>=n[c+1]&&(!a||a(this.boxKeys[u]))){if(s.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[u],x1:n[c],y1:n[c+1],x2:n[c+2],y2:n[c+3]})}}}const u=this.circleCells[n];if(null!==u){const n=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(n[u],n[u+1],n[u+2],e,t,r,i)&&(!a||a(this.circleKeys[c]))){if(s.hitTest)return o.push(!0),!0;{const e=n[u],t=n[u+1],r=n[u+2];o.push({key:this.circleKeys[c],x1:e-r,y1:t-r,x2:e+r,y2:t+r})}}}}}_queryCellCircle(e,t,r,i,n,o,s,a){const l=s.circle,c=s.seenUids,u=this.boxCells[n];if(null!==u){const e=this.bboxes;for(const t of u)if(!c.box[t]){c.box[t]=!0;const r=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[r+0],e[r+1],e[r+2],e[r+3])&&(!a||a(this.boxKeys[t])))return o.push(!0),!0}}const h=this.circleCells[n];if(null!==h){const e=this.circles;for(const t of h)if(!c.circle[t]){c.circle[t]=!0;const r=3*t;if(this._circlesCollide(e[r],e[r+1],e[r+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[t])))return o.push(!0),!0}}}_forEachCell(e,t,r,i,n,o,s,a){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(r),h=this._convertToYCellCoord(i);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(n.call(this,e,t,r,i,this.xCellCount*l+d,o,s,a))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,r,i,n,o){const s=i-e,a=n-t,l=r+o;return l*l>s*s+a*a}_circleAndRectCollide(e,t,r,i,n,o,s){const a=(o-i)/2,l=Math.abs(e-(i+a));if(l>a+r)return!1;const c=(s-n)/2,u=Math.abs(t-(n+c));if(u>c+r)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=r*r}}const pr={unknown:0,flipRequired:1,flipNotRequired:2},fr=Math.tan(85*Math.PI/180);function mr(t,r,i,n,o,s,a){const l=e.a6.create();if(i)if("globe"===s.name){const t=e.b3(o,r);e.a6.multiply(l,l,t)}else{const t=e.b4.invert([],a);l[0]=t[0],l[1]=t[1],l[4]=t[2],l[5]=t[3],n||e.a6.rotateZ(l,l,o.angle)}else e.a6.multiply(l,o.labelPlaneMatrix,t);return l}function _r(e,t,r,i,n,o,s){const a=mr(e,t,r,i,n,o,s);return"globe"===o.name&&r||(a[2]=a[6]=a[10]=a[14]=0),a}function gr(t,r,i,n,o,s,a){if(i){if("globe"===s.name){const l=mr(t,r,i,n,o,s,a);return e.a6.invert(l,l),e.a6.multiply(l,t,l),l}{const r=e.a6.clone(t),i=e.a6.identity([]);return i[0]=a[0],i[1]=a[1],i[4]=a[2],i[5]=a[3],e.a6.multiply(r,r,i),n||e.a6.rotateZ(r,r,-o.angle),r}}return o.glCoordMatrix}function yr(t,r,i,n){const o=[t,r,i,1];i?e.a7.transformMat4(o,o,n):Cr(o,o,n);const s=o[3];return o[0]/=s,o[1]/=s,o[2]/=s,o}function xr(e,t){return Math.min(.5+e/t*.5,1.5)}function vr(e,t){const r=e[0]/e[3],i=e[1]/e[3];return r>=-t[0]&&r<=t[0]&&i>=-t[1]&&i<=t[1]}function br(t,r,i,n,o,s,a,l,c,u){const h=i.transform,d=n?t.textSizeData:t.iconSizeData,p=e.b5(d,i.transform.zoom),f="globe"===h.projection.name,m=[256/i.width*2+1,256/i.height*2+1],_=n?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;_.clear();let g=null;f&&(g=n?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const y=t.lineVertexArray,x=n?t.text.placedSymbolArray:t.icon.placedSymbolArray,v=i.transform.width/i.transform.height;let b,w=!1;for(let T=0;T<x.length;T++){const n=x.get(T),{numGlyphs:f,writingMode:E}=n;if(E!==e.b6.vertical||w||b===e.b6.horizontal||(w=!0),b=E,(n.hidden||E===e.b6.vertical)&&!w){Ir(f,_);continue}w=!1;const S=new e.P(n.tileAnchorX,n.tileAnchorY);let{x:M,y:A,z:I}=h.projection.projectTilePoint(S.x,S.y,u.canonical);if(c){const[e,t,r]=c(S);M+=e,A+=t,I+=r}const C=[M,A,I,1];if(e.a7.transformMat4(C,C,r),!vr(C,m)){Ir(f,_);continue}const P=C[3],L=xr(i.transform.getCameraToCenterDistance(h.projection),P),R=e.b7(d,p,n),D=a?R/L:R*L,O=yr(M,A,I,o);if(O[3]<=0){Ir(f,_);continue}let z={};const k=a?null:c,F=Er(n,D,!1,l,r,o,s,t.glyphOffsetArray,y,_,g,O,S,z,v,k,h.projection,u,a);w=F.useVertical,k&&F.needsFlipping&&(z={}),(F.notEnoughRoom||w||F.needsFlipping&&Er(n,D,!0,l,r,o,s,t.glyphOffsetArray,y,_,g,O,S,z,v,k,h.projection,u,a).notEnoughRoom)&&Ir(f,_)}n?(t.text.dynamicLayoutVertexBuffer.updateData(_),g&&t.text.globeExtVertexBuffer&&t.text.globeExtVertexBuffer.updateData(g)):(t.icon.dynamicLayoutVertexBuffer.updateData(_),g&&t.icon.globeExtVertexBuffer&&t.icon.globeExtVertexBuffer.updateData(g))}function wr(e,t,r,i,n,o,s,a,l,c,u,h,d,p,f,m){const{lineStartIndex:_,glyphStartIndex:g,segment:y}=a,x=g+a.numGlyphs,v=_+a.lineLength,b=t.getoffsetX(g),w=t.getoffsetX(x-1),T=Ar(e*b,r,i,n,o,s,y,_,v,l,c,u,h,d,!0,p,f,m);if(!T)return null;const E=Ar(e*w,r,i,n,o,s,y,_,v,l,c,u,h,d,!0,p,f,m);return E?{first:T,last:E}:null}function Tr(t,r,i,n){return t===e.b6.horizontal&&Math.abs(n)>Math.abs(i)?{useVertical:!0}:t===e.b6.vertical?n>0?{needsFlipping:!0}:null:r!==pr.unknown&&function(e,t){return 0===e||Math.abs(t/e)>fr}(i,n)?r===pr.flipRequired?{needsFlipping:!0}:null:i<0?{needsFlipping:!0}:null}function Er(t,r,i,n,o,s,a,l,c,u,h,d,p,f,m,_,g,y,x){const v=r/24,b=t.lineOffsetX*v,w=t.lineOffsetY*v,{lineStartIndex:T,glyphStartIndex:E,numGlyphs:S,segment:M,writingMode:A,flipState:I}=t,C=T+t.lineLength,P=t=>{if(h){const[r,i,n]=t.up,o=u.length;e.b8(h,o+0,r,i,n),e.b8(h,o+1,r,i,n),e.b8(h,o+2,r,i,n),e.b8(h,o+3,r,i,n)}const[r,i,n]=t.point;e.b9(u,r,i,n,t.angle)};if(S>1){const e=wr(v,l,b,w,i,d,p,t,c,s,f,_,!1,g,y,x);if(!e)return{notEnoughRoom:!0};if(n&&!i){let[r,i,n]=e.first.point,[o,s,l]=e.last.point;[r,i]=yr(r,i,n,a),[o,s]=yr(o,s,l,a);const c=Tr(A,I,(o-r)*m,s-i);if(t.flipState=c&&c.needsFlipping?pr.flipRequired:pr.flipNotRequired,c)return c}P(e.first);for(let t=E+1;t<E+S-1;t++){const e=Ar(v*l.getoffsetX(t),b,w,i,d,p,M,T,C,c,s,f,_,!1,!1,g,y,x);if(!e)return u.length-=4*(t-E),{notEnoughRoom:!0};P(e)}P(e.last)}else{if(n&&!i){const r=yr(p.x,p.y,0,o),i=T+M+1,n=new e.P(c.getx(i),c.gety(i)),s=yr(n.x,n.y,0,o),a=s[3]>0?s:Mr(p,n,r,1,o,void 0,g,y.canonical),l=Tr(A,I,(a[0]-r[0])*m,a[1]-r[1]);if(t.flipState=l&&l.needsFlipping?pr.flipRequired:pr.flipNotRequired,l)return l}const r=Ar(v*l.getoffsetX(E),b,w,i,d,p,M,T,C,c,s,f,_,!1,!1,g,y,x);if(!r)return{notEnoughRoom:!0};P(r)}return{}}function Sr(e,t,r,i,n){const{x:o,y:s,z:a}=i.projectTilePoint(e.x,e.y,t);if(!n)return yr(o,s,a,r);const[l,c,u]=n(e);return yr(o+l,s+c,a+u,r)}function Mr(t,r,i,n,o,s,a,l){const c=Sr(t.sub(r)._unit()._add(t),l,o,a,s);return e.N.sub(c,i,c),e.N.normalize(c,c),e.N.scaleAndAdd(c,i,c,n)}function Ar(t,r,i,n,o,s,a,l,c,u,h,d,p,f,m,_,g,y){const x=n?t-r:t+r;let v=x>0?1:-1,b=0;n&&(v*=-1,b=Math.PI),v<0&&(b+=Math.PI);let w=l+a+(v>0?0:1)|0,T=o,E=o,S=0,M=0;const A=Math.abs(x),I=[],C=[];let P=s,L=P;const R=()=>Mr(L,P,E,A-S+1,h,p,_,g.canonical);for(;S+M<=A;){if(w+=v,w<l||w>=c)return null;if(E=T,L=P,I.push(E),f&&C.push(L),P=new e.P(u.getx(w),u.gety(w)),T=d[w],!T){const e=Sr(P,g.canonical,h,_,p);T=e[3]>0?d[w]=e:R()}S+=M,M=e.N.distance(E,T)}m&&p&&(d[w]&&(T=R(),M=e.N.distance(E,T)),d[w]=T);const D=(A-S)/M,O=P.sub(L)._mult(D)._add(L),z=e.N.sub([],T,E),k=e.N.scaleAndAdd([],E,z,D);let F=[0,0,1],B=z[0],N=z[1];if(y&&(F=_.upVector(g.canonical,O.x,O.y),0!==F[0]||0!==F[1]||1!==F[2])){const t=[F[2],0,-F[0]],r=e.N.cross([],F,t);e.N.normalize(t,t),e.N.normalize(r,r),B=e.N.dot(z,t),N=e.N.dot(z,r)}if(i){const t=e.N.cross([],F,z);e.N.normalize(t,t),e.N.scaleAndAdd(k,k,t,i*v)}const U=b+Math.atan2(N,B);return I.push(k),f&&C.push(O),{point:k,angle:U,path:I,tilePath:C,up:F}}function Ir(e,t){const r=t.length,i=r+4*e;t.resize(i),t.float32.fill(-1/0,4*r,4*i)}function Cr(e,t,r){const i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e[3]=r[3]*i+r[7]*n+r[15],e}const Pr=100;class Lr{constructor(e,t,r=new dr(e.width+200,e.height+200,25),i=new dr(e.width+200,e.height+200,25)){this.transform=e,this.grid=r,this.ignoredGrid=i,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Pr,this.screenBottomBoundary=e.height+Pr,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(e,t,r,i,n,o,s,a){let l=r.projectedAnchorX,c=r.projectedAnchorY,u=r.projectedAnchorZ;const h=r.elevation,d=r.tileID,p=e.getProjection();if(h&&d){const[e,t,i]=p.upVector(d.canonical,r.tileAnchorX,r.tileAnchorY),n=p.upVectorScale(d.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=e*h*n,c+=t*h*n,u+=i*h*n}const f=this.projectAndGetPerspectiveRatio(s,l,c,u,r.tileID,"globe"===p.name||!!h||this.transform.pitch>0,p),m=o*f.perspectiveRatio,_=(r.x1*t+i.x-r.padding)*m+f.point.x,g=(r.y1*t+i.y-r.padding)*m+f.point.y,y=(r.x2*t+i.x+r.padding)*m+f.point.x,x=(r.y2*t+i.y+r.padding)*m+f.point.y,v=f.perspectiveRatio<=.55||f.occluded;return!this.isInsideGrid(_,g,y,x)||!n&&this.grid.hitTest(_,g,y,x,a)||v?{box:[],offscreen:!1,occluded:f.occluded}:{box:[_,g,y,x],offscreen:this.isOffscreen(_,g,y,x),occluded:!1}}placeCollisionCircles(t,r,i,n,o,s,a,l,c,u,h,d,p,f,m){const _=[],g=this.transform.elevation,y=t.getProjection(),x=g?g.getAtTileOffsetFunc(m,this.transform.center.lat,this.transform.worldSize,y):null,v=new e.P(i.tileAnchorX,i.tileAnchorY);let{x:b,y:w,z:T}=y.projectTilePoint(v.x,v.y,m.canonical);if(x){const[e,t,r]=x(v);b+=e,w+=t,T+=r}const E="globe"===y.name,S=this.projectAndGetPerspectiveRatio(a,b,w,T,m,E||!!g||this.transform.pitch>0,y),{perspectiveRatio:M}=S,A=(h?s/M:s*M)/e.bc,I=yr(b,w,T,l),C=S.signedDistanceFromCamera>0?wr(A,o,i.lineOffsetX*A,i.lineOffsetY*A,!1,I,v,i,n,l,{},g&&!h?x:null,h&&!!g,y,m,h):null;let P=!1,L=!1,R=!0;if(C&&!S.occluded){const t=.5*p*M+f,i=new e.P(-100,-100),n=new e.P(this.screenRightBoundary,this.screenBottomBoundary),o=new hr,{first:s,last:a}=C,l=s.path.length;let h=[];for(let e=l-1;e>=1;e--)h.push(s.path[e]);for(let e=1;e<a.path.length;e++)h.push(a.path[e]);const m=2.5*t;c&&(h=h.map((([e,t,r],i)=>(x&&!E&&(r=x(i<l-1?s.tilePath[l-1-i]:a.tilePath[i-l+2])[2]),yr(e,t,r,c)))),h.some((e=>e[3]<=0))&&(h=[]));let g=[];if(h.length>0){let t=1/0,r=-1/0,o=1/0,s=-1/0;for(const e of h)t=Math.min(t,e[0]),o=Math.min(o,e[1]),r=Math.max(r,e[0]),s=Math.max(s,e[1]);r>=i.x&&t<=n.x&&s>=i.y&&o<=n.y&&(g=[h.map((t=>new e.P(t[0],t[1])))],(t<i.x||r>n.x||o<i.y||s>n.y)&&(g=e.ba(g,i.x,i.y,n.x,n.y)))}for(const e of g){o.reset(e,.25*t);let i=0;i=o.length<=.5*t?1:Math.ceil(o.paddedLength/m)+1;for(let e=0;e<i;e++){const n=e/Math.max(i-1,1),s=o.lerp(n),a=s.x+Pr,l=s.y+Pr;_.push(a,l,t,0);const c=a-t,h=l-t,p=a+t,f=l+t;if(R=R&&this.isOffscreen(c,h,p,f),L=L||this.isInsideGrid(c,h,p,f),!r&&this.grid.hitTestCircle(a,l,t,d)&&(P=!0,!u))return{circles:[],offscreen:!1,collisionDetected:P,occluded:!1}}}}return{circles:!u&&P||!L?[]:_,offscreen:R,collisionDetected:P,occluded:S.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const r=[];let i=1/0,n=1/0,o=-1/0,s=-1/0;for(const u of t){const t=new e.P(u.x+Pr,u.y+Pr);i=Math.min(i,t.x),n=Math.min(n,t.y),o=Math.max(o,t.x),s=Math.max(s,t.y),r.push(t)}const a=this.grid.query(i,n,o,s).concat(this.ignoredGrid.query(i,n,o,s)),l={},c={};for(const u of a){const t=u.key;if(void 0===l[t.bucketInstanceId]&&(l[t.bucketInstanceId]={}),l[t.bucketInstanceId][t.featureIndex])continue;const i=[new e.P(u.x1,u.y1),new e.P(u.x2,u.y1),new e.P(u.x2,u.y2),new e.P(u.x1,u.y2)];e.bb(r,i)&&(l[t.bucketInstanceId][t.featureIndex]=!0,void 0===c[t.bucketInstanceId]&&(c[t.bucketInstanceId]=[]),c[t.bucketInstanceId].push(t.featureIndex))}return c}insertCollisionBox(e,t,r,i,n){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:i,collisionGroupID:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,r,i,n){const o=t?this.ignoredGrid:this.grid,s={bucketInstanceId:r,featureIndex:i,collisionGroupID:n};for(let a=0;a<e.length;a+=4)o.insertCircle(s,e[a],e[a+1],e[a+2])}projectAndGetPerspectiveRatio(t,r,i,n,o,s,a){const l=[r,i,n,1];let c=!1;if(n||this.transform.pitch>0){if(e.a7.transformMat4(l,l,t),this.fogState&&o&&"globe"!==a.name){const t=function(t,r,i,n,o,s){const a=s.calculateFogTileMatrix(o),l=[r,i,n];return e.N.transformMat4(l,l,a),ge(t,e.N.length(l),s.pitch,s._fov)}(this.fogState,r,i,n,o.toUnwrapped(),this.transform);c=t>.9}}else Cr(l,l,t);const u=l[3];return{point:new e.P((l[0]/u+1)/2*this.transform.width+Pr,(-l[1]/u+1)/2*this.transform.height+Pr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(a)/u*.5,1.5),signedDistanceFromCamera:u,occluded:s&&l[2]>u||c}}isOffscreen(e,t,r,i){return r<Pr||e>=this.screenRightBoundary||i<Pr||t>this.screenBottomBoundary}isInsideGrid(e,t,r,i){return r>=0&&e<this.gridRightBoundary&&i>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const t=e.a6.identity([]);return e.a6.translate(t,t,[-100,-100,0]),t}}function Rr(t,r,i){const n=r.createTileMatrix(t,t.worldSize,i.toUnwrapped());return e.a6.multiply(new Float32Array(16),t.projMatrix,n)}function Dr(e,t,r){if(t.projection.name===r.projection.name)return e.projMatrix;const i=r.clone();return i.setProjection(t.projection),Rr(i,t.getProjection(),e)}function Or(e,t,r){return t.name===r.projection.name?e.projMatrix:Rr(r,t,e)}class zr{constructor(e,t,r,i){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):i&&r?1:0,this.placed=r}isHidden(){return 0===this.opacity&&!this.placed}}class kr{constructor(e,t,r,i,n,o=!1){this.text=new zr(e?e.text:null,t,r,n),this.icon=new zr(e?e.icon:null,t,i,n),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Fr{constructor(e,t,r,i=!1){this.text=e,this.icon=t,this.skipFade=r,this.clipped=i}}class Br{constructor(){this.invProjMatrix=e.a6.create(),this.viewportMatrix=e.a6.create(),this.circles=[]}}class Nr{constructor(e,t,r,i,n){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=r,this.bucketIndex=i,this.tileID=n}}class Ur{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function Vr(t,r,i,n,o){const{horizontalAlign:s,verticalAlign:a}=e.bf(t),l=-(s-.5)*r,c=-(a-.5)*i,u=e.bd(t,n);return new e.P(l+u[0]*o,c+u[1]*o)}function jr(t,r,i,n,o){const s=new e.P(t,r);return i&&s._rotate(n?o:-o),s}class Gr{constructor(e,t,r,i,n,o){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new Lr(this.transform,n),this.buildingIndex=o,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new Ur(r),this.collisionCircleArrays={},this.prevPlacement=i,i&&(i.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,r,i,n){const o=i.getBucket(r),s=i.latestFeatureIndex;if(!o||!s||r.fqid!==o.layerIds[0])return;const a=o.layers[0].layout,l=i.collisionBoxArray,c=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),u=i.tileSize/e.V,h=i.tileID.toUnwrapped();this.transform.setProjection(o.projection);const d=(p=i.tileID,f=o.getProjection(),m=this.transform,f.name===this.projection?m.calculateProjMatrix(p.toUnwrapped()):Rr(m,f,p));var p,f,m;const _="map"===a.get("text-pitch-alignment"),g="map"===a.get("text-rotation-alignment");r.compileFilter();const y=r.dynamicFilter(),x=r.dynamicFilterNeedsFeature(),v=this.transform.calculatePixelsToTileUnitsMatrix(i),b=_r(d,i.tileID.canonical,_,g,this.transform,o.getProjection(),v);let w=null;if(_){const t=gr(d,i.tileID.canonical,_,g,this.transform,o.getProjection(),v);w=e.a6.multiply([],this.transform.labelPlaneMatrix,t)}let T=null;y&&i.latestFeatureIndex&&(T={unwrappedTileID:h,dynamicFilter:y,dynamicFilterNeedsFeature:x,featureIndex:i.latestFeatureIndex}),this.retainedQueryData[o.bucketInstanceId]=new Nr(o.bucketInstanceId,s,o.sourceLayerIndex,o.index,i.tileID);const E={bucket:o,layout:a,posMatrix:d,textLabelPlaneMatrix:b,labelToScreenMatrix:w,clippingData:T,scale:c,textPixelRatio:u,holdingForFade:i.holdingForFade(),collisionBoxArray:l,partiallyEvaluatedTextSize:e.b5(o.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:e.b5(o.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(n)for(const e of o.sortKeyRanges){const{sortKey:r,symbolInstanceStart:i,symbolInstanceEnd:n}=e;t.push({sortKey:r,symbolInstanceStart:i,symbolInstanceEnd:n,parameters:E})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:E})}attemptAnchorPlacement(e,t,r,i,n,o,s,a,l,c,u,h,d,p,f,m,_,g){const{textOffset0:y,textOffset1:x,crossTileID:v}=h,b=[y,x],w=Vr(e,r,i,b,n),T=this.collisionIndex.placeCollisionBox(p,n,t,jr(w.x,w.y,o,s,this.transform.angle),u,a,l,c.predicate);if(m){const e=p.getSymbolInstanceIconSize(g,this.transform.zoom,h.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(p,e,m,jr(w.x,w.y,o,s,this.transform.angle),u,a,l,c.predicate).box.length)return}if(T.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[v]&&this.prevPlacement.placements[v]&&this.prevPlacement.placements[v].text&&(t=this.prevPlacement.variableOffsets[v].anchor),this.variableOffsets[v]={textOffset:b,width:r,height:i,anchor:e,textScale:n,prevAnchor:t},this.markUsedJustification(p,e,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[v]=f),{shift:w,placedGlyphBoxes:T}}}placeLayerBucketPart(t,r,i,n){const{bucket:o,layout:s,posMatrix:a,textLabelPlaneMatrix:l,labelToScreenMatrix:c,clippingData:u,textPixelRatio:h,holdingForFade:d,collisionBoxArray:p,partiallyEvaluatedTextSize:f,partiallyEvaluatedIconSize:m,collisionGroup:_}=t.parameters,g=s.get("text-optional"),y=s.get("icon-optional"),x=s.get("text-allow-overlap"),v=s.get("icon-allow-overlap"),b="map"===s.get("text-rotation-alignment"),w="map"===s.get("text-pitch-alignment"),T="viewport-y"===s.get("symbol-z-order"),E=s.get("symbol-z-elevate");this.transform.setProjection(o.projection);let S=x&&(v||!o.hasIconData()||y),M=v&&(x||!o.hasTextData()||g);!o.collisionArrays&&p&&o.deserializeCollisionBoxes(p),i&&n&&o.updateCollisionDebugBuffers(this.transform.zoom,p);const A=(t,n,p)=>{const{crossTileID:T,numVerticalGlyphVertices:E}=t;if(u){const i={zoom:this.transform.zoom,pitch:this.transform.pitch};let n=null;if(u.dynamicFilterNeedsFeature){const e=this.retainedQueryData[o.bucketInstanceId];n=u.featureIndex.loadFeature({featureIndex:t.featureIndex,bucketIndex:e.bucketIndex,sourceLayerIndex:e.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,u.dynamicFilter)(i,n,this.retainedQueryData[o.bucketInstanceId].tileID.canonical,new e.P(t.tileAnchorX,t.tileAnchorY),this.transform.calculateDistanceTileData(u.unwrappedTileID)))return this.placements[T]=new Fr(!1,!1,!1,!0),void r.add(T)}if(r.has(T))return;if(d)return void(this.placements[T]=new Fr(!1,!1,!1));let A=!1,I=!1,C=!0,P=!1,L=!1,R=null,D={box:null,offscreen:null,occluded:null},O={box:null,offscreen:null,occluded:null},z=null,k=null,F=null,B=0,N=0,U=0;p.textFeatureIndex?B=p.textFeatureIndex:t.useRuntimeCollisionCircles&&(B=t.featureIndex),p.verticalTextFeatureIndex&&(N=p.verticalTextFeatureIndex);const V=e=>{e.tileID=this.retainedQueryData[o.bucketInstanceId].tileID;const r=this.transform.elevation;e.elevation=t.zOffset+(r?r.getAtTileOffset(e.tileID,e.tileAnchorX,e.tileAnchorY):0)},j=p.textBox;if(j){V(j);const r=r=>{let i=e.b6.horizontal;if(o.allowVerticalPlacement&&!r&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[T];e&&(this.placedOrientations[T]=e,i=e,this.markUsedOrientation(o,i,t))}return i},i=(t,r)=>{if(o.allowVerticalPlacement&&E>0&&p.verticalTextBox){for(const i of o.writingModes)if(i===e.b6.vertical?(D=r(),O=D):D=t(),D&&D.box&&D.box.length)break}else D=t()};if(s.get("text-variable-anchor")){let l=s.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[T]){const e=this.prevPlacement.variableOffsets[T];l.indexOf(e.anchor)>0&&(l=l.filter((t=>t!==e.anchor)),l.unshift(e.anchor))}const c=(e,r,i)=>{const s=o.getSymbolInstanceTextSize(f,t,this.transform.zoom,n),c=(e.x2-e.x1)*s+2*e.padding,u=(e.y2-e.y1)*s+2*e.padding,d=t.hasIconTextFit&&!v?r:null;d&&V(d);let p={box:[],offscreen:!1,occluded:!1};const g=x?2*l.length:l.length;for(let y=0;y<g;++y){const r=this.attemptAnchorPlacement(l[y%l.length],e,c,u,s,b,w,h,a,_,y>=l.length,t,n,o,i,d,f,m);if(r&&(p=r.placedGlyphBoxes,p&&p.box&&p.box.length)){A=!0,R=r.shift;break}}return p};i((()=>c(j,p.iconBox,e.b6.horizontal)),(()=>{const t=p.verticalTextBox;return t&&V(t),o.allowVerticalPlacement&&!(D&&D.box&&D.box.length)&&E>0&&t?c(t,p.verticalIconBox,e.b6.vertical):{box:null,offscreen:null,occluded:null}})),D&&(A=D.box,C=D.offscreen,P=D.occluded);const u=r(!(!D||!D.box));if(!A&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[T];e&&(this.variableOffsets[T]=e,this.markUsedJustification(o,e.anchor,t,u))}}else{const s=(r,i)=>{const s=o.getSymbolInstanceTextSize(f,t,this.transform.zoom,n),l=this.collisionIndex.placeCollisionBox(o,s,r,new e.P(0,0),x,h,a,_.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(o,i,t),this.placedOrientations[T]=i),l};i((()=>s(j,e.b6.horizontal)),(()=>{const t=p.verticalTextBox;return o.allowVerticalPlacement&&E>0&&t?(V(t),s(t,e.b6.vertical)):{box:null,offscreen:null,occluded:null}})),r(!!(D&&D.box&&D.box.length))}}if(z=D,A=z&&z.box&&z.box.length>0,C=z&&z.offscreen,P=z&&z.occluded,t.useRuntimeCollisionCircles){const r=o.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex),n=e.b7(o.textSizeData,f,r),u=s.get("text-padding");k=this.collisionIndex.placeCollisionCircles(o,x,r,o.lineVertexArray,o.glyphOffsetArray,n,a,l,c,i,w,_.predicate,t.collisionCircleDiameter*n/e.bc,u,this.retainedQueryData[o.bucketInstanceId].tileID),A=x||k.circles.length>0&&!k.collisionDetected,C=C&&k.offscreen,P=k.occluded}if(p.iconFeatureIndex&&(U=p.iconFeatureIndex),p.iconBox){const r=r=>{V(r);const i=t.hasIconTextFit&&R?jr(R.x,R.y,b,w,this.transform.angle):new e.P(0,0),n=o.getSymbolInstanceIconSize(m,this.transform.zoom,t.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(o,n,r,i,v,h,a,_.predicate)};O&&O.box&&O.box.length&&p.verticalIconBox?(F=r(p.verticalIconBox),I=F.box.length>0):(F=r(p.iconBox),I=F.box.length>0),C=C&&F.offscreen,L=F.occluded}const G=g||0===t.numHorizontalGlyphVertices&&0===E,$=y||0===t.numIconVertices;if(G||$?$?G||(I=I&&A):A=I&&A:I=A=I&&A,A&&z&&z.box&&this.collisionIndex.insertCollisionBox(z.box,s.get("text-ignore-placement"),o.bucketInstanceId,O&&O.box&&N?N:B,_.ID),I&&F&&this.collisionIndex.insertCollisionBox(F.box,s.get("icon-ignore-placement"),o.bucketInstanceId,U,_.ID),k&&(A&&this.collisionIndex.insertCollisionCircles(k.circles,s.get("text-ignore-placement"),o.bucketInstanceId,B,_.ID),i)){const e=o.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new Br);for(let r=0;r<k.circles.length;r+=4)t.circles.push(k.circles[r+0]),t.circles.push(k.circles[r+1]),t.circles.push(k.circles[r+2]),t.circles.push(k.collisionDetected?1:0)}const q="globe"!==o.projection.name;S=S&&(q||!P),M=M&&(q||!L),this.placements[T]=new Fr(A||S,I||M,C||o.justReloaded),r.add(T)};if(E&&this.buildingIndex&&(this.buildingIndex.updateZOffset(o,this.retainedQueryData[o.bucketInstanceId].tileID),o.updateZOffset()),T){const t=o.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const r=t[e];A(o.symbolInstances.get(r),r,o.collisionArrays[r])}o.hasAnyZOffset&&e.w(`${o.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(o.hasAnyZOffset){const e=o.getSortedIndexesByZOffset();for(let t=0;t<e.length;++t){const r=e[t];A(o.symbolInstances.get(r),r,o.collisionArrays[r])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)A(o.symbolInstances.get(e),e,o.collisionArrays[e]);if(i&&o.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[o.bucketInstanceId];e.a6.invert(t.invProjMatrix,a),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}markUsedJustification(t,r,i,n){const{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:l,crossTileID:c}=i,u=e.be(r),h=n===e.b6.vertical?l:"left"===u?o:"center"===u?s:"right"===u?a:-1;o>=0&&(t.text.placedSymbolArray.get(o).crossTileID=h>=0&&o!==h?0:c),s>=0&&(t.text.placedSymbolArray.get(s).crossTileID=h>=0&&s!==h?0:c),a>=0&&(t.text.placedSymbolArray.get(a).crossTileID=h>=0&&a!==h?0:c),l>=0&&(t.text.placedSymbolArray.get(l).crossTileID=h>=0&&l!==h?0:c)}markUsedOrientation(t,r,i){const n=r===e.b6.horizontal||r===e.b6.horizontalOnly?r:0,o=r===e.b6.vertical?r:0,{leftJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:c}=i,u=t.text.placedSymbolArray;s>=0&&(u.get(s).placedOrientation=n),a>=0&&(u.get(a).placedOrientation=n),l>=0&&(u.get(l).placedOrientation=n),c>=0&&(u.get(c).placedOrientation=o)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let r=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const i=t?t.symbolFadeChange(e):1,n=t?t.opacities:{},o=t?t.variableOffsets:{},s=t?t.placedOrientations:{};for(const a in this.placements){const e=this.placements[a],t=n[a];t?(this.opacities[a]=new kr(t,i,e.text,e.icon,null,e.clipped),r=r||e.text!==t.text.placed||e.icon!==t.icon.placed):(this.opacities[a]=new kr(null,i,e.text,e.icon,e.skipFade,e.clipped),r=r||e.text||e.icon)}for(const a in n){const e=n[a];if(!this.opacities[a]){const t=new kr(e,i,!1,!1);t.isHidden()||(this.opacities[a]=t,r=r||e.text.placed||e.icon.placed)}}for(const a in o)this.variableOffsets[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.variableOffsets[a]=o[a]);for(const a in s)this.placedOrientations[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.placedOrientations[a]=s[a]);r?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){const r=new Set;for(const i of t){const t=i.getBucket(e);t&&i.latestFeatureIndex&&e.fqid===t.layerIds[0]&&(this.updateBucketOpacities(t,r,i.collisionBoxArray),t.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(t,i.tileID),t.updateZOffset()))}}updateBucketOpacities(t,r,i){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const n=t.layers[0].layout,o=!!t.layers[0].dynamicFilter(),s=new kr(null,0,!1,!1,!0),a=n.get("text-allow-overlap"),l=n.get("icon-allow-overlap"),c=n.get("text-variable-anchor"),u="map"===n.get("text-rotation-alignment"),h="map"===n.get("text-pitch-alignment"),d=new kr(null,0,a&&(l||!t.hasIconData()||n.get("icon-optional")),l&&(a||!t.hasTextData()||n.get("text-optional")),!0);!t.collisionArrays&&i&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(i);const p=(e,t,r)=>{for(let i=0;i<t/4;i++)e.opacityVertexArray.emplaceBack(r)};let f=0;for(let m=0;m<t.symbolInstances.length;m++){const i=t.symbolInstances.get(m),{numHorizontalGlyphVertices:n,numVerticalGlyphVertices:a,crossTileID:l,numIconVertices:_}=i,g=r.has(l);let y=this.opacities[l];g?y=s:y||(y=d,this.opacities[l]=y),r.add(l);const x=n>0||a>0,v=_>0,b=this.placedOrientations[l],w=b===e.b6.vertical,T=b===e.b6.horizontal||b===e.b6.horizontalOnly;if(!x&&!v||y.isHidden()||f++,x){const e=Jr(y.text);p(t.text,n,w?Qr:e),p(t.text,a,T?Qr:e);const r=y.text.isHidden(),{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:c,verticalPlacedTextSymbolIndex:u}=i,h=t.text.placedSymbolArray,d=r||w?1:0;o>=0&&(h.get(o).hidden=d),s>=0&&(h.get(s).hidden=d),c>=0&&(h.get(c).hidden=d),u>=0&&(h.get(u).hidden=r||T?1:0);const f=this.variableOffsets[l];f&&this.markUsedJustification(t,f.anchor,i,b);const m=this.placedOrientations[l];m&&(this.markUsedJustification(t,"left",i,m),this.markUsedOrientation(t,m,i))}if(v){const e=Jr(y.icon),{placedIconSymbolIndex:r,verticalPlacedIconSymbolIndex:n}=i,o=t.icon.placedSymbolArray,s=y.icon.isHidden()?1:0;r>=0&&(p(t.icon,_,w?Qr:e),o.get(r).hidden=s),n>=0&&(p(t.icon,i.numVerticalIconVertices,T?Qr:e),o.get(n).hidden=s)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const r=t.collisionArrays[m];if(r){let n=new e.P(0,0),s=!0;if(r.textBox||r.verticalTextBox){if(c){const e=this.variableOffsets[l];e?(n=Vr(e.anchor,e.width,e.height,e.textOffset,e.textScale),u&&n._rotate(h?this.transform.angle:-this.transform.angle)):s=!1}o&&(s=!y.clipped),r.textBox&&$r(t.textCollisionBox.collisionVertexArray,y.text.placed,!s||w,n.x,n.y),r.verticalTextBox&&$r(t.textCollisionBox.collisionVertexArray,y.text.placed,!s||T,n.x,n.y)}const a=s&&Boolean(!T&&r.verticalIconBox);r.iconBox&&$r(t.iconCollisionBox.collisionVertexArray,y.icon.placed,a,i.hasIconTextFit?n.x:0,i.hasIconTextFit?n.y:0),r.verticalIconBox&&$r(t.iconCollisionBox.collisionVertexArray,y.icon.placed,!a,i.hasIconTextFit?n.x:0,i.hasIconTextFit?n.y:0)}}}if(t.fullyClipped=0===f,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const r=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*r>e}setStale(){this.stale=!0}}function $r(e,t,r,i,n){e.emplaceBack(t?1:0,r?1:0,i||0,n||0),e.emplaceBack(t?1:0,r?1:0,i||0,n||0),e.emplaceBack(t?1:0,r?1:0,i||0,n||0),e.emplaceBack(t?1:0,r?1:0,i||0,n||0)}const qr=Math.pow(2,25),Zr=Math.pow(2,24),Wr=Math.pow(2,17),Hr=Math.pow(2,16),Xr=Math.pow(2,9),Yr=Math.pow(2,8),Kr=Math.pow(2,1);function Jr(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,r=Math.floor(127*e.opacity);return r*qr+t*Zr+r*Wr+t*Hr+r*Xr+t*Yr+r*Kr+t}const Qr=0;class ei{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,t,r,i,n){const o=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(o,i,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,n())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<o.length;){const e=o[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,r,0===e.symbolInstanceStart),this._currentPartIndex++,n())return!0}return!1}}class ti{constructor(e,t,r,i,n,o,s,a,l){this.placement=new Gr(e,n,o,s,a,l),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=i,this._done=!1}isDone(){return this._done}continuePlacement(t,r,i,n){const o=e.f.now(),s=()=>{const t=e.f.now()-o;return!this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const o=r[t[this._currentPlacementIndex]],a=this.placement.collisionIndex.transform.zoom;if("symbol"===o.type&&(!o.minzoom||o.minzoom<=a)&&(!o.maxzoom||o.maxzoom>a)){const t=o,r=t.layout.get("symbol-z-elevate"),a=this._inProgressLayer=this._inProgressLayer||new ei(t),l=e.ag(o.source,o.scope);if(a.continuePlacement(r?n[l]:i[l],this.placement,this._showCollisionBoxes,o,s))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const ri=512/e.V/2;class ii{constructor(t,r,i){this.tileID=t,this.bucketInstanceId=i,this.index=new e.bg(r.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const n=t.canonical.x*e.V,o=t.canonical.y*e.V;for(let e=0;e<r.length;e++){const{key:t,crossTileID:i,tileAnchorX:s,tileAnchorY:a}=r.get(e),l=Math.floor((n+s)*ri),c=Math.floor((o+a)*ri);this.index.add(l,c),this.keys.push(t),this.crossTileIDs.push(i)}this.index.finish()}findMatches(t,r,i){const n=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z),o=ri/Math.pow(2,r.canonical.z-this.tileID.canonical.z),s=r.canonical.x*e.V,a=r.canonical.y*e.V;for(let e=0;e<t.length;e++){const r=t.get(e);if(r.crossTileID)continue;const{key:l,tileAnchorX:c,tileAnchorY:u}=r,h=Math.floor((s+c)*o),d=Math.floor((a+u)*o),p=this.index.range(h-n,d-n,h+n,d+n);for(const e of p){const t=this.crossTileIDs[e];if(this.keys[e]===l&&!i.has(t)){i.add(t),r.crossTileID=t;break}}}}}class ni{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class oi{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const r in this.indexes){const e=this.indexes[r],i={};for(const r in e){const n=e[r];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+t),i[n.tileID.key]=n}this.indexes[r]=i}this.lng=e}addBucket(e,t,r){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let n=0;n<t.symbolInstances.length;n++)t.symbolInstances.get(n).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);const i=this.usedCrossTileIDs[e.overscaledZ];for(const n in this.indexes){const r=this.indexes[n];if(Number(n)>e.overscaledZ)for(const n in r){const o=r[n];o.tileID.isChildOf(e)&&o.findMatches(t.symbolInstances,e,i)}else{const o=r[e.scaledTo(Number(n)).key];o&&o.findMatches(t.symbolInstances,e,i)}}for(let n=0;n<t.symbolInstances.length;n++){const e=t.symbolInstances.get(n);e.crossTileID||(e.crossTileID=r.generate(),i.add(e.crossTileID))}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new ii(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const r of t.crossTileIDs)this.usedCrossTileIDs[e].delete(r)}removeStaleBuckets(e){let t=!1;for(const r in this.indexes){const i=this.indexes[r];for(const n in i)e[i[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(r,i[n]),delete i[n],t=!0)}return t}}class si{constructor(){this.layerIndexes={},this.crossTileIDs=new ni,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,r,i){let n=this.layerIndexes[e.fqid];void 0===n&&(n=this.layerIndexes[e.fqid]=new oi);let o=!1;const s={};"globe"!==i.name&&n.handleWrapJump(r);for(const a of t){const t=a.getBucket(e);t&&e.fqid===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(a.tileID,t,this.crossTileIDs)&&(o=!0),s[t.bucketInstanceId]=!0)}return n.removeStaleBuckets(s)&&(o=!0),o}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0}));for(const r in this.layerIndexes)t[r]||delete this.layerIndexes[r]}}class ai{constructor(e=0,t=0,r=0,i=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(r)||r<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=r,this.right=i}interpolate(t,r,i){return null!=r.top&&null!=t.top&&(this.top=e.U(t.top,r.top,i)),null!=r.bottom&&null!=t.bottom&&(this.bottom=e.U(t.bottom,r.bottom,i)),null!=r.left&&null!=t.left&&(this.left=e.U(t.left,r.left,i)),null!=r.right&&null!=t.right&&(this.right=e.U(t.right,r.right,i)),this}getCenter(t,r){const i=e.aa((this.left+t-this.right)/2,0,t),n=e.aa((this.top+r-this.bottom)/2,0,r);return new e.P(i,n)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new ai(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function li(t,r){const i=e.bk(t,3);e.a6.fromQuat(t,r),e.bm(t,3,i)}function ci(t,r){const i=e.bi.identity([]);return e.bi.rotateZ(i,i,-r),e.bi.rotateX(i,i,-t),i}function ui(t,r){const i=[t[0],t[1],0],n=[r[0],r[1],0];if(e.N.length(i)>=1e-15){const t=e.N.normalize([],i);e.N.scale(n,t,e.N.dot(n,t)),r[0]=n[0],r[1]=n[1]}const o=e.N.cross([],r,t);if(e.N.len(o)<1e-15)return null;const s=Math.atan2(-o[1],o[0]);return ci(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),s)}class hi{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(t){if(t){const r=t instanceof e.L?t:new e.L(t[0],t[1],t[2]);this._renderWorldCopies&&(r.x=e.bh(r.x,0,1)),this._position=r}else this._position=null}lookAtPoint(t,r){if(this.orientation=null,!this.position)return;const i=this.position,n=this._elevation?this._elevation.getAtPointOrZero(e.L.fromLngLat(t)):0,o=e.L.fromLngLat(t,n),s=[o.x-i.x,o.y-i.y,o.z-i.z];r||(r=[0,0,1]),r[2]=Math.abs(r[2]),this.orientation=ui(s,r)}setPitchBearing(t,r){this.orientation=ci(e.bj(t),e.bj(-r))}}class di{constructor(t,r){this._transform=e.a6.identity([]),this.orientation=r,this.position=t}get mercatorPosition(){const t=this.position;return new e.L(t[0],t[1],t[2])}get position(){const t=e.bk(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var r;t&&e.bm(this._transform,3,[(r=t)[0],r[1],r[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||e.bi.identity([]),t&&li(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=ci(e,t),li(this._transform,this._orientation)}forward(){const t=e.bk(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=e.bk(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=e.bk(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,r){const i=new Float64Array(16);return e.a6.invert(i,this.getWorldToCamera(t,r)),i}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,r,i){const n=this.position;e.N.scale(n,n,-t);const o=new Float64Array(16);return e.a6.fromScaling(o,[i,i,i]),e.a6.translate(o,o,n),o[10]*=r,o}getWorldToCamera(t,r){const i=new Float64Array(16),n=new Float64Array(4),o=this.position;return e.bi.conjugate(n,this._orientation),e.N.scale(o,o,-t),e.a6.fromQuat(i,n),e.a6.translate(i,i,o),i[1]*=-1,i[5]*=-1,i[9]*=-1,i[13]*=-1,i[8]*=r,i[9]*=r,i[10]*=r,i[11]*=r,i}getCameraToClipPerspective(t,r,i,n){const o=new Float64Array(16);return e.a6.perspective(o,t,r,i,n),o}getCameraToClipOrthographic(t,r,i,n,o,s){const a=new Float64Array(16);return e.a6.ortho(a,t,r,i,n,o,s),a}getDistanceToElevation(t,r=!1){const i=0===t?0:e.bl(t,r?e.au(this.position[1]):this.position[1]),n=this.forward();return(i-this.position[2])/n[2]}clone(){return new di([...this.position],[...this.orientation])}}const pi=(e,t,r)=>(1-r)*e+r*t,fi=e=>e*e*e*e*e;class mi{constructor(t,r,i,n,o,s,a){this.tileSize=512,this._renderWorldCopies=void 0===o||o,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=null==i?0:i,this._maxPitch=null==n?60:n,this.setProjection(s),this.setMaxBounds(a),this.width=0,this.height=0,this._center=new e.bn(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ai,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new di,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const e=new mi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(e,t=!1){const r=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||r)&&this._updateCameraOnTerrain(),(e||r)&&this._constrainCamera(t),this._calcMatrices()}getProjection(){return e.ac(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const i=this.projection?this.getProjection():void 0;this.projection=e.bo(this.projectionOptions);const n=!t(i,this.getProjection());return n&&this._calcMatrices(),this.mercatorFromTransition=!1,n}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=e.bo({name:"mercator"});const r=t!==this.projection.name;return r&&this._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return e.bl(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.P(this.width,this.height)}get bearing(){return e.bh(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const r=-t*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=e.b4.create(),e.b4.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=e.aa(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=e.bj(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(e){this._tileCoverLift!==e&&(this._tileCoverLift=e)}_updateCameraOnTerrain(){const e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,t=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!t||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;t||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&r.exaggeration()&&this._centerAltitudeValidForExaggeration!==r.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*r.exaggeration(),this._centerAltitudeValidForExaggeration=r.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=r.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,r=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],i=this.horizonLineFromTop();let n=0,o=0;for(let s=0;s<r.length;s++){const a=new e.P(r[s][0]*this.width,i+r[s][1]*(this.height-i)),l=t.pointCoordinate(a);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);n+=l[3]*c,o+=c}return 0===o?NaN:n/o}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),r=this.pixelsPerMeter/this.worldSize*t,i=this._mercatorZfromZoom(e),n=this._mercatorZfromZoom(this._maxZoom),o=Math.max(i-r,n);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(t){const r=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let i;i=t.z<this._camera.position[2]?[r.x,r.y,r.z]:[t.x,t.y,t.z];const n=e.N.length(e.N.sub([],this._camera.position,i));return e.aa(this._zoomFromMercatorZ(n),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height)return;if(!t.position&&!t.orientation)return;this._updateCameraState();let r=!1;if(t.orientation&&!e.bi.exactEquals(t.orientation,this._camera.orientation)&&(r=this._setCameraOrientation(t.orientation)),t.position){const i=[t.position.x,t.position.y,t.position.z];e.N.exactEquals(i,this._camera.position)||(this._setCameraPosition(i),r=!0)}r&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,r=new hi;return r.position=new e.L(t[0],t[1],t[2]),r.orientation=this._camera.orientation,r._elevation=this.elevation,r._renderWorldCopies=this.renderWorldCopies,r}_setCameraOrientation(t){if(!e.bi.length(t))return!1;e.bi.normalize(t,t);const r=e.N.transformQuat([],[0,0,-1],t),i=e.N.transformQuat([],[0,-1,0],t);if(i[2]<0)return!1;const n=ui(r,i);return!!n&&(this._camera.orientation=n,!0)}_setCameraPosition(t){const r=this.zoomScale(this.minZoom)*this.tileSize,i=this.zoomScale(this.maxZoom)*this.tileSize,n=this.cameraToCenterDistance;t[2]=e.aa(t[2],n/i,n/r),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,r){this._unmodified=!1,this._edgeInsets.interpolate(e,t,r),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(t){const r=[new e.bp(0,t)];if(this.renderWorldCopies){const i=this.pointCoordinate(new e.P(0,0)),n=this.pointCoordinate(new e.P(this.width,0)),o=this.pointCoordinate(new e.P(this.width,this.height)),s=this.pointCoordinate(new e.P(0,this.height)),a=Math.floor(Math.min(i.x,n.x,o.x,s.x)),l=Math.floor(Math.max(i.x,n.x,o.x,s.x)),c=1;for(let u=a-c;u<=l+c;u++)0!==u&&r.push(new e.bp(u,t))}return r}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(t,r,i){let n=[];if(0===r[0]&&0===r[1])return n;for(const s of t){const t=s.canonical,i=s.overscaledZ,o=s.wrap,a=1<<t.z,l=t.x+1<a,c=t.x>0,u=t.y+1<a,h=t.y>0,d=s.wrap-(c?0:1),p=s.wrap+(l?0:1),f=c?t.x-1:a-1,m=l?t.x+1:0;r[0]<0?(n.push(new e.am(i,p,t.z,m,t.y)),r[1]<0&&u&&(n.push(new e.am(i,o,t.z,t.x,t.y+1)),n.push(new e.am(i,p,t.z,m,t.y+1))),r[1]>0&&h&&(n.push(new e.am(i,o,t.z,t.x,t.y-1)),n.push(new e.am(i,p,t.z,m,t.y-1)))):r[0]>0?(n.push(new e.am(i,d,t.z,f,t.y)),r[1]<0&&u&&(n.push(new e.am(i,o,t.z,t.x,t.y+1)),n.push(new e.am(i,d,t.z,f,t.y+1))),r[1]>0&&h&&(n.push(new e.am(i,o,t.z,t.x,t.y-1)),n.push(new e.am(i,d,t.z,f,t.y-1)))):r[1]<0&&u?n.push(new e.am(i,o,t.z,t.x,t.y+1)):h&&n.push(new e.am(i,o,t.z,t.x,t.y-1))}if(n.length>1){n.sort(((e,t)=>e.overscaledZ-t.overscaledZ||e.wrap-t.wrap||e.canonical.z-t.canonical.z||e.canonical.x-t.canonical.x||e.canonical.y-t.canonical.y));let e=0,t=0;for(;t<n.length;)n[t].equals(n[e])?++t:n[++e]=n[t++];n.length=e+1}const o=[];for(const e of n)n.some((t=>e.isChildOf(t)))||o.push(e);return n=o.filter((e=>!t.some((t=>!!(e.overscaledZ<i&&t.isChildOf(e))||e.equals(t)||e.isChildOf(t))))),n}coveringTiles(t){let r=this.coveringZoomLevel(t);const i=r,n=this.elevation&&this.elevation.exaggeration(),o=n&&!t.isTerrainDEM,s="mercator"===this.projection.name;if(void 0!==t.minzoom&&r<t.minzoom)return[];void 0!==t.maxzoom&&r>t.maxzoom&&(r=t.maxzoom);const a=this.locationCoordinate(this.center),l=this.center.lat,c=1<<r,u=[c*a.x,c*a.y,0],h="globe"===this.projection.name,d=!h,p=e.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,d),f=h?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),m=c*e.bl(1,this.center.lat),_=this._camera.position[2]/e.bl(1,this.center.lat),g=[c*f.x,c*f.y,_*(d?1:m)],y=h||n,x=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),v=this.isLODDisabled(!0)?r:0;let b;if(this._elevation&&t.isTerrainDEM)b=1e4*this._elevation.exaggeration();else if(this._elevation){const e=this._elevation.getMinMaxForVisibleTiles();b=e?e.max:this._centerAltitude}else b=this._centerAltitude;const w=t.isTerrainDEM?-b:this._elevation?this._elevation.getMinElevationBelowMSL():0,T=this.projection.isReprojectedInTileSpace?e.br(this):1,E=t=>{const r=1/4e4,i=new e.L(t.x+r,t.y,t.z),n=new e.L(t.x,t.y+r,t.z),o=t.toLngLat(),s=i.toLngLat(),a=n.toLngLat(),l=this.locationCoordinate(o),c=this.locationCoordinate(s),u=this.locationCoordinate(a),h=Math.hypot(c.x-l.x,c.y-l.y),d=Math.hypot(u.x-l.x,u.y-l.y);return Math.sqrt(h*d)*T/r},S=t=>{const r=b,i=w;return{aabb:e.bu(this,c,0,0,0,t,i,r,this.projection),zoom:0,x:0,y:0,minZ:i,maxZ:r,wrap:t,fullyVisible:!1}},M=[];let A=[];const I=r,C=t.reparseOverscaled?i:r,P=e=>e*e,L=P((_-this._centerAltitude)*m),R=e=>{if(!this._elevation||!e.tileID||!s)return;const t=this._elevation.getMinMaxForTile(e.tileID),r=e.aabb;t?(r.min[2]=t.min,r.max[2]=t.max,r.center[2]=(r.min[2]+r.max[2])/2):(e.shouldSplit=D(e),e.shouldSplit||(r.min[2]=r.max[2]=r.center[2]=this._centerAltitude))},D=t=>{if(t.zoom<v)return!0;if(t.zoom===I)return!1;if(null!=t.shouldSplit)return t.shouldSplit;const r=t.aabb.distanceX(g),n=t.aabb.distanceY(g);let s=L,a=1;if(h){s=P(t.aabb.distanceZ(g));const r=Math.pow(2,t.zoom),i=e.au((t.y+1)/r),n=e.au(t.y/r),o=Math.min(Math.max(l,i),n),c=e.bJ(o)/e.bJ(l);if(a=o===l?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,c/this._mercatorScaleRatio),this.zoom<=e.bG&&t.zoom===I-1&&c>=.9)return!0}else if(o&&(s=P(t.aabb.distanceZ(g)*m)),this.projection.isReprojectedInTileSpace&&i<=5){const r=Math.pow(2,t.zoom),i=E(new e.L((t.x+.5)/r,(t.y+.5)/r));a=i>.85?1:i}const c=r*r+n*n+s,u=P((1<<I-t.zoom)*x*a*((e,t)=>{if(t*P(.707)<e)return 1;const r=Math.sqrt(t/e);return r/(1.4144271570014144+(Math.pow(1.1,r-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(s,L),c));return c<u};if(this.renderWorldCopies)for(let e=1;e<=3;e++)M.push(S(-e)),M.push(S(e));for(M.push(S(0));M.length>0;){const i=M.pop(),n=i.x,a=i.y;let l=i.fullyVisible;const d=()=>"globe"===this.projection.name&&(0===i.y||i.y===(1<<i.zoom)-1);if(!l){let t=y?i.aabb.intersects(p):i.aabb.intersectsFlat(p);if(0===t&&d()){const r=new e.bs(i.zoom,n,a);t=e.bt(this,c,r,!0).intersects(p)}if(0===t)continue;l=2===t}if(i.zoom!==I&&D(i))for(let t=0;t<4;t++){const r=(n<<1)+t%2,u=(a<<1)+(t>>1),d={aabb:s?i.aabb.quadrant(t):e.bu(this,c,i.zoom+1,r,u,i.wrap,i.minZ,i.maxZ,this.projection),zoom:i.zoom+1,x:r,y:u,wrap:i.wrap,fullyVisible:l,tileID:void 0,shouldSplit:void 0,minZ:i.minZ,maxZ:i.maxZ};o&&!h&&(d.tileID=new e.am(i.zoom+1===I?C:i.zoom+1,i.wrap,i.zoom+1,r,u),R(d)),M.push(d)}else{const o=i.zoom===I?C:i.zoom;if(t.minzoom&&t.minzoom>o)continue;if(!l){let t=y?i.aabb.intersectsPrecise(p):i.aabb.intersectsPreciseFlat(p);if(0===t&&d()){const r=new e.bs(i.zoom,n,a);t=e.bt(this,c,r,!0).intersectsPrecise(p)}if(0===t)continue}const s=u[0]-(.5+n+(i.wrap<<i.zoom))*(1<<r-i.zoom),h=u[1]-.5-a,f=i.tileID?i.tileID:new e.am(o,i.wrap,i.zoom,n,a);A.push({tileID:f,distanceSq:s*s+h*h})}}if(this.fogCullDistSq){const r=this.fogCullDistSq,i=this.horizonLineFromTop();A=A.filter((n=>{const o=[0,0,0,1],s=[e.V,e.V,0,1],a=this.calculateFogTileMatrix(n.tileID.toUnwrapped());e.a7.transformMat4(o,o,a),e.a7.transformMat4(s,s,a);const l=e.a7.min([],o,s),c=e.a7.max([],o,s),u=e.bv(l,c);if(0===u)return!0;let h=!1;const d=this._elevation;if(d&&u>r&&0!==i){const r=this.calculateProjMatrix(n.tileID.toUnwrapped());let o;t.isTerrainDEM||(o=d.getMinMaxForTile(n.tileID)),o||(o={min:w,max:b});const s=e.bH(this.rotation),a=[s[0]*e.V,s[1]*e.V,o.max];e.N.transformMat4(a,a,r),h=(1-a[1])*this.height*.5<i}return u<r||h}))}return A.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){const r=e.aa(t.lat,-e.bw,e.bw),i=this.projection.project(t.lng,r);return new e.P(i.x*this.worldSize,i.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/e.bl(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,r){let i,n;const o=this.centerPoint;if("globe"===this.projection.name){const e=this.worldSize;i=(r.x-o.x)/e,n=(r.y-o.y)/e}else{const e=this.pointCoordinate(r),t=this.pointCoordinate(o);i=e.x-t.x,n=e.y-t.y}const s=this.locationCoordinate(t);this.setLocation(new e.L(s.x-i,s.y-n))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(t,r){const i=r?e.bl(r,t.lat):void 0,n=this.projection.project(t.lng,t.lat);return new e.L(n.x,n.y,i)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(t,r){const i=null!=r?r:this._centerAltitude,n=[t.x,t.y,0,1],o=[t.x,t.y,1,1];e.a7.transformMat4(n,n,this.pixelMatrixInverse),e.a7.transformMat4(o,o,this.pixelMatrixInverse);const s=o[3];e.a7.scale(n,n,1/n[3]),e.a7.scale(o,o,1/s);const a=n[2],l=o[2];return{p0:n,p1:o,t:a===l?0:(i-a)/(l-a)}}screenPointToMercatorRay(t){const r=[t.x,t.y,0,1],i=[t.x,t.y,1,1];return e.a7.transformMat4(r,r,this.pixelMatrixInverse),e.a7.transformMat4(i,i,this.pixelMatrixInverse),e.a7.scale(r,r,1/r[3]),e.a7.scale(i,i,1/i[3]),r[2]=e.bl(r[2],this._center.lat)*this.worldSize,i[2]=e.bl(i[2],this._center.lat)*this.worldSize,e.a7.scale(r,r,1/this.worldSize),e.a7.scale(i,i,1/this.worldSize),new e.a2([r[0],r[1],r[2]],e.N.normalize([],e.N.sub([],i,r)))}rayIntersectionCoordinate(t){const{p0:r,p1:i,t:n}=t,o=e.bl(r[2],this._center.lat),s=e.bl(i[2],this._center.lat);return new e.L(e.U(r[0],i[0],n)/this.worldSize,e.U(r[1],i[1],n)/this.worldSize,e.U(o,s,n))}pointCoordinate(e,t=this._centerAltitude){return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let r=this.projection.pointCoordinate3D(this,t.x,t.y);if(r)return new e.L(r[0],r[1],r[2]);let i=0,n=this.horizonLineFromTop();if(t.y>n)return this.pointCoordinate(t);const o=.02*n,s=t.clone();for(let a=0;a<10&&n-i>o;a++){s.y=e.U(i,n,.66);const t=this.projection.pointCoordinate3D(this,s.x,s.y);t?(n=s.y,r=t):i=s.y}return r?new e.L(r[0],r[1],r[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=e.bx)return!this.isPointAboveHorizon(t);const r=this.pointCoordinate(t);return r.y>=0&&r.y<=1}_coordinatePoint(t,r){const i=r&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,n=[t.x*this.worldSize,t.y*this.worldSize,i+t.toAltitude(),1];return e.a7.transformMat4(n,n,this.pixelMatrix),n[3]>0?new e.P(n[0]/n[3],n[1]/n[3]):new e.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:r}=this._edgeInsets,i=this.height-this._edgeInsets.bottom,n=this.width-this._edgeInsets.right,o=this.pointLocation3D(new e.P(r,t)),s=this.pointLocation3D(new e.P(n,t)),a=this.pointLocation3D(new e.P(n,i)),l=this.pointLocation3D(new e.P(r,i));let c=Math.min(o.lng,s.lng,a.lng,l.lng),u=Math.max(o.lng,s.lng,a.lng,l.lng),h=Math.min(o.lat,s.lat,a.lat,l.lat),d=Math.max(o.lat,s.lat,a.lat,l.lat);const p=Math.pow(2,-this.zoom)/16*270,f="globe"===this.projection.name?1:4,m=(t,r,i,n,o)=>{const s=(t+i)/2,a=(r+n)/2,l=new e.P(s,a),{lng:_,lat:g}=this.pointLocation3D(l),y=Math.max(0,c-_,h-g,_-u,g-d);c=Math.min(c,_),u=Math.max(u,_),h=Math.min(h,g),d=Math.max(d,g),(o<f||y>p)&&(m(t,r,s,a,o+1),m(s,a,i,n,o+1))};if(m(r,t,n,t,1),m(n,t,n,i,1),m(n,i,r,i,1),m(r,i,r,t,1),"globe"===this.projection.name){const[t,r]=e.by(this);t?(d=90,u=180,c=-180):r&&(h=-90,u=180,c=-180)}return new e.ad(new e.bn(c,h),new e.bn(u,d))}_getBoundsRectangular(t,r){const{top:i,left:n}=this._edgeInsets,o=this.height-this._edgeInsets.bottom,s=this.width-this._edgeInsets.right,a=new e.P(n,i),l=new e.P(s,i),c=new e.P(s,o),u=new e.P(n,o);let h=this.pointCoordinate(a,t),d=this.pointCoordinate(l,t);const p=this.pointCoordinate(c,r),f=this.pointCoordinate(u,r),m=(e,t)=>(t.y-e.y)/(t.x-e.x);return h.y>1&&d.y>=0?h=new e.L((1-f.y)/m(f,h)+f.x,1):h.y<0&&d.y<=1&&(h=new e.L(-f.y/m(f,h)+f.x,0)),d.y>1&&h.y>=0?d=new e.L((1-p.y)/m(p,d)+p.x,1):d.y<0&&h.y<=1&&(d=new e.L(-p.y/m(p,d)+p.x,0)),(new e.ad).extend(this.coordinateLocation(h)).extend(this.coordinateLocation(d)).extend(this.coordinateLocation(f)).extend(this.coordinateLocation(p))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const t=e.visibleDemTiles.reduce(((e,t)=>{if(t.dem){const r=t.dem.tree;e.min=Math.min(e.min,r.minimums[0]),e.max=Math.max(e.max,r.maximums[0])}return e}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(e=!0){const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,r=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,r):r}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-e.bw,this.maxLat=e.bw,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=e.a5(this.minLng)*this.tileSize,this.worldMaxX=e.a5(this.maxLng)*this.tileSize,this.worldMinY=e.ae(this.maxLat)*this.tileSize,this.worldMaxY=e.ae(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(t){const r=t.key,i=this._distanceTileDataCache;if(i[r])return i[r];const n=t.canonical,o=1/this.height,s=this.cameraWorldSize,a=s/this.zoomScale(n.z),l=(n.x+Math.pow(2,n.z)*t.wrap)*a,c=n.y*a,u=this.point;u.x*=s/this.worldSize,u.y*=s/this.worldSize;const h=this.angle,d=Math.sin(-h),p=-Math.cos(-h);return i[r]={bearing:[d,p],center:[(u.x-l)*o,(u.y-c)*o],scale:a/e.V*o},i[r]}calculateFogTileMatrix(t){const r=t.key,i=this._fogTileMatrixCache;if(i[r])return i[r];const n=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return e.a6.multiply(n,this.worldToFogMatrix,n),i[r]=new Float32Array(n),i[r]}calculateProjMatrix(t,r=!1,i=!1){const n=t.key;let o;if(o=i?this._expandedProjMatrixCache:r?this._alignedProjMatrixCache:this._projMatrixCache,o[n])return o[n];const s=this.calculatePosMatrix(t,this.worldSize);let a;return a=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:i?this.expandedFarZProjMatrix:r?this.alignedProjMatrix:this.projMatrix,e.a6.multiply(s,a,s),o[n]=new Float32Array(s),o[n]}calculatePixelsToTileUnitsMatrix(t){const r=t.tileID.key,i=this._pixelsToTileUnitsCache;if(i[r])return i[r];const n=e.bz(t,this);return i[r]=n,i[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const t=1/this.worldSize,r=e.a6.fromScaling([],[t,t,t]);return e.a6.multiply(r,r,this.globeMatrix),r}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const r=e.bl(1,this._center.lat)*this.worldSize,i=this._computeCameraPosition(r),n=this._camera.forward(),o=e.bl(1,this._center.lat);i[2]/=o,n[2]/=o,e.N.normalize(n,n);const s=t.raycast(i,n,t.exaggeration());if(s){const t=e.N.scaleAndAdd([],i,n,s),r=new e.L(t[0],t[1],e.bl(t[2],e.au(t[1]))),a=(r.z+e.N.length([r.x-i[0],r.y-i[1],r.z-i[2]*o]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(a),this._centerAltitude=r.toAltitude(),this._center=this.coordinateLocation(r),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const r=this._elevation,i=e.bl(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(i),o=r.getAtPointOrZero(new e.L(...n)),s=this.pixelsPerMeter/this.worldSize*o,a=this._minimumHeightOverTerrain(),l=n[2]-s;if(l<=a)if(l<0||t){const t=this.locationCoordinate(this._center,this._centerAltitude),r=[n[0],n[1],t.z-n[2]],i=e.N.length(r);r[2]-=(a-l)/this._pixelsPerMercatorPixel;const o=e.N.length(r);if(0===o)return;e.N.scale(r,r,i/o*this._pixelsPerMercatorPixel),this._camera.position=[n[0],n[1],t.z*this._pixelsPerMercatorPixel-r[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const r=this.center;return r.lat=e.aa(r.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(r.lng=e.aa(r.lng,this.minLng,this.maxLng)),this.center=r,void(this._constraining=!1)}const r=this._unmodified,{x:i,y:n}=this.point;let o=0,s=i,a=n;const l=this.width/2,c=this.height/2,u=this.worldMinY*this.scale,h=this.worldMaxY*this.scale;if(n-c<u&&(a=u+c),n+c>h&&(a=h-c),h-u<this.height&&(o=Math.max(o,this.height/(h-u)),a=(h+u)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const e=this.worldMinX*this.scale,t=this.worldMaxX*this.scale,r=this.worldSize/2-(e+t)/2;s=(i+r+this.worldSize)%this.worldSize-r,s-l<e&&(s=e+l),s+l>t&&(s=t-l),t-e<this.width&&(o=Math.max(o,this.width/(t-e)),s=(t+e)/2)}s===i&&a===n||(this.center=this.unproject(new e.P(s,a))),o&&(this.zoom+=this.scaleZoom(o)),this._constrainCamera(),this._unmodified=r,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,r="globe"===this.projection.name,i=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=e.bl(1,this.center.lat)/e.bl(1,e.bI));const n=e.bA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,n),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const o="meters"===this.projection.zAxisUnit?i:1,s=this._camera.getWorldToCamera(this.worldSize,o);let a;const l=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(l[8]=2*-t.x/this.width,l[9]=2*t.y/this.height,this.isOrthographic){let e=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),r=e*this.aspect,i=-r,n=-e;r-=t.x,i-=t.x,e+=t.y,n+=t.y,a=this._camera.getCameraToClipOrthographic(i,r,n,e,this._nearZ,this._farZ),((e,t,r,i)=>{for(let n=0;n<16;n++)e[n]=pi(t[n],r[n],i)})(a,a,l,fi(this.pitch>=15?1:this.pitch/15))}else a=l;const c=e.a6.mul([],l,s);let u=e.a6.mul([],a,s);if(this.projection.isReprojectedInTileSpace){const t=this.locationCoordinate(this.center),r=e.a6.identity([]);e.a6.translate(r,r,[t.x*this.worldSize,t.y*this.worldSize,0]),e.a6.multiply(r,r,e.bB(this)),e.a6.translate(r,r,[-t.x*this.worldSize,-t.y*this.worldSize,0]),e.a6.multiply(u,u,r),e.a6.multiply(c,c,r),this.inverseAdjustmentMatrix=e.bC(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=e.a6.scale([],u,[this.worldSize,this.worldSize,this.worldSize/o,1]),this.projMatrix=u,this.invProjMatrix=e.a6.invert(new Float64Array(16),this.projMatrix),r){const r=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);r[8]=2*-t.x/this.width,r[9]=2*t.y/this.height,this.expandedFarZProjMatrix=e.a6.mul([],r,s)}else this.expandedFarZProjMatrix=this.projMatrix;const h=e.a6.invert([],a);this.frustumCorners=e.bD.fromInvProjectionMatrix(h,this.horizonLineFromTop(),this.height),this.cameraFrustum=e.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!r);const d=new Float32Array(16);e.a6.identity(d),e.a6.scale(d,d,[1,-1,1]),e.a6.rotateX(d,d,this._pitch),e.a6.rotateZ(d,d,this.angle);const p=e.a6.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=e.a6.clone(p);const f=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;p[8]=2*-t.x/this.width,p[9]=2*(t.y+f)/this.height,this.skyboxMatrix=e.a6.multiply(d,p,d);const m=this.point,_=m.x,g=m.y,y=this.width%2/2,x=this.height%2/2,v=Math.cos(this.angle),b=Math.sin(this.angle),w=_-Math.round(_)+v*y+b*x,T=g-Math.round(g)+v*x+b*y,E=new Float64Array(u);if(e.a6.translate(E,E,[w>.5?w-1:w,T>.5?T-1:T,0]),this.alignedProjMatrix=E,u=e.a6.create(),e.a6.scale(u,u,[this.width/2,-this.height/2,1]),e.a6.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=e.a6.create(),e.a6.scale(u,u,[1,-1,1]),e.a6.translate(u,u,[-1,-1,0]),e.a6.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=e.a6.multiply(new Float64Array(16),this.labelPlaneMatrix,c),this._calcFogMatrices(),this._distanceTileDataCache={},u=e.a6.invert(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=u,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=e.bE(this);const t=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=e.N.transformMat4(t,t,s),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=u;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,r=this.cameraPixelsPerMeter,i=this._camera.position,n=1/this.height/this._pixelsPerMercatorPixel,o=[t,t,r];e.N.scale(o,o,n),e.N.scale(i,i,-1),e.N.multiply(i,i,o);const s=e.a6.create();e.a6.translate(s,s,i),e.a6.scale(s,s,o),this.mercatorFogMatrix=s,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,r,n)}_computeCameraPosition(e){const t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,r=this._camera.forward(),i=this.point,n=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*t-e/this.worldSize*this._centerAltitude;return[i.x/this.worldSize-r[0]*n,i.y/this.worldSize-r[1]*n,e/this.worldSize*this._centerAltitude-r[2]*n]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const r=this._maxCameraBoundsDistance()*Math.cos(this._pitch),i=this._camera.position[2],n=t[2];let o=1;this.projection.wrap&&(this.center=this.center.wrap()),n>0&&(o=Math.min((r-i)/n,1)),this._camera.position=e.N.scaleAndAdd([],this._camera.position,t,o),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,r=this._camera.forward(),{pitch:i,bearing:n}=this._camera.getPitchBearing(),o=e.bl(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,s=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.bj(this._maxPitch)),a=Math.max((t[2]-o)/Math.cos(i),s),l=this._zoomFromMercatorZ(a);e.N.scaleAndAdd(t,t,r,a),this._pitch=e.aa(i,e.bj(this.minPitch),e.bj(this.maxPitch)),this.angle=e.bh(n,-Math.PI,Math.PI),this._setZoom(e.aa(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new e.L(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}zoomFromMercatorZAdjusted(t){let r=0,i=e.bx,n=0,o=1/0;for(;i-r>1e-6&&i>r;){const e=r+.5*(i-r),s=this.tileSize*Math.pow(2,e),a=this.getCameraToCenterDistance(this.projection,e,s),l=this.scaleZoom(a/(t*this.tileSize)),c=Math.abs(e-l);c<o&&(o=c,n=e),e<l?r=e:i=e}return n}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(e.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,r){const i=Math.min(t.x,r.x),n=Math.max(t.x,r.x),o=Math.min(t.y,r.y),s=Math.max(t.y,r.y);if(o<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const a=[new e.P(i,o),new e.P(n,s),new e.P(i,s),new e.P(n,o)],l=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const e of a){const t=this.pointRayIntersection(e);if(t.t<0)return!0;const r=this.rayIntersectionCoordinate(t);if(r.x<l||r.y<0||r.x>c||r.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+e.bF(this.fovAboveCenter)>88||this.anyCornerOffEdge(new e.P(0,0),new e.P(this.width,this.height))}zoomDeltaToMovement(t,r){const i=e.N.length(e.N.sub([],this._camera.position,t)),n=this._zoomFromMercatorZ(i)+r;return i-this._mercatorZfromZoom(n)}getCameraPoint(){if("globe"===this.projection.name){const t=function([t,r,i],n){const o=[t,r,i,1];e.a7.transformMat4(o,o,n);const s=o[3]=Math.max(o[3],1e-6);return o[0]/=s,o[1]/=s,o[2]/=s,o}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new e.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.P(0,t))}}getCameraToCenterDistance(t,r=this.zoom,i=this.worldSize){const n=e.bA(t,r,this.width,this.height,1024),o=t.pixelSpaceConversion(this.center.lat,i,n);let s=.5/Math.tan(.5*this._fov)*this.height*o;return this.isOrthographic&&(s=pi(1,s,fi(this.pitch>=15?1:this.pitch/15))),s}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&e.a6.multiply(t,t,this.globeMatrix),t}getFrustum(t){return e.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,"meters"===this.projection.zAxisUnit)}}const _i={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},gi=(t,r)=>{if(r>0&&t.terrain&&e.w("Cutoff is currently disabled on terrain"),r<=0||t.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const i=t.transform,n=Math.max(Math.abs(i._zoom-(t.minCutoffZoom-1)),1),o=i.isLODDisabled(!1)?e.O(60,45,i.pitch):e.O(30,15,i.pitch),s=i._farZ-i._nearZ,a=r*i.height,l=((1-(c=o))*i.cameraToCenterDistance+c*(i._farZ+a))*n;var c;return{shouldRenderCutoff:o<1,uniformValues:{u_cutoff_params:[i._nearZ,i._farZ,(l-i._nearZ)/s,(l-a-i._nearZ)/s]}}},yi={cascadeCount:2,shadowMapResolution:2048};class xi{constructor(e,t){this.aabb=e,this.lastCascade=t}}class vi{add(e,t){const r=this.receivers[e.key];void 0!==r?(r.aabb.min[0]=Math.min(r.aabb.min[0],t.min[0]),r.aabb.min[1]=Math.min(r.aabb.min[1],t.min[1]),r.aabb.min[2]=Math.min(r.aabb.min[2],t.min[2]),r.aabb.max[0]=Math.max(r.aabb.max[0],t.max[0]),r.aabb.max[1]=Math.max(r.aabb.max[1],t.max[1]),r.aabb.max[2]=Math.max(r.aabb.max[2],t.max[2])):this.receivers[e.key]=new xi(t,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(t,r,i){const n=e.bS.fromPoints(t.points);let o=0;for(const s in this.receivers){const t=this.receivers[s];if(!t)continue;if(!n.intersectsAabb(t.aabb))continue;t.aabb.min=n.closestPoint(t.aabb.min),t.aabb.max=n.closestPoint(t.aabb.max);const a=t.aabb.getCorners();for(let n=0;n<i.length;n++){let s=!0;for(const t of a){const o=[t[0]*r,t[1]*r,t[2]];if(e.N.transformMat4(o,o,i[n].matrix),o[0]<-1||o[0]>1||o[1]<-1||o[1]>1){s=!1;break}}if(t.lastCascade=n,o=Math.max(o,n),s)break}}return o+1}}class bi{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new vi,this._depthMode=new Ct(e.context.gl.LEQUAL,Ct.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,e.tp.registerParameter(yi,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),e.tp.registerParameter(yi,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(const e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,r){const i=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!r||!r.properties)return;const n=r.properties.get("shadow-intensity");if(!r.shadowsEnabled()||n<=0)return;if(this._shadowLayerCount=i.style.order.reduce(((e,r)=>{const n=i.style._mergedLayers[r];return e+(n.hasShadowPass()&&!n.isHidden(t.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this._enabled)return;const o=i.context,s=yi.shadowMapResolution,a=yi.shadowMapResolution;if(0===this._cascades.length||yi.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let t=0;t<yi.cascadeCount;++t){const t=i._shadowMapDebug,r=o.gl,n=o.createFramebuffer(s,a,t,"texture"),l=new e.T(o,{width:s,height:a,data:null},r.DEPTH_COMPONENT);if(n.depthAttachment.set(l.texture),t){const t=new e.T(o,{width:s,height:a,data:null},r.RGBA);n.colorAttachment.set(t.texture)}this._cascades.push({framebuffer:n,texture:l,matrix:[],far:0,boundingSphereRadius:0,frustum:new e.bq,scale:0})}}this.shadowDirection=Ti(r);let l=0;if(t.elevation){const e=t.elevation,r=[1e4,-1e4];e.visibleDemTiles.filter((e=>e.dem)).forEach((e=>{const t=e.dem.tree;r[0]=Math.min(r[0],t.minimums[0]),r[1]=Math.max(r[1],t.maximums[0])})),1e4!==r[0]&&(l=(r[1]-r[0])*e.exaggeration())}const c=1.5*t.cameraToCenterDistance,u=3*c,h=new Float64Array(16);for(let f=0;f<this._cascades.length;++f){const r=this._cascades[f];let i=t.height/50,n=1;1===yi.cascadeCount?n=u:0===f?n=c:(i=c,n=u);const[o,s]=Si(t,this.shadowDirection,i,n,yi.shadowMapResolution,l);r.scale=t.scale,r.matrix=o,r.boundingSphereRadius=s,e.a6.invert(h,r.matrix),r.frustum=e.bq.fromInvProjectionMatrix(h,1,0,!0),r.far=n}const d=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[d].far,this._cascades[d].far],this._uniformValues.u_shadow_intensity=n,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/yi.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=yi.shadowMapResolution,this._uniformValues.u_shadowmap_0=_i.ShadowMap0,this._uniformValues.u_shadowmap_1=_i.ShadowMap0+1,this._groundShadowTiles=i.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const p=i.transform.elevation;for(const e of this._groundShadowTiles){let t={min:0,max:0};if(p){const r=p.getMinMaxForTile(e);r&&(t=r)}this.addShadowReceiver(e.toUnwrapped(),t.min,t.max)}}get enabled(){return this._enabled}set enabled(e){this._enabled=e}drawShadowPass(t,r){if(!this._enabled)return;const i=this.painter,n=i.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(i.transform.getFrustum(0),i.transform.worldSize,this._cascades),n.viewport.set([0,0,yi.shadowMapResolution,yi.shadowMapResolution]);for(let o=0;o<this._numCascadesToRender;++o){i.currentShadowCascade=o,n.bindFramebuffer.set(this._cascades[o].framebuffer.framebuffer),n.clear({color:e.ax.white,depth:1});for(const e of t.order){const n=t._mergedLayers[e];if(!n.hasShadowPass()||n.isHidden(i.transform.zoom))continue;const o=t.getLayerSourceCache(n),s=o?r[o.id]:void 0;("model"===n.type||s&&s.length)&&i.renderLayer(i,o,n,s)}}i.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const e=this.painter,t=e.style,r=e.context,i=t.directionalLight,n=t.ambientLight;if(!i||!n)return;const o=[],s=gi(e,e.longestCutoffRange);s.shouldRenderCutoff&&o.push("RENDER_CUTOFF");const a=Ei(i,n),l=new Ct(r.gl.LEQUAL,Ct.ReadOnly,e.depthRangeFor3D);for(const c of this._groundShadowTiles){const t=c.toUnwrapped(),i=e.isTileAffectedByFog(c),n=e.getOrCreateProgram("groundShadow",{defines:o,overrideFog:i});this.setupShadows(t,n),e.uploadCommonUniforms(r,n,t,null,s);const u={u_matrix:e.transform.calculateProjMatrix(t),u_ground_shadow_factor:a};n.draw(e,r.gl.TRIANGLES,l,Lt.disabled,Dt.multiply,kt.disabled,u,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,{},e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Dt.unblended:Dt.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const r=this.painter.transform,i=r.calculatePosMatrix(t,r.worldSize);return e.a6.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}calculateShadowPassMatrixFromMatrix(t){return e.a6.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,r,i,n=0){if(!this._enabled)return;const o=this.painter.transform,s=this.painter.context,a=s.gl,l=this._uniformValues,c=new Float64Array(16),u=o.calculatePosMatrix(t,o.worldSize);for(let h=0;h<this._cascades.length;h++)e.a6.multiply(c,this._cascades[h].matrix,u),l[0===h?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(c),s.activeTexture.set(a.TEXTURE0+_i.ShadowMap0+h),this._cascades[h].texture.bind(a.NEAREST,a.CLAMP_TO_EDGE);if(this.useNormalOffset=!!i,this.useNormalOffset){const r=e.bR(t.canonical),s=2/o.tileSize*e.V/yi.shadowMapResolution,a=s*this._cascades[0].boundingSphereRadius,c=s*this._cascades[this._cascades.length-1].boundingSphereRadius,u=("vector-tile"===i?1:3)/Math.pow(2,n-t.canonical.z-(1-o.zoom+Math.floor(o.zoom)));l.u_shadow_normal_offset=[r,a*u,c*u],l.u_shadow_bias=[6e-5,.0012,.012]}else l.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(s,l)}setupShadowsFromMatrix(t,r,i=!1){if(!this._enabled)return;const n=this.painter.context,o=n.gl,s=this._uniformValues,a=new Float64Array(16);for(let l=0;l<yi.cascadeCount;l++)e.a6.multiply(a,this._cascades[l].matrix,t),s[0===l?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(a),n.activeTexture.set(o.TEXTURE0+_i.ShadowMap0+l),this._cascades[l].texture.bind(o.NEAREST,o.CLAMP_TO_EDGE);if(this.useNormalOffset=i,i){const e=5;s.u_shadow_normal_offset=[1,e,e],s.u_shadow_bias=[6e-5,.0012,.012]}else s.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(n,s)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,r,i,n){if(n[2]>=0)return{};const o=function(t,r,i){const n=i/(1<<t.canonical.z);return new e.bS([t.canonical.x*n+t.wrap*i,t.canonical.y*n+t.wrap*i,0],[(t.canonical.x+1)*n+t.wrap*i,(t.canonical.y+1)*n+t.wrap*i,r])}(t,r,i).getCorners(),s=r/-n[2];n[0]<0?(e.N.add(o[0],o[0],[n[0]*s,0,0]),e.N.add(o[3],o[3],[n[0]*s,0,0])):n[0]>0&&(e.N.add(o[1],o[1],[n[0]*s,0,0]),e.N.add(o[2],o[2],[n[0]*s,0,0])),n[1]<0?(e.N.add(o[0],o[0],[0,n[1]*s,0]),e.N.add(o[1],o[1],[0,n[1]*s,0])):n[1]>0&&(e.N.add(o[2],o[2],[0,n[1]*s,0]),e.N.add(o[3],o[3],[0,n[1]*s,0]));const a={};return a.vertices=o,a.planes=[wi(o[1],o[0],o[4]),wi(o[2],o[1],o[5]),wi(o[3],o[2],o[6]),wi(o[0],o[3],o[7])],a}addShadowReceiver(t,r,i){this._receivers.add(t,e.bS.fromTileIdAndHeight(t,r,i))}getMaxCascadeForTile(e){const t=this._receivers.get(e);return t&&t.lastCascade?t.lastCascade:0}}function wi(t,r,i){const n=e.N.sub([],i,r),o=e.N.sub([],t,r),s=e.N.cross([],n,o),a=e.N.length(s);return 0===a?[0,0,1,0]:(e.N.scale(s,s,1/a),[s[0],s[1],s[2],-e.N.dot(s,r)])}function Ti(t){const r=t.properties.get("direction"),i=e.bQ(r.x,r.y,r.z);i[2]=e.aa(i[2],0,75);const n=e.bT([i[0],i[1],i[2]]);return e.N.fromValues(n.x,n.y,n.z)}function Ei(t,r){const i=t.properties.get("color"),n=t.properties.get("intensity"),o=t.properties.get("direction"),s=[o.x,o.y,o.z],a=r.properties.get("color"),l=r.properties.get("intensity"),c=Math.max(e.N.dot([0,0,1],s),0),u=[0,0,0];e.N.scale(u,a.toArray01Linear().slice(0,3),l);const h=[0,0,0];return e.N.scale(h,i.toArray01Linear().slice(0,3),c*n),e.bU([u[0]>0?u[0]/(u[0]+h[0]):0,u[1]>0?u[1]/(u[1]+h[1]):0,u[2]>0?u[2]/(u[2]+h[2]):0])}function Si(t,r,i,n,o,s){const a=t.zoom,l=t.scale,c=t.worldSize,u=1/c,h=t.aspect,d=Math.sqrt(1+h*h)*Math.tan(.5*t.fovX),p=d*d,f=n-i,m=n+i;let _,g;p>f/m?(_=n,g=n*d):(_=.5*m*(1+p),g=.5*Math.sqrt(f*f+2*(n*n+i*i)*p+m*m*p*p));const y=t.projection.pixelsPerMeter(t.center.lat,c),x=t._camera.getCameraToWorldMercator(),v=[0,0,-_*u];e.N.transformMat4(v,v,x);let b=g*u;const w=t._edgeInsets;if(!(0===w.left&&0===w.top&&0===w.right&&0===w.bottom||w.left===w.right&&w.top===w.bottom)){const r=t._camera.getWorldToCamera(t.worldSize,"meters"===t.projection.zAxisUnit?y:1),o=t._camera.getCameraToClipPerspective(t._fov,t.width/t.height,i,n);o[8]=2*-t.centerOffset.x/t.width,o[9]=2*t.centerOffset.y/t.height;const s=new Float64Array(16);e.a6.mul(s,o,r);const u=new Float64Array(16);e.a6.invert(u,s);const h=e.bq.fromInvProjectionMatrix(u,c,a,!0);for(const i of h.points){const r=((T=i)[0]/=l,T[1]/=l,T[2]=e.bl(T[2],t._center.lat),T);b=Math.max(b,e.N.len(e.N.subtract([],v,r)))}}var T;b*=o/(o-1);const E=Math.acos(r[2]),S=Math.atan2(-r[0],-r[1]),M=new di;M.position=v,M.setPitchBearing(E,S);const A=M.getWorldToCamera(c,y),I=b*c,C=Math.min(t._mercatorZfromZoom(17)*c*-2,-2*I),P=M.getCameraToClipOrthographic(-I,I,-I,I,C,(I+s*y)/r[2]),L=new Float64Array(16);e.a6.multiply(L,P,A);const R=e.N.fromValues(Math.floor(1e6*v[0])/1e6*c,Math.floor(1e6*v[1])/1e6*c,0),D=.5*o,O=[0,0,0];e.N.transformMat4(O,R,L),e.N.scale(O,O,D);const z=[Math.floor(O[0]),Math.floor(O[1]),Math.floor(O[2])],k=[0,0,0];e.N.sub(k,O,z),e.N.scale(k,k,-1/D);const F=new Float64Array(16);return e.a6.identity(F),e.a6.translate(F,F,k),e.a6.multiply(L,F,L),[L,I]}const Mi=(e,t)=>ce(e,t&&t.filter((e=>"source.canvas"!==e.identifier))),Ai=e.ac(ir,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Ii=e.ac(ir,["setCenter","setZoom","setBearing","setPitch"]),Ci={version:8,layers:[],sources:{}},Pi={duration:300,delay:0},Li=new Set(["fill","line","background","hillshade","raster"]);class Ri extends e.E{constructor(t,r={}){super(),this.map=t,this.scope=r.scope||"",this.fragments=[],this.importDepth=r.importDepth||0,this.importsCache=r.importsCache||new Map,this.resolvedImports=r.resolvedImports||new Set,this.transition=e.e({},Pi),this._buildingIndex=new er(this),this.crossTileSymbolIndex=new si,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=r.styleChanges||new y,this.dispatcher=r.dispatcher?r.dispatcher:new e.bW(e.bX(),this),r.imageManager?this.imageManager=r.imageManager:(this.imageManager=new w,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=r.glyphManager?r.glyphManager:new e.bY(t._requestManager,r.localFontFamily?e.bZ.all:r.localIdeographFontFamily?e.bZ.ideographs:e.bZ.none,r.localFontFamily||r.localIdeographFontFamily),r.modelManager?this.modelManager=r.modelManager:(this.modelManager=new x(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=r.configOptions?r.configOptions:new Map,this._configDependentLayers=r.configDependentLayers?r.configDependentLayers:new Set,this._config=r.config,this.dispatcher.broadcast("setReferrer",e.b_());const i=this;this._rtlTextPluginCallback=Ri.registerForPluginStateChange((t=>{i.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},((t,r)=>{if(e.b$(t),r&&r.every((e=>e)))for(const e in i._sourceCaches){const t=i._sourceCaches[e],r=t.getSource().type;"vector"!==r&&"geojson"!==r||t.reload()}}))})),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getOwnSource(e.sourceId);if(t&&t.vectorLayerIds)for(const r in this._layers){const e=this._layers[r];e.source===t.id&&this._validateLayer(e)}}))}loadURL(t,r={}){this.fire(new e.b("dataloading",{dataType:"style"}));const i="boolean"==typeof r.validate?r.validate:!e.c0(t);t=this.map._requestManager.normalizeStyleURL(t,r.accessToken),this.resolvedImports.add(t);const n=this.importsCache.get(t);if(n)return this._load(n,i);const o=this.map._requestManager.transformRequest(t,e.R.Style);this._request=e.g(o,((r,n)=>{if(this._request=null,r)this.fire(new e.a(r));else if(n)return this.importsCache.set(t,n),this._load(n,i)}))}loadJSON(t,r={}){this.fire(new e.b("dataloading",{dataType:"style"})),this._request=e.f.frame((()=>{this._request=null,this._load(t,!1!==r.validate)}))}loadEmpty(){this.fire(new e.b("dataloading",{dataType:"style"})),this._load(Ci,!1)}_loadImports(t,r,i){if(this.importDepth>=4)return e.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const n=[];for(const e of t){const t=this._createFragmentStyle(e),o=new Promise((e=>{t.once("style.import.load",e),t.once("error",e)})).then((()=>this.mergeAll()));if(n.push(o),this.resolvedImports.has(e.url)){t.loadEmpty();continue}const s=e.data||this.importsCache.get(e.url);s?t.loadJSON(s,{validate:r}):e.url?t.loadURL(e.url,{validate:r}):t.loadEmpty();const a={style:t,id:e.id,config:e.config};if(i){const e=this.fragments.findIndex((({id:e})=>e===i));this.fragments=this.fragments.slice(0,e).concat(a).concat(this.fragments.slice(e))}else this.fragments.push(a)}return Promise.allSettled(n)}_createFragmentStyle(t){const r=this.scope?e.ag(t.id,this.scope):t.id,i=new Ri(this.map,{scope:r,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:t.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return i.setEventedParent(this.map,{style:i}),i}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const t=this.isRootStyle();this._shouldPrecompile=t,this.fire(new e.b(t?"style.load":"style.import.load"))}_load(t,r){const i=t.schema;if(this.isRootStyle()&&(t.fragment||i&&!1!==t.fragment)){const i=e.e({},Ci,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(i,r)}if(this.setConfig(this._config,i),r&&Mi(this,K(t)))return;this._loaded=!0,this.stylesheet=e.c1(t);for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1,isInitialLoad:!0});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const n=rr(this.stylesheet.layers);if(this._order=n.map((e=>e.id)),this.stylesheet.light&&e.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const e=this.stylesheet.lights[0];this.light=new he(e.properties,e.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new he(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const s of n){const t=e.c2(s,this.scope,this.options);t.isConfigDependent&&this._configDependentLayers.add(t.fqid),t.setEventedParent(this,{layer:{id:t.id}}),this._layers[t.id]=t,this._serializedLayers[t.id]=t.serialize();const r=this.getOwnLayerSourceCache(t),i=!!this.directionalLight&&this.directionalLight.shadowsEnabled();r&&t.canCastShadows()&&i&&(r.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const o=this.stylesheet.terrain;o&&(void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=e.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?e.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(o,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new e.b("data",{dataType:"style"})),t.imports?this._loadImports(t.imports,r).then((()=>this._reloadImports())):this._reloadImports()}isRootStyle(){return 0===this.importDepth}mergeAll(){let t,r,i,n,o,s,a,l;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((e=>{if(e.stylesheet){if(null!=e.light&&(t=e.light),e.stylesheet.lights)for(const t of e.stylesheet.lights)"ambient"===t.type&&null!=e.ambientLight&&(r=e.ambientLight),"directional"===t.type&&null!=e.directionalLight&&(i=e.directionalLight);n=this._prioritizeTerrain(n,e.terrain,e.stylesheet.terrain),e.stylesheet.fog&&null!=e.fog&&(o=e.fog),null!=e.stylesheet.camera&&(l=e.stylesheet.camera),null!=e.stylesheet.projection&&(s=e.stylesheet.projection),null!=e.stylesheet.transition&&(a=e.stylesheet.transition)}})),this.light=t,this.ambientLight=r,this.directionalLight=i,this.fog=o,null===n?delete this.terrain:this.terrain=n,this.camera=l||{"camera-projection":"perspective"},this.projection=s||{name:"mercator"},this.transition=e.e({},Pi,a),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(e){const t=r=>{for(const e of r.fragments)t(e.style);e(r)};t(this)}_prioritizeTerrain(e,t,r){const i=e&&0===e.drapeRenderMode;return null===r?t&&0===t.drapeRenderMode?t:i?e:null:null!=t&&(!e||i||t&&1===t.drapeRenderMode)?t:e}mergeTerrain(){let e;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((t=>{e=this._prioritizeTerrain(e,t.terrain,t.stylesheet.terrain)})),null===e?delete this.terrain:this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle((t=>{null!=t.stylesheet.projection&&(e=t.stylesheet.projection)})),this.projection=e||{name:"mercator"}}mergeSources(){const t={},r={},i={};this.forEachFragmentStyle((n=>{for(const r in n._sourceCaches){const i=e.ag(r,n.scope);t[i]=n._sourceCaches[r]}for(const t in n._otherSourceCaches){const i=e.ag(t,n.scope);r[i]=n._otherSourceCaches[t]}for(const t in n._symbolSourceCaches){const r=e.ag(t,n.scope);i[r]=n._symbolSourceCaches[t]}})),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=r,this._mergedSymbolSourceCaches=i}mergeLayers(){const t={},r=[],i={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((i=>{for(const n of i._order){const o=i._layers[n];if("slot"===o.type){const r=e.c3(n);if(t[r])continue;t[r]=[]}o.slot&&t[o.slot]?t[o.slot].push(o):r.push(o)}})),this._mergedOrder=[];const n=(r=[])=>{for(const o of r)if("slot"===o.type){const r=e.c3(o.id);t[r]&&n(t[r])}else{const t=e.ag(o.id,o.scope);this._mergedOrder.push(t),i[t]=o,o.is3D()&&(this._has3DLayers=!0),"circle"===o.type&&(this._hasCircleLayers=!0),"symbol"===o.type&&(this._hasSymbolLayers=!0)}};n(r),this._mergedLayers=i,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=e.e({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(t,r,i){let n,o,s;const a=e.f.devicePixelRatio>1?"@2x":"";let l=e.g(r.transformRequest(r.normalizeSpriteURL(t,a,".json"),e.R.SpriteJSON),((e,t)=>{l=null,s||(s=e,n=t,u())})),c=e.d(r.transformRequest(r.normalizeSpriteURL(t,a,".png"),e.R.SpriteImage),((e,t)=>{c=null,s||(s=e,o=t,u())}));function u(){if(s)i(s);else if(n&&o){const t=e.f.getImageData(o),r={};for(const i in n){const{width:o,height:s,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p}=n[i],f=new e.h({width:o,height:s});e.h.copy(t,f,{x:a,y:l},{x:0,y:0},{width:o,height:s}),r[i]={data:f,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p}}i(null,r)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(t,this.map._requestManager,((t,r)=>{if(this._spriteRequest=null,t)this.fire(new e.a(t));else if(r)for(const e in r)this.imageManager.addImage(e,this.scope,r[e]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new e.b("data",{dataType:"style"}))}))}_validateLayer(t){const r=this.getOwnSource(t.source);if(!r)return;const i=t.sourceLayer;i&&("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(i))&&this.fire(new e.a(new Error(`Source layer "${i}" does not exist on source "${r.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded())return!1;if(!this.modelManager.isLoaded())return!1;for(const{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((e,t)=>{const r=this.fragments[t];return r&&r.style&&(e.data=r.style.serialize()),e}))}_serializeSources(){const e={};for(const t in this._sourceCaches){const r=this._sourceCaches[t].getSource();e[r.id]||(e[r.id]=r.serialize())}return e}_serializeLayers(e){const t=[];for(const r of e){const e=this._layers[r];e&&"custom"!==e.type&&t.push(e.serialize())}return t}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return!0;if(this.hasFogTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&("function"==typeof e.isLayerDraped?e.isLayerDraped(this.getLayerSourceCache(e)):Li.has(e.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const r=this.getOwnLayer(t);if(r)return r;this.fire(new e.a(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const r=this.getOwnSource(t);if(r)return r;this.fire(new e.a(new Error(`The source '${t}' does not exist in the map's style.`)))}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const r=this.calculateLightsBrightness();t.brightness=r||0,r!==this._brightness&&(this._brightness=r,this.dispatcher.broadcast("setBrightness",r));const i=this._changes.isDirty();if(this._changes.isDirty()){const e=this._changes.getLayerUpdatesByScope();for(const t in e){const{updatedIds:r,removedIds:i}=e[t];(r||i)&&this._updateWorkerLayers(t,r,i)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}const n={};for(const e in this._mergedSourceCaches){const t=this._mergedSourceCaches[e];n[e]=t.used,t.used=!1,t.tileCoverLift=0}for(const e of this._mergedOrder){const r=this._mergedLayers[e];if(r.recalculate(t,this._availableImages),!r.isHidden(t.zoom)){const e=this.getLayerSourceCache(r);e&&(e.used=!0,e.tileCoverLift=Math.max(e.tileCoverLift,r.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let e=r.minzoom||0;e<(r.maxzoom||25.5);e++){const e=this.map.painter;if(e){const i=r.getProgramIds();if(!i)continue;for(const n of i){const i=r.getDefaultProgramParams(n,t.zoom);i&&(e.style=this,this.fog&&(e._fogVisible=!0,i.overrideFog=!0,e.getOrCreateProgram(n,i)),e._fogVisible=!1,i.overrideFog=!1,e.getOrCreateProgram(n,i),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(i.overrideRtt=!0,e.getOrCreateProgram(n,i)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const o in n){const t=this._mergedSourceCaches[o];n[o]!==t.used&&t.getSource().fire(new e.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:t.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),i&&this.fire(new e.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=this._changes.getUpdatedImages();if(e.length){for(const t in this._sourceCaches)this._sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changes.resetUpdatedImages()}}_updateWorkerLayers(e,t,r){const i=this.getFragmentStyle(e);i&&this.dispatcher.broadcast("updateLayers",{layers:t?i._serializeLayers(t):[],scope:e,removedIds:r||[],options:i.options})}setState(r){if(this._checkLoaded(),Mi(this,K(r)))return!1;(r=e.c1(r)).layers=rr(r.layers);const i=function(e,r){if(!e)return[{command:ir.setStyle,args:[r]}];let i=[];try{if(!t(e.version,r.version))return[{command:ir.setStyle,args:[r]}];t(e.center,r.center)||i.push({command:ir.setCenter,args:[r.center]}),t(e.zoom,r.zoom)||i.push({command:ir.setZoom,args:[r.zoom]}),t(e.bearing,r.bearing)||i.push({command:ir.setBearing,args:[r.bearing]}),t(e.pitch,r.pitch)||i.push({command:ir.setPitch,args:[r.pitch]}),t(e.sprite,r.sprite)||i.push({command:ir.setSprite,args:[r.sprite]}),t(e.glyphs,r.glyphs)||i.push({command:ir.setGlyphs,args:[r.glyphs]}),t(e.imports,r.imports)||function(e=[],r=[],i){r=r||[];const n=(e=e||[]).map(cr),o=r.map(cr),s=e.reduce(ur,{}),a=r.reduce(ur,{}),l=n.slice();let c,u,h,d;for(c=0,u=0;c<n.length;c++)h=n[c],a.hasOwnProperty(h)?u++:(i.push({command:ir.removeImport,args:[h]}),l.splice(l.indexOf(h,u),1));for(c=0,u=0;c<o.length;c++)h=o[o.length-1-c],l[l.length-1-c]!==h&&(s.hasOwnProperty(h)?(i.push({command:ir.removeImport,args:[h]}),l.splice(l.lastIndexOf(h,l.length-u),1)):u++,d=l[l.length-c],i.push({command:ir.addImport,args:[a[h],d]}),l.splice(l.length-c,0,h));for(const p of r){const e=s[p.id];e&&!t(e,p)&&i.push({command:ir.updateImport,args:[p.id,p]})}}(e.imports,r.imports,i),t(e.transition,r.transition)||i.push({command:ir.setTransition,args:[r.transition]}),t(e.light,r.light)||i.push({command:ir.setLight,args:[r.light]}),t(e.fog,r.fog)||i.push({command:ir.setFog,args:[r.fog]}),t(e.projection,r.projection)||i.push({command:ir.setProjection,args:[r.projection]}),t(e.lights,r.lights)||i.push({command:ir.setLights,args:[r.lights]}),t(e.camera,r.camera)||i.push({command:ir.setCamera,args:[r.camera]});const n={},o=[];!function(e,r,i,n){let o;for(o in r=r||{},e=e||{})e.hasOwnProperty(o)&&(r.hasOwnProperty(o)||or(o,i,n));for(o in r){if(!r.hasOwnProperty(o))continue;const s=r[o];e.hasOwnProperty(o)?t(e[o],s)||("geojson"===e[o].type&&"geojson"===s.type&&ar(e,r,o)?i.push({command:ir.setGeoJSONSourceData,args:[o,s.data]}):sr(o,r,i,n)):nr(o,r,i)}}(e.sources,r.sources,o,n);const s=[];e.layers&&e.layers.forEach((e=>{e.source&&n[e.source]?i.push({command:ir.removeLayer,args:[e.id]}):s.push(e)}));let a=e.terrain;a&&n[a.source]&&(i.push({command:ir.setTerrain,args:[void 0]}),a=void 0),i=i.concat(o),t(a,r.terrain)||i.push({command:ir.setTerrain,args:[r.terrain]}),function(e,r,i){r=r||[];const n=(e=e||[]).map(cr),o=r.map(cr),s=e.reduce(ur,{}),a=r.reduce(ur,{}),l=n.slice(),c=Object.create(null);let u,h,d,p,f,m,_;for(u=0,h=0;u<n.length;u++)d=n[u],a.hasOwnProperty(d)?h++:(i.push({command:ir.removeLayer,args:[d]}),l.splice(l.indexOf(d,h),1));for(u=0,h=0;u<o.length;u++)d=o[o.length-1-u],l[l.length-1-u]!==d&&(s.hasOwnProperty(d)?(i.push({command:ir.removeLayer,args:[d]}),l.splice(l.lastIndexOf(d,l.length-h),1)):h++,m=l[l.length-u],i.push({command:ir.addLayer,args:[a[d],m]}),l.splice(l.length-u,0,d),c[d]=!0);for(u=0;u<o.length;u++)if(d=o[u],p=s[d],f=a[d],!c[d]&&!t(p,f))if(t(p.source,f.source)&&t(p["source-layer"],f["source-layer"])&&t(p.type,f.type)){for(_ in lr(p.layout,f.layout,i,d,null,ir.setLayoutProperty),lr(p.paint,f.paint,i,d,null,ir.setPaintProperty),t(p.slot,f.slot)||i.push({command:ir.setSlot,args:[d,f.slot]}),t(p.filter,f.filter)||i.push({command:ir.setFilter,args:[d,f.filter]}),t(p.minzoom,f.minzoom)&&t(p.maxzoom,f.maxzoom)||i.push({command:ir.setLayerZoomRange,args:[d,f.minzoom,f.maxzoom]}),p)p.hasOwnProperty(_)&&"layout"!==_&&"paint"!==_&&"filter"!==_&&"metadata"!==_&&"minzoom"!==_&&"maxzoom"!==_&&"slot"!==_&&(0===_.indexOf("paint.")?lr(p[_],f[_],i,d,_.slice(6),ir.setPaintProperty):t(p[_],f[_])||i.push({command:ir.setLayerProperty,args:[d,_,f[_]]}));for(_ in f)f.hasOwnProperty(_)&&!p.hasOwnProperty(_)&&"layout"!==_&&"paint"!==_&&"filter"!==_&&"metadata"!==_&&"minzoom"!==_&&"maxzoom"!==_&&"slot"!==_&&(0===_.indexOf("paint.")?lr(p[_],f[_],i,d,_.slice(6),ir.setPaintProperty):t(p[_],f[_])||i.push({command:ir.setLayerProperty,args:[d,_,f[_]]}))}else i.push({command:ir.removeLayer,args:[d]}),m=l[l.lastIndexOf(d)+1],i.push({command:ir.addLayer,args:[f,m]})}(s,r.layers,i)}catch(e){console.warn("Unable to compute style diff:",e),i=[{command:ir.setStyle,args:[r]}]}return i}(this.serialize(),r).filter((e=>!(e.command in Ii)));if(0===i.length)return!1;const n=i.filter((e=>!(e.command in Ai)));if(n.length>0)throw new Error(`Unimplemented: ${n.map((e=>e.command)).join(", ")}.`);return i.forEach((e=>{this[e.command].apply(this,e.args)})),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,r){return this.getImage(t)?this.fire(new e.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,r),this._afterImageUpdated(t),this)}updateImage(e,t){this.imageManager.updateImage(e,this.scope,t)}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new e.a(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new e.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(e,t,r={}){return this._checkLoaded(),this._validate(ae,`models.${e}`,t,null,r)||(this.modelManager.addModel(e,t,this.scope),this._changes.setDirty()),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new e.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,r,i={}){if(this._checkLoaded(),void 0!==this.getOwnSource(t))throw new Error(`There is already a source with ID "${t}".`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(J,`sources.${t}`,r,null,i))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const n=Gt(t,r,this.dispatcher,this);n.scope=this.scope,n.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(n.id),source:n.serialize(),sourceId:n.id})));const o=t=>{const r=(t?"symbol:":"other:")+n.id,i=e.ag(r,this.scope),o=this._sourceCaches[r]=new Yt(i,n,t);(t?this._symbolSourceCaches:this._otherSourceCaches)[n.id]=o,o.onAdd(this.map)};o(!1),"vector"!==r.type&&"geojson"!==r.type||o(!0),n.onAdd&&n.onAdd(this.map),i.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const r=this.getOwnSource(t);if(!r)throw new Error("There is no source with this ID");for(const n in this._layers)if(this._layers[n].source===t)return this.fire(new e.a(new Error(`Source "${t}" cannot be removed while layer "${n}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new e.a(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const i=this.getOwnSourceCaches(t);for(const n of i){const t=e.c3(n.id);delete this._sourceCaches[t],this._changes.discardSourceCacheUpdate(n.id),n.fire(new e.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:n.getSource().id})),n.setEventedParent(null),n.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),r.setEventedParent(null),r.onRemove&&r.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getOwnSource(e).setData(t),this._changes.setDirty()}getOwnSource(e){const t=this.getOwnSourceCache(e);return t&&t.getSource()}getOwnSources(){const e=[];for(const t in this._otherSourceCaches){const r=this.getOwnSourceCache(t);r&&e.push(r.getSource())}return e}areTilesLoaded(){const e=this._mergedSourceCaches;for(const t in e){const r=e[t]._tiles;for(const e in r){const t=r[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const r=this._getTransitionParameters();for(const e of t){if(this._validate(ee,"lights",e))return;switch(e.type){case"ambient":if(this.ambientLight){const t=this.ambientLight;t.set(e),t.updateTransitions(r)}else this.ambientLight=new Te(e,Ee,this.scope,this.options);break;case"directional":if(this.directionalLight){const t=this.directionalLight;t.set(e),t.updateTransitions(r)}else this.directionalLight=new Te(e,Se,this.scope,this.options)}}const i=new e.K(this.z||0,r);this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,r=this.ambientLight;if(!t||!r)return;const i=e=>.2126*(e[0]<=.03928?e[0]/12.92:Math.pow((e[0]+.055)/1.055,2.4))+.7152*(e[1]<=.03928?e[1]/12.92:Math.pow((e[1]+.055)/1.055,2.4))+.0722*(e[2]<=.03928?e[2]/12.92:Math.pow((e[2]+.055)/1.055,2.4)),n=t.properties.get("color").toArray01(),o=t.properties.get("intensity"),s=t.properties.get("direction"),a=1-e.bQ(s.x,s.y,s.z)[2]/90,l=i(n)*o*a,c=r.properties.get("color").toArray01(),u=r.properties.get("intensity");return(l+i(c)*u)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(e.c4(t)){const r=e.c5(t),i=this.fragments.find((({id:e})=>e===r));if(!i)throw new Error(`Style import not found: ${t}`);const n=e.c3(t);return i.style.getFragmentStyle(n)}{const e=this.fragments.find((({id:e})=>e===t));if(!e)throw new Error(`Style import not found: ${t}`);return e.style}}getConfigProperty(t,r){const i=this.getFragmentStyle(t);if(!i)return null;const n=e.ag(r,i.scope),o=i.options.get(n),s=o?o.value||o.default:null;return s?s.serialize():null}setConfigProperty(t,r,i){const n=e.r(i);if("success"!==n.result)return void Mi(this,n.value);const o=n.value.expression,s=this.getFragmentStyle(t);if(!s)return;const a=e.ag(r,s.scope),l=s.options.get(a);l&&(this.options.set(a,{...l,value:o}),this.updateConfigDependencies())}setConfig(t,r){if(this._config=t,t||r)if(r)for(const i in r){let n,o;const s=e.r(r[i].default);if("success"===s.result&&(n=s.value.expression),t&&void 0!==t[i]){const r=e.r(t[i]);"success"===r.result&&(o=r.value.expression)}const{minValue:a,maxValue:l,stepValue:c,type:u,values:h}=r[i];if(n){const t=e.ag(i,this.scope);this.options.set(t,{default:n,value:o,minValue:a,maxValue:l,stepValue:c,type:u,values:h})}else this.fire(new e.a(new Error(`No schema defined for config option "${i}".`)))}else this.fire(new e.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const e of this._configDependentLayers){const t=this.getLayer(e);t&&(t.possiblyEvaluateVisibility(),this._updateLayer(t))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(t,r,i={}){this._checkLoaded();const n=t.id;if(this._layers[n])return void this.fire(new e.a(new Error(`Layer with id "${n}" already exists on this map`)));let o;if("custom"===t.type){if(Mi(this,e.c6(t)))return;o=e.c2(t,this.scope,this.options)}else{if("object"==typeof t.source&&(this.addSource(n,t.source),t=e.c1(t),t=e.e(t,{source:n})),this._validate(ie,`layers.${n}`,t,{arrayIndex:-1},i))return;o=e.c2(t,this.scope,this.options),this._validateLayer(o),o.setEventedParent(this,{layer:{id:n}}),this._serializedLayers[o.id]=o.serialize()}o.isConfigDependent&&this._configDependentLayers.add(o.fqid);let s=this._order.length;if(r){const t=this._order.indexOf(r);if(-1===t)return void this.fire(new e.a(new Error(`Layer with id "${r}" does not exist on this map.`)));o.slot===this._layers[r].slot?s=t:e.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(s,0,n),this._layerOrderChanged=!0,this._layers[n]=o;const a=this.getOwnLayerSourceCache(o),l=!!this.directionalLight&&this.directionalLight.shadowsEnabled();a&&o.canCastShadows()&&l&&(a.castsShadows=!0);const c=this._changes.getRemovedLayer(o);if(c&&o.source&&a&&"custom"!==o.type){this._changes.discardLayerRemoval(o);const t=e.ag(o.source,o.scope);c.type!==o.type?this._changes.updateSourceCache(t,"clear"):(this._changes.updateSourceCache(t,"reload"),a.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map),o.scope=this.scope,this.mergeLayers()}moveLayer(t,r){this._checkLoaded();const i=this._checkLayer(t);if(!i)return;if(t===r)return;const n=this._order.indexOf(t);this._order.splice(n,1);let o=this._order.length;if(r){const t=this._order.indexOf(r);if(-1===t)return void this.fire(new e.a(new Error(`Layer with id "${r}" does not exist on this map.`)));i.slot===this._layers[r].slot?o=t:e.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(o,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(e){this._checkLoaded();const t=this._checkLayer(e);if(!t)return;t.setEventedParent(null);const r=this._order.indexOf(e);this._order.splice(r,1),delete this._layers[e],delete this._serializedLayers[e],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(t.fqid),this._changes.removeLayer(t);const i=this.getOwnLayerSourceCache(t);if(i&&i.castsShadows){let e=!1;for(const r in this._layers)if(this._layers[r].source===t.source&&this._layers[r].canCastShadows()){e=!0;break}i.castsShadows=e}t.onRemove&&t.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(e,t,r){this._checkLoaded();const i=this._checkLayer(e);i&&(i.minzoom===t&&i.maxzoom===r||(null!=t&&(i.minzoom=t),null!=r&&(i.maxzoom=r),this._updateLayer(i)))}setSlot(e,t){this._checkLoaded();const r=this._checkLayer(e);r&&r.slot!==t&&(r.slot=t,this._updateLayer(r))}setFilter(r,i,n={}){this._checkLoaded();const o=this._checkLayer(r);if(o&&!t(o.filter,i))return null==i?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(ne,`layers.${o.id}.filter`,i,{layerType:o.type},n)||(o.filter=e.c1(i),this._updateLayer(o)))}getFilter(t){const r=this._checkLayer(t);if(r)return e.c1(r.filter)}setLayoutProperty(r,i,n,o={}){this._checkLoaded();const s=this._checkLayer(r);if(s&&!t(s.getLayoutProperty(i),n)){if(null!=n&&(!o||!1!==o.validate)&&Mi(s,se.call(K,{key:`layers.${r}.layout.${i}`,layerType:s.type,objectKey:i,value:n,styleSpec:e.D,style:{glyphs:!0,sprite:!0}})))return;s.setLayoutProperty(i,n),s.isConfigDependent&&this._configDependentLayers.add(s.fqid),this._updateLayer(s)}}getLayoutProperty(e,t){const r=this._checkLayer(e);if(r)return r.getLayoutProperty(t)}setPaintProperty(r,i,n,o={}){this._checkLoaded();const s=this._checkLayer(r);if(!s)return;if(t(s.getPaintProperty(i),n))return;if(null!=n&&(!o||!1!==o.validate)&&Mi(s,oe.call(K,{key:`layers.${r}.paint.${i}`,layerType:s.type,objectKey:i,value:n,styleSpec:e.D})))return;const a=s.setPaintProperty(i,n);s.isConfigDependent&&this._configDependentLayers.add(s.fqid),a&&this._updateLayer(s),this._changes.updatePaintProperties(s)}getPaintProperty(e,t){const r=this._checkLayer(e);if(r)return r.getPaintProperty(t)}setFeatureState(t,r){this._checkLoaded();const i=t.source,n=t.sourceLayer,o=this._checkSource(i);if(!o)return;const s=o.type;if("geojson"===s&&n)return void this.fire(new e.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===s&&!n)return void this.fire(new e.a(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new e.a(new Error("The feature id parameter must be provided.")));const a=this.getOwnSourceCaches(i);for(const e of a)e.setFeatureState(n,t.id,r)}removeFeatureState(t,r){this._checkLoaded();const i=t.source,n=this._checkSource(i);if(!n)return;const o=n.type,s="vector"===o?t.sourceLayer:void 0;if("vector"===o&&!s)return void this.fire(new e.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(r&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new e.a(new Error("A feature id is required to remove its specific state property.")));const a=this.getOwnSourceCaches(i);for(const e of a)e.removeFeatureState(s,t.id,r)}getFeatureState(t){this._checkLoaded();const r=t.source,i=t.sourceLayer,n=this._checkSource(r);if(n){if("vector"!==n.type||i)return void 0===t.id&&this.fire(new e.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(r)[0].getFeatureState(i,t.id);this.fire(new e.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=e.e({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return e.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),r=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return e.c7({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:r,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(e=>void 0!==e))}_updateLayer(t){this._changes.updateLayer(t);const r=this.getLayerSourceCache(t),i=e.ag(t.source,t.scope),n=this._changes.getUpdatedSourceCaches();t.source&&!n[i]&&r&&"raster"!==r.getSource().type&&(this._changes.updateSourceCache(i,"reload"),r.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._mergedLayers[e].type||"model"===this._mergedLayers[e].type,r=this.order,i={},n=[];for(let s=r.length-1;s>=0;s--){const o=r[s];if(t(o)){i[o]=s;for(const t of e){const e=t[o];if(e)for(const t of e)n.push(t)}}}n.sort(((e,t)=>t.intersectionZ-e.intersectionZ));const o=[];for(let s=r.length-1;s>=0;s--){const a=r[s];if(t(a))for(let e=n.length-1;e>=0;e--){const t=n[e].feature;if(i[t.layer.id]<s)break;o.push(t),n.pop()}else for(const t of e){const e=t[a];if(e)for(const t of e)o.push(t.feature)}}return o}queryRenderedFeatures(t,r,i){r&&r.filter&&this._validate(ne,"queryRenderedFeatures.filter",r.filter,null,r),r.scope=this.scope,r.availableImages=this._availableImages,r.serializedLayers=this._serializedLayers;const n={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new e.a(new Error("parameters.layers must be an Array."))),[];for(const t of r.layers){const r=this._mergedLayers[t];if(!r)return this.fire(new e.a(new Error(`The layer '${t}' does not exist in the map's style and cannot be queried for features.`))),[];n[r.source]=!0}}const o=[],s=r.serializedLayers||{},a=r&&r.layers?r.layers.some((e=>{const t=this.getLayer(e);return t&&t.is3D()})):this.has3DLayers(),l=Me.createFromScreenPoints(t,i);for(const e in this._mergedSourceCaches){const t=this._mergedSourceCaches[e].getSource();if(!t||t.scope!==r.scope)continue;const c=this._mergedSourceCaches[e].getSource().id;r.layers&&!n[c]||o.push(qt(this._mergedSourceCaches[e],this._mergedLayers,s,l,r,i,a,!!this.map._showQueryGeometry))}return this.placement&&o.push(function(e,t,r,i,n,o,s){const a={},l=o.queryRenderedSymbols(i),c=[];for(const u of Object.keys(l).map(Number))c.push(s[u]);c.sort(Wt);for(const u of c){const r=u.featureIndex.lookupSymbolFeatures(l[u.bucketInstanceId],t,u.bucketIndex,u.sourceLayerIndex,n.filter,n.layers,n.availableImages,e);for(const e in r){const t=a[e]=a[e]||[],i=r[e];i.sort(((e,t)=>{const r=u.featureSortOrder;if(r){const i=r.indexOf(e.featureIndex);return r.indexOf(t.featureIndex)-i}return t.featureIndex-e.featureIndex}));for(const e of i)t.push(e)}}for(const u in a)a[u].forEach((t=>{const i=t.feature,n=r(e[u]);if(!n)return;const o=n.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=o}));return a}(this._mergedLayers,s,this.getLayerSourceCache.bind(this),l.screenGeometry,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(e,t){t&&t.filter&&this._validate(ne,"querySourceFeatures.filter",t.filter,null,t);const r=this.getOwnSourceCaches(e);let i=[];for(const n of r)i=i.concat(Zt(n,t));return i}addSourceType(e,t,r){return Ri.getSourceType(e)?r(new Error(`A source type called "${e}" already exists.`)):(Ri.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},r):r(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(e,r,i={}){this._checkLoaded();const n=this.light.getLight();let o=!1;for(const a in e)if(!t(e[a],n[a])){o=!0;break}if(!o)return;const s=this._getTransitionParameters();this.light.setLight(e,r,i),this.light.updateTransitions(s)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,i=1){if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()&&0!==i||delete this.terrain,null===r?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let n=r;const o=null==r.source;if(1===i){if("object"==typeof n.source){const t="terrain-dem-src";this.addSource(t,n.source),n=e.c1(n),n=e.e(n,{source:t})}const t=e.e({},n),r={};if(this.terrain&&o){t.source=this.terrain.get().source;const e=this.terrain?this.getFragmentStyle(this.terrain.scope):null;e&&(r.style=e.serialize())}if(this._validate(te,"terrain",t,r))return}if(!this.terrain||this.terrain.scope!==this.scope&&!o||this.terrain&&i!==this.terrain.drapeRenderMode){if(!n)return;this._createTerrain(n,i),this.fire(new e.b("data",{dataType:"style"}))}else{const i=this.terrain,o=i.get();for(const t of Object.keys(e.D.terrain))!n.hasOwnProperty(t)&&e.D.terrain[t].default&&(n[t]=e.D.terrain[t].default);for(const n in r)if(!t(r[n],o[n])){i.set(r,this.options),this.stylesheet.terrain=r;const t=this._getTransitionParameters({duration:0});i.updateTransitions(t),this.fire(new e.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const t=this.fog=new we(e,this.map.transform,this.scope,this.options);this.stylesheet.fog=t.get();const r=this._getTransitionParameters({duration:0});t.updateTransitions(r)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const e of this.map._markers)e._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const r=this.fog;if(!t(r.get(),e)){r.set(e,this.options),this.stylesheet.fog=r.get();const t=this._getTransitionParameters({duration:0});r.updateTransitions(t)}}else this._createFog(e);this._markersNeedUpdate=!0}_getTransitionParameters(t){return{now:e.f.now(),transition:e.e(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const e=[],t=[];for(const r in this._mergedLayers)this.isLayerDraped(this._mergedLayers[r])?e.push(r):t.push(r);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}_createTerrain(e,t){const r=this.terrain=new pe(e,t,this.scope,this.options);1===t&&(this.stylesheet.terrain=e),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const i=this._getTransitionParameters({duration:0});r.updateTransitions(i)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"symbol"===t.type&&this._updateLayer(t)}}_validate(t,r,i,n,o={}){if(o&&!1===o.validate)return!1;const s=e.e({},this.serialize());return Mi(this,t.call(K,e.e({key:r,style:s,value:i,styleSpec:e.D},n)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.c8.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(e){const t=this.getSourceCaches(e);for(const r of t)r.clearTiles()}clearSources(){for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}reloadSource(e){const t=this.getSourceCaches(e);for(const r of t)r.resume(),r.reload()}reloadSources(){for(const e of this.getSources())e.reload&&e.reload()}updateSources(e){let t;this.directionalLight&&(t=Ti(this.directionalLight));for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].update(e,void 0,void 0,t)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(t,r,i,n,o=!1){let s=!1,a=!1;const l={},c={};for(const u of this._mergedOrder){const r=this._mergedLayers[u];if("symbol"!==r.type)continue;const i=e.ag(r.source,r.scope);let n=l[i];if(!n){const e=this.getLayerSourceCache(r);if(!e)continue;const t=e.getRenderableIds(!0).map((t=>e.getTileByID(t)));c[i]=t.slice(),n=l[i]=t.sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)))}const o=this.crossTileSymbolIndex.addLayer(r,n,t.center.lng,t.projection);s=s||o}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),o=o||this._layerOrderChanged||0===i,this._layerOrderChanged&&this.fire(new e.b("neworder")),(o||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.f.now(),t.zoom))&&(this.pauseablePlacement=new ti(t,this._mergedOrder,o,r,i,n,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,l,c),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.f.now()),a=!0),s&&this.pauseablePlacement.placement.setStale()),a||s){this._buildingIndex.onNewFrame(t.zoom);for(const t of this._mergedOrder){const r=this._mergedLayers[t];"symbol"===r.type&&this.placement.updateLayerOpacities(r,l[e.ag(r.source,r.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.f.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(t,r){this._checkLoaded();const i=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==i.findIndex((({id:e})=>e===t.id)))return this.fire(new e.a(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!r)return i.push(t),this._loadImports([t],!0),this;const n=i.findIndex((({id:e})=>e===r));return-1===n?this.fire(new e.a(new Error(`Import with id "${r}" does not exist on this map.`))):(this.stylesheet.imports=i.slice(0,n).concat(t).concat(i.slice(n)),this._loadImports([t],!0,r),this)}updateImport(e,r){this._checkLoaded();const i=this.stylesheet.imports||[],n=this.getImportIndex(e);return-1===n?this:"string"==typeof r?(this.setImportUrl(e,r),this):(r.url&&r.url!==i[n].url&&this.setImportUrl(e,r.url),t(r.config,i[n].config)||this.setImportConfig(e,r.config),t(r.data,i[n].data)||this.setImportData(e,r.data),this)}moveImport(e,t){this._checkLoaded();let r=this.stylesheet.imports||[];const i=this.getImportIndex(e);if(-1===i)return this;const n=this.getImportIndex(t);if(-1===n)return this;const o=r[i],s=this.fragments[i];return r=r.filter((({id:t})=>t!==e)),this.fragments=this.fragments.filter((({id:t})=>t!==e)),this.stylesheet.imports=r.slice(0,n).concat(o).concat(r.slice(n)),this.fragments=this.fragments.slice(0,n).concat(s).concat(this.fragments.slice(n)),this.mergeLayers(),this}setImportUrl(e,t){this._checkLoaded();const r=this.stylesheet.imports||[],i=this.getImportIndex(e);if(-1===i)return this;r[i].url=t;const n=this.fragments[i];return n.style=this._createFragmentStyle(r[i]),n.style.on("style.import.load",(()=>this.mergeAll())),n.style.loadURL(t),this}setImportData(e,t){this._checkLoaded();const r=this.getImportIndex(e),i=this.stylesheet.imports||[];return-1===r?this:t?(this.fragments[r].style.setState(t),this._reloadImports(),this):(delete i[r].data,this.setImportUrl(e,i[r].url))}setImportConfig(e,t){this._checkLoaded();const r=this.getImportIndex(e),i=this.stylesheet.imports||[];if(-1===r)return this;t?i[r].config=t:delete i[r].config;const n=this.fragments[r],o=n.style.stylesheet&&n.style.stylesheet.schema;return n.config=t,n.style.setConfig(t,o),this.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();const t=this.stylesheet.imports||[],r=this.getImportIndex(e);return-1===r||(t.splice(r,1),this.fragments[r].style._remove(),this.fragments.splice(r,1),this._reloadImports()),this}getImportIndex(t){const r=(this.stylesheet.imports||[]).findIndex((e=>e.id===t));return-1===r&&this.fire(new e.a(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),r}getLayer(e){return this._mergedLayers[e]}getSources(){const e=[];for(const t in this._mergedOtherSourceCaches){const r=this._mergedOtherSourceCaches[t];r&&e.push(r.getSource())}return e}getSource(e,t){const r=this.getSourceCache(e,t);return r&&r.getSource()}getLayerSource(e){const t=this.getLayerSourceCache(e);return t&&t.getSource()}getSourceCache(t,r){const i=e.ag(t,r);return this._mergedOtherSourceCaches[i]}getLayerSourceCache(t){const r=e.ag(t.source,t.scope);return"symbol"===t.type?this._mergedSymbolSourceCaches[r]:this._mergedOtherSourceCaches[r]}getSourceCaches(e){const t=[];return this._mergedOtherSourceCaches[e]&&t.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&t.push(this._mergedSymbolSourceCaches[e]),t}updateSourceCaches(){const e=this._changes.getUpdatedSourceCaches();for(const t in e){const r=e[t];"reload"===r?this.reloadSource(t):"clear"===r&&this.clearSource(t)}}updateLayers(e){const t=this._changes.getUpdatedPaintProperties();for(const r of t){const t=this.getLayer(r);t&&t.updateTransitions(e)}}getImages(e,t,r){this.imageManager.getImages(t.icons,t.scope,r),this._updateTilesForChangedImages();const i=e=>{e&&e.setDependencies(t.tileID.key,t.type,t.icons)};i(this._otherSourceCaches[t.source]),i(this._symbolSourceCaches[t.source])}getGlyphs(e,t,r){this.glyphManager.getGlyphs(t.stacks,t.scope,r)}getResource(t,r,i){return e.c9(r,i)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(t){const r=this.getOwnSourceCaches(t);return 0===r.length?(this.fire(new e.a(new Error(`There is no source with ID '${t}'`))),!1):r.every((e=>e.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((e=>{e.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ri.getSourceType=function(e){return jt[e]},Ri.setSourceType=function(e,t){jt[e]=t},Ri.registerForPluginStateChange=e.bV;var Di="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",Oi="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}",zi="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",ki="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Fi="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",Bi="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Ni="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",Ui="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",Vi="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform vec2 u_velocity_res;uniform float u_max_speed;const vec2 INVALID_VELOCITY=vec2(-1);uniform vec2 u_texture_offset;uniform float u_data_offset;uniform vec4 u_data_scale;vec2 lookup_velocity(vec2 uv) {uv=u_texture_offset.x+u_texture_offset.y*uv;vec2 fxy;ivec4 c=_raTexLinearCoord(uv,u_velocity_res,fxy);vec4 tl=texelFetch(u_velocity,c.yz,0);vec4 tr=texelFetch(u_velocity,c.xz,0);vec4 bl=texelFetch(u_velocity,c.yw,0);vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NODATA) {return INVALID_VELOCITY;}if (tr==NODATA) {return INVALID_VELOCITY;}if (bl==NODATA) {return INVALID_VELOCITY;}if (br==NODATA) {return INVALID_VELOCITY;}vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);\n#ifdef DATA_FORMAT_UINT32\nvec2 velocity=vec2(u_data_offset+dot(t,u_data_scale),0);return velocity;\n#else\nvec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));\n#endif\nreturn velocity/max(u_max_speed,length(velocity));}\n#endif",ji="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",Gi="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const $i=[];Yi(Di,$i),Yi(zi,$i),Yi(Oi,$i);const qi={"_prelude_fog.vertex.glsl":Bi,"_prelude_terrain.vertex.glsl":Fi,"_prelude_shadow.vertex.glsl":ji,"_prelude_fog.fragment.glsl":Ni,"_prelude_shadow.fragment.glsl":Gi,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":Ui,"_prelude_raster_particle.glsl":Vi},Zi={};Ki("",Fi),Ki(Ni,Bi),Ki(Gi,ji),Ki(Ui,""),Ki(Vi,"");const Wi=Ki(Oi,zi),Hi=Di;var Xi={background:Ki('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:Ki('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:Ki('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:Ki("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ki('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:Ki("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ki("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:Ki("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ki("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:Ki('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:Ki('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:Ki('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:Ki('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:Ki('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:Ki("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:Ki('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:Ki('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:Ki("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:Ki("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ki('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:Ki('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:Ki('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 v_uv;\n#endif\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 a_packed;\n#endif\nin float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec4 v_uv;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nfloat a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:Ki('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:Ki('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;vec2 uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nvec2 uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:Ki("precision highp float;uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'precision highp float;\n#include "_prelude_raster_array.glsl"\n#include "_prelude_raster_particle.glsl"\nin vec3 a_pos;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {vec2 pos=a_pos.xy+u_tile_offset;vec2 tex_coords=fract(pos);gl_PointSize=1.0;vec2 velocity=lookup_velocity(tex_coords);if (velocity==INVALID_VELOCITY) {v_particle_speed=0.0;gl_Position=vec4(2.0,2.0,2.0,1.0);} else {v_particle_speed=length(velocity);gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);}}'),rasterParticleTexture:Ki("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {v_tex_pos=0.5*a_pos+vec2(0.5);gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ki("void main() {}",'#include "_prelude_raster_array.glsl"\n#include "_prelude_raster_particle.glsl"\nin vec3 a_pos;uniform float u_speed_factor;uniform float u_lifetime_delta;uniform float u_rand_seed;out vec3 v_new_particle;const vec3 rand_constants=vec3(12.9898,78.233,4375.85453);float rand(const vec2 co) {float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {float lifetime=a_pos.z;vec2 pos=a_pos.xy;vec2 uv=clamp(pos,vec2(0.0),vec2(1.0));vec2 velocity=lookup_velocity(uv);float next_lifetime=lifetime-u_lifetime_delta;float t=step(0.0,next_lifetime);\n#ifdef DATA_FORMAT_UINT32\nvec2 dp=vec2(0);\n#else\nvec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;\n#endif\nvec2 seed=pos*u_rand_seed;vec2 next_pos=pos+dp;vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));v_new_particle=vec3(\nvec2(mix(random_pos,next_pos,t)),mix(1.0,next_lifetime,t)\n);}'),symbolIcon:Ki('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nuniform mediump float u_icon_saturation;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;\n#else\nout_color=texture(u_texture,v_tex_a)*alpha;\n#endif\n#ifdef SATURATION\nvec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:Ki('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:Ki('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:Ki('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:Ki("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:Ki('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',ki),skyboxGradient:Ki('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',ki),skyboxCapture:Ki("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ki('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:Ki('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:Ki('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=local_pos;\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:Ki("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:Ki("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function Yi(e,t){const r=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let i of r)if(i=i.trim(),"#"===i[0]&&i.includes("if")&&!i.includes("endif")){i=i.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const e=i.split(" ");for(const r of e)t.includes(r)||t.push(r)}}function Ki(e,t){const r=/#include\s+"([^"]+)"/g,i=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let n=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);n&&(n=n.map((e=>{const t=e.split(" ");return t[t.length-1]})),n=[...new Set(n)]);const o={},s=[],a=[];if(e=e.replace(r,((e,t)=>(a.push(t),""))),(t=t.replace(r,((e,t)=>(s.push(t),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let l=[...$i];Yi(e,l),Yi(t,l);for(const c of[...s,...a])qi[c]||console.error(`Undefined include: ${c}`),Zi[c]||(Zi[c]=[],Yi(qi[c],Zi[c])),l=[...l,...Zi[c]];return{fragmentSource:e=e.replace(i,((e,t,r,i,n)=>(o[n]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nin ${r} ${i} ${n};\n#else\nuniform ${r} ${i} u_${n};\n#endif\n`:"initialize"===t?`\n#ifdef HAS_UNIFORM_u_${n}\n    ${r} ${i} ${n} = u_${n};\n#endif\n`:"define-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    in ${r} ${i} ${n};\n#endif\n`:"initialize-attribute"===t?"":void 0))),vertexSource:t=t.replace(i,((e,t,r,i,n)=>{const s="float"===i?"vec2":i,a=n.match(/color/)?"color":s;return"define-attribute-vertex-shader-only"===t?`\n#ifdef HAS_ATTRIBUTE_a_${n}\nin ${r} ${i} a_${n};\n#endif\n`:o[n]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nin ${r} ${s} a_${n};\nout ${r} ${i} ${n};\n#else\nuniform ${r} ${i} u_${n};\n#endif\n`:"initialize"===t?"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = a_${n};\n#else\n    ${r} ${i} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = unpack_mix_${a}(a_${n}, u_${n}_t);\n#else\n    ${r} ${i} ${n} = u_${n};\n#endif\n`:"define-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    in ${r} ${i} a_${n};\n    out ${r} ${i} ${n};\n#endif\n`:"initialize-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    ${n} = a_${n};\n#endif\n`:void 0:"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nin ${r} ${s} a_${n};\n#else\nuniform ${r} ${i} u_${n};\n#endif\n`:"define-instanced"===t?"mat4"===a?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${n}0;\nin vec4 a_${n}1;\nin vec4 a_${n}2;\nin vec4 a_${n}3;\n#else\nuniform ${r} ${i} u_${n};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${r} ${s} a_${n};\n#else\nuniform ${r} ${i} u_${n};\n#endif\n`:"initialize-attribute-custom"===t?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    ${r} ${i} ${n} = a_${n};\n#endif\n`:"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${r} ${i} ${n} = a_${n};\n#else\n    ${r} ${i} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${r} ${i} ${n} = unpack_mix_${a}(a_${n}, u_${n}_t);\n#else\n    ${r} ${i} ${n} = u_${n};\n#endif\n`})),staticAttributes:n,usedDefines:l,vertexIncludes:s,fragmentIncludes:a}}class Ji{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,t,r,i,n,o,s,a){this.context=e;let l=this.boundPaintVertexBuffers.length!==i.length;for(let u=0;!l&&u<i.length;u++)this.boundPaintVertexBuffers[u]!==i[u]&&(l=!0);let c=this.boundDynamicVertexBuffers.length!==s.length;for(let u=0;!c&&u<s.length;u++)this.boundDynamicVertexBuffers[u]!==s[u]&&(c=!0);if(!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==r||l||c||this.boundIndexBuffer!==n||this.boundVertexOffset!==o)this.freshBind(t,r,i,n,o,s,a);else{e.bindVertexArrayOES.set(this.vao);for(const r of s)r&&(r.bind(),a&&r.instanceCount&&r.setVertexAttribDivisor(e.gl,t,a));n&&n.dynamicDraw&&n.bind()}}freshBind(e,t,r,i,n,o,s){const a=e.numAttributes,l=this.context,c=l.gl;this.vao&&this.destroy(),this.vao=l.gl.createVertexArray(),l.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=i,this.boundVertexOffset=n,this.boundDynamicVertexBuffers=o,t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,n);for(const u of r)u.enableAttributes(c,e),u.bind(),u.setVertexAttribPointers(c,e,n);for(const u of o)u&&(u.enableAttributes(c,e),u.bind(),u.setVertexAttribPointers(c,e,n),s&&u.instanceCount&&u.setVertexAttribDivisor(c,e,s));i&&i.bind(),l.currentNumAttributes=a}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Qi(t,r){const i=Math.pow(2,r.canonical.z),n=r.canonical.y;return[new e.L(0,n/i).toLngLat().lat,new e.L(0,(n+1)/i).toLngLat().lat]}function en(t,r,i,n,o,s,a){const l=t.context,c=l.gl,u=i.hillshadeFBO;if(!u)return;t.prepareDrawTile();const h=t.isTileAffectedByFog(r),d=t.getOrCreateProgram("hillshade",{overrideFog:h});l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment.get());const p=((t,r,i,n)=>{const o=i.paint.get("hillshade-shadow-color"),s=i.paint.get("hillshade-highlight-color"),a=i.paint.get("hillshade-accent-color"),l=i.paint.get("hillshade-emissive-strength");let c=e.bj(i.paint.get("hillshade-illumination-direction"));if("viewport"===i.paint.get("hillshade-illumination-anchor"))c-=t.transform.angle;else if(t.style&&t.style.enable3dLights()&&t.style.directionalLight){const r=t.style.directionalLight.properties.get("direction"),i=e.bQ(r.x,r.y,r.z);c=e.bj(i[1])}const u=!t.options.moving;return{u_matrix:n||t.transform.calculateProjMatrix(r.tileID.toUnwrapped(),u),u_image:0,u_latrange:Qi(0,r.tileID),u_light:[i.paint.get("hillshade-exaggeration"),c],u_shadow:o,u_highlight:s,u_emissive_strength:l,u_accent:a}})(t,i,n,t.terrain?r.projMatrix:null);t.uploadCommonUniforms(l,d,r.toUnwrapped());const{tileBoundsBuffer:f,tileBoundsIndexBuffer:m,tileBoundsSegments:_}=t.getTileBoundsBuffers(i);d.draw(t,c.TRIANGLES,o,s,a,kt.disabled,p,n.id,f,m,_)}function tn(t,r,i){if(!r.needsDEMTextureUpload)return;const n=t.context,o=n.gl;n.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||t.getTileTexture(i.stride);const s=i.getPixels();r.demTexture?r.demTexture.update(s,{premultiply:!1}):r.demTexture=new e.T(n,s,o.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function rn(t,r,i){const n=t.context,o=n.gl;if(!r.dem)return;const s=r.dem;if(n.activeTexture.set(o.TEXTURE1),tn(t,r,s),!r.demTexture)return;r.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE);const a=s.dim;n.activeTexture.set(o.TEXTURE0);let l=r.hillshadeFBO;if(!l){const t=new e.T(n,{width:a,height:a,data:null},o.RGBA);t.bind(o.LINEAR,o.CLAMP_TO_EDGE),l=r.hillshadeFBO=n.createFramebuffer(a,a,!0,"renderbuffer"),l.colorAttachment.set(t.texture)}n.bindFramebuffer.set(l.framebuffer),n.viewport.set([0,0,a,a]);const{tileBoundsBuffer:c,tileBoundsIndexBuffer:u,tileBoundsSegments:h}=t.getMercatorTileBoundsBuffers(),d=[];t.linearFloatFilteringSupported()&&d.push("TERRAIN_DEM_FLOAT_FORMAT"),t.getOrCreateProgram("hillshadePrepare",{defines:d}).draw(t,o.TRIANGLES,Ct.disabled,Lt.disabled,Dt.unblended,kt.disabled,((t,r)=>{const i=r.stride,n=e.a6.create();return e.a6.ortho(n,0,e.V,-e.V,0,0,1),e.a6.translate(n,n,[0,-e.V,0]),{u_matrix:n,u_image:1,u_dimension:[i,i],u_zoom:t.overscaledZ}})(r.tileID,s),i.id,c,u,h),r.needsHillshadePrepare=!1}const nn=t=>({u_matrix:new e.bK(t),u_image0:new e.bO(t),u_skirt_height:new e.bN(t),u_ground_shadow_factor:new e.bM(t)}),on=(e,t,r)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:r}),sn=(e,t,r,i,n,o,s,a,l,c,u,h,d,p,f,m)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(i),u_merc_matrix:r,u_zoom_transition:n,u_merc_center:o,u_image0:0,u_frustum_tl:s,u_frustum_tr:a,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:h,u_viewport:d,u_grid_matrix:m?Float32Array.from(m):new Float32Array(9),u_skirt_height:p,u_far_z_cutoff:f});function an(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const ln=new class{constructor(){this.operations={}}newMorphing(e,t,r,i,n){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==r.tileID.key&&(t.queued=r)}else this.operations[e]={startTime:i,phase:0,duration:n,from:t,to:r,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const r=this.operations[t];for(r.phase=(e-r.startTime)/r.duration;r.phase>=1||!this._validOp(r);)if(!this._nextOp(r,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},cn={0:null,1:"TERRAIN_VERTEX_MORPHING"};function un(e,t,r){if(0===t)return 0;const i=t<1&&514===r?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*i}function hn(e,t){const r=1<<e.z;return!t&&(0===e.x||e.x===r-1)||0===e.y||e.y===r-1}const dn=e=>({u_matrix:e});function pn(t,r,i,n,o){if(o>0){const s=e.f.now(),a=(s-t.timeAdded)/o,l=r?(s-r.timeAdded)/o:-1,c=i.getSource(),u=n.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!r||Math.abs(r.tileID.overscaledZ-u)>Math.abs(t.tileID.overscaledZ-u),d=h&&t.refreshedUponExpiration?1:e.aa(h?a:1-l,0,1);return t.refreshedUponExpiration&&a>=1&&(t.refreshedUponExpiration=!1),r?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}class fn extends Yt{constructor(t){const r={type:"raster-dem",maxzoom:t.transform.maxZoom},i=new e.bW(e.bX(),null),n=Gt("mock-dem",r,i,t.style);super("mock-dem",n,!1),n.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,t){e.state="loaded",t(null)}}class mn extends Yt{constructor(t){const r=Gt("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new e.bW(e.bX(),null),t.style);super("proxy",r,!1),r.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,t,r){if(e.freezeTileCoverage)return;this.transform=e;const i=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((t,r)=>{if(t[r.key]="",!this._tiles[r.key]){const t=new Vt(r,this._source.tileSize*r.overscaleFactor(),e.tileZoom);t.state="loaded",this._tiles[r.key]=t}return t}),{});for(const n in this._tiles)n in i||(this.freeFBO(n),this._tiles[n].unloadVectorData(),delete this._tiles[n])}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const r=Object.values(t);this.renderCachePool.push(...r),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach((e=>e.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class _n extends e.am{constructor(e,t,r){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=r}}class gn extends e.ck{constructor(t,r){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[i,n,o]=function(t){const r=new e.aN,i=new e.aw,n=131;r.reserve(17161),i.reserve(33800);const o=e.V/128,s=e.V+o/2,a=s+o;for(let c=-o;c<a;c+=o)for(let t=-o;t<a;t+=o){const i=t<0||t>s||c<0||c>s?24575:0,n=e.aa(Math.round(t),0,e.V),o=e.aa(Math.round(c),0,e.V);r.emplaceBack(n+i,o)}const l=(e,t)=>{const r=t*n+e;i.emplaceBack(r+1,r,r+n),i.emplaceBack(r+n,r+n+1,r+1)};for(let e=1;e<129;e++)for(let t=1;t<129;t++)l(t,e);return[0,129].forEach((e=>{for(let t=0;t<130;t++)l(t,e),l(e,t)})),[r,i,32768]}(),s=t.context;this.gridBuffer=s.createVertexBuffer(i,e.aP.members),this.gridIndexBuffer=s.createIndexBuffer(n),this.gridSegments=e.aB.simpleSegment(0,0,i.length,n.length),this.gridNoSkirtSegments=e.aB.simpleSegment(0,0,i.length,o),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new mn(r.map),this.orthoMatrix=e.a6.create(),e.a6.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,e.V,0,e.V,0,1);const a=s.gl;this._overlapStencilMode=new Lt({func:a.GEQUAL,mask:255},0,255,a.KEEP,a.KEEP,a.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=r,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new fn(r.map),this._pendingGroundEffectLayers=[]}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(t,r,i){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const n=t.terrain.properties,o=0===t.terrain.drapeRenderMode,s=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=e.f.now();const a=t.terrain&&t.terrain.scope,l=n.get("source"),c=o?this._mockSourceCache:t.getSourceCache(l,a);if(!c)return void e.w(`Couldn't find terrain source "${l}".`);if(this.sourceCache=c,this._exaggeration=s?this.calculateExaggeration(r):n.get("exaggeration"),!r.projection.requiresDraping&&s&&0===this._exaggeration)return void this._disable();this.enabled=!0;const u=()=>{this.sourceCache.used&&e.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const t=this.getScaledDemTileSize();this.sourceCache.update(r,t,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,u(),this._initializing=!0),u(),r.updateElevation(!0,i),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(r),this._emptyDEMTextureDirty=!0,this._previousZoom=r.zoom}else this._disable()}calculateExaggeration(t){const r=this._previousCameraAltitude,i=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=i;const n=null!=r?i-r:Number.MAX_VALUE;if(Math.abs(n)<2)return this._exaggeration;const o=t.zoom,s=this._style.terrain;if(!this._previousUpdateTimestamp)return s.getExaggeration(o);let a=o-this._previousZoom;const l=this._previousUpdateTimestamp;let c=o;null!=this._evaluationZoom&&(c=this._evaluationZoom,Math.abs(o-c)>.5&&(a=.5*(o-c+a)),a*n<0&&(c+=a)),this._evaluationZoom=c;const u=s.getExaggeration(c),h=u===s.getExaggeration(Math.max(0,c-.1));if(h&&Math.abs(u-this._exaggeration)<.01)return u;let d=Math.min(.1,.00375*(this._updateTimestamp-l));return(h||u<.1||Math.abs(a)<1e-4)&&(d=Math.min(.2,4*d)),e.U(this._exaggeration,u,d)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((e=>e.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const r=this.proxySourceCache,i=this.painter.transform;this._initializing&&(this._initializing=0===i._centerAltitude&&-1===this.getAtPointOrZero(e.L.fromLngLat(i.center),-1),this._emptyDEMTextureDirty=!this._initializing);const n=this.proxyCoords=r.getIds().map((e=>{const t=r.getTileByID(e).tileID;return t.projMatrix=i.calculateProjMatrix(t.toUnwrapped()),t}));!function(t,r){const i=r.transform.pointCoordinate(r.transform.getCameraPoint()),n=new e.P(i.x,i.y);t.sort(((t,r)=>{if(r.overscaledZ-t.overscaledZ)return r.overscaledZ-t.overscaledZ;const i=new e.P(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),o=new e.P(r.canonical.x+(1<<r.canonical.z)*r.wrap,r.canonical.y),s=n.mult(1<<t.canonical.z);return s.x-=.5,s.y-=.5,s.distSqr(i)-s.distSqr(o)}))}(n,this.painter);const o=this.proxyToSource||{};this.proxyToSource={},n.forEach((e=>{this.proxyToSource[e.key]={}})),this.terrainTileForTile={};const s=this._style._mergedSourceCaches;for(const e in s){const r=s[e];if(!r.used)continue;if(r!==this.sourceCache&&this.resetTileLookupCache(r.id),this._setupProxiedCoordsForOrtho(r,t[e],o),r.usedForTerrain)continue;const i=t[e];r.getSource().reparseOverscaled&&this._assignTerrainTiles(i)}this.proxiedCoords[r.id]=n.map((e=>new _n(e,e.key,this.orthoMatrix))),this._assignTerrainTiles(n),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1;const a={};this._visibleDemTiles=[];for(const e of this.proxyCoords){const t=this.terrainTileForTile[e.key];if(!t)continue;const r=t.tileID.key;r in a||(this._visibleDemTiles.push(t),a[r]=r)}}_assignTerrainTiles(e){this._initializing||e.forEach((e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)}))}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const r in this.terrainTileForTile){const i=this.terrainTileForTile[r],n=i.dem;!n||i.demTexture&&!i.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),tn(this.painter,i,n))}}_prepareDemTileUniforms(e,t,r,i){if(!t||null==t.demTexture)return!1;const n=e.tileID.canonical,o=Math.pow(2,t.tileID.canonical.z-n.z),s=i||"";return r[`u_dem_tl${s}`]=[n.x*o%1,n.y*o%1],r[`u_dem_scale${s}`]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,r=t.gl;if(!this._emptyDepthBufferTexture){const i=new e.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new e.T(t,i,r.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let e=0;const t=this._visibleDemTiles.reduce(((t,r)=>{if(!r.dem)return t;const i=r.dem.tree.minimums[0];return i>0&&e++,t+i}),0);return e?t/e:0}_updateEmptyDEMTexture(){const t=this.painter.context,r=t.gl;t.activeTexture.set(r.TEXTURE2);const i=this._getLoadedAreaMinimum(),[n,o]=(()=>{const t=new e.cm({width:1,height:1},new Float32Array([i]));return[r.R32F,t]})();this._emptyDEMTextureDirty=!1;let s=this._emptyDEMTexture;return s?s.update(o,{premultiply:!1}):s=this._emptyDEMTexture=new e.T(t,o,n,{premultiply:!1}),s}setupElevationDraw(t,r,i){const n=this.painter.context,o=n.gl,s={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};s.u_exaggeration=this.exaggeration();let a=null,l=null,c=1;if(i&&i.morphing&&this._useVertexMorphing){const e=i.morphing.srcDemTile,r=i.morphing.dstDemTile;c=i.morphing.phase,e&&r&&(this._prepareDemTileUniforms(t,e,s,"_prev")&&(l=e),this._prepareDemTileUniforms(t,r,s)&&(a=r))}const u=e=>e&&e.demTexture&&this.painter.linearFloatFilteringSupported()?o.LINEAR:o.NEAREST,h=e=>{s.u_dem_size=1===e.size[0]?1:e.size[0]-2};if(l&&a)n.activeTexture.set(o.TEXTURE2),a.demTexture.bind(u(a),o.CLAMP_TO_EDGE),n.activeTexture.set(o.TEXTURE4),l.demTexture.bind(u(l),o.CLAMP_TO_EDGE),a.demTexture&&h(a.demTexture),s.u_dem_lerp=c;else{a=this.terrainTileForTile[t.tileID.key],n.activeTexture.set(o.TEXTURE2);const e=this._prepareDemTileUniforms(t,a,s)?a.demTexture:this.emptyDEMTexture;e.bind(u(a),o.CLAMP_TO_EDGE),h(e)}if(n.activeTexture.set(o.TEXTURE3),i&&i.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),this._depthFBO&&(s.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),s.u_depth_size_inv=[1,1]),i&&i.useMeterToDem&&a){const t=(1<<a.tileID.canonical.z)*e.bl(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;s.u_meter_to_dem=t}if(i&&i.labelPlaneMatrixInv&&(s.u_label_plane_matrix_inv=i.labelPlaneMatrixInv),r.setTerrainUniformValues(n,s),"globe"===this.painter.transform.projection.name){const e=this.globeUniformValues(this.painter.transform,t.tileID.canonical,i&&i.useDenormalizedUpVectorScale);r.setGlobeUniformValues(n,e)}}globeUniformValues(t,r,i){const n=t.projection;return{u_tile_tl_up:n.upVector(r,0,0),u_tile_tr_up:n.upVector(r,e.V,0),u_tile_br_up:n.upVector(r,e.V,e.V),u_tile_bl_up:n.upVector(r,0,e.V),u_tile_up_scale:i?e.cl(1):n.upVectorScale(r,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const r=this.painter,i=this.painter.context;0!==t.length&&(i.bindFramebuffer.set(null),i.viewport.set([0,0,r.width,r.height]),r.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(t,r,i,n,o){if("globe"===t.transform.projection.name)!function(t,r,i,n,o){const s=t.context,a=s.gl;let l,c;const u=t.transform,h=e.cd(t,s,u),d=(e,r)=>{if(c===r)return;const i=[cn[r],"PROJECTION_GLOBE_VIEW"];h&&i.push("CUSTOM_ANTIALIASING");const n=t.isTileAffectedByFog(e);l=t.getOrCreateProgram("globeRaster",{defines:i,overrideFog:n}),c=r},p=t.colorModeForRenderPass(),f=new Ct(a.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D);ln.update(o);const m=e.ce(u),_=[e.a5(u.center.lng),e.ae(u.center.lat)],g=t.globeSharedBuffers,y=[u.width*e.f.devicePixelRatio,u.height*e.f.devicePixelRatio],x=Float32Array.from(u.globeMatrix),v={useDenormalizedUpVectorScale:!0};{const u=t.transform,h=un(u.zoom,r.exaggeration(),r.sourceCache._source.tileSize);c=-1;const b=a.TRIANGLES;for(const c of n){const n=i.getTile(c),w=Lt.disabled,T=r.prevTerrainTileForTile[c.key],E=r.terrainTileForTile[c.key];an(T,E)&&ln.newMorphing(c.key,T,E,o,250),s.activeTexture.set(a.TEXTURE0),n.texture&&n.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const S=ln.getMorphValuesForProxy(c.key),M=S?1:0;S&&e.j(v,{morphing:{srcDemTile:S.from,dstDemTile:S.to,phase:e.cc(S.phase)}});const A=e.cf(c.canonical),I=e.cg(A.getCenter().lat),C=e.ch(c.canonical,A,I,u.worldSize/u._pixelsPerMercatorPixel),P=e.aT(e.ci(c.canonical)),L=sn(u.expandedFarZProjMatrix,x,m,P,e.S(u.zoom),_,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,y,h,u._farZ,C);if(d(c,M),l&&(r.setupElevationDraw(n,l,v),t.uploadCommonUniforms(s,l,c.toUnwrapped()),g)){const[e,r,i]=g.getGridBuffers(I,0!==h);l.draw(t,b,f,w,p,kt.backCCW,L,"globe_raster",e,r,i)}}}if(g&&(t.renderDefaultNorthPole||t.renderDefaultSouthPole)){const o=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];h&&o.push("CUSTOM_ANTIALIASING"),l=t.getOrCreateProgram("globeRaster",{defines:o});for(const c of n){const{x:n,y:o,z:h}=c.canonical,d=0===o,m=o===(1<<h)-1,[x,b,w,T]=g.getPoleBuffers(h,!1);if(T&&(d||m)){const o=i.getTile(c);s.activeTexture.set(a.TEXTURE0),o.texture&&o.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);let g=e.cj(h,n,u);const E=e.aT(e.ci(c.canonical)),S=(e,r)=>e.draw(t,a.TRIANGLES,f,Lt.disabled,p,kt.disabled,sn(u.expandedFarZProjMatrix,g,g,E,0,_,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,y,0,u._farZ),"globe_pole_raster",r,w,T);r.setupElevationDraw(o,l,v),t.uploadCommonUniforms(s,l,c.toUnwrapped()),d&&t.renderDefaultNorthPole&&S(l,x),m&&t.renderDefaultSouthPole&&(g=e.a6.scale(e.a6.create(),g,[1,-1,1]),S(l,b))}}}}(t,r,i,n,o);else{const s=t.context,a=s.gl;let l,c;const u=t.shadowRenderer,h=gi(t,t.longestCutoffRange),d=e=>{if(c===e)return;const r=[];r.push(cn[e]),h.shouldRenderCutoff&&r.push("RENDER_CUTOFF"),l=t.getOrCreateProgram("terrainRaster",{defines:r}),c=e},p=t.colorModeForRenderPass(),f=new Ct(a.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D);ln.update(o);const m=t.transform,_=un(m.zoom,r.exaggeration(),r.sourceCache._source.tileSize);let g=[0,0,0];if(u){const e=t.style.directionalLight,r=t.style.ambientLight;e&&r&&(g=Ei(e,r))}{c=-1;const y=a.TRIANGLES,[x,v]=[r.gridIndexBuffer,r.gridSegments];for(const c of n){const n=i.getTile(c),b=Lt.disabled,w=r.prevTerrainTileForTile[c.key],T=r.terrainTileForTile[c.key];an(w,T)&&ln.newMorphing(c.key,w,T,o,250),s.activeTexture.set(a.TEXTURE0),n.texture&&n.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const E=ln.getMorphValuesForProxy(c.key),S=E?1:0;let M;E&&(M={morphing:{srcDemTile:E.from,dstDemTile:E.to,phase:e.cc(E.phase)}});const A=on(c.projMatrix,hn(c.canonical,m.renderWorldCopies)?_/10:_,g);if(d(S),!l)continue;r.setupElevationDraw(n,l,M);const I=c.toUnwrapped();u&&u.setupShadows(I,l),t.uploadCommonUniforms(s,l,I,null,h),l.draw(t,y,f,b,p,kt.backCCW,A,"terrain_raster",r.gridBuffer,x,v)}}}}(r,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,r.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const r=this.painter,i=this.painter.context,n=this.proxySourceCache,o=this.proxiedCoords[n.id],s=this._drapedRenderBatches.shift(),a=r.style.order,l=[];let c=0;for(const u of o){const o=n.getTileByID(u.proxyTileKey),h=n.proxyCachedFBO[u.key]?n.proxyCachedFBO[u.key][t]:void 0,d=void 0!==h?n.renderCache[h]:this.pool[c++],p=void 0!==h;if(o.texture=d.tex,p&&!d.dirty){l.push(o.tileID);continue}let f;i.bindFramebuffer.set(d.fb.framebuffer),this.renderedToTile=!1,d.dirty&&(i.clear({color:e.ax.transparent,stencil:0}),d.dirty=!1);for(let e=s.start;e<=s.end;++e){const t=r.style._mergedLayers[a[e]];if(t.isHidden(r.transform.zoom))continue;const n=r.style.getLayerSourceCache(t),o=n?this.proxyToSource[u.key][n.id]:[u];if(!o)continue;const s=o;i.viewport.set([0,0,d.fb.width,d.fb.height]),f!==(n?n.id:null)&&(this._setupStencil(d,o,t,n),f=n?n.id:null),r.renderLayer(r,n,t,s)}if(0===this._drapedRenderBatches.length)for(const e of this._pendingGroundEffectLayers){const t=r.style._mergedLayers[a[e]];if(t.isHidden(r.transform.zoom))continue;const n=r.style.getLayerSourceCache(t),o=n?this.proxyToSource[u.key][n.id]:[u];if(!o)continue;const s=o;i.viewport.set([0,0,d.fb.width,d.fb.height]),f!==(n?n.id:null)&&(this._setupStencil(d,o,t,n),f=n?n.id:null),r.renderLayer(r,n,t,s)}this.renderedToTile?(d.dirty=!0,l.push(o.tileID)):p||--c,5===c&&(c=0,this.renderToBackBuffer(l))}return this.renderToBackBuffer(l),this.renderingToTexture=!1,i.bindFramebuffer.set(null),i.viewport.set([0,0,r.width,r.height]),s.end+1}postRender(){}isLayerOrderingCorrect(e){const t=e.order.length;let r=-1,i=t;for(let n=0;n<t;++n)this._style.isLayerDraped(e._mergedLayers[e.order[n]])?r=Math.max(r,n):i=Math.min(i,n);return i>r}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter((e=>e.dem)).forEach((t=>{e=Math.min(e,t.dem.tree.minimums[0])})),0===e?e:(e-30)*this._exaggeration}raycast(e,t,r){if(!this._visibleDemTiles)return null;const i=this._visibleDemTiles.filter((e=>e.dem)).map((i=>{const n=i.tileID,o=1<<n.overscaledZ,{x:s,y:a}=n.canonical,l=s/o,c=(s+1)/o,u=a/o,h=(a+1)/o;return{minx:l,miny:u,maxx:c,maxy:h,t:i.dem.tree.raycastRoot(l,u,c,h,e,t,r),tile:i}}));i.sort(((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE)));for(const n of i){if(null==n.t)return null;const i=n.tile.dem.tree.raycast(n.minx,n.miny,n.maxx,n.maxy,e,t,r);if(null!=i)return i}return null}_createFBO(){const t=this.painter.context,r=t.gl,i=this.drapeBufferSize;t.activeTexture.set(r.TEXTURE0);const n=new e.T(t,{width:i[0],height:i[1],data:null},r.RGBA);n.bind(r.LINEAR,r.CLAMP_TO_EDGE);const o=t.createFramebuffer(i[0],i[1],!0,null);return o.colorAttachment.set(n.texture),o.depthAttachment=new At(t,o.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,i[0],i[1]),this._stencilRef=0,o.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):o.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&r.texParameterf(r.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:o,tex:n,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache)return!0;if(this._style.hasLightTransitions())return!0;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some((e=>{const t=this._style._mergedLayers[e],r=t.isHidden(this.painter.transform.zoom);return"custom"===t.type?!r&&t.shouldRedrape():!r&&t.hasTransition()}))}_clearLineLayersFromRenderCache(){let t=!1;for(const e of this._style.getSources())if(e instanceof Re){t=!0;break}if(!t)return;const r={};for(let i=0;i<this._style.order.length;++i){const t=this._style._mergedLayers[this._style.order[i]],n=this._style.getLayerSourceCache(t);if(n&&!r[n.id]&&!t.isHidden(this.painter.transform.zoom)&&"line"===t.type&&t.widthExpression()instanceof e.Z){r[n.id]=!0;for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][n.id];if(t)for(const e of t)this._clearRenderCacheForTile(n.id,e)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r]._source instanceof De){e=!0;break}if(!e)return;const t={};for(let r=0;r<this._style.order.length;++r){const e=this._style._mergedLayers[this._style.order[r]],i=this._style.getLayerSourceCache(e);if(!i||t[i.id])continue;if(e.isHidden(this.painter.transform.zoom)||"raster"!==e.type)continue;const n=e.paint.get("raster-fade-duration");for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][i.id];if(e)for(const t of e){const e=pn(i.getTile(t),i.findLoadedParent(t,0),i,this.painter.transform,n);(1!==e.opacity||0!==e.mix)&&this._clearRenderCacheForTile(i.id,t)}}}}_setupDrapedRenderBatches(){const t=this._style.order,r=t.length;if(0===r)return;const i=[];this._pendingGroundEffectLayers=[];let n,o=0,s=this._style._mergedLayers[t[o]];for(;!this._style.isLayerDraped(s)&&s.isHidden(this.painter.transform.zoom)&&++o<r;)s=this._style._mergedLayers[t[o]];for(;o<r;++o){const e=this._style._mergedLayers[t[o]];e.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(e)?void 0===n&&(n=o):("fill-extrusion"===e.type&&this._pendingGroundEffectLayers.push(o),void 0!==n&&(i.push({start:n,end:o-1}),n=void 0)))}if(void 0!==n&&i.push({start:n,end:o-1}),0!==i.length){const t=i[i.length-1];this._pendingGroundEffectLayers.every((e=>e>t.end))||e.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=i}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let r=0;r<e.length;++r){const i=Object.values(e[r]);t.renderCachePool.push(...i)}}return}this._clearRasterLayersFromRenderCache();const r=this.proxyCoords,i=this._tilesDirty;for(let o=r.length-1;o>=0;o--){const n=r[o];if(t.getTileByID(n.key),void 0!==t.proxyCachedFBO[n.key]){const r=e[n.key],o=this.proxyToSource[n.key];let s=0;for(const e in o){const t=o[e],n=r[e];if(!n||n.length!==t.length||t.some(((t,r)=>t!==n[r]||i[e]&&i[e].hasOwnProperty(t.key)))){s=-1;break}++s}for(const e in t.proxyCachedFBO[n.key])t.renderCache[t.proxyCachedFBO[n.key][e]].dirty=s<0||s!==Object.values(r).length}}const n=[...this._drapedRenderBatches];n.sort(((e,t)=>t.end-t.start-(e.end-e.start)));for(const o of n)for(const e of r){if(t.proxyCachedFBO[e.key])continue;let r=t.renderCachePool.pop();void 0===r&&t.renderCache.length<50&&(r=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==r&&(t.proxyCachedFBO[e.key]={},t.proxyCachedFBO[e.key][o.start]=r,t.renderCache[r].dirty=!0)}this._tilesDirty={}}_setupStencil(e,t,r,i){if(!i||!this._sourceTilesOverlap[i.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const n=this.painter.context,o=n.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let s;if(r.isTileClipped())s=t.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);s=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+s>255&&(n.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=s,this._overlapStencilMode.ref=this._stencilRef,r.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):Lt.disabled}_renderTileClippingMasks(e,t){const r=this.painter,i=this.painter.context,n=i.gl;r._tileClippingMaskIDs={},i.setColorMode(Dt.disabled),i.setDepthMode(Ct.disabled);const o=r.getOrCreateProgram("clippingMask");for(const s of e){const e=r._tileClippingMaskIDs[s.key]=--t;o.draw(r,n.TRIANGLES,Ct.disabled,new Lt({func:n.ALWAYS,mask:0},e,255,n.KEEP,n.KEEP,n.REPLACE),Dt.disabled,kt.disabled,dn(s.projMatrix),"$clipping",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments)}}pointCoordinate(t){const r=this.painter.transform;if(t.x<0||t.x>r.width||t.y<0||t.y>r.height)return null;const i=[t.x,t.y,1,1];e.a7.transformMat4(i,i,r.pixelMatrixInverse),e.a7.scale(i,i,1/i[3]),i[0]/=r.worldSize,i[1]/=r.worldSize;const n=r._camera.position,o=e.bl(1,r.center.lat),s=[n[0],n[1],n[2]/o,0],a=e.N.subtract([],i.slice(0,3),s);e.N.normalize(a,a);const l=this.raycast(s,a,this._exaggeration);return null!==l&&l?(e.N.scaleAndAdd(s,s,a,l),s[3]=s[2],s[2]*=o,s):null}drawDepth(){const t=this.painter,r=t.context,i=this.proxySourceCache,n=Math.ceil(t.width),o=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===n&&this._depthFBO.height===o||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const t=r.gl,i=r.createFramebuffer(n,o,!0,"renderbuffer");r.activeTexture.set(t.TEXTURE0);const s=new e.T(r,{width:n,height:o,data:null},t.RGBA);s.bind(t.NEAREST,t.CLAMP_TO_EDGE),i.colorAttachment.set(s.texture);const a=r.createRenderbuffer(r.gl.DEPTH_COMPONENT16,n,o);i.depthAttachment.set(a),this._depthFBO=i,this._depthTexture=s}r.bindFramebuffer.set(this._depthFBO.framebuffer),r.viewport.set([0,0,n,o]),function(e,t,r,i){if("globe"===e.transform.projection.name)return;const n=e.context,o=n.gl;n.clear({depth:1});const s=e.getOrCreateProgram("terrainDepth"),a=new Ct(o.LESS,Ct.ReadWrite,e.depthRangeFor3D);for(const l of i){const i=r.getTile(l),n=on(l.projMatrix,0,[0,0,0]);t.setupElevationDraw(i,s),s.draw(e,o.TRIANGLES,a,Lt.disabled,Dt.unblended,kt.backCCW,n,"terrain_depth",t.gridBuffer,t.gridIndexBuffer,t.gridNoSkirtSegments)}}(t,this,i,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,r,i){if(t.getSource()instanceof e.ap)return this._setupProxiedCoordsForImageSource(t,r,i);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const n=this.proxiedCoords[t.id]=[],o=this.proxyCoords;for(let e=0;e<o.length;e++){const r=o[e],s=this._findTileCoveringTileID(r,t);if(s){const e=this._createProxiedId(r,s,i[r.key]&&i[r.key][t.id]);n.push(e),this.proxyToSource[r.key][t.id]=[e]}}let s=!1;const a=new Set;for(let e=0;e<r.length;e++){const o=t.getTile(r[e]);if(!o||!o.hasData())continue;const l=this._findTileCoveringTileID(o.tileID,this.proxySourceCache);if(l&&l.tileID.canonical.z!==o.tileID.canonical.z){const e=this.proxyToSource[l.tileID.key][t.id],r=this._createProxiedId(l.tileID,o,i[l.tileID.key]&&i[l.tileID.key][t.id]);e?e.splice(e.length-1,0,r):this.proxyToSource[l.tileID.key][t.id]=[r];const c=this.proxyToSource[l.tileID.key][t.id];a.has(c)||a.add(c),n.push(r),s=!0}}if(this._sourceTilesOverlap[t.id]=s,s&&this._debugParams.sortTilesHiZFirst)for(const e of a)e.sort(((e,t)=>t.overscaledZ-e.overscaledZ))}_setupProxiedCoordsForImageSource(t,r,i){if(!t.getSource().loaded())return;const n=this.proxiedCoords[t.id]=[],o=this.proxyCoords,s=t.getSource(),a=s.tileID;if(!a)return;const l=new e.P(a.x,a.y)._div(1<<a.z),c=s.coordinates.map(e.L.fromLngLat).reduce(((e,t)=>(e.min.x=Math.min(e.min.x,t.x-l.x),e.min.y=Math.min(e.min.y,t.y-l.y),e.max.x=Math.max(e.max.x,t.x-l.x),e.max.y=Math.max(e.max.y,t.y-l.y),e)),{min:new e.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),u=(t,r)=>{const i=t.wrap+t.canonical.x/(1<<t.canonical.z),n=t.canonical.y/(1<<t.canonical.z),o=e.V/(1<<t.canonical.z),s=r.wrap+r.canonical.x/(1<<r.canonical.z),a=r.canonical.y/(1<<r.canonical.z);return i+o<s+c.min.x||i>s+c.max.x||n+o<a+c.min.y||n>a+c.max.y};for(let e=0;e<o.length;e++){const s=o[e];for(let e=0;e<r.length;e++){const o=t.getTile(r[e]);if(!o||!o.hasData())continue;if(u(s,o.tileID))continue;const a=this._createProxiedId(s,o,i[s.key]&&i[s.key][t.id]),l=this.proxyToSource[s.key][t.id];l?l.push(a):this.proxyToSource[s.key][t.id]=[a],n.push(a)}}}_createProxiedId(t,r,i){let n=this.orthoMatrix;if(i){const e=i.find((e=>e.key===r.tileID.key));if(e)return e}if(r.tileID.key!==t.key){const i=t.canonical.z-r.tileID.canonical.z;let o,s,a;n=e.a6.create();const l=r.tileID.wrap-t.wrap<<t.overscaledZ;i>0?(o=e.V>>i,s=o*((r.tileID.canonical.x<<i)-t.canonical.x+l),a=o*((r.tileID.canonical.y<<i)-t.canonical.y)):(o=e.V<<-i,s=e.V*(r.tileID.canonical.x-(t.canonical.x+l<<-i)),a=e.V*(r.tileID.canonical.y-(t.canonical.y<<-i))),e.a6.ortho(n,0,o,0,o,0,1),e.a6.translate(n,n,[s,a,0])}return new _n(r.tileID,t.key,n)}_findTileCoveringTileID(t,r){let i=r.getTile(t);if(i&&i.hasData())return i;const n=this._findCoveringTileCache[r.id],o=n[t.key];if(i=o?r.getTileByID(o):null,i&&i.hasData()||null===o)return i;let s=i?i.tileID:t,a=s.overscaledZ;const l=r.getSource().minzoom,c=[];if(!o){const n=r.getSource().maxzoom;if(t.canonical.z>=n){const i=t.canonical.z-n;r.getSource().reparseOverscaled?(a=Math.max(t.canonical.z+2,r.transform.tileZoom),s=new e.am(a,t.wrap,n,t.canonical.x>>i,t.canonical.y>>i)):0!==i&&(a=n,s=new e.am(a,t.wrap,n,t.canonical.x>>i,t.canonical.y>>i))}s.key!==t.key&&(c.push(s.key),i=r.getTile(s))}const u=e=>{c.forEach((t=>{n[t]=e})),c.length=0};for(a-=1;a>=l&&(!i||!i.hasData());a--){i&&u(i.tileID.key);const e=s.calculateScaledKey(a);if(i=r.getTileByID(e),i&&i.hasData())break;const t=n[e];if(null===t)break;void 0===t?c.push(e):i=r.getTileByID(t)}return u(i?i.tileID.key:null),i&&i.hasData()?i:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let r=this._tilesDirty[e];r||(r=this._tilesDirty[e]={}),r[t.key]=!0}}function yn(t,r,i){const n=function(t,r,i){const n=e.N.dot(r,t),o=e.N.dot(i,[.2126,.7152,.0722]),s=(e,t,r)=>(1-r)*e+r*t,a=s(1-.3*Math.min(o,1),1,Math.min(n+1,1));return s(.92,1,Math.asin(e.aa(r[2],-1,1))/Math.PI+.5)*a}(t,[0,0,1],r),o=[0,0,0];e.N.scale(o,i.slice(0,3),n);const s=[0,0,0];e.N.scale(s,r.slice(0,3),t[2]);const a=[0,0,0];return e.N.add(a,o,s),e.bU(a)}const xn=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],vn=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class bn{static cacheKey(e,t,r,i){let n=`${t}${i?i.cacheKey:""}`;for(const o of r)e.usedDefines.includes(o)&&(n+=`/${o}`);return n}constructor(t,r,i,n,o,s,a){const l=t.gl;this.program=l.createProgram(),this.configuration=n,this.name=r,this.fixedDefines=[...s];const c=n?n.getBinderAttributes():[],u=(i.staticAttributes||[]).concat(c);let h=n?n.defines():[];h=h.concat(s.map((e=>`#define ${e}`)));const d="#version 300 es\n";let p=d+h.concat("precision mediump float;",Hi,Wi.fragmentSource).join("\n");for(const e of i.fragmentIncludes)p+=`\n${qi[e]}`;p+=`\n${i.fragmentSource}`;let f=d+h.concat("precision highp float;",Hi,Wi.vertexSource).join("\n");for(const e of i.vertexIncludes)f+=`\n${qi[e]}`;f+=`\n${i.vertexSource}`;const m=l.createShader(l.FRAGMENT_SHADER);if(l.isContextLost())return void(this.failedToCreate=!0);l.shaderSource(m,p),l.compileShader(m),l.attachShader(this.program,m);const _=l.createShader(l.VERTEX_SHADER);if(l.isContextLost())this.failedToCreate=!0;else{l.shaderSource(_,f),l.compileShader(_),l.attachShader(this.program,_),this.attributes={},this.numAttributes=u.length;for(let e=0;e<this.numAttributes;e++)if(u[e]){const t=u[e].startsWith("a_")?u[e]:`a_${u[e]}`;l.bindAttribLocation(this.program,e,t),this.attributes[t]=e}a&&a.shaderVaryings.length>0&&l.transformFeedbackVaryings(this.program,a.shaderVaryings,a.bufferMode),l.linkProgram(this.program),l.deleteShader(_),l.deleteShader(m),this.fixedUniforms=o(t),this.binderUniforms=n?n.getUniforms(t):[],s.includes("TERRAIN")&&(this.terrainUniforms=(t=>({u_dem:new e.bO(t),u_dem_prev:new e.bO(t),u_dem_tl:new e.bL(t),u_dem_scale:new e.bN(t),u_dem_tl_prev:new e.bL(t),u_dem_scale_prev:new e.bN(t),u_dem_size:new e.bN(t),u_dem_lerp:new e.bN(t),u_exaggeration:new e.bN(t),u_depth:new e.bO(t),u_depth_size_inv:new e.bL(t),u_meter_to_dem:new e.bN(t),u_label_plane_matrix_inv:new e.bK(t)}))(t)),s.includes("GLOBE")&&(this.globeUniforms=(t=>({u_tile_tl_up:new e.bM(t),u_tile_tr_up:new e.bM(t),u_tile_br_up:new e.bM(t),u_tile_bl_up:new e.bM(t),u_tile_up_scale:new e.bN(t)}))(t)),s.includes("FOG")&&(this.fogUniforms=(t=>({u_fog_matrix:new e.bK(t),u_fog_range:new e.bL(t),u_fog_color:new e.bP(t),u_fog_horizon_blend:new e.bN(t),u_fog_vertical_limit:new e.bL(t),u_fog_temporal_offset:new e.bN(t),u_frustum_tl:new e.bM(t),u_frustum_tr:new e.bM(t),u_frustum_br:new e.bM(t),u_frustum_bl:new e.bM(t),u_globe_pos:new e.bM(t),u_globe_radius:new e.bN(t),u_globe_transition:new e.bN(t),u_is_globe:new e.bO(t),u_viewport:new e.bL(t)}))(t)),s.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(t=>({u_cutoff_params:new e.bP(t)}))(t)),s.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(t=>({u_lighting_ambient_color:new e.bM(t),u_lighting_directional_dir:new e.bM(t),u_lighting_directional_color:new e.bM(t),u_ground_radiance:new e.bM(t)}))(t)),s.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(t=>({u_light_matrix_0:new e.bK(t),u_light_matrix_1:new e.bK(t),u_fade_range:new e.bL(t),u_shadow_normal_offset:new e.bM(t),u_shadow_intensity:new e.bN(t),u_shadow_texel_size:new e.bN(t),u_shadow_map_resolution:new e.bN(t),u_shadow_direction:new e.bM(t),u_shadow_bias:new e.bM(t),u_shadowmap_0:new e.bO(t),u_shadowmap_1:new e.bO(t)}))(t))}}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const r=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e]&&r[e].set(this.program,e,t[e])}}setGlobeUniformValues(e,t){if(!this.globeUniforms)return;const r=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e]&&r[e].set(this.program,e,t[e])}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const r=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e].set(this.program,e,t[e])}}setCutoffUniformValues(e,t){if(!this.cutoffUniforms)return;const r=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e].set(this.program,e,t[e])}}setLightsUniformValues(e,t){if(!this.lightsUniforms)return;const r=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e].set(this.program,e,t[e])}}setShadowUniformValues(e,t){if(this.failedToCreate||!this.shadowUniforms)return;const r=this.shadowUniforms;e.program.set(this.program);for(const i in t)r[i].set(this.program,i,t[i])}_drawDebugWireframe(t,r,i,n,o,s,a,l,c,u){const h=t.options.wireframe;if(!1===h.terrain&&!1===h.layers2D&&!1===h.layers3D)return;const d=t.context;if(!(()=>!(!h.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!h.layers2D||t._terrain&&t._terrain.renderingToTexture||!xn.includes(this.name))||!(!h.layers3D||!vn.includes(this.name)))())return;const p=d.gl,f=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,o,d);if(!f)return;const m=[...this.fixedDefines];m.push("DEBUG_WIREFRAME");const _=t.getOrCreateProgram(this.name,{config:this.configuration,defines:m});d.program.set(_.program);const g=(e,t,r)=>{if(t[e]&&r[e])for(const i in t[e])r[e][i]&&r[e][i].set(r.program,i,t[e][i].current)};c&&c.setUniforms(_.program,d,_.binderUniforms,a,{zoom:l}),g("fixedUniforms",this,_),g("terrainUniforms",this,_),g("globeUniforms",this,_),g("fogUniforms",this,_),g("lightsUniforms",this,_),g("shadowUniforms",this,_),f.bind(),d.setColorMode(new Dt([p.ONE,p.ONE_MINUS_SRC_ALPHA,p.ZERO,p.ONE],e.ax.transparent,[!0,!0,!0,!1])),d.setDepthMode(new Ct(r.func===p.LESS?p.LEQUAL:r.func,Ct.ReadOnly,r.range)),d.setStencilMode(Lt.disabled);const y=3*s.primitiveLength*2,x=3*s.primitiveOffset*2*2;u&&u>1?p.drawElementsInstanced(p.LINES,y,p.UNSIGNED_SHORT,x,u):p.drawElements(p.LINES,y,p.UNSIGNED_SHORT,x),o.bind(),d.program.set(this.program),d.setDepthMode(r),d.setStencilMode(i),d.setColorMode(n)}draw(e,t,r,i,n,o,s,a,l,c,u,h,d,p,f,m,_){const g=e.context,y=g.gl;if(this.failedToCreate)return;g.program.set(this.program),g.setDepthMode(r),g.setStencilMode(i),g.setColorMode(n),g.setCullFace(o);for(const w of Object.keys(this.fixedUniforms))this.fixedUniforms[w].set(this.program,w,s[w]);p&&p.setUniforms(this.program,g,this.binderUniforms,h,{zoom:d});const x={[y.POINTS]:1,[y.LINES]:2,[y.TRIANGLES]:3,[y.LINE_STRIP]:1}[t],v=_&&_.length>0;if(v){for(const e of _)y.bindBufferBase(y.TRANSFORM_FEEDBACK_BUFFER,e.targetIndex,e.buffer.buffer);y.beginTransformFeedback(t)}const b=m&&m>0?1:void 0;for(const w of u.get()){const o=w.vaos||(w.vaos={});(o[a]||(o[a]=new Ji)).bind(g,this,l,p?p.getPaintVertexBuffers():[],c,w.vertexOffset,f||[],b),m&&m>1?y.drawElementsInstanced(t,w.primitiveLength*x,y.UNSIGNED_SHORT,w.primitiveOffset*x*2,m):c?y.drawElements(t,w.primitiveLength*x,y.UNSIGNED_SHORT,w.primitiveOffset*x*2):y.drawArrays(t,w.vertexOffset,w.vertexLength),t===y.TRIANGLES&&c&&this._drawDebugWireframe(e,r,i,n,c,w,h,d,p,m)}v&&y.endTransformFeedback()}}function wn(t,r){const i=Math.pow(2,r.tileID.overscaledZ),n=r.tileSize*Math.pow(2,t.transform.tileZoom)/i,o=n*(r.tileID.canonical.x+r.tileID.wrap*i),s=n*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/e.a3(r,1,t.transform.tileZoom),u_pixel_coord_upper:[o>>16,s>>16],u_pixel_coord_lower:[65535&o,65535&s]}}const Tn=e.a6.create(),En=(t,r,i,n,o,s,a,l,c,u,h,d,p,f,m,_)=>{const g=r.style.light,y=g.properties.get("position"),x=[y.x,y.y,y.z],v=e.co.create();"viewport"===g.properties.get("anchor")&&(e.co.fromRotation(v,-r.transform.angle),e.N.transformMat3(x,x,v));const b=g.properties.get("color"),w=r.transform,T={u_matrix:t,u_lightpos:x,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_vertical_gradient:+i,u_opacity:n,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Tn,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:o,u_edge_radius:s,u_flood_light_color:d,u_vertical_scale:p,u_flood_light_intensity:f,u_ground_shadow_factor:m,u_emissive_strength:_};return"globe"===w.projection.name&&(T.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],T.u_zoom_transition=c,T.u_inv_rot_matrix=h,T.u_merc_center=u,T.u_up_dir=w.projection.upVector(new e.bs(0,0,0),u[0]*e.V,u[1]*e.V),T.u_height_lift=l),T},Sn=(e,t,r)=>({u_matrix:e,u_edge_radius:t,u_vertical_scale:r}),Mn=(t,r,i,n,o,s,a,l,c,u,h,d,p,f)=>{const m=En(t,r,i,n,o,s,a,c,u,h,d,p,f,1,[0,0,0],0),_={u_height_factor:-Math.pow(2,a.overscaledZ)/l.tileSize/8};return e.e(m,wn(r,l),_)},An=(e,t)=>({u_matrix:e,u_emissive_strength:t}),In=(t,r,i,n)=>e.e(An(t,r),wn(i,n)),Cn=(e,t,r)=>({u_matrix:e,u_world:r,u_emissive_strength:t}),Pn=(t,r,i,n,o)=>e.e(In(t,r,i,n),{u_world:o}),Ln=(t,r,i,n)=>{const o=e.V/i.tileSize;return{u_matrix:t,u_camera_to_center_distance:r.getCameraToCenterDistance(n),u_extrude_scale:[r.pixelsToGLUnits[0]/o,r.pixelsToGLUnits[1]/o]}},Rn=(e,t,r=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:r}),Dn=e.a6.create(),On=(t,r,i,n,o,s,a)=>{const l=t.transform,c="globe"===l.projection.name,u=c?e.cp(l.zoom,r.canonical)*l._pixelsPerMercatorPixel:e.a3(i,1,s),h={u_matrix:r.projMatrix,u_extrude_scale:u,u_intensity:a,u_inv_rot_matrix:Dn,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){h.u_inv_rot_matrix=n,h.u_merc_center=o,h.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],h.u_zoom_transition=e.S(l.zoom);const t=o[0]*e.V,i=o[1]*e.V;h.u_up_dir=l.projection.upVector(new e.bs(0,0,0),t,i)}return h};function zn(e,[t,r,i,n],[o,s]){if(o===s)return[0,0,0,0];const a=255*(e-1)/(e*(s-o));return[t*a,r*a,i*a,n*a]}function kn(e,t,[r,i]){return r===i?0:.5/e+(t-r)*(e-1)/(e*(i-r))}const Fn=(t,r,i,n,o,s,a,l,c,u,h,d,p,f,m,_,g,y,x,v,b)=>{return{u_matrix:t,u_normalize_matrix:r,u_globe_matrix:i,u_merc_matrix:n,u_grid_matrix:o,u_tl_parent:s,u_scale_parent:u,u_fade_t:h.mix,u_opacity:h.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(T=d.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(w=d.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Bn(d.paint.get("raster-hue-rotate")),u_perspective_transform:p,u_raster_elevation:f,u_zoom_transition:a,u_merc_center:l,u_cutoff_params:c,u_colorization_mix:zn(e.cq,_,y),u_colorization_offset:kn(e.cq,g,y),u_color_ramp:m,u_texture_offset:[v/(x+2*v),x/(x+2*v)],u_texture_res:[x+2*v,x+2*v],u_emissive_strength:b};var w,T};function Bn(e){e*=Math.PI/180;const t=Math.sin(e),r=Math.cos(e);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const Nn=(e,t,r,i,n,o,s,a,l,c,u,h)=>({u_matrix:e,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:i,u_grid_matrix:n,u_tl_parent:o,u_scale_parent:c,u_fade_t:u.mix,u_opacity:u.opacity,u_image0:0,u_image1:1,u_raster_elevation:h,u_zoom_transition:s,u_merc_center:a,u_cutoff_params:l}),Un=(e,t,r,i,n,o,s,a)=>({u_tile_offset:e,u_velocity:t,u_color_ramp:i,u_velocity_res:r,u_max_speed:n,u_texture_offset:o,u_data_scale:s,u_data_offset:a}),Vn=(e,t,r,i,n,o,s,a)=>({u_velocity:e,u_velocity_res:t,u_max_speed:r,u_speed_factor:i,u_lifetime_delta:n,u_rand_seed:Math.random(),u_texture_offset:o,u_data_scale:s,u_data_offset:a}),jn=e.a6.create(),Gn=(t,r,i,n,o,s,a,l,c,u,h,d,p,f,m,_,g,y)=>{const x=o.transform,v={u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:x.getCameraToCenterDistance(_),u_rotate_symbol:+i,u_aspect_ratio:x.width/x.height,u_fade_change:o.options.fadeDuration?o.symbolFadeChange:1,u_matrix:s,u_label_plane_matrix:a,u_coord_matrix:l,u_is_text:+c,u_pitch_with_map:+n,u_texsize:u,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:jn,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:jn,u_up_vector:[0,-1,0],u_icon_transition:y||0,u_icon_saturation:g};return"globe"===_.name&&(v.u_tile_id=[h.canonical.x,h.canonical.y,1<<h.canonical.z],v.u_zoom_transition=d,v.u_inv_rot_matrix=f,v.u_merc_center=p,v.u_camera_forward=x._camera.forward(),v.u_ecef_origin=e.cr(x.globeMatrix,h.toUnwrapped()),v.u_tile_matrix=Float32Array.from(x.globeMatrix),v.u_up_vector=m),v},$n=(t,r,i,n,o,s,a,l,c,u,h,d,p,f,m,_,g)=>e.e(Gn(t,r,i,n,o,s,a,l,c,u,d,p,f,m,_,g,1),{u_gamma_scale:n?o.transform.getCameraToCenterDistance(g)*Math.cos(o.terrain?0:o.transform._pitch):1,u_device_pixel_ratio:e.f.devicePixelRatio,u_is_halo:+h,undefined:void 0}),qn=(t,r,i,n,o,s,a,l,c,u,h,d,p,f,m,_)=>e.e($n(t,r,i,n,o,s,a,l,!0,c,!0,h,d,p,f,m,_),{u_texsize_icon:u,u_texture_icon:1}),Zn=(e,t,r,i)=>({u_matrix:e,u_emissive_strength:t,u_opacity:r,u_color:i}),Wn=(t,r,i,n,o,s,a)=>e.e(function(t,r,i,n){const o=i.imageManager.getPattern(t.toString(),r),{width:s,height:a}=i.imageManager.getPixelSize(r),l=Math.pow(2,n.tileID.overscaledZ),c=n.tileSize*Math.pow(2,i.transform.tileZoom)/l,u=c*(n.tileID.canonical.x+n.tileID.wrap*l),h=c*n.tileID.canonical.y;return{u_image:0,u_pattern_tl:o.tl,u_pattern_br:o.br,u_texsize:[s,a],u_pattern_size:o.displaySize,u_tile_units_to_pixels:1/e.a3(n,1,i.transform.tileZoom),u_pixel_coord_upper:[u>>16,h>>16],u_pixel_coord_lower:[65535&u,65535&h]}}(o,s,n,a),{u_matrix:t,u_emissive_strength:r,u_opacity:i}),Hn=(t,r,i,n,o,s,a,l,c,u,h,d,p=[0,0,0],f)=>{const m=n.style.light,_=m.properties.get("position"),g=[-_.x,-_.y,_.z],y=e.co.create();"viewport"===m.properties.get("anchor")&&(e.co.fromRotation(y,-n.transform.angle),e.N.transformMat3(g,g,y));const x="MASK"===u.alphaMode,v=m.properties.get("color"),b=d.paint.get("model-ambient-occlusion-intensity"),w=d.paint.get("model-color").constantOr(e.ax.white),T=d.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:t,u_lighting_matrix:r,u_normal_matrix:i,u_lightpos:g,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[v.r,v.g,v.b],u_camera_pos:p,u_opacity:o,u_baseTextureIsAlpha:0,u_alphaMask:+x,u_alphaCutoff:u.alphaCutoff,u_baseColorFactor:[s.r,s.g,s.b,s.a],u_emissiveFactor:[a[0],a[1],a[2],1],u_metallicFactor:l,u_roughnessFactor:c,u_baseColorTexture:_i.BaseColor,u_metallicRoughnessTexture:_i.MetallicRoughness,u_normalTexture:_i.Normal,u_occlusionTexture:_i.Occlusion,u_emissionTexture:_i.Emission,u_color_mix:[w.r,w.g,w.b,T],u_aoIntensity:b,u_emissive_strength:h,u_occlusionTextureTransform:f||[0,0,0,0]}},Xn=new Float32Array(16),Yn=(e,t=Xn,r=Xn)=>({u_matrix:e,u_instance:t,u_node_matrix:r}),Kn={fillExtrusion:t=>({u_matrix:new e.bK(t),u_lightpos:new e.bM(t),u_lightintensity:new e.bN(t),u_lightcolor:new e.bM(t),u_vertical_gradient:new e.bN(t),u_opacity:new e.bN(t),u_edge_radius:new e.bN(t),u_ao:new e.bL(t),u_tile_id:new e.bM(t),u_zoom_transition:new e.bN(t),u_inv_rot_matrix:new e.bK(t),u_merc_center:new e.bL(t),u_up_dir:new e.bM(t),u_height_lift:new e.bN(t),u_flood_light_color:new e.bM(t),u_vertical_scale:new e.bN(t),u_flood_light_intensity:new e.bN(t),u_ground_shadow_factor:new e.bM(t),u_emissive_strength:new e.bN(t)}),fillExtrusionDepth:t=>({u_matrix:new e.bK(t),u_edge_radius:new e.bN(t),u_vertical_scale:new e.bN(t)}),fillExtrusionPattern:t=>({u_matrix:new e.bK(t),u_lightpos:new e.bM(t),u_lightintensity:new e.bN(t),u_lightcolor:new e.bM(t),u_vertical_gradient:new e.bN(t),u_height_factor:new e.bN(t),u_edge_radius:new e.bN(t),u_ao:new e.bL(t),u_tile_id:new e.bM(t),u_zoom_transition:new e.bN(t),u_inv_rot_matrix:new e.bK(t),u_merc_center:new e.bL(t),u_up_dir:new e.bM(t),u_height_lift:new e.bN(t),u_image:new e.bO(t),u_texsize:new e.bL(t),u_pixel_coord_upper:new e.bL(t),u_pixel_coord_lower:new e.bL(t),u_tile_units_to_pixels:new e.bN(t),u_opacity:new e.bN(t)}),fillExtrusionGroundEffect:t=>({u_matrix:new e.bK(t),u_opacity:new e.bN(t),u_ao_pass:new e.bN(t),u_meter_to_tile:new e.bN(t),u_ao:new e.bL(t),u_flood_light_intensity:new e.bN(t),u_flood_light_color:new e.bM(t),u_attenuation:new e.bN(t),u_edge_radius:new e.bN(t),u_fb:new e.bO(t),u_fb_size:new e.bN(t)}),fill:t=>({u_matrix:new e.bK(t),u_emissive_strength:new e.bN(t)}),fillPattern:t=>({u_matrix:new e.bK(t),u_emissive_strength:new e.bN(t),u_image:new e.bO(t),u_texsize:new e.bL(t),u_pixel_coord_upper:new e.bL(t),u_pixel_coord_lower:new e.bL(t),u_tile_units_to_pixels:new e.bN(t)}),fillOutline:t=>({u_matrix:new e.bK(t),u_emissive_strength:new e.bN(t),u_world:new e.bL(t)}),fillOutlinePattern:t=>({u_matrix:new e.bK(t),u_emissive_strength:new e.bN(t),u_world:new e.bL(t),u_image:new e.bO(t),u_texsize:new e.bL(t),u_pixel_coord_upper:new e.bL(t),u_pixel_coord_lower:new e.bL(t),u_tile_units_to_pixels:new e.bN(t)}),circle:e.cs,collisionBox:t=>({u_matrix:new e.bK(t),u_camera_to_center_distance:new e.bN(t),u_extrude_scale:new e.bL(t)}),collisionCircle:t=>({u_matrix:new e.bK(t),u_inv_matrix:new e.bK(t),u_camera_to_center_distance:new e.bN(t),u_viewport_size:new e.bL(t)}),debug:t=>({u_color:new e.ca(t),u_matrix:new e.bK(t),u_overlay:new e.bO(t),u_overlay_scale:new e.bN(t)}),clippingMask:t=>({u_matrix:new e.bK(t)}),heatmap:t=>({u_extrude_scale:new e.bN(t),u_intensity:new e.bN(t),u_matrix:new e.bK(t),u_inv_rot_matrix:new e.bK(t),u_merc_center:new e.bL(t),u_tile_id:new e.bM(t),u_zoom_transition:new e.bN(t),u_up_dir:new e.bM(t)}),heatmapTexture:t=>({u_image:new e.bO(t),u_color_ramp:new e.bO(t),u_opacity:new e.bN(t)}),hillshade:t=>({u_matrix:new e.bK(t),u_image:new e.bO(t),u_latrange:new e.bL(t),u_light:new e.bL(t),u_shadow:new e.ca(t),u_highlight:new e.ca(t),u_emissive_strength:new e.bN(t),u_accent:new e.ca(t)}),hillshadePrepare:t=>({u_matrix:new e.bK(t),u_image:new e.bO(t),u_dimension:new e.bL(t),u_zoom:new e.bN(t)}),line:e.ct,linePattern:e.cu,raster:t=>({u_matrix:new e.bK(t),u_normalize_matrix:new e.bK(t),u_globe_matrix:new e.bK(t),u_merc_matrix:new e.bK(t),u_grid_matrix:new e.cb(t),u_tl_parent:new e.bL(t),u_scale_parent:new e.bN(t),u_fade_t:new e.bN(t),u_opacity:new e.bN(t),u_image0:new e.bO(t),u_image1:new e.bO(t),u_brightness_low:new e.bN(t),u_brightness_high:new e.bN(t),u_saturation_factor:new e.bN(t),u_contrast_factor:new e.bN(t),u_spin_weights:new e.bM(t),u_perspective_transform:new e.bL(t),u_raster_elevation:new e.bN(t),u_zoom_transition:new e.bN(t),u_merc_center:new e.bL(t),u_cutoff_params:new e.bP(t),u_colorization_mix:new e.bP(t),u_colorization_offset:new e.bN(t),u_color_ramp:new e.bO(t),u_texture_offset:new e.bL(t),u_texture_res:new e.bL(t),u_emissive_strength:new e.bN(t)}),rasterParticle:t=>({u_matrix:new e.bK(t),u_normalize_matrix:new e.bK(t),u_globe_matrix:new e.bK(t),u_merc_matrix:new e.bK(t),u_grid_matrix:new e.cb(t),u_tl_parent:new e.bL(t),u_scale_parent:new e.bN(t),u_fade_t:new e.bN(t),u_opacity:new e.bN(t),u_image0:new e.bO(t),u_image1:new e.bO(t),u_raster_elevation:new e.bN(t),u_zoom_transition:new e.bN(t),u_merc_center:new e.bL(t),u_cutoff_params:new e.bP(t)}),rasterParticleTexture:t=>({u_texture:new e.bO(t),u_opacity:new e.bN(t)}),rasterParticleDraw:t=>({u_tile_offset:new e.bL(t),u_velocity:new e.bO(t),u_color_ramp:new e.bO(t),u_velocity_res:new e.bL(t),u_max_speed:new e.bN(t),u_texture_offset:new e.bL(t),u_data_scale:new e.bP(t),u_data_offset:new e.bN(t)}),rasterParticleUpdate:t=>({u_velocity:new e.bO(t),u_velocity_res:new e.bL(t),u_max_speed:new e.bN(t),u_speed_factor:new e.bN(t),u_lifetime_delta:new e.bN(t),u_rand_seed:new e.bN(t),u_texture_offset:new e.bL(t),u_data_scale:new e.bP(t),u_data_offset:new e.bN(t)}),symbolIcon:t=>({u_is_size_zoom_constant:new e.bO(t),u_is_size_feature_constant:new e.bO(t),u_size_t:new e.bN(t),u_size:new e.bN(t),u_camera_to_center_distance:new e.bN(t),u_rotate_symbol:new e.bO(t),u_aspect_ratio:new e.bN(t),u_fade_change:new e.bN(t),u_matrix:new e.bK(t),u_label_plane_matrix:new e.bK(t),u_coord_matrix:new e.bK(t),u_is_text:new e.bO(t),u_pitch_with_map:new e.bO(t),u_texsize:new e.bL(t),u_tile_id:new e.bM(t),u_zoom_transition:new e.bN(t),u_inv_rot_matrix:new e.bK(t),u_merc_center:new e.bL(t),u_camera_forward:new e.bM(t),u_tile_matrix:new e.bK(t),u_up_vector:new e.bM(t),u_ecef_origin:new e.bM(t),u_texture:new e.bO(t),u_icon_transition:new e.bN(t),u_icon_saturation:new e.bN(t)}),symbolSDF:t=>({u_is_size_zoom_constant:new e.bO(t),u_is_size_feature_constant:new e.bO(t),u_size_t:new e.bN(t),u_size:new e.bN(t),u_camera_to_center_distance:new e.bN(t),u_rotate_symbol:new e.bO(t),u_aspect_ratio:new e.bN(t),u_fade_change:new e.bN(t),u_matrix:new e.bK(t),u_label_plane_matrix:new e.bK(t),u_coord_matrix:new e.bK(t),u_is_text:new e.bO(t),u_pitch_with_map:new e.bO(t),u_texsize:new e.bL(t),u_texture:new e.bO(t),u_gamma_scale:new e.bN(t),u_device_pixel_ratio:new e.bN(t),u_tile_id:new e.bM(t),u_zoom_transition:new e.bN(t),u_inv_rot_matrix:new e.bK(t),u_merc_center:new e.bL(t),u_camera_forward:new e.bM(t),u_tile_matrix:new e.bK(t),u_up_vector:new e.bM(t),u_ecef_origin:new e.bM(t),u_is_halo:new e.bO(t)}),symbolTextAndIcon:t=>({u_is_size_zoom_constant:new e.bO(t),u_is_size_feature_constant:new e.bO(t),u_size_t:new e.bN(t),u_size:new e.bN(t),u_camera_to_center_distance:new e.bN(t),u_rotate_symbol:new e.bO(t),u_aspect_ratio:new e.bN(t),u_fade_change:new e.bN(t),u_matrix:new e.bK(t),u_label_plane_matrix:new e.bK(t),u_coord_matrix:new e.bK(t),u_is_text:new e.bO(t),u_pitch_with_map:new e.bO(t),u_texsize:new e.bL(t),u_texsize_icon:new e.bL(t),u_texture:new e.bO(t),u_texture_icon:new e.bO(t),u_gamma_scale:new e.bN(t),u_device_pixel_ratio:new e.bN(t),u_is_halo:new e.bO(t)}),background:t=>({u_matrix:new e.bK(t),u_emissive_strength:new e.bN(t),u_opacity:new e.bN(t),u_color:new e.ca(t)}),backgroundPattern:t=>({u_matrix:new e.bK(t),u_emissive_strength:new e.bN(t),u_opacity:new e.bN(t),u_image:new e.bO(t),u_pattern_tl:new e.bL(t),u_pattern_br:new e.bL(t),u_texsize:new e.bL(t),u_pattern_size:new e.bL(t),u_pixel_coord_upper:new e.bL(t),u_pixel_coord_lower:new e.bL(t),u_tile_units_to_pixels:new e.bN(t)}),terrainRaster:nn,terrainDepth:nn,skybox:t=>({u_matrix:new e.bK(t),u_sun_direction:new e.bM(t),u_cubemap:new e.bO(t),u_opacity:new e.bN(t),u_temporal_offset:new e.bN(t)}),skyboxGradient:t=>({u_matrix:new e.bK(t),u_color_ramp:new e.bO(t),u_center_direction:new e.bM(t),u_radius:new e.bN(t),u_opacity:new e.bN(t),u_temporal_offset:new e.bN(t)}),skyboxCapture:t=>({u_matrix_3f:new e.cb(t),u_sun_direction:new e.bM(t),u_sun_intensity:new e.bN(t),u_color_tint_r:new e.bP(t),u_color_tint_m:new e.bP(t),u_luminance:new e.bN(t)}),globeRaster:t=>({u_proj_matrix:new e.bK(t),u_globe_matrix:new e.bK(t),u_normalize_matrix:new e.bK(t),u_merc_matrix:new e.bK(t),u_zoom_transition:new e.bN(t),u_merc_center:new e.bL(t),u_image0:new e.bO(t),u_grid_matrix:new e.cb(t),u_skirt_height:new e.bN(t),u_far_z_cutoff:new e.bN(t),u_frustum_tl:new e.bM(t),u_frustum_tr:new e.bM(t),u_frustum_br:new e.bM(t),u_frustum_bl:new e.bM(t),u_globe_pos:new e.bM(t),u_globe_radius:new e.bN(t),u_viewport:new e.bL(t)}),globeAtmosphere:t=>({u_frustum_tl:new e.bM(t),u_frustum_tr:new e.bM(t),u_frustum_br:new e.bM(t),u_frustum_bl:new e.bM(t),u_horizon:new e.bN(t),u_transition:new e.bN(t),u_fadeout_range:new e.bN(t),u_color:new e.bP(t),u_high_color:new e.bP(t),u_space_color:new e.bP(t),u_temporal_offset:new e.bN(t),u_horizon_angle:new e.bN(t)}),model:t=>({u_matrix:new e.bK(t),u_lighting_matrix:new e.bK(t),u_normal_matrix:new e.bK(t),u_lightpos:new e.bM(t),u_lightintensity:new e.bN(t),u_lightcolor:new e.bM(t),u_camera_pos:new e.bM(t),u_opacity:new e.bN(t),u_baseColorFactor:new e.bP(t),u_emissiveFactor:new e.bP(t),u_metallicFactor:new e.bN(t),u_roughnessFactor:new e.bN(t),u_baseTextureIsAlpha:new e.bO(t),u_alphaMask:new e.bO(t),u_alphaCutoff:new e.bN(t),u_baseColorTexture:new e.bO(t),u_metallicRoughnessTexture:new e.bO(t),u_normalTexture:new e.bO(t),u_occlusionTexture:new e.bO(t),u_emissionTexture:new e.bO(t),u_color_mix:new e.bP(t),u_aoIntensity:new e.bN(t),u_emissive_strength:new e.bN(t),u_occlusionTextureTransform:new e.bP(t)}),modelDepth:t=>({u_matrix:new e.bK(t),u_instance:new e.bK(t),u_node_matrix:new e.bK(t)}),groundShadow:t=>({u_matrix:new e.bK(t),u_ground_shadow_factor:new e.bM(t)}),stars:t=>({u_matrix:new e.bK(t),u_up:new e.bM(t),u_right:new e.bM(t),u_intensity_multiplier:new e.bN(t)})};let Jn;function Qn(t,r,i,n,o,s,a){const l=t.context,c=l.gl,u=t.transform,h=t.getOrCreateProgram("collisionBox"),d=[];let p=0,f=0;for(let b=0;b<n.length;b++){const l=n[b],m=r.getTile(l),_=m.getBucket(i);if(!_)continue;const g=Dr(l,_,u);let y=g;0===o[0]&&0===o[1]||(y=t.translatePosMatrix(g,m,o,s));const x=a?_.textCollisionBox:_.iconCollisionBox,v=_.collisionCircleArray;if(v.length>0){const t=e.a6.create(),r=y;e.a6.mul(t,_.placementInvProjMatrix,u.glCoordMatrix),e.a6.mul(t,t,_.placementViewportMatrix),d.push({circleArray:v,circleOffset:f,transform:r,invTransform:t,projection:_.getProjection()}),p+=v.length/4,f=p}x&&(t.terrain&&t.terrain.setupElevationDraw(m,h),h.draw(t,c.LINES,Ct.disabled,Lt.disabled,t.colorModeForRenderPass(),kt.disabled,Ln(y,u,m,_.getProjection()),i.id,x.layoutVertexBuffer,x.indexBuffer,x.segments,null,u.zoom,null,[x.collisionVertexBuffer,x.collisionVertexBufferExt]))}if(!a||!d.length)return;const m=t.getOrCreateProgram("collisionCircle"),_=new e.cv;_.resize(4*p),_._trim();let g=0;for(const e of d)for(let t=0;t<e.circleArray.length/4;t++){const r=4*t,i=e.circleArray[r+0],n=e.circleArray[r+1],o=e.circleArray[r+2],s=e.circleArray[r+3];_.emplace(g++,i,n,o,s,0),_.emplace(g++,i,n,o,s,1),_.emplace(g++,i,n,o,s,2),_.emplace(g++,i,n,o,s,3)}(!Jn||Jn.length<2*p)&&(Jn=function(t){const r=2*t,i=new e.aw;i.resize(r),i._trim();for(let e=0;e<r;e++){const t=6*e;i.uint16[t+0]=4*e+0,i.uint16[t+1]=4*e+1,i.uint16[t+2]=4*e+2,i.uint16[t+3]=4*e+2,i.uint16[t+4]=4*e+3,i.uint16[t+5]=4*e+0}return i}(p));const y=l.createIndexBuffer(Jn,!0),x=l.createVertexBuffer(_,e.cw.members,!0);for(const b of d){const r={u_matrix:b.transform,u_inv_matrix:b.invTransform,u_camera_to_center_distance:(v=u).getCameraToCenterDistance(b.projection),u_viewport_size:[v.width,v.height]};m.draw(t,c.TRIANGLES,Ct.disabled,Lt.disabled,t.colorModeForRenderPass(),kt.disabled,r,i.id,x,y,e.aB.simpleSegment(0,2*b.circleOffset,b.circleArray.length,b.circleArray.length/2),null,u.zoom)}var v;x.destroy(),y.destroy()}const eo=e.a6.create();function to(t){const r=t._camera.getWorldToCamera(t.worldSize,1),i=e.a6.multiply([],r,t.globeMatrix);e.a6.invert(i,i);const n=[0,0,0],o=[0,1,0,0];return e.a7.transformMat4(o,o,i),n[0]=o[0],n[1]=o[1],n[2]=o[2],e.N.normalize(n,n),n}function ro({width:t,height:r,anchor:i,textOffset:n,textScale:o},s){const{horizontalAlign:a,verticalAlign:l}=e.bf(i),c=-(a-.5)*t,u=-(l-.5)*r,h=e.bd(i,n);return new e.P((c/o+h[0])*s,(u/o+h[1])*s)}function io(t,r,i,n,o,s,a,l,c,u,h){const d=t.text.placedSymbolArray,p=t.text.dynamicLayoutVertexArray,f=t.icon.dynamicLayoutVertexArray,m={},_=t.getProjection(),g=Or(l,_,s),y=s.elevation,x=_.upVectorScale(l.canonical,s.center.lat,s.worldSize).metersToTile;p.clear();for(let v=0;v<d.length;v++){const f=d.get(v),{tileAnchorX:b,tileAnchorY:w,numGlyphs:T}=f,E=f.hidden||!f.crossTileID||t.allowVerticalPlacement&&!f.placedOrientation?null:n[f.crossTileID];if(E){let n=0,d=0,v=0;if(y){const e=y?y.getAtTileOffset(l,b,w):0,[t,r,i]=_.upVector(l.canonical,b,w);n=e*t*x,d=e*r*x,v=e*i*x}let[S,M,A,I]=yr(f.projectedAnchorX+n,f.projectedAnchorY+d,f.projectedAnchorZ+v,i?g:a);const C=xr(s.getCameraToCenterDistance(_),I);let P=o.evaluateSizeForFeature(t.textSizeData,u,f)*C/e.bc;i&&(P*=t.tilePixelRatio/c);const L=ro(E,P);i?(({x:S,y:M,z:A}=_.projectTilePoint(b+L.x,w+L.y,l.canonical)),[S,M,A]=yr(S+n,M+d,A+v,a)):(r&&L._rotate(-s.angle),S+=L.x,M+=L.y,A=0);const R=t.allowVerticalPlacement&&f.placedOrientation===e.b6.vertical?Math.PI/2:0;for(let t=0;t<T;t++)e.b9(p,S,M,A,R);h&&f.associatedIconIndex>=0&&(m[f.associatedIconIndex]={x:S,y:M,z:A,angle:R})}else Ir(T,p)}if(h){f.clear();const r=t.icon.placedSymbolArray;for(let t=0;t<r.length;t++){const i=r.get(t),{numGlyphs:n}=i,o=m[t];if(i.hidden||!o)Ir(n,f);else{const{x:t,y:r,z:i,angle:s}=o;for(let o=0;o<n;o++)e.b9(f,t,r,i,s)}}t.icon.dynamicLayoutVertexBuffer.updateData(f)}t.text.dynamicLayoutVertexBuffer.updateData(p)}function no(t,r,i,n,o,s,a={}){const l=i.paint.get("icon-translate"),c=i.paint.get("text-translate"),u=i.paint.get("icon-translate-anchor"),h=i.paint.get("text-translate-anchor"),d=i.layout.get("icon-rotation-alignment"),p=i.layout.get("text-rotation-alignment"),f=i.layout.get("icon-pitch-alignment"),m=i.layout.get("text-pitch-alignment"),_=i.layout.get("icon-keep-upright"),g=i.layout.get("text-keep-upright"),y=i.paint.get("icon-color-saturation"),x=t.context,v=x.gl,b=t.transform,w="map"===d,T="map"===p,E="map"===f,S="map"===m,M=void 0!==i.layout.get("symbol-sort-key").constantOr(1);let A=!1;const I=t.depthModeForSublayer(0,Ct.ReadOnly),C=[e.a5(b.center.lng),e.ae(b.center.lat)],P=i.layout.get("text-variable-anchor"),L="globe"===b.projection.name,R=[],D=[0,-1,0];for(const O of n){const n=r.getTile(O),o=n.getBucket(i);if(!o)continue;if("mercator"===o.projection.name&&L)continue;if(o.fullyClipped)continue;const s="globe"===o.projection.name,d=s?e.S(b.zoom):0,p=Or(O,o.getProjection(),b),f=b.calculatePixelsToTileUnitsMatrix(n),m=P&&o.hasTextData(),x=o.hasIconTextFit()&&m&&o.hasIconData(),I=o.getProjection().createInversionMatrix(b,O.canonical),z=()=>{const r=w&&"point"!==i.layout.get("symbol-placement"),a=[],c=r||x,h=i.paint.get("icon-image-cross-fade").constantOr(0);t.terrainRenderModeElevated()&&E&&a.push("PITCH_WITH_MAP_TERRAIN"),s&&(a.push("PROJECTION_GLOBE_VIEW"),c&&a.push("PROJECTED_POS_ON_VIEWPORT")),h>0&&a.push("ICON_TRANSITION"),o.icon.zOffsetVertexBuffer&&a.push("Z_OFFSET"),y<1&&a.push("SATURATION");const m=o.icon.programConfigurations.get(i.id),g=t.getOrCreateProgram(o.sdfIcons?"symbolSDF":"symbolIcon",{config:m,defines:a});let T;const S=n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],M=o.iconSizeData,A=e.b5(M,b.zoom),P=E||0!==b.pitch,R=mr(p,n.tileID.canonical,E,w,b,o.getProjection(),f),z=gr(p,n.tileID.canonical,E,w,b,o.getProjection(),f),k=t.translatePosMatrix(z,n,l,u,!0),F=t.translatePosMatrix(p,n,l,u),B=c?eo:R,N=w&&!E&&!r;let U=D;!L&&!b.mercatorFromTransition||w||(U=to(b));const V=s?U:D;T=o.sdfIcons&&!o.iconsInText?$n(M.kind,A,N,E,t,F,B,k,!1,S,!0,O,d,C,I,V,o.getProjection()):Gn(M.kind,A,N,E,t,F,B,k,!1,S,O,d,C,I,V,o.getProjection(),y,h);const j=n.imageAtlasTexture?n.imageAtlasTexture:null,G=1!==i.layout.get("icon-size").constantOr(0)||o.iconsNeedLinear,$=o.sdfIcons||t.options.rotating||t.options.zooming||G||P?v.LINEAR:v.NEAREST,q=o.sdfIcons&&0!==i.paint.get("icon-halo-width").constantOr(1),Z=t.terrain&&E&&r?e.a6.invert(e.a6.create(),R):eo;if(r&&o.icon){const e=b.elevation,r=e?e.getAtTileOffsetFunc(O,b.center.lat,b.worldSize,o.getProjection()):null,i=_r(p,n.tileID.canonical,E,w,b,o.getProjection(),f);br(o,p,t,!1,i,z,E,_,r,O)}return{program:g,buffers:o.icon,uniformValues:T,atlasTexture:j,atlasTextureIcon:null,atlasInterpolation:$,atlasInterpolationIcon:null,isSDF:o.sdfIcons,hasHalo:q,tile:n,labelPlaneMatrixInv:Z}},k=()=>{const r=T&&"point"!==i.layout.get("symbol-placement"),a=[],l=r||P||x;t.terrainRenderModeElevated()&&S&&a.push("PITCH_WITH_MAP_TERRAIN"),s&&(a.push("PROJECTION_GLOBE_VIEW"),l&&a.push("PROJECTED_POS_ON_VIEWPORT")),o.text.zOffsetVertexBuffer&&a.push("Z_OFFSET");const u=o.text.programConfigurations.get(i.id),m=t.getOrCreateProgram(o.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:u,defines:a});let _,y=[0,0],w=null;const E=o.textSizeData;o.iconsInText&&(y=n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],w=n.imageAtlasTexture?n.imageAtlasTexture:null,_=S||0!==b.pitch||t.options.rotating||t.options.zooming||"composite"===E.kind||"camera"===E.kind?v.LINEAR:v.NEAREST);const M=n.glyphAtlasTexture?n.glyphAtlasTexture.size:[0,0],A=e.b5(E,b.zoom),R=mr(p,n.tileID.canonical,S,T,b,o.getProjection(),f),z=gr(p,n.tileID.canonical,S,T,b,o.getProjection(),f),k=t.translatePosMatrix(z,n,c,h,!0),F=t.translatePosMatrix(p,n,c,h),B=l?eo:R,N=T&&!S&&!r;let U=D;!L&&!b.mercatorFromTransition||T||(U=to(b));const V=s?U:D;let j;j=o.iconsInText?qn(E.kind,A,N,S,t,F,B,k,M,y,O,d,C,I,V,o.getProjection()):$n(E.kind,A,N,S,t,F,B,k,!0,M,!0,O,d,C,I,V,o.getProjection());const G=n.glyphAtlasTexture?n.glyphAtlasTexture:null,$=v.LINEAR,q=0!==i.paint.get("text-halo-width").constantOr(1),Z=t.terrain&&S&&r?e.a6.invert(e.a6.create(),R):eo;if(r&&o.text){const e=b.elevation,r=e?e.getAtTileOffsetFunc(O,b.center.lat,b.worldSize,o.getProjection()):null,i=_r(p,n.tileID.canonical,S,T,b,o.getProjection(),f);br(o,p,t,!0,i,z,S,g,r,O)}return{program:m,buffers:o.text,uniformValues:j,atlasTexture:G,atlasTextureIcon:w,atlasInterpolation:$,atlasInterpolationIcon:_,isSDF:!0,hasHalo:q,tile:n,labelPlaneMatrixInv:Z}},F=o.icon.segments.get().length,B=o.text.segments.get().length,N=F&&!a.onlyText?z():null,U=B&&!a.onlyIcons?k():null,V=i.paint.get("icon-opacity").constantOr(1),j=i.paint.get("text-opacity").constantOr(1);if(M&&o.canOverlap){A=!0;const t=V&&!a.onlyText?o.icon.segments.get():[],r=j&&!a.onlyIcons?o.text.segments.get():[];for(const i of t)R.push({segments:new e.aB([i]),sortKey:i.sortKey,state:N});for(const i of r)R.push({segments:new e.aB([i]),sortKey:i.sortKey,state:U})}else a.onlyText||R.push({segments:V?o.icon.segments:new e.aB([]),sortKey:0,state:N}),a.onlyIcons||R.push({segments:j?o.text.segments:new e.aB([]),sortKey:0,state:U})}A&&R.sort(((e,t)=>e.sortKey-t.sortKey));for(const e of R){const r=e.state;if(r)if(t.terrain&&t.terrain.setupElevationDraw(r.tile,r.program,{useDepthForOcclusion:b.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:r.labelPlaneMatrixInv}),x.activeTexture.set(v.TEXTURE0),r.atlasTexture&&r.atlasTexture.bind(r.atlasInterpolation,v.CLAMP_TO_EDGE,!0),r.atlasTextureIcon&&(x.activeTexture.set(v.TEXTURE1),r.atlasTextureIcon&&r.atlasTextureIcon.bind(r.atlasInterpolationIcon,v.CLAMP_TO_EDGE,!0)),t.uploadCommonLightUniforms(t.context,r.program),r.hasHalo){const n=r.uniformValues;n.u_is_halo=1,oo(r.buffers,e.segments,i,t,r.program,I,o,s,n,2),n.u_is_halo=0}else{if(r.isSDF){const n=r.uniformValues;r.hasHalo&&(n.u_is_halo=1,oo(r.buffers,e.segments,i,t,r.program,I,o,s,n,1)),n.u_is_halo=0}oo(r.buffers,e.segments,i,t,r.program,I,o,s,r.uniformValues,1)}}}function oo(e,t,r,i,n,o,s,a,l,c){const u=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer];n.draw(i,i.context.gl.TRIANGLES,o,s,a,kt.disabled,l,r.id,e.layoutVertexBuffer,e.indexBuffer,t,r.paint,i.transform.zoom,e.programConfigurations.get(r.id),u,c)}function so(e,t,r,i,n,o,s){const a=e.context.gl,l=r.paint.get("fill-pattern"),c=l&&l.constantOr(1);let u,h,d,p,f;s?(h=c&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",u=a.LINES):(h=c?"fillPattern":"fill",u=a.TRIANGLES);for(const m of i){const i=t.getTile(m);if(c&&!i.patternsLoaded())continue;const _=i.getBucket(r);if(!_)continue;e.prepareDrawTile();const g=_.programConfigurations.get(r.id),y=e.isTileAffectedByFog(m),x=e.getOrCreateProgram(h,{config:g,overrideFog:y});c&&(e.context.activeTexture.set(a.TEXTURE0),i.imageAtlasTexture&&i.imageAtlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),g.updatePaintBuffers());const v=l.constantOr(null);if(v&&i.imageAtlas){const e=i.imageAtlas.patternPositions[v.toString()];e&&g.setConstantPatternPositions(e)}const b=e.translatePosMatrix(m.projMatrix,i,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor")),w=r.paint.get("fill-emissive-strength");if(s){p=_.indexBuffer2,f=_.segments2;const t=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[a.drawingBufferWidth,a.drawingBufferHeight];d="fillOutlinePattern"===h&&c?Pn(b,w,e,i,t):Cn(b,w,t)}else p=_.indexBuffer,f=_.segments,d=c?In(b,w,e,i):An(b,w);e.uploadCommonUniforms(e.context,x,m.toUnwrapped()),x.draw(e,u,n,e.stencilModeForClipping(m),o,kt.disabled,d,r.id,_.layoutVertexBuffer,p,f,r.paint,e.transform.zoom,g,void 0)}}function ao(t,r,i,n,o,s,a,l){i.resetLayerRenderingStats(t);const c=t.context,u=c.gl,h=t.transform,d=i.paint.get("fill-extrusion-pattern"),p=d.constantOr(1),f=i.paint.get("fill-extrusion-opacity"),m=t.style.enable3dLights(),_=i.paint.get(m&&!p?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),g=[i.paint.get("fill-extrusion-ambient-occlusion-intensity"),_],y=i.layout.get("fill-extrusion-edge-radius"),x=y>0&&!i.paint.get("fill-extrusion-rounded-roof"),v=x?0:y,b="globe"===h.projection.name?e.cF():0,w="globe"===h.projection.name,T=w?e.S(h.zoom):0,E=[e.a5(h.center.lng),e.ae(h.center.lat)],S=i.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),M=i.paint.get("fill-extrusion-flood-light-intensity"),A=i.paint.get("fill-extrusion-vertical-scale"),I=gi(t,i.paint.get("fill-extrusion-cutoff-fade-range")),C=i.paint.get("fill-extrusion-emissive-strength"),P=[];let L;w&&P.push("PROJECTION_GLOBE_VIEW"),g[0]>0&&P.push("FAUX_AO"),x&&P.push("ZERO_ROOF_RADIUS"),l&&P.push("HAS_CENTROID"),M>0&&P.push("FLOOD_LIGHT"),I.shouldRenderCutoff&&P.push("RENDER_CUTOFF");const R="shadow"===t.renderPass,D=t.shadowRenderer,O=R&&!!D;t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0);let z=[0,0,0];if(D){const e=t.style.directionalLight,r=t.style.ambientLight;e&&r&&(z=Ei(e,r)),L=P.concat(["SHADOWS_SINGLE_CASCADE"])}const k=O?"fillExtrusionDepth":p?"fillExtrusionPattern":"fillExtrusion",F=i.getLayerRenderingStats();for(const e of n){const n=r.getTile(e),m=n.getBucket(i);if(!m||m.projection.name!==h.projection.name)continue;let _=!1;D&&(_=0===D.getMaxCascadeForTile(e.toUnwrapped()));const y=t.isTileAffectedByFog(e),x=m.programConfigurations.get(i.id),O=t.getOrCreateProgram(k,{config:x,defines:_?L:P,overrideFog:y});if(t.terrain&&t.terrain.setupElevationDraw(n,O,{useMeterToDem:!0}),!m.centroidVertexBuffer){const e=O.attributes.a_centroid_pos;void 0!==e&&u.vertexAttrib2f(e,0,0)}!R&&D&&D.setupShadows(n.tileID.toUnwrapped(),O,"vector-tile",n.tileID.overscaledZ),p&&(t.context.activeTexture.set(u.TEXTURE0),n.imageAtlasTexture&&n.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),x.updatePaintBuffers());const B=d.constantOr(null);if(B&&n.imageAtlas){const e=n.imageAtlas.patternPositions[B.toString()];e&&x.setConstantPatternPositions(e)}const N=i.paint.get("fill-extrusion-vertical-gradient");let U;if(R&&D){if(fo(n.tileID,m,t))continue;const e=D.calculateShadowPassMatrixFromTile(n.tileID.toUnwrapped());U=Sn(e,v,A)}else{const r=t.translatePosMatrix(e.expandedProjMatrix,n,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),o=h.projection.createInversionMatrix(h,e.canonical);U=p?Mn(r,t,N,f,g,v,e,n,b,T,E,o,S,A):En(r,t,N,f,g,v,e,b,T,E,o,S,A,M,z,C)}t.uploadCommonUniforms(c,O,e.toUnwrapped(),null,I);let V=m.segments;if("mercator"===h.projection.name&&!R&&(V=m.getVisibleSegments(n.tileID,t.terrain,t.transform.getFrustum(0)),!V.get().length))continue;if(F)if(R)for(const e of V.get())F.numRenderedVerticesInShadowPass+=e.primitiveLength;else for(const e of V.get())F.numRenderedVerticesInTransparentPass+=e.primitiveLength;const j=[];(t.terrain||l)&&j.push(m.centroidVertexBuffer),w&&j.push(m.layoutVertexExtBuffer),O.draw(t,c.gl.TRIANGLES,o,s,a,kt.backCCW,U,i.id,m.layoutVertexBuffer,m.indexBuffer,V,i.paint,t.transform.zoom,x,j)}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1)}function lo(t,r,i,n,o,s,a,l,c,u,h,d,p,f,m,_,g,y,x){const v=t.context,b=v.gl,w=t.transform,T=t.transform.zoom,E=[],S=gi(t,i.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===u?(E.push("CLEAR_SUBPASS"),x&&(E.push("CLEAR_FROM_TEXTURE"),v.activeTexture.set(b.TEXTURE0),x.bind(b.LINEAR,b.CLAMP_TO_EDGE))):"sdf"===u&&E.push("SDF_SUBPASS"),g&&E.push("HAS_CENTROID"),S.shouldRenderCutoff&&E.push("RENDER_CUTOFF");const M=i.layout.get("fill-extrusion-edge-radius"),A=(e,r,n,u,y)=>{const b=r.programConfigurations.get(i.id),w=t.isTileAffectedByFog(e),A=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:b,defines:E,overrideFog:w}),I=((e,t,r,i,n,o,s,a,l,c,u)=>({u_matrix:t,u_opacity:r,u_ao_pass:i?1:0,u_meter_to_tile:n,u_ao:o,u_flood_light_intensity:s,u_flood_light_color:a,u_attenuation:l,u_edge_radius:c,u_fb:0,u_fb_size:u}))(0,u,h,c,y,[d,p*y],f,m,_,T>=17?0:M*y,x?x.size[0]:0),C=[];g&&C.push(r.hiddenByLandmarkVertexBuffer),t.uploadCommonUniforms(v,A,e.toUnwrapped(),null,S),A.draw(t,v.gl.TRIANGLES,o,s,a,l,I,i.id,r.vertexBuffer,r.indexBuffer,n,i.paint,T,b,C)};for(const I of n){const n=r.getTile(I),o=n.getBucket(i);if(!o||o.projection.name!==w.projection.name||!o.groundEffect||o.groundEffect&&!o.groundEffect.hasData())continue;const s=o.groundEffect,a=1/o.tileToMeter;{const e=t.translatePosMatrix(I.projMatrix,n,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),r=s.getDefaultSegment();A(I,s,r,e,a)}if(y)for(let l=0;l<4;l++){const o=e.cG[l](I),s=r.getTile(o);if(!s)continue;const c=s.getBucket(i);if(!c||c.projection.name!==w.projection.name||!c.groundEffect||c.groundEffect&&!c.groundEffect.hasData())continue;const u=c.groundEffect;let h,d;0===l?(h=[-e.V,0,0],d=1):1===l?(h=[e.V,0,0],d=0):2===l?(h=[0,-e.V,0],d=3):(h=[0,e.V,0],d=2);const p=u.regionSegments[d];if(!p)continue;const f=new Float32Array(16);e.a6.translate(f,I.projMatrix,h),A(I,u,p,t.translatePosMatrix(f,n,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),a)}}}function co(t,r,i,n,o,s,a){0===n.centroidVertexArray.length&&n.createCentroidsBuffer();const l=s?s.findDEMTileFor(i):null;if(!(l&&l.dem||a))return;const c=t=>new e.P(Math.ceil((t+e.cJ)*e.cK),0),u=e=>{const t=r.getSource().minzoom,i=e=>{const t=r.getTileByID(e);if(t&&t.hasData())return t.getBucket(o)},n=[0,-1,1];for(const r of n){if(e.overscaledZ+r<t)continue;const n=i(e.calculateScaledKey(e.overscaledZ+r));if(n)return n}},h=[0,0,0],d=(t,r)=>(h[0]=Math.min(t.min.y,r.min.y),h[1]=Math.max(t.max.y,r.max.y),h[2]=e.V-r.min.x>t.max.x?r.min.x-e.V:t.max.x,h),p=(t,r)=>(h[0]=Math.min(t.min.x,r.min.x),h[1]=Math.max(t.max.x,r.max.x),h[2]=e.V-r.min.y>t.max.y?r.min.y-e.V:t.max.y,h),f=[(e,t)=>d(e,t),(e,t)=>d(t,e),(e,t)=>p(e,t),(e,t)=>p(t,e)],m=(t,r,n,o,a,c,u)=>{if(!s)return 0;const h=[[c?n:t,c?t:n,0],[c?n:r,c?r:n,0]],d=u<0?e.V+u:u,p=[c?d:(t+r)/2,c?(t+r)/2:d,0];return 0===n&&u<0||0!==n&&u>0?s.getForTilePoints(a,[p],!0,o):h.push(p),s.getForTilePoints(i,h,!0,l),Math.max(h[0][2],h[1][2],p[2])/s.exaggeration()};for(let y=0;y<4;y++){const t=n.borderFeatureIndices[y];if(0===t.length)continue;const r=e.cG[y](i),o=u(r);if(!(o&&o instanceof e.cH))continue;if(n.borderDoneWithNeighborZ[y]===o.canonical.z)continue;0===o.centroidVertexArray.length&&o.createCentroidsBuffer();const l=s?s.findDEMTileFor(r):null;if(!(l&&l.dem||a))continue;const h=(y<2?1:5)-y,d=o.borderDoneWithNeighborZ[h]!==n.canonical.z,p=o.borderFeatureIndices[h];let x=0;if(n.canonical.z!==o.canonical.z){for(const e of t)n.showCentroid(n.featuresOnBorder[e]);if(d)for(const e of p)o.showCentroid(o.featuresOnBorder[e]);n.borderDoneWithNeighborZ[y]=o.canonical.z,o.borderDoneWithNeighborZ[h]=n.canonical.z}for(const i of t){const t=n.featuresOnBorder[i],s=n.centroidData[t.centroidDataIndex],u=t.borders[y];let d;for(;x<p.length;){d=o.featuresOnBorder[p[x]];const e=d.borders[h];if(e[1]>u[0]+3||e[0]>u[0]-3)break;o.showCentroid(d),x++}if(d&&x<p.length){const i=x;let v=0;for(;!(d.borders[h][0]>u[1]-3)&&(v++,++x!==p.length);)d=o.featuresOnBorder[p[x]];if(d=o.featuresOnBorder[p[i]],v>1){const e=d.borders[h];Math.abs(u[0]-e[0])<3&&Math.abs(u[1]-e[1])<3&&(v=1,x=i+1)}else if(0===v){n.showCentroid(t);continue}const b=o.centroidData[d.centroidDataIndex];a&&1===v&&(((_=s).flags|(g=b).flags)&e.cI?(_.flags|=e.cI,g.flags|=e.cI):(_.flags&=~e.cI,g.flags&=~e.cI));const w=t.intersectsCount()>1||d.intersectsCount()>1;if(v>1)x=i,s.centroidXY=b.centroidXY=new e.P(0,0);else if(l&&l.dem&&!w){const t=f[y](s,b),i=y%2?e.V-1:0,n=m(t[0],Math.min(e.V-1,t[1]),i,l,r,y<2,t[2]);s.centroidXY=b.centroidXY=c(n)}else w?s.centroidXY=b.centroidXY=new e.P(0,0):(s.centroidXY=n.encodeBorderCentroid(t),b.centroidXY=o.encodeBorderCentroid(d));n.writeCentroidToBuffer(s),o.writeCentroidToBuffer(b)}else n.showCentroid(t)}n.borderDoneWithNeighborZ[y]=o.canonical.z,o.borderDoneWithNeighborZ[h]=n.canonical.z}var _,g;(n.needsCentroidUpdate||!n.centroidVertexBuffer&&0!==n.centroidVertexArray.length)&&n.uploadCentroid(t)}const uo=[1,0,0],ho=[0,1,0],po=[0,0,1];function fo(t,r,i){const n=i.transform,o=i.shadowRenderer;if(!o)return!0;const s=t.toUnwrapped(),a=n.tileSize*o._cascades[i.currentShadowCascade].scale;let l=r.maxHeight;if(n.elevation){const e=n.elevation.getMinMaxForTile(t);e&&(l+=e.max)}const c=[...o.shadowDirection];c[2]=-c[2];const u=o.computeSimplifiedTileShadowVolume(s,l,a,c);if(!u)return!1;const h=[uo,ho,po,c,[c[0],0,c[2]],[0,c[1],c[2]]],d="globe"===n.projection.name,p=n.scaleZoom(a),f=e.bq.fromInvProjectionMatrix(n.invProjMatrix,n.worldSize,p,!d),m=o.getCurrentCascadeFrustum();return 0===f.intersectsPrecise(u.vertices,u.planes,h)||0===m.intersectsPrecise(u.vertices,u.planes,h)}function mo(t){return[t[0]*e.cL,t[1]*e.cL,t[2]*e.cL,0]}function _o(t,r,i,n,o,s,a,l,c){const u=n.getSource(),h=i.globeSharedBuffers;if(!h)return;let d,p,f;if(r&&(d=n.getTile(r)),u instanceof e.ap?(p=u.texture,f=e.cj(0,0,i.transform)):d&&r&&(p=d.texture,f=e.cj(r.canonical.z,r.canonical.x,i.transform)),!p||!f)return;t||(f=e.a6.scale(e.a6.create(),f,[1,-1,1]));const m=i.context,_=m.gl,g="nearest"===o.paint.get("raster-resampling")?_.NEAREST:_.LINEAR,y=i.colorModeForDrapableLayerRenderPass(s),x=a.defines;x.push("GLOBE_POLES");const v=new Ct(_.LEQUAL,Ct.ReadWrite,i.depthRangeFor3D),b=Float32Array.from(i.transform.expandedFarZProjMatrix),w=Float32Array.from(e.aT(e.ci(new e.bs(0,0,0))));i.terrain&&i.terrain.prepareDrawTile(),m.activeTexture.set(_.TEXTURE0),p.bind(g,_.CLAMP_TO_EDGE),m.activeTexture.set(_.TEXTURE1),p.bind(g,_.CLAMP_TO_EDGE),p.useMipmap&&m.extTextureFilterAnisotropic&&i.transform.pitch>20&&_.texParameterf(_.TEXTURE_2D,m.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,m.extTextureFilterAnisotropicMax);const[T,E,S,M]=r?h.getPoleBuffers(r.canonical.z,!1):h.getPoleBuffers(0,!0),A=o.paint.get("raster-elevation");let I;t?(I=T,i.renderDefaultNorthPole=0!==A):(I=E,i.renderDefaultSouthPole=0!==A);const C=mo(a.mix),P=((e,t,r,i,n,o,s,a,l,c,u,h,d)=>Fn(e,t,r,new Float32Array(16),new Float32Array(9),[0,0],i,[0,0],[0,0,0,0],1,{opacity:1,mix:0},o,[0,0]||0,a,2,c,u,h,1,0,d))(b,w,f,e.S(i.transform.zoom),0,o,0,A,0,C,a.offset,a.range,s),L=i.getOrCreateProgram("raster",{defines:x});i.uploadCommonUniforms(m,L,null),L.draw(i,_.TRIANGLES,v,c,y,l,P,o.id,I,S,M)}function go(e){const t=e._nearZ,r=e.projection.farthestPixelDistance(e),i=r-t,n=.2*e.height,o=t+n;return[t,r,(o-n-t)/i,(o-t)/i]}function yo(e,t,r,i){if(e)return t instanceof Oe&&e instanceof Ht?t.getTextureDescriptor(e,r,!0):{texture:e.texture,mix:mo(i.mix),offset:i.offset,buffer:0,tileSize:1}}function xo(t,r,i){if(!t)return null;const n=r.getTextureDescriptor(t,i,!0);if(!n)return null;let{texture:o,mix:s,offset:a,tileSize:l,buffer:c,format:u}=n;if(!o||!u)return null;let h=!1;return"uint32"===u&&(h=!0,s[3]=0,s=zn(e.cM,s,[0,i.paint.get("raster-particle-max-speed")]),a=kn(e.cM,a,[0,i.paint.get("raster-particle-max-speed")])),{texture:o,textureOffset:[c/(l+2*c),l/(l+2*c)],tileSize:l,scalarData:h,scale:s,offset:a,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[u]]}}function vo(e){const t=e._nearZ,r=e.projection.farthestPixelDistance(e),i=r-t,n=.2*e.height,o=t+n;return[t,r,(o-n-t)/i,(o-t)/i]}const bo=new e.ax(1,0,0,1),wo=new e.ax(0,1,0,1),To=new e.ax(0,0,1,1),Eo=new e.ax(1,0,1,1),So=new e.ax(0,1,1,1);function Mo(t,r,i,n,o,s,a){const l=t.context,c=t.transform,u=l.gl,h="globe"===c.projection.name,d=h?["PROJECTION_GLOBE_VIEW"]:[];let p=e.a6.clone(i.projMatrix);if(h&&e.S(c.zoom)>0){const t=e.aS(i.canonical,c),r=e.cN(t);p=e.a6.multiply(new Float32Array(16),c.globeMatrix,r),e.a6.multiply(p,c.projMatrix,p)}const f=e.a6.create();f[12]+=2*o/(e.f.devicePixelRatio*c.width),f[13]+=2*s/(e.f.devicePixelRatio*c.height),e.a6.multiply(p,f,p);const m=t.getOrCreateProgram("debug",{defines:d}),_=r.getTileByID(i.key);t.terrain&&t.terrain.setupElevationDraw(_,m);const g=Ct.disabled,y=Lt.disabled,x=t.colorModeForRenderPass(),v="$debug";l.activeTexture.set(u.TEXTURE0),t.emptyTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),h?_._makeGlobeTileDebugBuffers(t.context,c):_._makeDebugTileBoundsBuffers(t.context,c.projection);const b=_._tileDebugBuffer||t.debugBuffer,w=_._tileDebugIndexBuffer||t.debugIndexBuffer,T=_._tileDebugSegments||t.debugSegments;if(m.draw(t,u.LINE_STRIP,g,y,x,kt.disabled,Rn(p,n),v,b,w,T,null,null,null,[_._globeTileDebugBorderBuffer]),a){const e=_.latestRawTileData,r=Math.floor((e&&e.byteLength||0)/1024);let n=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(n+=` => ${i.overscaledZ}`),n+=` ${_.state}`,n+=` ${r}kb`,function(e,t){e.initDebugOverlayCanvas();const r=e.debugOverlayCanvas,i=e.context.gl,n=e.debugOverlayCanvas.getContext("2d");n.clearRect(0,0,r.width,r.height),n.shadowColor="white",n.shadowBlur=2,n.lineWidth=1.5,n.strokeStyle="white",n.textBaseline="top",n.font="bold 36px Open Sans, sans-serif",n.fillText(t,5,5),n.strokeText(t,5,5),e.debugOverlayTexture.update(r),e.debugOverlayTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}(t,n)}const E=r.getTile(i).tileSize,S=512/Math.min(E,512)*(i.overscaledZ/c.zoom)*.5,M=_._tileDebugTextBuffer||t.debugBuffer,A=_._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,I=_._tileDebugTextSegments||t.debugSegments;m.draw(t,u.TRIANGLES,g,y,Dt.alphaBlended,kt.disabled,Rn(p,e.ax.transparent,S),v,M,A,I,null,null,null,[_._globeTileDebugTextBuffer])}function Ao(e,t,r,i){Co(e,0,t+r/2,e.transform.width,r,i)}function Io(e,t,r,i){Co(e,t-r/2,0,r,e.transform.height,i)}function Co(t,r,i,n,o,s){const a=t.context,l=a.gl;l.enable(l.SCISSOR_TEST),l.scissor(r*e.f.devicePixelRatio,i*e.f.devicePixelRatio,n*e.f.devicePixelRatio,o*e.f.devicePixelRatio),a.clear({color:s}),l.disable(l.SCISSOR_TEST)}const Po=e.ay([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Lo}=Po;function Ro(e,t,r,i){e.emplaceBack(t,r,i)}class Do{constructor(t){this.vertexArray=new e.az,this.indices=new e.aw,Ro(this.vertexArray,-1,-1,1),Ro(this.vertexArray,1,-1,1),Ro(this.vertexArray,-1,1,1),Ro(this.vertexArray,1,1,1),Ro(this.vertexArray,-1,-1,-1),Ro(this.vertexArray,1,-1,-1),Ro(this.vertexArray,-1,1,-1),Ro(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Lo),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=e.aB.simpleSegment(0,0,36,12)}}function Oo(t,r,i,n,o,s){const a=t.context.gl,l=r.paint.get("sky-atmosphere-color"),c=r.paint.get("sky-atmosphere-halo-color"),u=r.paint.get("sky-atmosphere-sun-intensity"),h=((e,t,r,i,n)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:r,u_color_tint_r:[i.r,i.g,i.b,i.a],u_color_tint_m:[n.r,n.g,n.b,n.a],u_luminance:5e-5}))(e.co.fromMat4(e.co.create(),n),o,u,l,c);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+s,r.skyboxTexture,0),i.draw(t,a.TRIANGLES,Ct.disabled,Lt.disabled,Dt.unblended,kt.frontCW,h,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const zo=e.ay([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ko{constructor(t){const r=new e.cO;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);const i=new e.aw;i.emplaceBack(0,1,2),i.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(r,zo.members),this.indexBuffer=t.createIndexBuffer(i),this.segments=e.aB.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Fo=e.ay([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Bo{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class No{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Dt([1,Rt,1,Rt],e.ax.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Dt([1,0,1,0],e.ax.transparent,[!1,!1,!1,!0]),this.params=new Bo,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(t){const r=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new ko(r);const t=this.params.sizeRange,i=this.params.intensityRange,n=function(t){const r=e.aA(30),i=[];for(let n=0;n<t;++n){const t=2*Math.PI*r(),n=Math.acos(1-2*r())-.5*Math.PI;i.push(e.N.fromValues(Math.cos(n)*Math.cos(t),Math.cos(n)*Math.sin(t),Math.sin(n)))}return i}(this.params.starsCount),o=e.aA(300),s=new e.cP,a=new e.aw;let l=0;for(let r=0;r<n.length;++r){const c=e.N.scale([],n[r],200),u=Math.max(0,1+.01*t*(1*o()-.5)),h=Math.max(0,1+.01*i*(1*o()-.5));s.emplaceBack(c[0],c[1],c[2],-1,-1,u,h),s.emplaceBack(c[0],c[1],c[2],1,-1,u,h),s.emplaceBack(c[0],c[1],c[2],1,1,u,h),s.emplaceBack(c[0],c[1],c[2],-1,1,u,h),a.emplaceBack(l+0,l+1,l+2),a.emplaceBack(l+0,l+2,l+3),l+=4}this.starsVx=r.createVertexBuffer(s,Fo.members),this.starsIdx=r.createIndexBuffer(a),this.starsSegments=e.aB.simpleSegment(0,0,s.length,a.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,r){const i=t.context,n=i.gl,o=t.transform,s=new Ct(n.LEQUAL,Ct.ReadOnly,[0,1]),a=e.S(o.zoom),l=r.properties.get("color").toArray01(),c=r.properties.get("high-color").toArray01(),u=r.properties.get("space-color").toArray01PremultipliedAlpha(),h=5e-4,d=e.cQ(r.properties.get("horizon-blend"),0,1,h,.25),p=e.cd(t,i,o)&&d===h?o.worldSize/(2*Math.PI*1.025)-1:o.globeRadius,f=t.frameCounter/1e3%1,m=e.N.length(o.globeCenterInViewSpace),_=Math.sqrt(Math.pow(m,2)-Math.pow(p,2)),g=Math.acos(_/m),y=e=>{const r="globe"===o.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];e&&r.push("ALPHA_PASS");const h=t.getOrCreateProgram("globeAtmosphere",{defines:r}),p=((e,t,r,i,n,o,s,a,l,c,u,h)=>({u_frustum_tl:e,u_frustum_tr:t,u_frustum_br:r,u_frustum_bl:i,u_horizon:n,u_transition:o,u_fadeout_range:s,u_color:a,u_high_color:l,u_space_color:c,u_temporal_offset:u,u_horizon_angle:h}))(o.frustumCorners.TL,o.frustumCorners.TR,o.frustumCorners.BR,o.frustumCorners.BL,o.frustumCorners.horizon,a,d,l,c,u,f,g);t.uploadCommonUniforms(i,h);const m=this.atmosphereBuffer;m&&h.draw(t,n.TRIANGLES,s,Lt.disabled,e?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,kt.backCW,p,e?"atmosphere_glow_alpha":"atmosphere_glow",m.vertexBuffer,m.indexBuffer,m.segments)};y(!1),y(!0)}drawStars(t,r){const i=e.aa(r.properties.get("star-intensity"),0,1);if(0===i)return;const n=t.context,o=n.gl,s=t.transform,a=t.getOrCreateProgram("stars"),l=e.bi.identity([]);e.bi.rotateX(l,l,-s._pitch),e.bi.rotateZ(l,l,-s.angle),e.bi.rotateX(l,l,e.bj(s._center.lat)),e.bi.rotateY(l,l,-e.bj(s._center.lng));const c=e.a6.fromQuat(new Float32Array(16),l),u=e.a6.multiply([],s.starsProjMatrix,c),h=e.co.fromMat4([],c),d=e.co.invert([],h),p=[0,1,0];e.N.transformMat3(p,p,d),e.N.scale(p,p,this.params.sizeMultiplier);const f=[1,0,0];e.N.transformMat3(f,f,d),e.N.scale(f,f,this.params.sizeMultiplier);const m=(_=p,g=f,y=i,{u_matrix:Float32Array.from(u),u_up:_,u_right:g,u_intensity_multiplier:y});var _,g,y;t.uploadCommonUniforms(n,a),this.starsVx&&this.starsIdx&&a.draw(t,o.TRIANGLES,Ct.disabled,Lt.disabled,this.colorModeAlphaBlendedWriteRGB,kt.disabled,m,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Uo(t,r){const i=[...t],n=r.cameraWorldSizeForFog/r.worldSize,o=e.a6.identity([]);return e.a6.scale(o,o,[n,n,1]),e.a6.multiply(i,o,i),e.a6.multiply(i,r.worldToFogMatrix,i),i}function Vo(e,t,r,i){const n=r.material,o=i.context,{baseColorTexture:s,metallicRoughnessTexture:a}=n.pbrMetallicRoughness,{normalTexture:l,occlusionTexture:c,emissionTexture:u}=n;function h(t,r,i){if(t&&(e.push(r),o.activeTexture.set(o.gl.TEXTURE0+i),t.gfxTexture)){const{minFilter:e,magFilter:r,wrapS:i,wrapT:n}=t.sampler;t.gfxTexture.bindExtraParam(e,r,i,n)}}h(s,"HAS_TEXTURE_u_baseColorTexture",_i.BaseColor),h(a,"HAS_TEXTURE_u_metallicRoughnessTexture",_i.MetallicRoughness),h(l,"HAS_TEXTURE_u_normalTexture",_i.Normal),h(c,"HAS_TEXTURE_u_occlusionTexture",_i.Occlusion),h(u,"HAS_TEXTURE_u_emissionTexture",_i.Emission),r.texcoordBuffer&&(e.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(r.texcoordBuffer)),r.colorBuffer&&(e.push(12===r.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(r.colorBuffer)),r.normalBuffer&&(e.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(r.normalBuffer)),r.pbrBuffer&&(e.push("HAS_ATTRIBUTE_a_pbr"),e.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(r.pbrBuffer)),"OPAQUE"!==n.alphaMode&&"MASK"!==n.alphaMode||e.push("UNPREMULT_TEXTURE_IN_SHADER"),n.defined||e.push("DIFFUSE_SHADED"),e.push("USE_STANDARD_DERIVATIVES")}function jo(t,r,i,n,o,s){const a=i.paint.get("model-opacity"),l=r.context,c=new Ct(r.context.gl.LEQUAL,Ct.ReadWrite,r.depthRangeFor3D),u=r.transform,h=t.mesh,d=h.material,p=d.pbrMetallicRoughness,f=r.style.fog;let m;m="pixels"===r.transform.projection.zAxisUnit?[...t.nodeModelMatrix]:e.a6.multiply([],n.zScaleMatrix,t.nodeModelMatrix),e.a6.multiply(m,n.negCameraPosMatrix,m);const _=e.a6.invert([],m);e.a6.transpose(_,_);const g=i.paint.get("model-emissive-strength").constantOr(0),y=Hn(new Float32Array(t.worldViewProjection),new Float32Array(m),new Float32Array(_),r,a,p.baseColorFactor,d.emissiveFactor,p.metallicFactor,p.roughnessFactor,d,g,i),x={defines:[]},v=[];Vo(x.defines,v,h,r);const b=r.shadowRenderer;b&&(b.useNormalOffset=!1);let w=null;if(f){const e=Uo(t.nodeModelMatrix,r.transform);if(w=new Float32Array(e),"globe"!==u.projection.name){const t=h.aabb.min,r=h.aabb.max,[i,n]=f.getOpacityForBounds(e,t[0],t[1],r[0],r[1]);x.overrideFog=i>=_e||n>=_e}}const T=gi(r,i.paint.get("model-cutoff-fade-range"));T.shouldRenderCutoff&&x.defines.push("RENDER_CUTOFF");const E=r.getOrCreateProgram("model",x);r.uploadCommonUniforms(l,E,null,w,T),"shadow"!==r.renderPass&&b&&b.setupShadowsFromMatrix(t.nodeModelMatrix,E),E.draw(r,l.gl.TRIANGLES,c,o,s,h.material.doubleSided?kt.disabled:kt.backCCW,y,i.id,h.vertexBuffer,h.indexBuffer,h.segments,i.paint,r.transform.zoom,void 0,v)}function Go(t,r,i,n,o,s,a){let l;l="globe"===t.projection.name?e.cS(i,t):[...i],e.a6.multiply(l,l,r.matrix);const c=e.a6.multiply([],n,l);if(r.meshes)for(const u of r.meshes){if("BLEND"!==u.material.alphaMode){a.push({mesh:u,depth:0,modelIndex:o,worldViewProjection:c,nodeModelMatrix:l});continue}const t=e.N.transformMat4([],u.centroid,c);t[2]>0&&s.push({mesh:u,depth:t[2],modelIndex:o,worldViewProjection:c,nodeModelMatrix:l})}if(r.children)for(const e of r.children)Go(t,e,i,n,o,s,a)}function $o(e,t,r,i){const n=r.shadowRenderer;if(!n)return;const o=n.getShadowPassDepthMode(),s=n.getShadowPassColorMode(),a=n.calculateShadowPassMatrixFromMatrix(t),l=Yn(a);r.getOrCreateProgram("modelDepth",{defines:r._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(r,r.context.gl.TRIANGLES,o,Lt.disabled,s,kt.backCCW,l,i.id,e.vertexBuffer,e.indexBuffer,e.segments,i.paint,r.transform.zoom,void 0,void 0)}function qo(t,r,i){const n=r.updateZoomBasedPaintProperties(),o=function(t,r,i){let n,o,s,a=t.terrain?t.terrain.exaggeration():0;if(t.terrain&&a>0){const r=t.terrain,o=r.findDEMTileFor(i);o&&o.dem?n=e.cU.create(r,i,o):a=0}if(0===a&&(r.terrainElevationMin=0,r.terrainElevationMax=0),a===r.validForExaggeration&&(0===a||n&&n._demTile&&n._demTile.tileID===r.validForDEMTile.id&&n._dem._timestamp===r.validForDEMTile.timestamp))return!1;for(const e in r.instancesPerModel){const t=r.instancesPerModel[e];for(let e=0;e<t.instancedDataArray.length;++e){const i=(n?a*n.getElevationAt(0|t.instancedDataArray.float32[16*e],0|t.instancedDataArray.float32[16*e+1],!0,!0):0)+t.instancesEvaluatedElevation[e];t.instancedDataArray.float32[16*e+6]=i,o=o?Math.min(r.terrainElevationMin,i):i,s=s?Math.max(r.terrainElevationMax,i):i}}return r.terrainElevationMin=o||0,r.terrainElevationMax=s||0,r.validForExaggeration=a,r.validForDEMTile=n&&n._demTile?{id:n._demTile.tileID,timestamp:n._dem._timestamp}:{id:void 0,timestamp:0},!0}(t,r,i);(n||o)&&(r.uploaded=!1,r.upload(t.context))}const Zo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new e.bS([0,0,0],[e.V,e.V,0])};function Wo(t,r){const i=1<<t.canonical.z,n=r.getFreeCameraOptions().position,o=r.elevation,s=t.canonical.x/i,a=(t.canonical.x+1)/i,l=t.canonical.y/i,c=(t.canonical.y+1)/i;let u=r._centerAltitude;if(o){const e=o.getMinMaxForTile(t);e&&e.max>u&&(u=e.max)}const h=e.aa(n.x,s,a)-n.x,d=e.aa(n.y,l,c)-n.y,p=e.bl(u,r.center.lat)-n.z;return r._zoomFromMercatorZ(Math.sqrt(h*h+d*d+p*p))}function Ho(e,t,r,i,n,o,s){const a=e.context,l="shadow"===e.renderPass,c=e.shadowRenderer,u=l&&c?c.getShadowPassDepthMode():new Ct(a.gl.LEQUAL,Ct.ReadWrite,e.depthRangeFor3D),h=e.isTileAffectedByFog(o);if(r.meshes)for(const d of r.meshes){const p=["MODEL_POSITION_ON_GPU"],f=[];let m,_,g;i.instancedDataArray.length>20&&p.push("INSTANCED_ARRAYS");const y=gi(e,t.paint.get("model-cutoff-fade-range"));if(y.shouldRenderCutoff&&p.push("RENDER_CUTOFF"),l&&c)m=e.getOrCreateProgram("modelDepth",{defines:p}),_=Yn(s.shadowTileMatrix,s.shadowTileMatrix,Float32Array.from(r.matrix)),g=c.getShadowPassColorMode();else{Vo(p,f,d,e),m=e.getOrCreateProgram("model",{defines:p,overrideFog:h});const i=d.material,l=i.pbrMetallicRoughness,u=t.paint.get("model-opacity"),x=t.paint.get("model-emissive-strength").constantOr(0);_=Hn(o.expandedProjMatrix,Float32Array.from(r.matrix),new Float32Array(16),e,u,l.baseColorFactor,i.emissiveFactor,l.metallicFactor,l.roughnessFactor,i,x,t,n),c&&(s.shadowUniformsInitialized?m.setShadowUniformValues(a,c.getShadowUniformValues()):(c.setupShadows(o.toUnwrapped(),m,"model-tile",o.overscaledZ),s.shadowUniformsInitialized=!0)),g=y.shouldRenderCutoff||u<1||"OPAQUE"!==i.alphaMode?Dt.alphaBlended:Dt.unblended}e.uploadCommonUniforms(a,m,o.toUnwrapped(),null,y);const x=d.material.doubleSided?kt.disabled:kt.backCCW;if(i.instancedDataArray.length>20)f.push(i.instancedDataBuffer),m.draw(e,a.gl.TRIANGLES,u,Lt.disabled,g,x,_,t.id,d.vertexBuffer,d.indexBuffer,d.segments,t.paint,e.transform.zoom,void 0,f,i.instancedDataArray.length);else{const r=l?"u_instance":"u_normal_matrix";for(let n=0;n<i.instancedDataArray.length;++n)_[r]=new Float32Array(i.instancedDataArray.arrayBuffer,64*n,16),m.draw(e,a.gl.TRIANGLES,u,Lt.disabled,g,x,_,t.id,d.vertexBuffer,d.indexBuffer,d.segments,t.paint,e.transform.zoom,void 0,f)}}if(r.children)for(const d of r.children)Ho(e,t,d,i,n,o,s)}const Xo=[1,-1,1];function Yo(t,r,i,n){if(!i.modelManager)return!0;const o=i.modelManager;if(!i.shadowRenderer)return!0;const s=i.shadowRenderer,a=r.aabb;let l=!0,c=t.maxHeight;if(0===c){let e=0;for(const r in t.instancesPerModel){const t=o.getModel(r,n);t?e=Math.max(e,Math.max(Math.max(t.aabb.max[0],t.aabb.max[1]),t.aabb.max[2])):l=!1}c=t.maxScale*e*1.41+t.maxVerticalOffset,l&&(t.maxHeight=c)}a.max[2]=c,a.min[2]+=t.terrainElevationMin,a.max[2]+=t.terrainElevationMax,e.N.transformMat4(a.min,a.min,r.tileMatrix),e.N.transformMat4(a.max,a.max,r.tileMatrix);const u=a.intersects(s.getCurrentCascadeFrustum());return 0===i.currentShadowCascade&&(t.isInsideFirstShadowMapFrustum=2===u),0===u}class Ko{}class Jo{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,r,i){{const e=this._storage.get(r.id);if(e)return e.lastUsedFrameIdx=t,e.buf}const n=i.gl,o=n.getBufferParameter(n.ELEMENT_ARRAY_BUFFER,n.BUFFER_SIZE),s=new ArrayBuffer(o),a=new Int16Array(s);n.getBufferSubData(n.ELEMENT_ARRAY_BUFFER,0,new Int16Array(s));const l=new e.cW;for(let e=0;e<o/2;e+=3){const t=a[e],r=a[e+1],i=a[e+2];l.emplaceBack(t,r),l.emplaceBack(r,i),l.emplaceBack(i,t)}const c=i.bindVertexArrayOES.current,u=new Ko;return u.buf=new je(i,l),u.lastUsedFrameIdx=t,this._storage.set(r.id,u),i.bindVertexArrayOES.set(c),u.buf}update(e){for(const[t,r]of this._storage)e-r.lastUsedFrameIdx>30&&(r.buf.destroy(),this._storage.delete(t))}destroy(){for(const[e,t]of this._storage)t.buf.destroy(),this._storage.delete(e)}}class Qo{registerParameter(e,t,r,i,n){}registerButton(e,t,r){}}const es={symbol:function(t,r,i,n,o){if("translucent"!==t.renderPass)return;const s=Lt.disabled,a=t.colorModeForRenderPass();i.layout.get("text-variable-anchor")&&function(t,r,i,n,o,s,a){const l=r.transform,c="map"===o,u="map"===s;for(const h of t){const t=n.getTile(h),r=t.getBucket(i);if(!r||!r.text||!r.text.segments.get().length)continue;const o=e.b5(r.textSizeData,l.zoom),s=Or(h,r.getProjection(),l),d=l.calculatePixelsToTileUnitsMatrix(t),p=mr(s,t.tileID.canonical,u,c,l,r.getProjection(),d),f=r.hasIconTextFit()&&r.hasIconData();if(o){const i=Math.pow(2,l.zoom-t.tileID.overscaledZ);io(r,c,u,a,e.cx,l,p,h,i,o,f)}}}(n,t,i,r,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),o);const l=0!==i.paint.get("icon-opacity").constantOr(1),c=0!==i.paint.get("text-opacity").constantOr(1);void 0!==i.layout.get("symbol-sort-key").constantOr(1)&&(l||c)?no(t,r,i,n,s,a):(l&&no(t,r,i,n,s,a,{onlyIcons:!0}),c&&no(t,r,i,n,s,a,{onlyText:!0})),r.map.showCollisionBoxes&&(Qn(t,r,i,n,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),Qn(t,r,i,n,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))},circle:function(t,r,i,n){if("translucent"!==t.renderPass)return;const o=i.paint.get("circle-opacity"),s=i.paint.get("circle-stroke-width"),a=i.paint.get("circle-stroke-opacity"),l=void 0!==i.layout.get("circle-sort-key").constantOr(1),c=i.paint.get("circle-emissive-strength");if(0===o.constantOr(1)&&(0===s.constantOr(1)||0===a.constantOr(1)))return;const u=t.context,h=u.gl,d=t.transform,p=t.depthModeForSublayer(0,Ct.ReadOnly),f=Lt.disabled,m=t.colorModeForDrapableLayerRenderPass(c),_="globe"===d.projection.name,g=[e.a5(d.center.lng),e.ae(d.center.lat)],y=[];for(let v=0;v<n.length;v++){const o=n[v],s=r.getTile(o),a=s.getBucket(i);if(!a||a.projection.name!==d.projection.name)continue;const c=a.programConfigurations.get(i.id),u=e.cy(i),h=t.isTileAffectedByFog(o);_&&u.push("PROJECTION_GLOBE_VIEW");const p=t.getOrCreateProgram("circle",{config:c,defines:u,overrideFog:h}),f=a.layoutVertexBuffer,m=a.globeExtVertexBuffer,x=a.indexBuffer,b=d.projection.createInversionMatrix(d,o.canonical),w={programConfiguration:c,program:p,layoutVertexBuffer:f,globeExtVertexBuffer:m,indexBuffer:x,uniformValues:e.cz(t,o,s,b,g,i),tile:s};if(l){const t=a.segments.get();for(const r of t)y.push({segments:new e.aB([r]),sortKey:r.sortKey,state:w})}else y.push({segments:a.segments,sortKey:0,state:w})}l&&y.sort(((e,t)=>e.sortKey-t.sortKey));const x={useDepthForOcclusion:d.depthOcclusionForSymbolsAndCircles};for(const e of y){const{programConfiguration:r,program:n,layoutVertexBuffer:o,globeExtVertexBuffer:s,indexBuffer:a,uniformValues:l,tile:c}=e.state,_=e.segments;t.terrain&&t.terrain.setupElevationDraw(c,n,x),t.uploadCommonUniforms(u,n,c.tileID.toUnwrapped()),n.draw(t,h.TRIANGLES,p,f,m,kt.disabled,l,i.id,o,a,_,i.paint,d.zoom,r,[s])}},heatmap:function(t,r,i,n){if(0!==i.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const o=t.context,s=o.gl,a=Lt.disabled,l=new Dt([s.ONE,s.ONE,s.ONE,s.ONE],e.ax.transparent,[!0,!0,!0,!0]);!function(e,t,r,i){const n=e.gl,o=t.width*i,s=t.height*i;e.activeTexture.set(n.TEXTURE1),e.viewport.set([0,0,o,s]);let a=r.heatmapFbo;if(!a||a&&(a.width!==o||a.height!==s)){a&&a.destroy();const t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),a=r.heatmapFbo=e.createFramebuffer(o,s,!0,null),function(e,t,r,i,n,o){const s=e.gl;s.texImage2D(s.TEXTURE_2D,0,e.extRenderToTextureHalfFloat?s.RGBA16F:s.RGBA,n,o,0,s.RGBA,e.extRenderToTextureHalfFloat?s.HALF_FLOAT:s.UNSIGNED_BYTE,null),i.colorAttachment.set(r)}(e,0,t,a,o,s)}else n.bindTexture(n.TEXTURE_2D,a.colorAttachment.get()),e.bindFramebuffer.set(a.framebuffer)}(o,t,i,"globe"===t.transform.projection.name?.5:.25),o.clear({color:e.ax.transparent});const c=t.transform,u="globe"===c.projection.name,h=u?["PROJECTION_GLOBE_VIEW"]:[],d=u?kt.frontCCW:kt.disabled,p=[e.a5(c.center.lng),e.ae(c.center.lat)];for(let e=0;e<n.length;e++){const f=n[e];if(r.hasRenderableParent(f))continue;const m=r.getTile(f),_=m.getBucket(i);if(!_||_.projection.name!==c.projection.name)continue;const g=t.isTileAffectedByFog(f),y=_.programConfigurations.get(i.id),x=t.getOrCreateProgram("heatmap",{config:y,defines:h,overrideFog:g}),{zoom:v}=t.transform;t.terrain&&t.terrain.setupElevationDraw(m,x),t.uploadCommonUniforms(o,x,f.toUnwrapped());const b=c.projection.createInversionMatrix(c,f.canonical);x.draw(t,s.TRIANGLES,Ct.disabled,a,l,d,On(t,f,m,b,p,v,i.paint.get("heatmap-intensity")),i.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,i.paint,t.transform.zoom,y,u?[_.globeExtVertexBuffer]:null)}o.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,r){const i=t.context,n=i.gl,o=r.heatmapFbo;if(!o)return;i.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o.colorAttachment.get()),i.activeTexture.set(n.TEXTURE1);let s=r.colorRampTexture;s||(s=r.colorRampTexture=new e.T(i,r.colorRamp,n.RGBA)),s.bind(n.LINEAR,n.CLAMP_TO_EDGE),t.getOrCreateProgram("heatmapTexture").draw(t,n.TRIANGLES,Ct.disabled,Lt.disabled,t.colorModeForRenderPass(),kt.disabled,((e,t,r,i)=>({u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}))(0,r),r.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,r.paint,t.transform.zoom)}(t,i))},line:function(t,r,i,n){if("translucent"!==t.renderPass)return;const o=i.paint.get("line-opacity"),s=i.paint.get("line-width");if(0===o.constantOr(1)||0===s.constantOr(1))return;const a=i.paint.get("line-emissive-strength"),l=t.depthModeForSublayer(0,Ct.ReadOnly),c=t.colorModeForDrapableLayerRenderPass(a),u=t.terrain&&t.terrain.renderingToTexture?1:e.f.devicePixelRatio,h=i.paint.get("line-dasharray"),d=h.constantOr(1),p=i.layout.get("line-cap"),f=i.paint.get("line-pattern"),m=f.constantOr(1),_=i.paint.get("line-pattern").constantOr(1),g=1!==i.paint.get("line-opacity").constantOr(1);let y=!_&&g;const x=i.paint.get("line-gradient"),v=m?"linePattern":"line",b=t.context,w=b.gl,T=e.cA(i);t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(y=!1);for(const E of n){const n=r.getTile(E);if(m&&!n.patternsLoaded())continue;const o=n.getBucket(i);if(!o)continue;t.prepareDrawTile();const s=o.programConfigurations.get(i.id),a=t.isTileAffectedByFog(E),_=t.getOrCreateProgram(v,{config:s,defines:T,overrideFog:a}),g=f.constantOr(null);if(g&&n.imageAtlas){const e=n.imageAtlas.patternPositions[g.toString()];e&&s.setConstantPatternPositions(e)}const S=h.constantOr(null),M=p.constantOr(null);if(!m&&S&&M&&n.lineAtlas){const e=n.lineAtlas.getDash(S,M);e&&s.setConstantPatternPositions(e)}let[A,I]=i.paint.get("line-trim-offset");if("round"===M||"square"===M){const e=1;A!==I&&(0===A&&(A-=e),1===I&&(I+=e))}const C=t.terrain?E.projMatrix:null,P=m?e.cB(t,n,i,C,u,[A,I]):e.cC(t,n,i,C,o.lineClipsArray.length,u,[A,I]);if(x){const n=o.gradients[i.id];let s=n.texture;if(i.gradientVersion!==n.version){let a=256;if(i.stepInterpolant){const i=r.getSource().maxzoom,n=E.canonical.z===i?Math.ceil(1<<t.transform.maxZoom-E.canonical.z):1;a=e.aa(e.cD(o.maxLineLength/e.V*1024*n),256,b.maxTextureSize)}n.gradient=e.cE({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:a,image:n.gradient||void 0,clips:o.lineClipsArray}),n.texture?n.texture.update(n.gradient):n.texture=new e.T(b,n.gradient,w.RGBA),n.version=i.gradientVersion,s=n.texture}b.activeTexture.set(w.TEXTURE1),s.bind(i.stepInterpolant?w.NEAREST:w.LINEAR,w.CLAMP_TO_EDGE)}d&&(b.activeTexture.set(w.TEXTURE0),n.lineAtlasTexture&&n.lineAtlasTexture.bind(w.LINEAR,w.REPEAT),s.updatePaintBuffers()),m&&(b.activeTexture.set(w.TEXTURE0),n.imageAtlasTexture&&n.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),s.updatePaintBuffers()),t.uploadCommonUniforms(b,_,E.toUnwrapped());const L=e=>{_.draw(t,w.TRIANGLES,l,e,c,kt.disabled,P,i.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,i.paint,t.transform.zoom,s,[o.layoutVertexBuffer2])};if(y){const e=t.stencilModeForClipping(E).ref;0===e&&t.terrain&&b.clear({stencil:0});const r={func:w.EQUAL,mask:255};P.u_alpha_discard_threshold=.8,L(new Lt(r,e,255,w.KEEP,w.KEEP,w.INVERT)),P.u_alpha_discard_threshold=0,L(new Lt(r,e,255,w.KEEP,w.KEEP,w.KEEP))}else L(t.stencilModeForClipping(E))}y&&(t.resetStencilClippingMasks(),t.terrain&&b.clear({stencil:0}))},fill:function(t,r,i,n){const o=i.paint.get("fill-color"),s=i.paint.get("fill-opacity");if(0===s.constantOr(1))return;const a=i.paint.get("fill-emissive-strength"),l=t.colorModeForDrapableLayerRenderPass(a),c=i.paint.get("fill-pattern"),u=t.opaquePassEnabledForLayer()&&!c.constantOr(1)&&1===o.constantOr(e.ax.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";if(t.renderPass===u){const e=t.depthModeForSublayer(1,"opaque"===t.renderPass?Ct.ReadWrite:Ct.ReadOnly);so(t,r,i,n,e,l,!1)}if("translucent"===t.renderPass&&i.paint.get("fill-antialias")){const e=t.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,Ct.ReadOnly);so(t,r,i,n,e,l,!0)}},"fill-extrusion":function(t,r,i,n){const o=i.paint.get("fill-extrusion-opacity"),s=t.context,a=s.gl,l=t.terrain,c=l&&l.renderingToTexture;if(0===o)return;const u=t.conflationActive&&t.layerUsedInConflation(i,r.getSource());if(u&&function(e,t,r,i){for(const n of i){const i=t.getTile(n).getBucket(r);i&&(i.updateReplacement(n,e.replacementSource),i.uploadCentroid(e.context))}}(t,r,i,n),l||u)for(const e of n){const n=r.getTile(e).getBucket(i);n&&co(t.context,r,e,n,i,l,u)}if("shadow"===t.renderPass&&t.shadowRenderer){const s=t.shadowRenderer;if(l&&o<.65&&i._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof e.Z)return;const a=s.getShadowPassDepthMode(),c=s.getShadowPassColorMode();ao(t,r,i,n,a,Lt.disabled,c,u)}else if("translucent"===t.renderPass){const h=!i.paint.get("fill-extrusion-pattern").constantOr(1),d=i.paint.get("fill-extrusion-color").constantOr(e.ax.white);if(!c&&0!==d.a){const e=new Ct(t.context.gl.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D);1===o&&h?ao(t,r,i,n,e,Lt.disabled,Dt.unblended,u):(ao(t,r,i,n,e,Lt.disabled,Dt.disabled,u),ao(t,r,i,n,e,t.stencilModeFor3D(),t.colorModeForRenderPass(),u),t.resetStencilClippingMasks())}if(t.style.enable3dLights()&&h&&(!l&&"globe"!==t.transform.projection.name||c)){const o=i.paint.get("fill-extrusion-opacity"),h=i.paint.get("fill-extrusion-ambient-occlusion-intensity"),d=i.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),p=i.paint.get("fill-extrusion-flood-light-intensity"),f=i.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),m=h>0&&d>0,_=p>0,g=(e,t,r)=>(1-r)*e+r*t,y=s=>{const l=t.depthModeForSublayer(1,Ct.ReadOnly,a.LEQUAL,!0),c=i.paint.get(s?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),m=g(.1,3,c),_=t._showOverdrawInspector;if(!_){const c=new Lt({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),_=new Dt([a.ONE,a.ONE,a.ONE,a.ONE],e.ax.transparent,[!1,!1,!1,!0],a.MIN);lo(t,r,i,n,l,c,_,kt.disabled,s,"sdf",o,h,d,p,f,m,u,!1)}{const c=_?Lt.disabled:new Lt({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),g=_?t.colorModeForRenderPass():new Dt([a.ONE_MINUS_DST_ALPHA,a.DST_ALPHA,a.ONE,a.ONE],e.ax.transparent,[!0,!0,!0,!0]);lo(t,r,i,n,l,c,g,kt.disabled,s,"color",o,h,d,p,f,m,u,!1)}};if(c){const c=(s,l,c)=>{const m=t.depthModeForSublayer(1,Ct.ReadOnly,a.LEQUAL,!1),_=i.paint.get(s?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),y=g(.1,3,_);{const c=new Dt([a.ONE,a.ONE,a.ONE,a.ONE],e.ax.transparent,[!1,!1,!1,!0]);lo(t,r,i,n,m,Lt.disabled,c,kt.disabled,s,"clear",o,h,d,p,f,y,u,l)}{const c=new Lt({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),_=new Dt([a.ONE,a.ONE,a.ONE,a.ONE],e.ax.transparent,[!1,!1,!1,!0],a.MIN);lo(t,r,i,n,m,c,_,kt.disabled,s,"sdf",o,h,d,p,f,y,u,l)}{const c=s?a.ZERO:a.ONE_MINUS_DST_ALPHA,_=new Lt({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),g=new Dt([c,a.DST_ALPHA,a.ONE_MINUS_DST_ALPHA,a.ZERO],e.ax.transparent,[!0,!0,!0,!0]);lo(t,r,i,n,m,_,g,kt.disabled,s,"color",o,h,d,p,f,y,u,l)}{const _=new Dt([a.ONE,a.ONE,a.ONE,s?a.ZERO:a.ONE],e.ax.transparent,[!1,!1,!1,!0],s?a.FUNC_ADD:a.MAX);lo(t,r,i,n,m,Lt.disabled,_,kt.disabled,s,"clear",o,h,d,p,f,y,u,l,c)}};if(m||_){let r;if(t.prepareDrawTile(),l){const t=l.drapeBufferSize[0],i=l.drapeBufferSize[1];r=l.framebufferCopyTexture,r&&(!r||r.size[0]===t&&r.size[1]===i)||(r&&r.destroy(),r=l.framebufferCopyTexture=new e.T(s,new e.h({width:t,height:i}),a.RGBA)),r.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,t,i,0)}m&&c(!0,!1,r),_&&c(!1,!0,r)}}else m&&y(!0),_&&y(!1)}}},hillshade:function(e,t,r,i){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;if(e.style.disableElevatedTerrain)return;const n=e.context,o=e.terrain&&e.terrain.renderingToTexture,[s,a]="translucent"!==e.renderPass||o?[{},i]:e.stencilConfigForOverlap(i);for(const l of a){const i=t.getTile(l);if(i.needsHillshadePrepare&&"offscreen"===e.renderPass)rn(e,i,r);else if("translucent"===e.renderPass){const t=e.depthModeForSublayer(0,Ct.ReadOnly),n=r.paint.get("hillshade-emissive-strength"),a=e.colorModeForDrapableLayerRenderPass(n),c=o&&e.terrain?e.terrain.stencilModeForRTTOverlap(l):s[l.overscaledZ];en(e,l,i,r,t,c,a)}}n.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(t,r,i,n,o,s){if("translucent"!==t.renderPass)return;if(0===i.paint.get("raster-opacity"))return;const a="globe"===t.transform.projection.name,l=0!==i.paint.get("raster-elevation"),c=l&&a;if(t.renderElevatedRasterBackface&&!c)return;const u=t.context,h=u.gl,d=r.getSource(),p=function(t,r,i,n){const o=r.paint.get("raster-color"),s="raster-array"===t.type,a=[],l=r.paint.get("raster-resampling"),c=r.paint.get("raster-color-mix");let u=r.paint.get("raster-color-range");const h=[c[0],c[1],c[2],0],d=c[3];let p="nearest"===l?n.NEAREST:n.LINEAR;if(s&&(a.push("RASTER_ARRAY"),o||a.push("RASTER_COLOR"),"linear"===l&&a.push("RASTER_ARRAY_LINEAR"),p=n.NEAREST,!u&&t.rasterLayers)){const e=t.rasterLayers.find((({id:e})=>e===r.sourceLayer));e&&e.fields&&e.fields.range&&(u=e.fields.range)}if(u=u||[0,1],o){a.push("RASTER_COLOR"),i.activeTexture.set(n.TEXTURE2),r.updateColorRamp(u);let t=r.colorRampTexture;t||(t=r.colorRampTexture=new e.T(i,r.colorRamp,n.RGBA)),t.bind(n.LINEAR,n.CLAMP_TO_EDGE)}return{mix:h,range:u,offset:d,defines:a,resampling:p}}(d,i,u,h);if(d instanceof e.ap&&!n.length&&!a)return;const f=i.paint.get("raster-emissive-strength"),m=t.colorModeForDrapableLayerRenderPass(f),_=t.terrain&&t.terrain.renderingToTexture,g=!t.options.moving,y="nearest"===i.paint.get("raster-resampling")?h.NEAREST:h.LINEAR;if(d instanceof e.ap&&!n.length&&(d.onNorthPole||d.onSouthPole)){const e=l?t.stencilModeFor3D():Lt.disabled;return void _o(!!d.onNorthPole,null,t,r,i,f,p,kt.disabled,e)}if(!n.length)return;const[x,v]=d instanceof e.ap||_?[{},n]:t.stencilConfigForOverlap(n),b=v[v.length-1].overscaledZ;c&&p.defines.push("PROJECTION_GLOBE_VIEW"),l&&p.defines.push("RENDER_CUTOFF");const w=(n,o,v)=>{for(const w of n){const n=w.toUnwrapped(),T=r.getTile(w);if(_&&(!T||!T.hasData()))continue;u.activeTexture.set(h.TEXTURE0);const E=yo(T,d,i,p);if(!E||!E.texture)continue;const{texture:S,mix:M,offset:A,tileSize:I,buffer:C}=E;let P,L;_?(P=Ct.disabled,L=w.projMatrix):l?(P=new Ct(h.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D),L=a?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(n,g)):(P=t.depthModeForSublayer(w.overscaledZ-b,1===i.paint.get("raster-opacity")?Ct.ReadWrite:Ct.ReadOnly,h.LESS),L=t.transform.calculateProjMatrix(n,g));const R=t.terrain&&_?t.terrain.stencilModeForRTTOverlap(w):x[w.overscaledZ],D=s?0:i.paint.get("raster-fade-duration");T.registerFadeDuration(D);const O=r.findLoadedParent(w,0),z=pn(T,O,r,t.transform,D);let k,F;t.terrain&&t.terrain.prepareDrawTile(),u.activeTexture.set(h.TEXTURE0),S.bind(y,h.CLAMP_TO_EDGE),u.activeTexture.set(h.TEXTURE1),O?(O.texture&&O.texture.bind(y,h.CLAMP_TO_EDGE),k=Math.pow(2,O.tileID.overscaledZ-T.tileID.overscaledZ),F=[T.tileID.canonical.x*k%1,T.tileID.canonical.y*k%1]):S.bind(y,h.CLAMP_TO_EDGE),S.useMipmap&&u.extTextureFilterAnisotropic&&t.transform.pitch>20&&h.texParameterf(h.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax);const B=t.transform;let N;const U=l?go(B):[0,0,0,0];let V,j,G,$,q,Z=0;if(c&&d instanceof e.ap&&d.coordinates.length>3)V=Float32Array.from(e.aT(e.ci(new e.bs(0,0,0)))),j=Float32Array.from(B.globeMatrix),G=Float32Array.from(e.ce(B)),$=[e.a5(B.center.lng),e.ae(B.center.lat)],N=d.elevatedGlobePerspectiveTransform,q=d.elevatedGlobeGridMatrix||new Float32Array(9);else if(c){const t=e.cf(w.canonical);Z=e.cg(t.getCenter().lat),V=Float32Array.from(e.aT(e.ci(w.canonical))),j=Float32Array.from(B.globeMatrix),G=Float32Array.from(e.ce(B)),$=[e.a5(B.center.lng),e.ae(B.center.lat)],N=[0,0],q=Float32Array.from(e.ch(w.canonical,t,Z,B.worldSize/B._pixelsPerMercatorPixel))}else N=d instanceof e.ap?d.perspectiveTransform:[0,0],V=new Float32Array(16),j=new Float32Array(9),G=new Float32Array(16),$=[0,0],q=new Float32Array(9);const W=Fn(L,V,j,G,q,F||[0,0],e.S(t.transform.zoom),$,U,k||1,z,i,N,l?i.paint.get("raster-elevation"):0,2,M,A,p.range,I,C,f),H=t.isTileAffectedByFog(w),X=t.getOrCreateProgram("raster",{defines:p.defines,overrideFog:H});if(t.uploadCommonUniforms(u,X,n),d instanceof e.ap){const r=d.elevatedGlobeVertexBuffer,n=d.elevatedGlobeIndexBuffer;if(_||!a)d.boundsBuffer&&d.boundsSegments&&X.draw(t,h.TRIANGLES,P,Lt.disabled,m,kt.disabled,W,i.id,d.boundsBuffer,t.quadTriangleIndexBuffer,d.boundsSegments);else if(r&&n){const s=B.zoom<=e.bG?d.elevatedGlobeSegments:d.getSegmentsForLongitude(B.center.lng);s&&X.draw(t,h.TRIANGLES,P,Lt.disabled,m,o,W,i.id,r,n,s)}}else if(c){P=new Ct(h.LEQUAL,Ct.ReadOnly,t.depthRangeFor3D);const e=t.globeSharedBuffers;if(e){const[r,n,s]=e.getGridBuffers(Z,!1);X.draw(t,h.TRIANGLES,P,v||R,t.colorModeForRenderPass(),o,W,i.id,r,n,s)}}else{const{tileBoundsBuffer:e,tileBoundsIndexBuffer:r,tileBoundsSegments:n}=t.getTileBoundsBuffers(T);X.draw(t,h.TRIANGLES,P,R,m,kt.disabled,W,i.id,e,r,n)}}if(!(d instanceof e.ap)&&c)for(const e of n){const n=e.canonical.y===(1<<e.canonical.z)-1;0===e.canonical.y&&_o(!0,e,t,r,i,f,p,o,v||Lt.disabled),n&&_o(!1,e,t,r,i,f,p,o===kt.frontCW?kt.backCW:kt.frontCW,v||Lt.disabled)}};c?w(v,t.renderElevatedRasterBackface?kt.backCW:kt.frontCW,t.stencilModeFor3D()):w(v,kt.disabled,void 0),t.resetStencilClippingMasks()},"raster-particle":function(t,r,i,n,o,s){"offscreen"===t.renderPass&&function(t,r,i,n){if(!n.length)return;const o=t.context,s=o.gl,a=r.getSource();if(!(a instanceof Oe))return;const l=[];for(const e of n){const t=r.getTile(e);if(!(t instanceof Ht))continue;const n=xo(t,a,i);if(!n)continue;const s=[n.tileSize,n.tileSize];let c=i.tileFramebuffer;c||(c=i.tileFramebuffer=o.createFramebuffer(s[0],s[1],!0,null));let u=t.rasterParticleState;const h=i.paint.get("raster-particle-count");u||(u=t.rasterParticleState=new Nt(o,e,s,h));const d=u.update(i.lastInvalidatedAt);u.numParticles!==h&&u.setNumParticles(e,h);const p=u.targetColorTexture;u.targetColorTexture=u.backgroundColorTexture,u.backgroundColorTexture=p;const f=u.particleVertices0;u.particleVertices0=u.particleVertices1,u.particleVertices1=f,l.push([e,n,u,d])}if(0===l.length)return;const c=e.f.now(),u=i.previousDrawTimestamp?.001*(c-i.previousDrawTimestamp):.0167;if(i.previousDrawTimestamp=c,i.hasColorMap()){o.activeTexture.set(s.TEXTURE0+2);let t=i.colorRampTexture;t||(t=i.colorRampTexture=new e.T(o,i.colorRamp,s.RGBA)),t.bind(s.LINEAR,s.CLAMP_TO_EDGE)}o.bindFramebuffer.set(i.tileFramebuffer.framebuffer),o.activeTexture.set(s.TEXTURE0),function(t,r,i){const n=t.context,o=n.gl,s=r.tileFramebuffer;n.activeTexture.set(o.TEXTURE0);const a={u_texture:0,u_opacity:1.05*(c=r.paint.get("raster-particle-fade-opacity-factor"))/(c+.05)},l=t.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var c;for(const u of i){const[,,i,c]=u;s.colorAttachment.set(i.targetColorTexture.texture),n.viewport.set([0,0,s.width,s.height]),n.clear({color:e.ax.transparent}),c&&(i.backgroundColorTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),l.draw(t,o.TRIANGLES,Ct.disabled,Lt.disabled,Dt.alphaBlended,kt.disabled,a,r.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments))}}(t,i,l),function(t,r,i,n){const o=t.context.gl,s=i.tileFramebuffer,a="globe"===t.transform.projection.name,l=i.paint.get("raster-particle-max-speed");for(const c of n){const[n,u,h]=c;u.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s.colorAttachment.set(h.targetColorTexture.texture);const d=t.getOrCreateProgram("rasterParticleDraw",{defines:u.defines,overrideFog:!1}),p=u.scalarData?[]:[0,1,2,3].map((t=>e.cG[t](n)));p.push(n);const f=n.canonical.x,m=n.canonical.y;for(const e of p){const s=r.getTile(a?e.wrapped():e);if(!s)continue;const c=s.rasterParticleState;if(!c)continue;const h=Un([e.canonical.x+(1<<e.canonical.z)*(e.wrap-n.wrap)-f,e.canonical.y-m],0,u.texture.size,2,l,u.textureOffset,u.scale,u.offset);d.draw(t,o.POINTS,Ct.disabled,Lt.disabled,Dt.alphaBlended,kt.disabled,h,i.id,c.particleVertices0,void 0,c.particleSegment)}}}(t,r,i,l),function(e,t,r,i){const n=e.context.gl;let o=t.transformFeedbackObject;o||(o=t.transformFeedbackObject=n.createTransformFeedback()),n.bindTransformFeedback(n.TRANSFORM_FEEDBACK,t.transformFeedbackObject);const s=t.paint.get("raster-particle-max-speed"),a=i*t.paint.get("raster-particle-speed-factor")*.3,l=(c=t.paint.get("raster-particle-reset-rate-factor"),Math.pow(c,6));var c;for(const u of r){const[,r,i]=u;r.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE);const o=Vn(0,r.texture.size,s,a,l,r.textureOffset,r.scale,r.offset);e.getOrCreateProgram("rasterParticleUpdate",{defines:r.defines,transformFeedback:{bufferMode:n.SEPARATE_ATTRIBS,shaderVaryings:["v_new_particle"]}}).draw(e,n.POINTS,Ct.disabled,Lt.disabled,Dt.disabled,kt.disabled,o,t.id,i.particleVertices0,void 0,i.particleSegment,{},void 0,void 0,void 0,void 0,[{buffer:i.particleVertices1,targetIndex:0}])}n.bindTransformFeedback(n.TRANSFORM_FEEDBACK,null)}(t,i,l,u)}(t,r,i,n),"translucent"===t.renderPass&&(function(t,r,i,n,o){const s=t.context,a=s.gl,l=!t.options.moving,c="globe"===t.transform.projection.name;if(!n.length)return;const[u,h]=t.stencilConfigForOverlap(n),d=[];c&&d.push("PROJECTION_GLOBE_VIEW");for(const p of h){const n=p.toUnwrapped(),o=r.getTile(p);if(!o.rasterParticleState)continue;const h=o.rasterParticleState,f=100;o.registerFadeDuration(f);const m=r.findLoadedParent(p,0),_=pn(o,m,r,t.transform,f);let g,y;t.terrain&&t.terrain.prepareDrawTile(),s.activeTexture.set(a.TEXTURE0),h.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),s.activeTexture.set(a.TEXTURE1),m&&m.rasterParticleState?(m.rasterParticleState.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),g=Math.pow(2,m.tileID.overscaledZ-o.tileID.overscaledZ),y=[o.tileID.canonical.x*g%1,o.tileID.canonical.y*g%1]):h.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const x=c?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(n,l),v=t.transform,b=vo(v),w=e.cf(p.canonical),T=e.cg(w.getCenter().lat);let E,S,M,A,I;c?(E=Float32Array.from(e.aT(e.ci(p.canonical))),S=Float32Array.from(v.globeMatrix),M=Float32Array.from(e.ce(v)),A=[e.a5(v.center.lng),e.ae(v.center.lat)],I=Float32Array.from(e.ch(p.canonical,w,T,v.worldSize/v._pixelsPerMercatorPixel))):(E=new Float32Array(16),S=new Float32Array(9),M=new Float32Array(16),A=[0,0],I=new Float32Array(9));const C=Nn(x,E,S,M,I,y||[0,0],e.S(t.transform.zoom),A,b,g||1,_,250),P=t.isTileAffectedByFog(p),L=t.getOrCreateProgram("rasterParticle",{defines:d,overrideFog:P});if(t.uploadCommonUniforms(s,L,n),c){const e=new Ct(a.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D),r=0,n=t.globeSharedBuffers;if(n){const[o,s,l]=n.getGridBuffers(T,0!==r);L.draw(t,a.TRIANGLES,e,Lt.disabled,Dt.alphaBlended,kt.backCCW,C,i.id,o,s,l)}}else{const e=t.depthModeForSublayer(0,Ct.ReadOnly),r=u[p.overscaledZ],{tileBoundsBuffer:n,tileBoundsIndexBuffer:s,tileBoundsSegments:l}=t.getTileBoundsBuffers(o);L.draw(t,a.TRIANGLES,e,r,Dt.alphaBlended,kt.disabled,C,i.id,n,s,l)}}t.resetStencilClippingMasks()}(t,r,i,n),t.style.map.triggerRepaint())},background:function(e,t,r,i){const n=r.paint.get("background-color"),o=r.paint.get("background-opacity"),s=r.paint.get("background-emissive-strength");if(0===o)return;const a=e.context,l=a.gl,c=e.transform,u=c.tileSize,h=r.paint.get("background-pattern");if(e.isPatternMissing(h,r.scope))return;const d=!h&&1===n.a&&1===o&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==d)return;const p=Lt.disabled,f=e.depthModeForSublayer(0,"opaque"===d?Ct.ReadWrite:Ct.ReadOnly),m=e.colorModeForDrapableLayerRenderPass(s),_=h?"backgroundPattern":"background";let g,y=i;y||(g=e.getBackgroundTiles(),y=Object.values(g).map((e=>e.tileID))),h&&(a.activeTexture.set(l.TEXTURE0),e.imageManager.bind(e.context,r.scope));for(const x of y){const d=e.isTileAffectedByFog(x),y=e.getOrCreateProgram(_,{overrideFog:d}),v=x.toUnwrapped(),b=i?x.projMatrix:e.transform.calculateProjMatrix(v);e.prepareDrawTile();const w=t?t.getTile(x):g?g[x.key]:new Vt(x,u,c.zoom,e),T=h?Wn(b,s,o,e,h,r.scope,{tileID:x,tileSize:u}):Zn(b,s,o,n);e.uploadCommonUniforms(a,y,v);const{tileBoundsBuffer:E,tileBoundsIndexBuffer:S,tileBoundsSegments:M}=e.getTileBoundsBuffers(w);y.draw(e,l.TRIANGLES,f,p,m,kt.disabled,T,r.id,E,S,M)}},sky:function(t,r,i){const n=t._atmosphere?e.S(t.transform.zoom):1,o=i.paint.get("sky-opacity")*n;if(0===o)return;const s=t.context,a=i.paint.get("sky-type"),l=new Ct(s.gl.LEQUAL,Ct.ReadOnly,[0,1]),c=t.frameCounter/1e3%1;"atmosphere"===a?"offscreen"===t.renderPass?i.needsSkyboxCapture(t)&&(function(t,r,i,n){const o=t.context,s=o.gl;let a=r.skyboxFbo;if(!a){a=r.skyboxFbo=o.createFramebuffer(32,32,!0,null),r.skyboxGeometry=new Do(o),r.skyboxTexture=o.gl.createTexture(),s.bindTexture(s.TEXTURE_CUBE_MAP,r.skyboxTexture),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR);for(let e=0;e<6;++e)s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,s.RGBA,32,32,0,s.RGBA,s.UNSIGNED_BYTE,null)}o.bindFramebuffer.set(a.framebuffer),o.viewport.set([0,0,32,32]);const l=r.getCenter(t,!0),c=t.getOrCreateProgram("skyboxCapture"),u=new Float64Array(16);e.a6.identity(u),e.a6.rotateY(u,u,.5*-Math.PI),Oo(t,r,c,u,l,0),e.a6.identity(u),e.a6.rotateY(u,u,.5*Math.PI),Oo(t,r,c,u,l,1),e.a6.identity(u),e.a6.rotateX(u,u,.5*-Math.PI),Oo(t,r,c,u,l,2),e.a6.identity(u),e.a6.rotateX(u,u,.5*Math.PI),Oo(t,r,c,u,l,3),e.a6.identity(u),Oo(t,r,c,u,l,4),e.a6.identity(u),e.a6.rotateY(u,u,Math.PI),Oo(t,r,c,u,l,5),o.viewport.set([0,0,t.width,t.height])}(t,i),i.markSkyboxValid(t)):"sky"===t.renderPass&&function(e,t,r,i,n){const o=e.context,s=o.gl,a=e.transform,l=e.getOrCreateProgram("skybox");o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,t.skyboxTexture);const c=((e,t,r,i,n)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:i,u_temporal_offset:n}))(a.skyboxMatrix,t.getCenter(e,!1),0,i,n);e.uploadCommonUniforms(o,l),l.draw(e,s.TRIANGLES,r,Lt.disabled,e.colorModeForRenderPass(),kt.backCW,c,"skybox",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}(t,i,l,o,c):"gradient"===a&&"sky"===t.renderPass&&function(t,r,i,n,o){const s=t.context,a=s.gl,l=t.transform,c=t.getOrCreateProgram("skyboxGradient");r.skyboxGeometry||(r.skyboxGeometry=new Do(s)),s.activeTexture.set(a.TEXTURE0);let u=r.colorRampTexture;u||(u=r.colorRampTexture=new e.T(s,r.colorRamp,a.RGBA)),u.bind(a.LINEAR,a.CLAMP_TO_EDGE);const h=((t,r,i,n,o)=>({u_matrix:t,u_color_ramp:0,u_center_direction:r,u_radius:e.bj(i),u_opacity:n,u_temporal_offset:o}))(l.skyboxMatrix,r.getCenter(t,!1),r.paint.get("sky-gradient-radius"),n,o);t.uploadCommonUniforms(s,c),c.draw(t,a.TRIANGLES,i,Lt.disabled,t.colorModeForRenderPass(),kt.backCW,h,"skyboxGradient",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}(t,i,l,o,c)},debug:function(t,r,i,n,o,s){for(let a=0;a<i.length;a++)if(o){const o=1,l=.8,c=new e.ax(n.r*l,n.g*l,n.b*l,1);Mo(t,r,i[a],n,-o,-o,s),Mo(t,r,i[a],n,-o,o,s),Mo(t,r,i[a],n,o,o,s),Mo(t,r,i[a],n,o,-o,s),Mo(t,r,i[a],c,0,0,s)}else Mo(t,r,i[a],n,0,0,s)},custom:function(t,r,i,n){const o=t.context,s=i.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||"offscreen"===t.renderPass)&&i.isLayerDraped(r)){if("offscreen"===t.renderPass){const r=s.prerender;if(r){if(t.setCustomLayerDefaults(),o.setColorMode(t.colorModeForRenderPass()),"globe"===t.transform.projection.name){const i=t.transform.pointMerc;r.call(s,o.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.S(t.transform.zoom),[i.x,i.y],t.transform.pixelsPerMeterRatio)}else r.call(s,o.gl,t.transform.customLayerMatrix());o.setDirty(),t.setBaseState()}}else if("translucent"===t.renderPass){if(t.terrain&&t.terrain.renderingToTexture){const r=s.renderToTile;if(r){const i=n[0].canonical,a=new e.L(i.x+n[0].wrap*(1<<i.z),i.y,i.z);o.setDepthMode(Ct.disabled),o.setStencilMode(Lt.disabled),o.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),r.call(s,o.gl,a),o.setDirty(),t.setBaseState()}return}t.setCustomLayerDefaults(),o.setColorMode(t.colorModeForRenderPass()),o.setStencilMode(Lt.disabled);const r="3d"===s.renderingMode?new Ct(t.context.gl.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Ct.ReadOnly);if(o.setDepthMode(r),"globe"===t.transform.projection.name){const r=t.transform.pointMerc;s.render(o.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.S(t.transform.zoom),[r.x,r.y],t.transform.pixelsPerMeterRatio)}else s.render(o.gl,t.transform.customLayerMatrix());o.setDirty(),t.setBaseState(),o.bindFramebuffer.set(null)}}else e.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(t,r,i,n){if("opaque"===t.renderPass)return;const o=i.paint.get("model-opacity");if(0===o)return;const s=i.paint.get("model-cast-shadows");if("shadow"===t.renderPass){if(!s)return;if(t.terrain&&o<.65&&i._transitionablePaint._values["model-opacity"].value.expression instanceof e.Z)return}const a=t.shadowRenderer,l=i.paint.get("model-receive-shadows");a&&(a.useNormalOffset=!0,l||(a.enabled=!1));const c=()=>{a&&(a.useNormalOffset=!0,l||(a.enabled=!0))},u=r.getSource();if("light-beam"===t.renderPass&&"batched-model"!==u.type)return;if("vector"===u.type||"geojson"===u.type)return function(t,r,i,n){const o=t.transform;if("mercator"!==o.projection.name)return void e.w(`Drawing 3D models for ${o.projection.name} projection is not yet implemented`);const s=o.getFreeCameraOptions().position;if(!t.modelManager)return;const a=t.modelManager;i.modelManager=a;const l=t.shadowRenderer;if(!i._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const c=i._unevaluatedLayout._values["model-id"],u={...i.layout.get("model-id").parameters};for(const h of n){const n=r.getTile(h).getBucket(i);if(!n||n.projection.name!==o.projection.name)continue;const d=Wo(h,o);u.zoom=d;const p=c.possiblyEvaluate(u);if(qo(t,n,h),Zo.shadowUniformsInitialized=!1,Zo.useSingleShadowCascade=!!l&&0===l.getMaxCascadeForTile(h.toUnwrapped()),"shadow"===t.renderPass&&l){if(1===t.currentShadowCascade&&n.isInsideFirstShadowMapFrustum)continue;const r=o.calculatePosMatrix(h.toUnwrapped(),o.worldSize);if(Zo.tileMatrix.set(r),Zo.shadowTileMatrix=Float32Array.from(l.calculateShadowPassMatrixFromMatrix(r)),Zo.aabb.min.fill(0),Zo.aabb.max[0]=Zo.aabb.max[1]=e.V,Zo.aabb.max[2]=0,Yo(n,Zo,t,i.scope))continue}const f=1<<h.canonical.z,m=[((s.x-h.wrap)*f-h.canonical.x)*e.V,(s.y*f-h.canonical.y)*e.V,s.z*f*e.V];for(let e in n.instancesPerModel){const r=n.instancesPerModel[e];r.features.length>0&&(e=p.evaluate(r.features[0].feature,{}));const o=a.getModel(e,i.scope);if(o&&o.uploaded)for(const e of o.nodes)Ho(t,i,e,r,m,h,Zo)}}}(t,r,i,n),void c();if(!u.loaded())return;if("batched-model"===u.type)return function(t,r,i,n){i.resetLayerRenderingStats(t);const o=t.context,s=t.transform,a=t.style.fog,l=t.shadowRenderer;if("mercator"!==s.projection.name)return void e.w(`Drawing 3D landmark models for ${s.projection.name} projection is not yet implemented`);const c=t.transform.getFreeCameraOptions().position,u=e.N.scale([],[c.x,c.y,c.z],t.transform.worldSize);e.N.negate(u,u);const h=e.a6.identity([]),d=e.cR(s.center.lat,s.zoom),p=e.a6.fromScaling([],[1,1,1/d]);e.a6.translate(h,h,u);const f=i.paint.get("model-opacity"),m=new Ct(o.gl.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D),_=new Ct(o.gl.LEQUAL,Ct.ReadOnly,t.depthRangeFor3D),g=new e.bS([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),y="shadow"===t.renderPass,x=y&&l?l.getCurrentCascadeFrustum():s.getFrustum(s.scaleZoom(s.worldSize)),v=i.getLayerRenderingStats(),b=function(c,u){for(const d of n){const n=r.getTile(d).getBucket(i);if(!n||!n.uploaded)continue;let b=!1;l&&(b=0===l.getMaxCascadeForTile(d.toUnwrapped()));const w=s.calculatePosMatrix(d.toUnwrapped(),s.worldSize),T=n.modelTraits;for(const r of n.getNodesInfo()){if(r.hiddenByReplacement)continue;if(!r.node.meshes)continue;const n=r.evaluatedScale,E=r.node;let S=0;if(t.terrain&&E.elevation&&(S=E.elevation*t.terrain.exaggeration()),n[0]<=1&&n[1]<=1&&n[2]<=1&&0===(()=>{const t=r.getLocalBounds();return g.min=[...t.min],g.max=[...t.max],g.min[2]+=S,g.max[2]+=S,e.N.transformMat4(g.min,g.min,w),e.N.transformMat4(g.max,g.max,w),g})().intersects(x))continue;const M="light-beam"===t.renderPass,A=[...w];e.a6.translate(A,A,[(E.anchor?E.anchor[0]:0)*(n[0]-1),(E.anchor?E.anchor[1]:0)*(n[1]-1),S]),e.N.exactEquals(n,e.cT)||e.a6.scale(A,A,n),e.a6.multiply(A,A,E.matrix);const I=e.a6.multiply([],p,A);e.a6.multiply(I,h,I);const C=e.a6.invert([],I);e.a6.transpose(C,C),e.a6.scale(C,C,Xo);const P=e.a6.multiply([],s.expandedFarZProjMatrix,A),L=T&e.cV.HasMapboxMeshFeatures,R=L?0:r.evaluatedRMEA[0][2];for(let e=0;e<E.meshes.length;++e){const n=E.meshes[e],h=e===E.lightMeshIndex;if(h){if(!M&&!t.terrain&&t.shadowRenderer){t.currentLayer<t.firstLightBeamLayer&&(t.firstLightBeamLayer=t.currentLayer);continue}}else if(M)continue;const p={defines:[]},g=[];if(Vo(p.defines,g,n,t),L||p.defines.push("DIFFUSE_SHADED"),b&&p.defines.push("SHADOWS_SINGLE_CASCADE"),v&&(y?v.numRenderedVerticesInShadowPass+=n.vertexArray.length:v.numRenderedVerticesInTransparentPass+=n.vertexArray.length),y){$o(n,A,t,i);continue}let x=null;if(a){const e=Uo(A,t.transform);if(x=new Float32Array(e),"globe"!==s.projection.name){const t=n.aabb.min,r=n.aabb.max,[i,o]=a.getOpacityForBounds(e,t[0],t[1],r[0],r[1]);p.overrideFog=i>=_e||o>=_e}}const w=n.material;let T;w.occlusionTexture&&w.occlusionTexture.offsetScale&&(T=w.occlusionTexture.offsetScale,p.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!y&&l&&(l.useNormalOffset=!!n.normalBuffer);const S=t.getOrCreateProgram("model",p);!y&&l&&l.setupShadowsFromMatrix(A,S,l.useNormalOffset),t.uploadCommonUniforms(o,S,d.toUnwrapped(),x);const D=w.pbrMetallicRoughness;D.metallicFactor=.9,D.roughnessFactor=.5;const O=Hn(new Float32Array(P),new Float32Array(I),new Float32Array(C),t,f,D.baseColorFactor,w.emissiveFactor,D.metallicFactor,D.roughnessFactor,w,R,i,[0,0,0],T);S.draw(t,o.gl.TRIANGLES,u&&!h?m:_,Lt.disabled,c?h||f<1||r.hasTranslucentParts?Dt.alphaBlended:Dt.unblended:Dt.disabled,kt.backCCW,O,i.id,n.vertexBuffer,n.indexBuffer,n.segments,i.paint,t.transform.zoom,void 0,g)}}}};(function(e,t,r,i){const n=e.terrain?e.terrain.exaggeration():0,o=e.transform.zoom;for(const s of i){const i=t.getTile(s).getBucket(r);i&&(e.conflationActive&&i.updateReplacement(s,e.replacementSource),i.evaluateScale(e,r),e.terrain&&n>0&&i.elevationUpdate(e.terrain,n,s,r.source),i.needsReEvaluation(e,o,r)&&i.evaluate(r))}})(t,r,i,n),1===f?b(!0,!0):(b(!1,!0),b(!0,!1))}(t,r,i,n),void c();const h=u.getModels(),d=[],p=t.transform.getFreeCameraOptions().position,f=e.N.scale([],[p.x,p.y,p.z],t.transform.worldSize);e.N.negate(f,f);const m=[],_=[];let g=0;for(const y of h){const r=i.paint.get("model-rotation").constantOr(null),n=i.paint.get("model-scale").constantOr(null),o=i.paint.get("model-translation").constantOr(null);y.computeModelMatrix(t,r,n,o,!0,!0,!1);const s=e.a6.identity([]),a=e.cR(y.position.lat,t.transform.zoom),l=e.a6.fromScaling([],[1,1,1/a]);e.a6.translate(s,s,f),d.push({zScaleMatrix:l,negCameraPosMatrix:s});for(const e of y.nodes)Go(t.transform,e,y.matrix,t.transform.expandedFarZProjMatrix,g,m,_);g++}if(m.sort(((e,t)=>t.depth-e.depth)),"shadow"!==t.renderPass){if(1===o)for(const e of _)jo(e,t,i,d[e.modelIndex],Lt.disabled,t.colorModeForRenderPass());else{for(const e of _)jo(e,t,i,d[e.modelIndex],Lt.disabled,Dt.disabled);for(const e of _)jo(e,t,i,d[e.modelIndex],t.stencilModeFor3D(),t.colorModeForRenderPass());t.resetStencilClippingMasks()}for(const e of m)jo(e,t,i,d[e.modelIndex],Lt.disabled,t.colorModeForRenderPass());c()}else{for(const e of _)$o(e.mesh,e.nodeModelMatrix,t,i);for(const e of m)$o(e.mesh,e.nodeModelMatrix,t,i);c()}}},ts={model:function(e,t,r){const i=e.scope,n=t.getSource();if(!n.loaded())return;if("vector"===n.type||"geojson"===n.type)return void(r.modelManager&&r.modelManager.upload(r,i));if("batched-model"===n.type)return;const o=n.getModels();for(const s of o)s.upload(r.context)},raster:function(e,t,r){const i=t.getSource();if(!(i instanceof Oe&&i.loaded()))return;const n=e.sourceLayer||i.rasterLayerIds&&i.rasterLayerIds[0];if(!n)return;const o=e.paint.get("raster-array-band")||i.getInitialBand(n);if(null==o)return;const s=t.getIds().map((e=>t.getTileByID(e)));for(const a of s)a.updateNeeded(n,o)&&i.prepareTile(a,n,o)},"raster-particle":function(e,t,r){const i=t.getSource();if(!(i instanceof Oe&&i.loaded()))return;const n=e.sourceLayer||i.rasterLayerIds&&i.rasterLayerIds[0];if(!n)return;const o=e.paint.get("raster-particle-array-band")||i.getInitialBand(n);if(null==o)return;const s=t.getIds().map((e=>t.getTileByID(e)));for(const a of s)a.updateNeeded(n,o)&&i.prepareTile(a,n,o)}};class rs{constructor(t,r,i,n){this.context=new Ft(t,r),this.transform=i,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=n,this._debugParams={showTerrainProxyTiles:!1},n.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),this.setup(),this.numSublayers=Yt.maxUnderzooming+Yt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new e.cX,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new bi(this),this._wireframeDebugCache=new Jo,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(e,t){const r=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(r||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new gn(this,e));const i=this._terrain;this.transform.elevation=r?i:null,i.update(e,this.transform,t),this.transform.elevation&&!i.enabled&&(this.transform.elevation=null)}_updateFog(e){const t=e.fog;if(!t||"globe"===this.transform.projection.name||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[r,i]=t.getFovAdjustedRange(this.transform._fov);if(r>i)return void(this.transform.fogCullDistSq=null);const n=r+.78*(i-r);this.transform.fogCullDistSq=n*n}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,r){if(this.width=t*e.f.devicePixelRatio,this.height=r*e.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style.order)this.style._mergedLayers[e].resize()}setup(){const t=this.context,r=new e.aN;r.emplaceBack(0,0),r.emplaceBack(e.V,0),r.emplaceBack(0,e.V),r.emplaceBack(e.V,e.V),this.tileExtentBuffer=t.createVertexBuffer(r,e.aP.members),this.tileExtentSegments=e.aB.simpleSegment(0,0,4,2);const i=new e.aN;i.emplaceBack(0,0),i.emplaceBack(e.V,0),i.emplaceBack(0,e.V),i.emplaceBack(e.V,e.V),this.debugBuffer=t.createVertexBuffer(i,e.aP.members),this.debugSegments=e.aB.simpleSegment(0,0,4,5);const n=new e.aN;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(-1,1),n.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(n,e.aP.members),this.viewportSegments=e.aB.simpleSegment(0,0,4,2);const o=new e.av;o.emplaceBack(0,0,0,0),o.emplaceBack(e.V,0,e.V,0),o.emplaceBack(0,e.V,0,e.V),o.emplaceBack(e.V,e.V,e.V,e.V),this.mercatorBoundsBuffer=t.createVertexBuffer(o,e.aR.members),this.mercatorBoundsSegments=e.aB.simpleSegment(0,0,4,2);const s=new e.aw;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(s);const a=new e.aO;for(const e of[0,1,3,2,0])a.emplaceBack(e);this.debugIndexBuffer=t.createIndexBuffer(a),this.emptyTexture=new e.T(t,new e.h({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=e.a6.create();const l=this.context.gl;this.stencilClearMode=new Lt({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,Ct.disabled,this.stencilClearMode,Dt.disabled,kt.disabled,dn(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,t,r){if(!t||this.currentStencilSource===t.id||!e.isTileClipped()||!r||0===r.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of r)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=t.id;const i=this.context,n=i.gl;this.nextStencilID+r.length>256&&this.clearStencil(),i.setColorMode(Dt.disabled),i.setDepthMode(Ct.disabled);const o=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const s of r){const e=t.getTile(s),r=this._tileClippingMaskIDs[s.key]=this.nextStencilID++,{tileBoundsBuffer:i,tileBoundsIndexBuffer:a,tileBoundsSegments:l}=this.getTileBoundsBuffers(e);o.draw(this,n.TRIANGLES,Ct.disabled,new Lt({func:n.ALWAYS,mask:0},r,255,n.KEEP,n.KEEP,n.REPLACE),Dt.disabled,kt.disabled,dn(s.projMatrix),"$clipping",i,a,l)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,t=this.context.gl;return new Lt({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const t=this.context.gl;return new Lt({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}stencilConfigForOverlap(e){const t=this.context.gl,r=e.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),i=r[r.length-1].overscaledZ,n=r[0].overscaledZ-i+1;if(n>1){this.currentStencilSource=void 0,this.nextStencilID+n>256&&this.clearStencil();const e={};for(let r=0;r<n;r++)e[r+i]=new Lt({func:t.GEQUAL,mask:255},r+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=n,[e,r]}return[{[i]:Lt.disabled},r]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const r=1/8;return new Dt([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new e.ax(r,r,r,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Dt.unblended:Dt.alphaBlended}colorModeForDrapableLayerRenderPass(t){const r=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new Dt([r.ONE,r.ONE_MINUS_SRC_ALPHA,r.CONSTANT_ALPHA,r.ONE_MINUS_SRC_ALPHA],new e.ax(0,0,0,void 0===t?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,t,r,i=!1){if(!this.opaquePassEnabledForLayer()&&!i)return Ct.disabled;const n=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Ct(r||this.context.gl.LEQUAL,t,[n,n])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,r){this._wireframeDebugCache.update(this.frameCounter),this.style=t,this.options=r;const i=this.style._mergedLayers,n=this.style.order,o=n.map((e=>i[e])),s=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.f.now()),this.imageManager.beginFrame();let a=0,l=!1;for(const e in s){const t=s[e];t.used&&(t.prepare(this.context),t.getSource().usedInConflation&&++a)}for(const e of o)e.isHidden(this.transform.zoom)||this.prepareLayer(e);const c={},u={},h={},d={},p={};for(const e in s){const t=s[e];c[e]=t.getVisibleCoordinates(),u[e]=c[e].slice().reverse(),h[e]=t.getVisibleCoordinates(!0).reverse(),d[e]=t.getShadowCasterCoordinates(),p[e]=t.sortCoordinatesByDistance(c[e])}const f=e=>{const t=this.style.getLayerSourceCache(e);return t&&t.used?t.getSource():null};if(a){const e=[];for(const t of o)this.layerUsedInConflation(t,f(t))&&e.push(t);if(e&&e.length>1){const t=[];for(const r of e){const e=this.style.getLayerSourceCache(r);e&&e.used&&e.getSource().usedInConflation&&t.push({layer:r.fqid,cache:e})}this.replacementSource.setSources(t),l=!0}}l||this.replacementSource.clear(),this.conflationActive=l,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const e of o){const t=e.cutoffRange();if(this.longestCutoffRange=Math.max(t,this.longestCutoffRange),t>0){const t=f(e);t&&(this.minCutoffZoom=Math.max(t.minzoom,this.minCutoffZoom)),e.minzoom&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let e=0;e<o.length;e++)if(o[e].is3D()){this.opaquePassCutoff=e;break}const m=this.style&&this.style.fog;m?(this._fogVisible=0!==m.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=m.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(h),this.opaquePassCutoff=0);const _=this._shadowRenderer;if(_){_.updateShadowParameters(this.transform,this.style.directionalLight);for(const e in s)for(const t of c[e]){let e={min:0,max:0};this.terrain&&(e=this.terrain.getMinMaxForTile(t)||e),_.addShadowReceiver(t.toUnwrapped(),e.min,e.max)}}if("globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new e.cY(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new No(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!e.cZ(this.context.gl))return;this.renderPass="offscreen";for(const e of o){const r=t.getLayerSourceCache(e);if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;const i=r?u[r.id]:void 0;("custom"===e.type||"raster"===e.type||"raster-particle"===e.type||e.isSky()||i&&i.length)&&this.renderLayer(this,r,e,i)}this.depthRangeFor3D=[0,1-(o.length+2)*this.numSublayers*this.depthEpsilon];const g=this.terrain;g&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&g.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,d)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const y="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),x=(()=>{if(r.showOverdrawInspector)return e.ax.black;if(this.style.fog&&this.transform.projection.supportsFog&&!y){const t=this.style.fog.properties.get("color").toArray01();return new e.ax(...t)}if(this.style.fog&&this.transform.projection.supportsFog&&y){const t=this.style.fog.properties.get("space-color").toArray01();return new e.ax(...t)}return e.ax.transparent})();if(this.context.clear({color:x,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=n.length-1;this.currentLayer>=0;this.currentLayer--){const e=o[this.currentLayer],r=t.getLayerSourceCache(e);if(e.isSky())continue;const i=r?(e.is3D()?p:u)[r.id]:void 0;this._renderTileClippingMasks(e,r,i),this.renderLayer(this,r,e,i)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||e.S(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<n.length;this.currentLayer++){const e=o[this.currentLayer],r=t.getLayerSourceCache(e);e.isSky()&&this.renderLayer(this,r,e,r?u[r.id]:void 0)}function v(e,t){let r;return t&&(r=("symbol"===e.type?h:e.is3D()?p:u)[t.id]),r}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<n.length;){const e=o[this.currentLayer];if("raster"===e.type){const r=t.getLayerSourceCache(e);this.renderLayer(this,r,e,v(e,r))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let b=0;for(_&&(b=_.getShadowCastingLayerCount());this.currentLayer<n.length;){const e=o[this.currentLayer],r=t.getLayerSourceCache(e);if(e.isSky())++this.currentLayer;else if(g&&this.style.isLayerDraped(e)){if(e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=g.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(e,r,r?c[r.id]:void 0),this.renderLayer(this,r,e,v(e,r)),!g&&_&&b>0&&e.hasShadowPass()&&0==--b&&(_.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const e=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=e;this.currentLayer++){const e=o[this.currentLayer];if(!e.hasLightBeamPass())continue;const r=t.getLayerSourceCache(e);this.renderLayer(this,r,e,r?u[r.id]:void 0)}this.currentLayer=e,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let r=null;o.forEach((e=>{const i=t.getLayerSourceCache(e);i&&!e.isHidden(this.transform.zoom)&&i.getVisibleCoordinates().length&&(!r||r.getSource().maxzoom<i.getSource().maxzoom)&&(r=i)})),r&&this.options.showTileBoundaries&&es.debug(this,r,r.getVisibleCoordinates(),e.ax.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&es.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new e.ax(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(e){const t=e.transform.padding;Ao(e,e.transform.height-(t.top||0),3,bo),Ao(e,t.bottom||0,3,wo),Io(e,t.left||0,3,To),Io(e,e.transform.width-(t.right||0),3,Eo);const r=e.transform.centerPoint;!function(e,t,r,i){Co(e,t-1,r-10,2,20,i),Co(e,t-10,r-1,20,2,i)}(e,r.x,e.transform.height-r.y,So)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),l||(this.conflationActive=!1)}prepareLayer(e){this.gpuTimingStart(e);const{unsupportedLayers:t}=this.transform.projection,r=!t||!t.includes(e.type);if(ts[e.type]&&(r||this.terrain&&"custom"===e.type)){const t=this.style.getLayerSourceCache(e);ts[e.type](e,t,this)}this.gpuTimingEnd()}renderLayer(e,t,r,i){r.isHidden(this.transform.zoom)||("background"===r.type||"sky"===r.type||"custom"===r.type||"model"===r.type||"raster"===r.type||"raster-particle"===r.type||i&&i.length)&&(this.id=r.id,this.gpuTimingStart(r),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(r.type)||e.terrain&&"custom"===r.type)&&es[r.type](e,t,r,i,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery,r=this.context.gl;let i=this.gpuTimers[e.id];i||(i=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:r.createQuery()}),i.calls++,r.beginQuery(t.TIME_ELAPSED_EXT,i.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,t=this.context.gl,r=t.createQuery();this.deferredRenderGpuTimeQueries.push(r),t.beginQuery(e.TIME_ELAPSED_EXT,r)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const t={};for(const r in e){const i=e[r],n=this.context.extTimerQuery,o=n.getQueryParameter(i.query,this.context.gl.QUERY_RESULT)/1e6;n.deleteQueryEXT(i.query),t[r]=o}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const t=this.context.extTimerQuery,r=this.context.gl;let i=0;for(const n of e)i+=t.getQueryParameter(n,r.QUERY_RESULT)/1e6,t.deleteQueryEXT(n);return i}translatePosMatrix(t,r,i,n,o){if(!i[0]&&!i[1])return t;const s=o?"map"===n?this.transform.angle:0:"viewport"===n?-this.transform.angle:0;if(s){const e=Math.sin(s),t=Math.cos(s);i=[i[0]*t-i[1]*e,i[0]*e+i[1]*t]}const a=[o?i[0]:e.a3(r,i[0],this.transform.zoom),o?i[1]:e.a3(r,i[1],this.transform.zoom),0],l=new Float32Array(16);return e.a6.translate(l,t,a),l}saveTileTexture(e){const t=e.size[0],r=this._tileTextures[t];r?r.push(e):this._tileTextures[t]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e,t){return null===e||void 0!==e&&!this.imageManager.getPattern(e.toString(),t)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(e,t,r){const i=void 0===r?this.terrain&&this.terrain.renderingToTexture:r,n=this.terrain&&0===this.terrain.exaggeration(),o=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===e||"terrainRaster"===e?(o.push("LIGHTING_3D_MODE"),o.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):i||o.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||o.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?o.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):o.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(o.push("TERRAIN"),this.linearFloatFilteringSupported()&&o.push("TERRAIN_DEM_FLOAT_FORMAT"),n&&o.push("ZERO_EXAGGERATION")),"globe"===this.transform.projection.name&&o.push("GLOBE"),!this._fogVisible||i||void 0!==t&&!t||o.push("FOG","FOG_DITHERING"),i&&o.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&o.push("OVERDRAW_INSPECTOR"),o}getOrCreateProgram(e,t){this.cache=this.cache||{};const r=t&&t.defines||[],i=t&&t.config,n=t&&t.transformFeedback,o=this.currentGlobalDefines(e,t&&t.overrideFog,t&&t.overrideRtt).concat(r),s=bn.cacheKey(Xi[e],e,o,i);return this.cache[s]||(this.cache[s]=new bn(this.context,e,Xi[e],i,Kn[e],o,n)),this.cache[s]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,r){if(this.style.enable3dLights()){const i=this.style.directionalLight,n=this.style.ambientLight;if(i&&n){const o=((t,r)=>{const i=t.properties.get("direction"),n=t.properties.get("color").toArray01(),o=t.properties.get("intensity"),s=r.properties.get("color").toArray01(),a=r.properties.get("intensity"),l=[i.x,i.y,i.z],c=e.cn(s,a),u=e.cn(n,o);return{u_lighting_ambient_color:c,u_lighting_directional_dir:l,u_lighting_directional_color:u,u_ground_radiance:yn(l,u,c)}})(i,n);r.setLightsUniformValues(t,o)}}}uploadCommonUniforms(t,r,i,n,o){if(this.uploadCommonLightUniforms(t,r),this.terrain&&this.terrain.renderingToTexture)return;const s=this.style.fog;if(s){const o=s.getOpacity(this.transform.pitch),a=((t,r,i,n,o,s,a,l,c,u,h,d)=>{const p=t.transform,f=r.properties.get("color").toArray01();f[3]=n;const m=t.frameCounter/1e3%1,[_,g]=r.properties.get("vertical-range");return{u_fog_matrix:i?p.calculateFogTileMatrix(i):d||t.identityMat,u_fog_range:r.getFovAdjustedRange(p._fov),u_fog_color:f,u_fog_horizon_blend:r.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(_,g),g],u_fog_temporal_offset:m,u_frustum_tl:o,u_frustum_tr:s,u_frustum_br:a,u_frustum_bl:l,u_globe_pos:c,u_globe_radius:u,u_viewport:h,u_globe_transition:e.S(p.zoom),u_is_globe:+("globe"===p.projection.name)}})(this,s,i,o,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*e.f.devicePixelRatio,this.transform.height*e.f.devicePixelRatio],n);r.setFogUniformValues(t,a)}o&&r.setCutoffUniformValues(t,o.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,t=this._backgroundTiles={},r=this.transform.coveringTiles({tileSize:512});for(const i of r)t[i.key]=e[i.key]||new Vt(i,512,this.transform.tileZoom,this);return t}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(e,t){return!(!e.is3D()||e.minzoom&&e.minzoom>this.transform.zoom||"building"!==e.sourceLayer&&(!t||"batched-model"!==t.type))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let t=this._cachedTileFogOpacities[e.key];return t||(this._cachedTileFogOpacities[e.key]=t=this.style.fog.getOpacityForTile(e)),t[0]>=_e||t[1]>=_e}}function is(e,t){let r=!1,i=null;const n=()=>{i=null,r&&(e(),i=setTimeout(n,t),r=!1)};return()=>(r=!0,i||n(),i)}class ns{constructor(t){this._hashName=t&&encodeURIComponent(t),e.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=is(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,window.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const e=this._map;if(!e)return"";const t=os(e);if(this._hashName){const e=this._hashName;let r=!1;const i=location.hash.slice(1).split("&").map((i=>{const n=i.split("=")[0];return n===e?(r=!0,`${n}=${t}`):i})).filter((e=>e));return r||i.push(`${e}=${t}`),`#${i.join("&")}`}return`#${t}`}_getCurrentHash(){const e=location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map((e=>e.split("="))).forEach((e=>{e[0]===this._hashName&&(t=e)})),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const t=this._getCurrentHash();if(t.length>=3&&!t.some((e=>isNaN(e)))){const r=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(t[3]||0):e.getBearing();return e.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:r,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function os(e,t){const r=e.getCenter(),i=Math.round(100*e.getZoom())/100,n=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,n),s=Math.round(r.lng*o)/o,a=Math.round(r.lat*o)/o,l=e.getBearing(),c=e.getPitch();let u=t?`/${s}/${a}/${i}`:`${i}/${a}/${s}`;return(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+=`/${Math.round(c)}`),u}const ss={linearity:.3,easing:e.c_(0,0,.3,1)},as=e.e({deceleration:2500,maxSpeed:1400},ss),ls=e.e({deceleration:20,maxSpeed:1400},ss),cs=e.e({deceleration:1e3,maxSpeed:360},ss),us=e.e({deceleration:1e3,maxSpeed:90},ss);class hs{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.f.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=e.f.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,pan:new e.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)r.zoom+=e.zoomDelta||0,r.bearing+=e.bearingDelta||0,r.pitch+=e.pitchDelta||0,e.panDelta&&r.pan._add(e.panDelta),e.around&&(r.around=e.around),e.pinchAround&&(r.pinchAround=e.pinchAround);const i=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,n={};if(r.pan.mag()){const o=ps(r.pan.mag(),i,e.e({},as,t||{}));n.offset=r.pan.mult(o.amount/r.pan.mag()),n.center=this._map.transform.center,ds(n,o)}if(r.zoom){const e=ps(r.zoom,i,ls);n.zoom=this._map.transform.zoom+e.amount,ds(n,e)}if(r.bearing){const t=ps(r.bearing,i,cs);n.bearing=this._map.transform.bearing+e.aa(t.amount,-179,179),ds(n,t)}if(r.pitch){const e=ps(r.pitch,i,us);n.pitch=this._map.transform.pitch+e.amount,ds(n,e)}if(n.zoom||n.bearing){const e=void 0===r.pinchAround?r.around:r.pinchAround;n.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),n.noMoveStart=!0,n}}function ds(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function ps(t,r,i){const{maxSpeed:n,linearity:o,deceleration:s}=i,a=e.aa(t*o/(r/1e3),-n,n),l=Math.abs(a)/(s*o);return{easing:i.easing,duration:1e3*l,amount:a*(l/2)}}class fs extends e.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,i,n={}){const o=f(r.getCanvasContainer(),i),s=r.unproject(o);super(t,e.e({point:o,lngLat:s,originalEvent:i},n)),this._defaultPrevented=!1,this.target=r}}class ms extends e.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,i){const n="touchend"===t?i.changedTouches:i.touches,o=m(r.getCanvasContainer(),n),s=o.map((e=>r.unproject(e))),a=o.reduce(((e,t,r,i)=>e.add(t.div(i.length))),new e.P(0,0));super(t,{points:o,point:a,lngLats:s,lngLat:r.unproject(a),originalEvent:i}),this._defaultPrevented=!1}}class _s extends e.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,r){super(e,{originalEvent:r}),this._defaultPrevented=!1}}class gs{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new _s(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new fs(e.type,this._map,e))}mouseup(e){this._map.fire(new fs(e.type,this._map,e))}preclick(t){const r=e.e({},t);r.type="preclick",this._map.fire(new fs(r.type,this._map,r))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new fs(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new fs(e.type,this._map,e))}mouseover(e){this._map.fire(new fs(e.type,this._map,e))}mouseout(e){this._map.fire(new fs(e.type,this._map,e))}touchstart(e){return this._firePreventable(new ms(e.type,this._map,e))}touchmove(e){this._map.fire(new ms(e.type,this._map,e))}touchend(e){this._map.fire(new ms(e.type,this._map,e))}touchcancel(e){this._map.fire(new ms(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ys{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new fs(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new fs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new fs(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xs{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(u(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const r=t,i=this._startPos,n=this._lastPos;if(!i||!n||n.equals(r)||!this._box&&r.dist(i)<this._clickTolerance)return;this._lastPos=r,this._box||(this._box=o("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const s=Math.min(i.x,r.x),a=Math.max(i.x,r.x),l=Math.min(i.y,r.y),c=Math.max(i.y,r.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${s}px,${l}px)`,this._box.style.width=a-s+"px",this._box.style.height=c-l+"px")}))}mouseupWindow(t,r){if(!this._active)return;const i=this._startPos,n=r;if(i&&0===t.button){if(this.reset(),p(),i.x!==n.x||i.y!==n.y)return this._map.fire(new e.b("boxzoomend",{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(i,n,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),h(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new e.b(t,{originalEvent:r}))}}function vs(e,t){const r={};for(let i=0;i<e.length;i++)r[e[i].identifier]=t[i];return r}class bs{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,r,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),i.length===this.numTouches&&(this.centroid=function(t){const r=new e.P(0,0);for(const e of t)r._add(e);return r.div(t.length)}(r),this.touches=vs(i,r)))}touchmove(e,t,r){if(this.aborted||!this.centroid)return;const i=vs(r,t);for(const n in this.touches){const e=i[n];(!e||e.dist(this.touches[n])>30)&&(this.aborted=!0)}}touchend(e,t,r){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===r.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class ws{constructor(e){this.singleTap=new bs(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,t,r){this.singleTap.touchstart(e,t,r)}touchmove(e,t,r){this.singleTap.touchmove(e,t,r)}touchend(e,t,r){const i=this.singleTap.touchend(e,t,r);if(i){const t=e.timeStamp-this.lastTime<500,r=!this.lastTap||this.lastTap.dist(i)<30;if(t&&r||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=i,this.count===this.numTaps)return this.reset(),i}}}class Ts{constructor(){this._zoomIn=new ws({numTouches:1,numTaps:2}),this._zoomOut=new ws({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,r){this._zoomIn.touchstart(e,t,r),this._zoomOut.touchstart(e,t,r)}touchmove(e,t,r){this._zoomIn.touchmove(e,t,r),this._zoomOut.touchmove(e,t,r)}touchend(e,t,r){const i=this._zoomIn.touchend(e,t,r),n=this._zoomOut.touchend(e,t,r);return i?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(i)},{originalEvent:e})}):n?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(n)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Es={0:1,2:2};class Ss{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const r=_(e);this._correctButton(e,r)&&(this._lastPoint=t,this._eventButton=r)}mousemoveWindow(e,t){const r=this._lastPoint;if(r)if(e.preventDefault(),null!=this._eventButton&&function(e,t){const r=Es[t];return void 0===e.buttons||(e.buttons&r)!==r}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(r)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(r,t)}mouseupWindow(e){this._lastPoint&&_(e)===this._eventButton&&(this._moved&&p(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ms extends Ss{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class As extends Ss{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const r=.8*(t.x-e.x);if(r)return this._active=!0,{bearingDelta:r}}contextmenu(e){e.preventDefault()}}class Is extends Ss{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const r=-.5*(t.y-e.y);if(r)return this._active=!0,{pitchDelta:r}}contextmenu(e){e.preventDefault()}}class Cs{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=r.clickTolerance||1,this.reset(),e.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new e.P(0,0)}touchstart(e,t,r){return this._calculateTransform(e,t,r)}touchmove(t,r,i){if(this._active&&!(i.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===i.length&&!e.c$())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,r,i)}}touchend(e,t,r){this._calculateTransform(e,t,r),this._active&&r.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,i){i.length>0&&(this._active=!0);const n=vs(i,r),o=new e.P(0,0),s=new e.P(0,0);let a=0;for(const e in n){const t=n[e],r=this._touches[e];r&&(o._add(t),s._add(t.sub(r)),a++,n[e]=t)}if(this._touches=n,a<this._minTouches||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class Ps{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,t,r){return{}}touchstart(e,t,r){this._firstTwoTouches||r.length<2||(this._firstTwoTouches=[r[0].identifier,r[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,r){const i=this._firstTwoTouches;if(!i)return;e.preventDefault();const[n,o]=i,s=Ls(r,t,n),a=Ls(r,t,o);if(!s||!a)return;const l=this._aroundCenter?null:s.add(a).div(2);return this._move([s,a],l,e)}touchend(e,t,r){if(!this._firstTwoTouches)return;const[i,n]=this._firstTwoTouches,o=Ls(r,t,i),s=Ls(r,t,n);o&&s||(this._active&&p(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ls(e,t,r){for(let i=0;i<e.length;i++)if(e[i].identifier===r)return t[i]}function Rs(e,t){return Math.log(e/t)/Math.LN2}class Ds extends Ps{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const r=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Rs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Rs(this._distance,r),pinchAround:t}}}function Os(e,t){return 180*e.angleWith(t)/Math.PI}class zs extends Ps{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const r=this._vector;if(this._vector=e[0].sub(e[1]),r&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Os(this._vector,r),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,r=this._startVector;if(!r)return!1;const i=Os(e,r);return Math.abs(i)<t}}function ks(e){return Math.abs(e.y)>Math.abs(e.x)}class Fs extends Ps{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,ks(e[0].sub(e[1]))&&(this._valid=!1)}_move(t,r,i){const n=this._lastPoints;if(!n)return;const o=t[0].sub(n[0]),s=t[1].sub(n[1]);return this._map._cooperativeGestures&&!e.c$()&&i.touches.length<3||(this._valid=this.gestureBeginsVertically(o,s,i.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(o.y+s.y)/2*-.5})}gestureBeginsVertically(e,t,r){if(void 0!==this._valid)return this._valid;const i=e.mag()>=2,n=t.mag()>=2;if(!i&&!n)return;if(!i||!n)return null==this._firstMove&&(this._firstMove=r),r-this._firstMove<100&&void 0;const o=e.y>0==t.y>0;return ks(e)&&ks(t)&&o}}const Bs={panStep:100,bearingStep:15,pitchStep:10};class Ns{constructor(){const e=Bs;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,r=0,i=0,n=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?r=-1:(e.preventDefault(),n=-1);break;case 39:e.shiftKey?r=1:(e.preventDefault(),n=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(r=0,i=0),{cameraAnimation:s=>{const a=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:Us,zoom:t?Math.round(a)+t*(e.shiftKey?2:1):a,bearing:s.getBearing()+r*this._bearingStep,pitch:s.getPitch()+i*this._pitchStep,offset:[-n*this._panStep,-o*this._panStep],center:s.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Us(e){return e*(2-e)}const Vs=4.000244140625,js=1/450;class Gs{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._handler=r,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=js,e.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||e.c$()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const i=e.f.now(),n=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==r&&r%Vs==0?this._type="wheel":0!==r&&Math.abs(r)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(n*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=f(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._map.transform;"wheel"===this._type&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const r=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>Vs?this._wheelZoomRate:this._defaultZoomRate;let i=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==i&&(i=1/i);const n=r(),o=Math.pow(2,n),s="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(s*i))),"wheel"===this._type&&(this._startZoom=n,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const i="number"==typeof this._targetZoom?this._targetZoom:r(),n=this._startZoom,o=this._easing;let s,a=!1;if("wheel"===this._type&&n&&o){const t=Math.min((e.f.now()-this._lastWheelEventTime)/200,1),r=o(t);s=e.U(n,i,r),t<1?this._frameId||(this._frameId=!0):a=!0}else s=i,a=!0;this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let l=s-r();return l*this._lastDelta<0&&(l=0),{noInertia:!0,needsRenderFrame:!a,zoomDelta:l,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=e.d0;if(this._prevEase){const t=this._prevEase,i=(e.f.now()-t.start)/t.duration,n=t.easing(i+.01)-t.easing(i),o=.27/Math.sqrt(n*n+1e-4)*.01,s=Math.sqrt(.0729-o*o);r=e.c_(o,s,.25,1)}return this._prevEase={start:e.f.now(),duration:t,easing:r},r}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class $s{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class qs{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,t){return e.preventDefault(),{cameraAnimation:r=>{r.easeTo({duration:300,zoom:r.getZoom()+(e.shiftKey?-1:1),around:r.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zs{constructor(){this._tap=new ws({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,t,r){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?r.length>0&&(this._swipePoint=t[0],this._swipeTouch=r[0].identifier):this._tap.touchstart(e,t,r))}touchmove(e,t,r){if(this._tapTime){if(this._swipePoint){if(r[0].identifier!==this._swipeTouch)return;const i=t[0],n=i.y-this._swipePoint.y;return this._swipePoint=i,e.preventDefault(),this._active=!0,{zoomDelta:n/128}}}else this._tap.touchmove(e,t,r)}touchend(e,t,r){this._tapTime?this._swipePoint&&0===r.length&&this.reset():this._tap.touchend(e,t,r)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ws{constructor(e,t,r){this._el=e,this._mousePan=t,this._touchPan=r}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Hs{constructor(e,t,r){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=r}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Xs{constructor(e,t,r,i){this._el=e,this._touchZoom=t,this._touchRotate=r,this._tapDragZoom=i,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ys=e=>e.zoom||e.drag||e.pitch||e.rotate;class Ks extends e.b{}class Js{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,r){const i=e.N.sub([],r,t);this.radius=e.N.length(i[2]<0?e.N.div([],i,this.constants):[i[0],i[1],0])}projectRay(t){e.N.div(t,t,this.constants),e.N.normalize(t,t),e.N.mul(t,t,this.constants);const r=e.N.scale([],t,this.radius);if(r[2]>0){const t=e.N.scale([],[0,0,1],e.N.dot(r,[0,0,1])),i=e.N.scale([],e.N.normalize([],[r[0],r[1],0]),this.radius),n=e.N.add([],r,e.N.scale([],e.N.sub([],e.N.add([],i,t),r),2));r[0]=n[0],r[1]=n[1]}return r}}function Qs(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class ea{constructor(t,r){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new hs(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Js,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(r),e.aY(["handleEvent","handleWindowEvent"],this);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];for(const[e,n,o]of this._listeners){const t=e===document?this.handleWindowEvent:this.handleEvent;e.addEventListener(n,t,o)}}destroy(){for(const[e,t,r]of this._listeners){const i=e===document?this.handleWindowEvent:this.handleEvent;e.removeEventListener(t,i,r)}}_addDefaultHandlers(e){const t=this._map,r=t.getCanvasContainer();this._add("mapEvent",new gs(t,e));const i=t.boxZoom=new xs(t,e);this._add("boxZoom",i);const n=new Ts,o=new qs;t.doubleClickZoom=new $s(o,n),this._add("tapZoom",n),this._add("clickZoom",o);const s=new Zs;this._add("tapDragZoom",s);const a=t.touchPitch=new Fs(t);this._add("touchPitch",a);const l=new As(e),c=new Is(e);t.dragRotate=new Hs(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new Ms(e),h=new Cs(t,e);t.dragPan=new Ws(r,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const d=new zs,p=new Ds;t.touchZoomRotate=new Xs(r,p,d,s),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ys(t));const f=t.scrollZoom=new Gs(t,this);this._add("scrollZoom",f,["mousePan"]);const m=t.keyboard=new Ns;this._add("keyboard",m);for(const _ of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[_]&&t[_].enable(e[_])}_add(e,t,r){this._handlers.push({handlerName:e,handler:t,allowed:r}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ys(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,t,r){for(const i in e)if(i!==r&&(!t||t.indexOf(i)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const t=[];for(const r of e)this._el.contains(r.target)&&t.push(r);return t}handleEvent(e,t){this._updatingCamera=!0;const r="renderFrame"===e.type,i=r?void 0:e,n={needsRenderFrame:!1},o={},s={},a=e.touches?this._getMapTouches(e.touches):void 0,l=a?m(this._el,a):r?void 0:f(this._el,e);for(const{handlerName:h,handler:d,allowed:p}of this._handlers){if(!d.isEnabled())continue;let r;this._blockedByActive(s,p,h)?d.reset():d[t||e.type]&&(r=d[t||e.type](e,l,a),this.mergeHandlerResult(n,o,r,h,i),r&&r.needsRenderFrame&&this._triggerRenderFrame()),(r||d.isActive())&&(s[h]=d)}const c={};for(const h in this._previousActiveHandlers)s[h]||(c[h]=i);this._previousActiveHandlers=s,(Object.keys(c).length||Qs(n))&&(this._changes.push([n,o,c]),this._triggerRenderFrame()),(Object.keys(s).length||Qs(n))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=n;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(t,r,i,n,o){if(!i)return;e.e(t,i);const s={handlerName:n,originalEvent:i.originalEvent||o};void 0!==i.zoomDelta&&(r.zoom=s),void 0!==i.panDelta&&(r.drag=s),void 0!==i.pitchDelta&&(r.pitch=s),void 0!==i.bearingDelta&&(r.rotate=s)}_applyChanges(){const t={},r={},i={};for(const[n,o,s]of this._changes)n.panDelta&&(t.panDelta=(t.panDelta||new e.P(0,0))._add(n.panDelta)),n.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+n.zoomDelta),n.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+n.bearingDelta),n.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+n.pitchDelta),void 0!==n.around&&(t.around=n.around),void 0!==n.aroundCoord&&(t.aroundCoord=n.aroundCoord),void 0!==n.pinchAround&&(t.pinchAround=n.pinchAround),n.noInertia&&(t.noInertia=n.noInertia),e.e(r,o),e.e(i,s);this._updateMapTransform(t,r,i),this._changes=[]}_updateMapTransform(t,r,i){const n=this._map,o=n.transform,s=e=>[e.x,e.y,e.z];if((e=>{const t=this._eventsInProgress.drag;return t&&!this._handlersById[t.handlerName].isActive()})()&&!Qs(t)){const e=o.zoom;o.cameraElevationReference="sea",null!=this._originalZoom&&o._orthographicProjectionAtLowPitch&&"globe"!==o.projection.name&&0===o.pitch?(o.cameraElevationReference="ground",o.zoom=this._originalZoom):(o.recenterOnTerrain(),o.cameraElevationReference="ground"),e!==o.zoom&&this._map._update(!0)}if(o._isCameraConstrained&&n._stop(!0),!Qs(t))return void this._fireEvents(r,i,!0);let{panDelta:a,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:h,aroundCoord:d,pinchAround:p}=t;o._isCameraConstrained&&(l>0&&(l=0),o._isCameraConstrained=!1),void 0!==p&&(h=p),(l||(e=>r[e]&&!this._eventsInProgress[e])("drag"))&&h&&(this._dragOrigin=s(o.pointCoordinate3D(h)),this._originalZoom=o.zoom,this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",n._stop(!0),h=h||n.transform.centerPoint,c&&(o.bearing+=c),u&&(o.pitch+=u),o._updateCameraState();const f=[0,0,0];if(a)if("mercator"===o.projection.name){const e=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(h).dir),t=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(h.sub(a)).dir);f[0]=t[0]-e[0],f[1]=t[1]-e[1]}else{const t=o.pointCoordinate(h);if("globe"===o.projection.name){a=a.rotate(-o.angle);const r=o._pixelsPerMercatorPixel/o.worldSize;f[0]=-a.x*e.d1(e.au(t.y))*r,f[1]=-a.y*e.d1(o.center.lat)*r}else{const e=o.pointCoordinate(h.sub(a));t&&e&&(f[0]=e.x-t.x,f[1]=e.y-t.y)}}const m=o.zoom,_=[0,0,0];if(l){const t=s(d||o.pointCoordinate3D(h)),r={dir:e.N.normalize([],e.N.sub([],t,o._camera.position))};if(r.dir[2]<0){const i=o.zoomDeltaToMovement(t,l);e.N.scale(_,r.dir,i)}}const g=e.N.add(f,f,_);o._translateCameraConstrained(g),l&&Math.abs(o.zoom-m)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,i,!0)}_fireEvents(t,r,i){const n=Ys(this._eventsInProgress),o=Ys(t),s={};for(const e in t){const{originalEvent:r}=t[e];this._eventsInProgress[e]||(s[`${e}start`]=r),this._eventsInProgress[e]=t[e]}!n&&o&&this._fireEvent("movestart",o.originalEvent);for(const e in s)this._fireEvent(e,s[e]);o&&this._fireEvent("move",o.originalEvent);for(const e in t){const{originalEvent:r}=t[e];this._fireEvent(e,r)}const a={};let l;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:i}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],l=r[t]||i,a[`${e}end`]=l)}for(const e in a)this._fireEvent(e,a[e]);const c=Ys(this._eventsInProgress);if(i&&(n||o)&&!c){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),r=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;t?(r(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:l})):(this._map.fire(new e.b("moveend",{originalEvent:l})),r(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new e.b(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{this._frameId=void 0,this.handleEvent(new Ks("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const ta="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ra extends e.E{constructor(t,r){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,this._respectPrefersReducedMotion=!1!==r.respectPrefersReducedMotion,e.aY(["_renderFrameCallback"],this)}getCenter(){return new e.bn(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,r,i){return t=e.P.convert(t).mult(-1),this.panTo(this.transform.center,e.e({offset:t},r),i)}panTo(t,r,i){return this.easeTo(e.e({center:t},r),i)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(t,r,i){return this.easeTo(e.e({zoom:t},r),i)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,r,i){return this.easeTo(e.e({bearing:t},r),i)}resetNorth(t,r){return this.rotateTo(0,e.e({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(e.e({bearing:0,pitch:0,duration:1e3},t),r),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(t,r){t=e.ad.convert(t);const i=r&&r.bearing||0,n=r&&r.pitch||0,o=t.getNorthWest(),s=t.getSouthEast();return this._cameraForBounds(this.transform,o,s,i,n,r)}_extendCameraOptions(t){const r={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=e.e({padding:r,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const e=t.padding;t.padding={top:e,bottom:e,right:e,left:e}}return t.padding=e.e(r,t.padding),t}_minimumAABBFrustumDistance(e,t){const r=t.max[0]-t.min[0],i=t.max[1]-t.min[1];return r/i>e.aspect?r/(2*Math.tan(.5*e.fovX)*e.aspect):i/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(t,r,i,n,o,s){const a=t.clone(),l=this._extendCameraOptions(s);a.bearing=n,a.pitch=o;const c=e.bn.convert(r),u=e.bn.convert(i),h=.5*(c.lat+u.lat),d=.5*(c.lng+u.lng),p=e.d2(h,d),f=e.N.normalize([],p),m=e.N.normalize([],e.N.cross([],f,[0,1,0])),_=e.N.cross([],m,f),g=[m[0],m[1],m[2],0,_[0],_[1],_[2],0,f[0],f[1],f[2],0,0,0,0,1],y=[p,e.d2(c.lat,c.lng),e.d2(u.lat,c.lng),e.d2(u.lat,u.lng),e.d2(c.lat,u.lng),e.d2(h,c.lng),e.d2(h,u.lng),e.d2(c.lat,d),e.d2(u.lat,d)];let x=e.bS.fromPoints(y.map((t=>[e.N.dot(m,t),e.N.dot(_,t),e.N.dot(f,t)])));const v=e.N.transformMat4([],x.center,g);0===e.N.squaredLength(v)&&e.N.set(v,0,0,1),e.N.normalize(v,v),e.N.scale(v,v,e.ab),a.center=e.d3(v);const b=a.getWorldToCameraMatrix(),w=e.a6.invert(new Float64Array(16),b);x=e.bS.applyTransform(x,e.a6.multiply([],b,g)),e.N.transformMat4(v,v,b);const T=.5*(x.max[2]-x.min[2]),E=this._minimumAABBFrustumDistance(a,x),S=e.N.scale([],[0,0,1],T),M=e.N.add(S,v,S),A=E+(0===a.pitch?0:e.N.distance(v,M)),I=a.globeCenterInViewSpace,C=e.N.sub([],v,[I[0],I[1],I[2]]);e.N.normalize(C,C),e.N.scale(C,C,A);const P=e.N.add([],v,C);e.N.transformMat4(P,P,w);const L=e.d4/e.ab,R=e.N.length(P),D=e.bl(Math.max(R*L-e.d4,Number.EPSILON),0),O=Math.min(a.zoomFromMercatorZAdjusted(D),l.maxZoom);return O>.5*(e.bG+e.bx)?(a.setProjection({name:"mercator"}),a.zoom=O,this._cameraForBounds(a,r,i,n,o,s)):{center:a.center,zoom:O,bearing:n,pitch:o}}queryTerrainElevation(t,r){const i=this.transform.elevation;return i?(r=e.e({},{exaggerated:!0},r),i.getAtPoint(e.L.fromLngLat(t),null,r.exaggerated)):null}_cameraForBounds(t,r,i,n,o,s){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,r,i,n,o,s);const a=t.clone(),l=this._extendCameraOptions(s),c=a.padding;a.bearing=n,a.pitch=o;const u=e.bn.convert(r),h=e.bn.convert(i),d=new e.bn(u.lng,h.lat),p=new e.bn(h.lng,u.lat),f=a.project(u),m=a.project(h),_=this.queryTerrainElevation(u),g=this.queryTerrainElevation(h),y=this.queryTerrainElevation(d),x=this.queryTerrainElevation(p),v=[[f.x,f.y,Math.min(_||0,g||0,y||0,x||0)],[m.x,m.y,Math.max(_||0,g||0,y||0,x||0)]];let b=e.bS.fromPoints(v);const w=a.getWorldToCameraMatrix(),T=e.a6.invert(new Float64Array(16),w);b=e.bS.applyTransform(b,w);const E=e.N.sub([],b.max,b.min),S=c.left||0,M=c.right||0,A=c.bottom||0,I=c.top||0,{left:C,right:P,top:L,bottom:R}=l.padding,D=.5*(S+M),O=.5*(I+A),z=Math.min(a.scaleZoom(a.scale*Math.min((a.width-(S+M+C+P))/E[0],(a.height-(A+I+R+L))/E[1])),l.maxZoom),k=a.scale/a.zoomScale(z);b=new e.bS([b.min[0]-(C+D)*k,b.min[1]-(R+O)*k,b.min[2]],[b.max[0]+(P+D)*k,b.max[1]+(L+O)*k,b.max[2]]);const F=.5*E[2],B=this._minimumAABBFrustumDistance(a,b),N=[0,0,1,0];e.a7.transformMat4(N,N,w),e.a7.normalize(N,N);const U=e.N.scale([],N,B+F),V=e.N.add([],b.center,U),j=("number"==typeof l.offset.x&&"number"==typeof l.offset.y?new e.P(l.offset.x,l.offset.y):e.P.convert(l.offset)).rotate(-e.bj(n));b.center[0]-=j.x*k,b.center[1]+=j.y*k,e.N.transformMat4(b.center,b.center,T),e.N.transformMat4(V,V,T);const G=[b.center[0],b.center[1],V[2]*a.pixelsPerMeter];e.N.scale(G,G,1/a.worldSize);const $=e.at(G[0]),q=e.au(G[1]),Z=Math.min(a._zoomFromMercatorZ(G[2]),l.maxZoom),W=new e.bn($,q);return a.mercatorFromTransition&&Z<.5*(e.bG+e.bx)?(a.setProjection({name:"globe"}),a.zoom=Z,this._cameraForBounds(a,r,i,n,o,s)):{center:W,zoom:Z,bearing:n,pitch:o}}fitBounds(e,t,r){const i=this.cameraForBounds(e,t);return this._fitInternal(i,t,r)}fitScreenCoordinates(t,r,i,n,o){const s=e.P.convert(t),a=e.P.convert(r),l=new e.P(Math.min(s.x,a.x),Math.min(s.y,a.y)),c=new e.P(Math.max(s.x,a.x),Math.max(s.y,a.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(s,a))return this;const u=this.transform.pointLocation3D(l),h=this.transform.pointLocation3D(c),d=this.transform.pointLocation3D(new e.P(l.x,c.y)),p=this.transform.pointLocation3D(new e.P(c.x,l.y)),f=[Math.min(u.lng,h.lng,d.lng,p.lng),Math.min(u.lat,h.lat,d.lat,p.lat)],m=[Math.max(u.lng,h.lng,d.lng,p.lng),Math.max(u.lat,h.lat,d.lat,p.lat)],_=n&&n.pitch?n.pitch:this.getPitch(),g=this._cameraForBounds(this.transform,f,m,i,_,n);return this._fitInternal(g,n,o)}_fitInternal(t,r,i){return t?(delete(r=e.e(t,r)).padding,r.linear?this.easeTo(r,i):this.flyTo(r,i)):this}jumpTo(t,r){this.stop();const i=t.preloadOnly?this.transform.clone():this.transform;let n=!1,o=!1,s=!1;return"zoom"in t&&i.zoom!==+t.zoom&&(n=!0,i.zoom=+t.zoom),void 0!==t.center&&(i.center=e.bn.convert(t.center)),"bearing"in t&&i.bearing!==+t.bearing&&(o=!0,i.bearing=+t.bearing),"pitch"in t&&i.pitch!==+t.pitch&&(s=!0,i.pitch=+t.pitch),null==t.padding||i.isPaddingEqual(t.padding)||(i.padding=t.padding),t.preloadOnly?(this._preloadTiles(i),this):(this.fire(new e.b("movestart",r)).fire(new e.b("move",r)),n&&this.fire(new e.b("zoomstart",r)).fire(new e.b("zoom",r)).fire(new e.b("zoomend",r)),o&&this.fire(new e.b("rotatestart",r)).fire(new e.b("rotate",r)).fire(new e.b("rotateend",r)),s&&this.fire(new e.b("pitchstart",r)).fire(new e.b("pitch",r)).fire(new e.b("pitchend",r)),this.fire(new e.b("moveend",r)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||e.w(ta),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,r){const i=this.transform;if(!i.projection.supportsFreeCamera)return e.w(ta),this;this.stop();const n=i.zoom,o=i.pitch,s=i.bearing;i.setFreeCameraOptions(t);const a=n!==i.zoom,l=o!==i.pitch,c=s!==i.bearing;return this.fire(new e.b("movestart",r)).fire(new e.b("move",r)),a&&this.fire(new e.b("zoomstart",r)).fire(new e.b("zoom",r)).fire(new e.b("zoomend",r)),c&&this.fire(new e.b("rotatestart",r)).fire(new e.b("rotate",r)).fire(new e.b("rotateend",r)),l&&this.fire(new e.b("pitchstart",r)).fire(new e.b("pitch",r)).fire(new e.b("pitchend",r)),this.fire(new e.b("moveend",r)),this}easeTo(t,r){this._stop(!1,t.easeId),(!1===(t=e.e({offset:[0,0],duration:500,easing:e.d0},t)).animate||this._prefersReducedMotion(t))&&(t.duration=0);const i=this.transform,n=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in t?+t.zoom:n,c="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:s,h="padding"in t?t.padding:i.padding,d=e.P.convert(t.offset);let p,f,m;if("globe"===i.projection.name){const r=e.L.fromLngLat(i.center),n=d.rotate(-i.angle);r.x+=n.x/i.worldSize,r.y+=n.y/i.worldSize;const o=r.toLngLat(),s=e.bn.convert(t.center||o);this._normalizeCenter(s),p=i.centerPoint.add(n),f=new e.P(r.x,r.y).mult(i.worldSize),m=new e.P(e.a5(s.lng),e.ae(s.lat)).mult(i.worldSize).sub(f)}else{p=i.centerPoint.add(d);const r=i.pointLocation(p),n=e.bn.convert(t.center||r);this._normalizeCenter(n),f=i.project(r),m=i.project(n).sub(f)}const _=i.zoomScale(l-n);let g,y;t.around&&(g=e.bn.convert(t.around),y=i.locationPoint(g));const x=this._zooming||l!==n,v=this._rotating||o!==c,b=this._pitching||u!==s,w=!i.isPaddingEqual(h),T=i=>T=>{if(x&&(i.zoom=e.U(n,l,T)),v&&(i.bearing=e.U(o,c,T)),b&&(i.pitch=e.U(s,u,T)),w&&(i.interpolatePadding(a,h,T),p=i.centerPoint.add(d)),g)i.setLocationAtPoint(g,y);else{const e=i.zoomScale(i.zoom-n),t=l>n?Math.min(2,_):Math.max(.5,_),r=Math.pow(t,1-T),o=i.unproject(f.add(m.mult(T*r)).mult(e));i.setLocationAtPoint(i.renderWorldCopies?o.wrap():o,p)}return t.preloadOnly||this._fireMoveEvents(r),i};if(t.preloadOnly){const e=this._emulate(T,t.duration,i);return this._preloadTiles(e),this}const E={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=x,this._rotating=v,this._pitching=b,this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,E),this._ease(T(i),(e=>{"sea"===i.cameraElevationReference&&i.recenterOnTerrain(),this._afterEase(r,e)}),t),this}_prepareEase(t,r,i={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),r||i.moving||this.fire(new e.b("movestart",t)),this._zooming&&!i.zooming&&this.fire(new e.b("zoomstart",t)),this._rotating&&!i.rotating&&this.fire(new e.b("rotatestart",t)),this._pitching&&!i.pitching&&this.fire(new e.b("pitchstart",t))}_fireMoveEvents(t){this.fire(new e.b("move",t)),this._zooming&&this.fire(new e.b("zoom",t)),this._rotating&&this.fire(new e.b("rotate",t)),this._pitching&&this.fire(new e.b("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const i=this._zooming,n=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,i&&this.fire(new e.b("zoomend",t)),n&&this.fire(new e.b("rotateend",t)),o&&this.fire(new e.b("pitchend",t)),this.fire(new e.b("moveend",t))}flyTo(t,r){if(this._prefersReducedMotion(t)){const i=e.ac(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(i,r)}this.stop(),t=e.e({offset:[0,0],speed:1.2,curve:1.42,easing:e.d0},t);const i=this.transform,n=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a="zoom"in t?e.aa(+t.zoom,i.minZoom,i.maxZoom):n,l="bearing"in t?this._normalizeBearing(t.bearing,o):o,c="pitch"in t?+t.pitch:s,u=i.zoomScale(a-n),h=e.P.convert(t.offset),d=i.centerPoint.add(h),p=i.pointLocation(d);let f=t.center;if(f&&t.padding){const e=this._cameraForBounds(this.transform,f,f,l,c,t);e&&(f=e.center)}f=e.bn.convert(f||p),this._normalizeCenter(f);const m=i.project(p),_=i.project(f).sub(m);let g=t.curve;const y=Math.max(i.width,i.height),x=y/u,v=_.mag();if("minZoom"in t){const r=e.aa(Math.min(t.minZoom,n,a),i.minZoom,i.maxZoom),o=y/i.zoomScale(r-n);g=Math.sqrt(o/v*2)}const b=g*g;function w(e){const t=(x*x-y*y+(e?-1:1)*b*b*v*v)/(2*(e?x:y)*b*v);return Math.log(Math.sqrt(t*t+1)-t)}function T(e){return(Math.exp(e)-Math.exp(-e))/2}function E(e){return(Math.exp(e)+Math.exp(-e))/2}const S=w(0);let M=function(e){return E(S)/E(S+g*e)},A=function(e){return y*((E(S)*(T(t=S+g*e)/E(t))-T(S))/b)/v;var t},I=(w(1)-S)/g;if(Math.abs(v)<1e-6||!isFinite(I)){if(Math.abs(y-x)<1e-6)return this.easeTo(t,r);const e=x<y?-1:1;I=Math.abs(Math.log(x/y))/g,A=function(){return 0},M=function(t){return Math.exp(e*g*t)}}t.duration="duration"in t?+t.duration:1e3*I/("screenSpeed"in t?+t.screenSpeed/g:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const C=o!==l,P=c!==s,L=i=>u=>{const h=u*I,p=1/M(h);i.zoom=1===u?a:n+i.scaleZoom(p),C&&(i.bearing=e.U(o,l,u)),P&&(i.pitch=e.U(s,c,u));const g=1===u?f:i.unproject(m.add(_.mult(A(h))).mult(p));return i.setLocationAtPoint(i.renderWorldCopies?g.wrap():g,d),i._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(r),i};if(t.preloadOnly){const e=this._emulate(L,t.duration,i);return this._preloadTiles(e),this}return this._zooming=!0,this._rotating=C,this._pitching=P,this._prepareEase(r,!1),this._ease(L(i),(()=>this._afterEase(r)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(t,r,i){!1===i.animate||0===i.duration?(t(1),r()):(this._easeStart=e.f.now(),this._easeOptions=i,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((e.f.now()-this._easeStart)/this._easeOptions.duration,1),r=this._onEaseFrame;r&&r(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,r){t=e.bh(t,-180,180);const i=Math.abs(t-r);return Math.abs(t-360-r)<i&&(t-=360),Math.abs(t+360-r)<i&&(t+=360),t}_normalizeCenter(e){const t=this.transform;if(t.maxBounds)return;if("globe"!==t.projection.name&&!t.renderWorldCopies)return;const r=e.lng-t.center.lng;e.lng+=r>180?-360:r<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&e.f.prefersReducedMotion&&!(t&&t.essential)}_emulate(e,t,r){const i=Math.ceil(15*t/1e3),n=[],o=e(r.clone());for(let s=0;s<=i;s++){const e=o(s/i);n.push(e.clone())}return n}}class ia{constructor(t={}){this.options=t,e.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact;return this._map=e,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=o("button","mapboxgl-ctrl-attrib-button",this._container),o("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=o("div","mapboxgl-ctrl-attrib-inner",this._container),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,t){const r=this._map._getUIString(`AttributionControl.${t}`);e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",r)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.d5.ACCESS_TOKEN}];if(t){const i=r.reduce(((e,t,i)=>(t.value&&(e+=`${t.key}=${t.value}${i<r.length-1?"&":""}`),e)),"?");t.href=`${e.d5.FEEDBACK_URL}/${i}#${os(this._map,!0)}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._mergedSourceCaches;for(const i in t){const r=t[i];if(r.used){const t=r.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,r)=>{for(let i=r+1;i<e.length;i++)if(e[i].indexOf(t)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const r=e.join(" | ");r!==this._attribHTML&&(this._attribHTML=r,e.length?(this._innerContainer.innerHTML=r,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class na{constructor(){e.aY(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=o("div","mapboxgl-ctrl");const t=o("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const r=e[t].getSource();if(r.hasOwnProperty("mapbox_logo")&&!r.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class oa{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,r=t?this._queue.concat(t):this._queue;for(const i of r)if(i.id===e)return void(i.cancelled=!0)}run(e=0){const t=this._currentlyRunning=this._queue;this._queue=[];for(const r of t)if(!r.cancelled&&(r.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function sa(t,r,i){if(t=new e.bn(t.lng,t.lat),r){const n=new e.bn(t.lng-360,t.lat),o=new e.bn(t.lng+360,t.lat),s=360*Math.ceil(Math.abs(t.lng-i.center.lng)/360),a=i.locationPoint(t).distSqr(r),l=r.x<0||r.y<0||r.x>i.width||r.y>i.height;i.locationPoint(n).distSqr(r)<a&&(l||Math.abs(n.lng-i.center.lng)<s)?t=n:i.locationPoint(o).distSqr(r)<a&&(l||Math.abs(o.lng-i.center.lng)<s)&&(t=o)}for(;Math.abs(t.lng-i.center.lng)>180;){const e=i.locationPoint(t);if(e.x>=0&&e.y>=0&&e.x<=i.width&&e.y<=i.height)break;t.lng>i.center.lng?t.lng-=360:t.lng+=360}return t}const aa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class la extends e.E{constructor(t,r){if(super(),(t instanceof HTMLElement||r)&&(t=e.e({element:t},r)),e.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=e.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=o("div");const r=41,i=27,n=s("svg",{display:"block",height:r*this._scale+"px",width:i*this._scale+"px",viewBox:`0 0 ${i} ${r}`},this._element),a=s("radialGradient",{id:"shadowGradient"},s("defs",{},n));s("stop",{offset:"10%","stop-opacity":.4},a),s("stop",{offset:"100%","stop-opacity":.05},a),s("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},n),s("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},n),s("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},n),s("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},n),this._offset=e.P.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()}));const i=this._element.classList;for(const e in aa)i.remove(`mapboxgl-marker-anchor-${e}`);i.add(`mapboxgl-marker-anchor-${this._anchor}`);const n=t&&t.className?t.className.trim().split(/\s+/):[];i.add(...n),this._popup=null}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.bn.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,r=13.5,i=Math.sqrt(Math.pow(r,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[i,-1*(t-r+i)],"bottom-right":[-i,-1*(t-r+i)],left:[r,-1*(t-r)],right:[-r,-1*(t-r)]}:this._offset}this._popup=e,e._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const t=e.code,r=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==r&&13!==r||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,r=this._element;this._popup&&(t===r||r.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,t=this._pos;if(!e||!t)return!1;const r=e.unproject(t),i=e.getFreeCameraOptions();if(!i.position)return!1;const n=i.position.toLngLat();return n.distanceTo(r)<.9*n.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const r=this._pos;if(!r||r.x<0||r.x>t.transform.width||r.y<0||r.y>t.transform.height)return void this._clearFadeTimer();const i=t.unproject(r);let n;t._showingGlobe()&&e.d6(t.transform,this._lngLat)?n=0:(n=1-t._queryFogOpacity(i),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(n*=this._occludedOpacity)),this._element.style.opacity=`${n}`,this._element.style.pointerEvents=n>0?"auto":"none",this._popup&&this._popup._setOpacity(n),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const t=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${e.x}px,${e.y}px)\n            ${aa[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${t.x}px,${t.y}px)\n        `}_calculateXYTransform(){const t=this._pos,r=this._map,i=this.getPitchAlignment();if(!r||!t||"map"!==i)return"";if(!r._showingGlobe()){const e=r.getPitch();return e?`rotateX(${e}deg)`:""}const n=e.bF(e.d7(r.transform,this._lngLat)),o=t.sub(e.d8(r.transform)),s=Math.abs(o.x)+Math.abs(o.y);if(0===s)return"";const a=n/s;return`rotateX(${-o.y*a}deg) rotateY(${o.x*a}deg)`}_calculateZTransform(){const t=this._pos,r=this._map;if(!r||!t)return"";let i=0;const n=this.getRotationAlignment();if("map"===n)if(r._showingGlobe()){const t=r.project(new e.bn(this._lngLat.lng,this._lngLat.lat+.001)),n=r.project(new e.bn(this._lngLat.lng,this._lngLat.lat-.001)).sub(t);i=e.bF(Math.atan2(n.y,n.x))-90}else i=-r.getBearing();else if("horizon"===n){const n=e.O(4,6,r.getZoom()),o=e.d8(r.transform);o.y+=n*r.transform.height;const s=t.sub(o),a=e.bF(Math.atan2(s.y,s.x));i=(a>90?a-270:a+90)*(1-n)}return i+=this._rotation,i?`rotateZ(${i}deg)`:""}_update(e){cancelAnimationFrame(this._updateFrameId);const t=this._map;t&&(t.transform.renderWorldCopies&&(this._lngLat=sa(this._lngLat,this._pos,t.transform)),this._pos=t.project(this._lngLat),!0===e?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),t._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(t._showingGlobe()||t.getTerrain()||t.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=e.P.convert(t),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(t){const r=this._map;if(!r)return;const i=this._pointerdownPos,n=this._positionDelta;if(i&&n){if(!this._isDragging){const e=this._clickTolerance||r._clickTolerance;if(t.point.dist(i)<e)return;this._isDragging=!0}this._pos=t.point.sub(n),this._lngLat=r.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.b("dragstart"))),this.fire(new e.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new e.b("dragend")),this._state="inactive"}_addDragHandler(e){const t=this._map,r=this._pos;t&&r&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(r),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ca={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ua=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ha(t=new e.P(0,0),r="bottom"){if("number"==typeof t){const i=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(r){case"top":return new e.P(0,t);case"top-left":return new e.P(i,i);case"top-right":return new e.P(-i,i);case"bottom":return new e.P(0,-t);case"bottom-left":return new e.P(i,-i);case"bottom-right":return new e.P(-i,-i);case"left":return new e.P(t,0);case"right":return new e.P(-t,0)}return new e.P(0,0)}return t instanceof e.P||Array.isArray(t)?e.P.convert(t):e.P.convert(t[r]||[0,0])}class da{constructor(e){this.jumpTo(e)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const r=e.cc((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-r)+this._end*r}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,r){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+r}}const pa={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},fa={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class ma{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.showParseStatus=!1,this.continuousRedraw=!1,this.showTileAABBs=!1,this.showPadding=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}const _a={showCompass:!0,showZoom:!0,visualizePitch:!1};class ga{constructor(t,r,i=!1){this._clickTolerance=10,this.element=r,this.mouseRotate=new As({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,i&&(this.mousePitch=new Is({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener("mousedown",this.mousedown),r.addEventListener("touchstart",this.touchstart,{passive:!1}),r.addEventListener("touchmove",this.touchmove),r.addEventListener("touchend",this.touchend),r.addEventListener("touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),u()}move(e,t){const r=this.map,i=this.mouseRotate.mousemoveWindow(e,t),n=i&&i.bearingDelta;if(n&&r.setBearing(r.getBearing()+n),this.mousePitch){const i=this.mousePitch.mousemoveWindow(e,t),n=i&&i.pitchDelta;n&&r.setPitch(r.getPitch()+n)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){h(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(e.e({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),f(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,f(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=m(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=m(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ya={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},xa={maxWidth:100,unit:"metric"},va={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ba={version:e.dk,supported:r,setRTLTextPlugin:e.dm,getRTLTextPluginStatus:e.dn,Map:class extends ra{constructor(t){const r=t;if(null!=(t=e.e({},fa,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&e.d9(window)&&(t.antialias=!1,e.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new mi(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t),this._repaint=!1,this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._collectResourceTiming=t.collectResourceTiming,this._language=this._parseLanguage(t.language),this._worldview=t.worldview,this._renderTaskQueue=new oa,this._domRenderTaskQueue=new oa,this._controls=[],this._markers=[],this._popups=[],this._mapId=e.aC(),this._locale=e.e({},pa,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._performanceMetricsCollection=t.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new da(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new e.da(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,this._contextCreateOptions=t.contextCreateOptions?{...t.contextCreateOptions}:{},"string"==typeof t.container){const e=document.getElementById(t.container);if(!e)throw new Error(`Container '${t.container.toString()}' not found.`);this._container=e}else{if(!(t.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&e.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),e.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new ma,this._tp=t.devtools?new Qo(this):new Qo,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug"],"showParseStatus",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,(e=>{this.repaint=e})),this._tp.registerParameter(this._debugParams,["Debug"],"showTileAABBs",void 0,(e=>{this.showTileAABBs=e})),this._tp.registerParameter(this._debugParams,["Debug"],"showPadding",void 0,(e=>{this.showPadding=e})),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,(()=>{this._update()})),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ea(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,(t.style||!t.testMode)&&this.setStyle(t.style||e.d5.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),t.hash&&(this._hash=new ns("string"==typeof t.hash&&t.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==r.center&&null==r.zoom||(this.transform._unmodified=!1),this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch});const i=t.bounds;i&&(this.resize(),this.fitBounds(i,e.e({},t.fitBoundsOptions,{duration:0})))}this.resize(),t.attributionControl&&this.addControl(new ia({customAttribution:t.customAttribution})),this._logoControl=new na,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(t=>{this._update("style"===t.dataType),this.fire(new e.b(`${t.dataType}data`,t))})),this.on("dataloading",(t=>{this.fire(new e.b(`${t.dataType}dataloading`,t))}))}_getMapId(){return this._mapId}addControl(t,r){if(void 0===r&&(r=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=t.onAdd(this);this._controls.push(t);const n=this._controlPositions[r];return-1!==r.indexOf("bottom")?n.insertBefore(i,n.firstChild):n.appendChild(i),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(t);return r>-1&&this._controls.splice(r,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new e.b("movestart",t)).fire(new e.b("move",t)),this.fire(new e.b("resize",t)),r&&this.fire(new e.b("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(e.ad.convert(t)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new e.b("zoomstart")).fire(new e.b("zoom")).fire(new e.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new e.b("zoomstart")).fire(new e.b("zoom")).fire(new e.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new e.b("pitchstart")).fire(new e.b("pitch")).fire(new e.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?85:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new e.b("pitchstart")).fire(new e.b("pitch")).fire(new e.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return"auto"===e?navigator.language:Array.isArray(e)?0===e.length?void 0:e.map((e=>"auto"===e?navigator.language:e)):e}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const t=this.transform,r=t.projection.name;let i;"globe"===r&&t.zoom>=e.bx?(t.setMercatorFromTransition(),i=!0):"mercator"===r&&t.zoom<e.bx&&(t.setProjection({name:"globe"}),i=!0),i&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(t){let r;return r="globe"===t.name&&this.transform.zoom>=e.bx?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate(),r&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(t){return this.transform.locationPoint3D(e.bn.convert(t))}unproject(t){return this.transform.pointLocation3D(e.P.convert(t))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,r){if("mouseenter"===e||"mouseover"===e){let i=!1;const n=n=>{const o=t.filter((e=>this.getLayer(e))),s=o.length?this.queryRenderedFeatures(n.point,{layers:o}):[];s.length?i||(i=!0,r.call(this,new fs(e,this,n.originalEvent,{features:s}))):i=!1},o=()=>{i=!1};return{layers:new Set(t),listener:r,delegates:{mousemove:n,mouseout:o}}}if("mouseleave"===e||"mouseout"===e){let i=!1;const n=n=>{const o=t.filter((e=>this.getLayer(e)));(o.length?this.queryRenderedFeatures(n.point,{layers:o}):[]).length?i=!0:i&&(i=!1,r.call(this,new fs(e,this,n.originalEvent)))},o=t=>{i&&(i=!1,r.call(this,new fs(e,this,t.originalEvent)))};return{layers:new Set(t),listener:r,delegates:{mousemove:n,mouseout:o}}}{const i=e=>{const i=t.filter((e=>this.getLayer(e))),n=i.length?this.queryRenderedFeatures(e.point,{layers:i}):[];n.length&&(e.features=n,r.call(this,e),delete e.features)};return{layers:new Set(t),listener:r,delegates:{[e]:i}}}}on(e,t,r){if(void 0===r)return super.on(e,t);if(Array.isArray(t)||(t=[t]),t)for(const n of t)if(!this._isValidId(n))return this;const i=this._createDelegatedListener(e,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(i);for(const n in i.delegates)this.on(n,i.delegates[n]);return this}once(e,t,r){if(void 0===r)return super.once(e,t);if(Array.isArray(t)||(t=[t]),t)for(const n of t)if(!this._isValidId(n))return this;const i=this._createDelegatedListener(e,t,r);for(const n in i.delegates)this.once(n,i.delegates[n]);return this}off(e,t,r){if(void 0===r)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);for(const o of t)if(!this._isValidId(o))return this;const i=(e,t)=>{if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0},n=this._delegatedListeners?this._delegatedListeners[e]:void 0;return n&&(e=>{for(let n=0;n<e.length;n++){const o=e[n];if(o.listener===r&&i(o.layers,t)){for(const e in o.delegates)this.off(e,o.delegates[e]);return e.splice(n,1),this}}})(n),this}queryRenderedFeatures(t,r){if(!this.style)return[];if(void 0!==r||void 0===t||t instanceof e.P||Array.isArray(t)||(r=t,t=void 0),t=t||[[0,0],[this.transform.width,this.transform.height]],(r=r||{}).layers&&Array.isArray(r.layers))for(const e of r.layers)if(!this._isValidId(e))return[];return this.style.queryRenderedFeatures(t,r,this.transform)}querySourceFeatures(e,t){return this._isValidId(e)?this.style.querySourceFeatures(e,t):[]}isPointOnSurface(t){const{name:r}=this.transform.projection;return"globe"!==r&&"mercator"!==r&&e.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(e.P.convert(t))}setStyle(t,r){return!1!==(r=e.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&t?(this._diffStyle(t,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(t,r))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e&&(this.style=new Ri(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ri(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,r){if("string"==typeof t){const i=this._requestManager.normalizeStyleURL(t),n=this._requestManager.transformRequest(i,e.R.Style);e.g(n,((t,i)=>{t?this.fire(new e.a(t)):i&&this._updateDiff(i,r)}))}else"object"==typeof t&&this._updateDiff(t,r)}_updateDiff(t,r){try{this.style.setState(t)&&this._update(!0)}catch(i){e.w(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(t,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(e.w("There is no style added to the map."),!1)}_isValidId(t){return null==t?(this.fire(new e.a(new Error("IDs can't be empty."))),!1):!e.c4(t)||(this.fire(new e.a(new Error(`IDs can't contain special symbols: "${t}".`))),!1)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(e,t,r){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,r)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(t,r,{pixelRatio:i=1,sdf:n=!1,stretchX:o,stretchY:s,content:a}={}){if(this._lazyInitEmptyStyle(),r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){const{width:l,height:c,data:u}=e.f.getImageData(r);this.style.addImage(t,{data:new e.h({width:l,height:c},u),pixelRatio:i,stretchX:o,stretchY:s,content:a,sdf:n,version:0})}else if(void 0===r.width||void 0===r.height)this.fire(new e.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:l,height:c}=r,u=r;this.style.addImage(t,{data:new e.h({width:l,height:c},new Uint8Array(u.data)),pixelRatio:i,stretchX:o,stretchY:s,content:a,sdf:n,version:0,userImage:u}),u.onAdd&&u.onAdd(this,t)}}updateImage(t,r){this._lazyInitEmptyStyle();const i=this.style.getImage(t);if(!i)return void this.fire(new e.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const n=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?e.f.getImageData(r):r,{width:o,height:s}=n,a=n.data;if(void 0===o||void 0===s)return void this.fire(new e.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(o!==i.data.width||s!==i.data.height)return void this.fire(new e.a(new Error(`The width and height of the updated image (${o}, ${s})\n                must be that same as the previous version of the image\n                (${i.data.width}, ${i.data.height})`)));const l=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);i.data.replace(a,l),this.style.updateImage(t,i)}hasImage(t){return t?!!this.style&&!!this.style.getImage(t):(this.fire(new e.a(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(t,r){e.d(this._requestManager.transformRequest(t,e.R.Image),((t,i)=>{r(t,i instanceof HTMLImageElement?e.f.getImageData(i):i)}))}listImages(){return this.style.listImages()}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(t){return t?this.style.hasModel(t):(this.fire(new e.a(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}getSlot(e){const t=this.getLayer(e);return t&&t.slot||null}setSlot(e,t){return this.style.setSlot(e,t),this.style.mergeLayers(),this._update(!0)}addImport(e,t){return this.style.addImport(e,t),this}updateImport(e,t){return"string"!=typeof t&&t.id!==e?(this.removeImport(e),this.addImport(t)):(this.style.updateImport(e,t),this._update(!0))}removeImport(e){return this.style.removeImport(e),this}moveImport(e,t){return this.style.moveImport(e,t),this._update(!0)}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){return this._isValidId(e)?this.style.getOwnLayer(e):null}setLayerZoomRange(e,t,r){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,r),this._update(!0)):this}setFilter(e,t,r={}){return this._isValidId(e)?(this.style.setFilter(e,t,r),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,r,i={}){return this._isValidId(e)?(this.style.setPaintProperty(e,t,r,i),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,r,i={}){return this._isValidId(e)?(this.style.setLayoutProperty(e,t,r,i),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}getConfigProperty(e,t){return this.style.getConfigProperty(e,t)}setConfigProperty(e,t,r){return this.style.setConfigProperty(e,t,r),this._update(!0)}setLights(e){if(this._lazyInitEmptyStyle(),e&&1===e.length&&"flat"===e[0].type){const t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const e=this.style.getLights()||[];return 0===e.length&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===e["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(e.bn.convert(t),this.transform):0}setFeatureState(e,t){return this._isValidId(e.source)?(this.style.setFeatureState(e,t),this._update()):this}removeFeatureState(e,t){return this._isValidId(e.source)?(this.style.removeFeatureState(e,t),this._update()):this}getFeatureState(e){return this._isValidId(e.source)?this.style.getFeatureState(e):null}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let r,i,n,o=this._container;for(;o&&(!i||!n);){const e=window.getComputedStyle(o).transform;e&&"none"!==e&&(r=e.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&"0"!==r[0]&&"1"!==r[0]&&(i=r[0]),r[3]&&"0"!==r[3]&&"1"!==r[3]&&(n=r[3])),o=o.parentElement}this._containerWidth=i?Math.abs(e/i):e,this._containerHeight=n?Math.abs(t/n):t}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=o("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=o("div","mapboxgl-canvas-container",e);this._canvas=o("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const r=this._controlContainer=o("div","mapboxgl-control-container",e),i=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{i[e]=o("div",`mapboxgl-ctrl-${e}`,r)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,r){const i=e.f.devicePixelRatio||1;this._canvas.width=i*Math.ceil(t),this._canvas.height=i*Math.ceil(r),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${r}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){const t=this._popups.indexOf(e);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const t=e.e({},r.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",t);i?(e.db(i,!0),this.painter=new rs(i,this._contextCreateOptions,this.transform,this._tp),this.on("data",(e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)})),e.dc.testSupport(i)):this.fire(new e.a(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.b("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new e.b("webglcontextrestored",{originalEvent:t}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(t){let r;this.fire(new e.b("renderstart"));const i=this.painter.context.extTimerQuery,n=e.f.now(),o=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=o.createQuery(),o.beginQuery(i.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;this._updateProjectionTransition();const s=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,r=this.transform.pitch,i=e.f.now(),n=new e.K(t,{now:i,fadeDuration:s,pitch:r,transition:this.style.transition});this.style.update(n)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let a=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),a=this._updateAverageElevation(n),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):a=this._updateAverageElevation(n),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,showParseStatus:this.showParseStatus||this._debugParams.showParseStatus,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs||this._debugParams.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding||this._debugParams.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new e.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const t=e.f.now()-n;o.endQuery(i.TIME_ELAPSED_EXT),setTimeout((()=>{const i=o.getQueryParameter(r,o.QUERY_RESULT)/1e6;o.deleteQuery(r),this.fire(new e.b("gpu-timing-frame",{cpuTime:t,gpuTime:i}))}),50)}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout((()=>{const r=this.painter.queryGpuTimers(t);this.fire(new e.b("gpu-timing-layer",{layerTimes:r}))}),50)}if(this.listens("gpu-timing-deferred-render")){const t=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const r=this.painter.queryGpuTimeDeferredRender(t);this.fire(new e.b("gpu-timing-deferred-render",{gpuTime:r}))}),50)}const l=this._sourcesDirty||this._styleDirty||this._placementDirty||a;if(l||this._repaint)this.triggerRepaint();else{const t=!this.isMoving()&&this.loaded();if(t&&(a=this._updateAverageElevation(n,!0)),a)this.triggerRepaint();else if(this._triggerFrame(!1),t&&(this.fire(new e.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new e.b("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,this._performanceMetricsCollection&&e.dd(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e,t=!1){const r=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&r(0);const i=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(i||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let n=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(n)?n=0:this._averageElevationLastSampledAt=e;const o=Math.abs(t-n);if(o>1){if(this._isInitialLoad||i)return this._averageElevation.jumpTo(n),r(n);this._averageElevation.easeTo(n,e,300)}else if(o>1e-4)return this._averageElevation.jumpTo(n),r(n)}return!!this._averageElevation.isEasing(e)&&r(this._averageElevation.getValue(e))}_authenticate(){e.de(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(t=>{if(t&&(t.message===e.df||401===t.status)){const t=this.painter.context.gl;e.db(t,!1),this._logoControl instanceof na&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new e.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),e.dg(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const r=this.painter.context.gl,i=r.createFramebuffer();function n(e){r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0);const t=new Uint8Array(r.drawingBufferWidth*r.drawingBufferHeight*4);return r.readPixels(0,0,r.drawingBufferWidth,r.drawingBufferHeight,r.RGBA,r.UNSIGNED_BYTE,t),t}return r.bindFramebuffer(r.FRAMEBUFFER,i),this._canvasPixelComparison(n(e),t.canvasCopies.map(n),t.timeStamps)}_canvasPixelComparison(e,t,r){let i=r[1]-r[0];const n=e.length/4;for(let o=0;o<t.length;o++){const s=t[o];let a=0;for(let t=0;t<s.length;t+=4)s[t]===e[t]&&s[t+1]===e[t+1]&&s[t+2]===e[t+2]&&s[t+3]===e[t+3]&&(a+=1);i+=(r[o+2]-r[o+1])*(1-a/n)}return i}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),e.dh(this.painter.context.gl),e.di.remove(),e.dj.remove(),this._removed=!0,this.fire(new e.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=e.f.frame((e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)})))}_preloadTiles(t){const r=this.style?Object.values(this.style._sourceCaches):[];return e.b1(r,((e,r)=>e._preloadTiles(t,r)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(e){this._showParseStatus!==e&&(this._showParseStatus=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,e&&this._update())}_setCacheLimits(t,r){e.dl(t,r)}get version(){return e.dk}},NavigationControl:class{constructor(t){this.options=e.e({},_a,t),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(e.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(e=>{this._map&&this._map.zoomIn({},{originalEvent:e})})),o("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(e=>{this._map&&this._map.zoomOut({},{originalEvent:e})})),o("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(e.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(e=>{const t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))})),this._compassIcon=o("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),r=t===e.getMaxZoom(),i=t===e.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ga(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const r=o("button",e,this._container);return r.type="button",r.addEventListener("click",t),r}_setButtonTitle(e,t){if(!this._map)return;const r=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",r),e.firstElementChild&&e.firstElementChild.setAttribute("title",r)}},GeolocateControl:class extends e.E{constructor(t){super();const r=navigator.geolocation;this.options=e.e({geolocation:r},ya,t),e.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=is(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){const t=(t=!!this.options.geolocation)=>{this._supportsGeolocation=t,e(t)};void 0!==this._supportsGeolocation?e(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then((e=>t("denied"!==e.state))).catch((()=>t())):t()}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),r=e.coords;return!!t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.b("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.b("geolocate",t)),this._finish()}}_updateCamera(t){const r=new e.bn(t.coords.longitude,t.coords.latitude),i=t.coords.accuracy,n=this._map.getBearing(),o=e.e({bearing:n},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(i),o,{geolocateSource:!0})}_updateMarker(t){if(t){const r=new e.bn(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map.transform,r=e.bl(1,t._center.lat)*t.worldSize,i=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${i}px`,this._circleElement.style.height=`${i}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.b("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=o("button","mapboxgl-ctrl-geolocate",this._container),o("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){e.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=o("div","mapboxgl-user-location"),this._dotElement.appendChild(o("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(o("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new la({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=o("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new la({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new e.b("trackuserlocationend")))}))}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return e.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&e()})).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ia,ScaleControl:class{constructor(t){this.options=e.e({},xa,t),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(e){return!1}}(),e.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,r=t._containerHeight/2,i=t._containerWidth/2-e/2,n=t.unproject([i,r]),o=t.unproject([i+e,r]),s=n.distanceTo(o);if("imperial"===this.options.unit){const t=3.2808*s;t>5280?this._setScale(e,t/5280,"mile"):this._setScale(e,t,"foot")}else"nautical"===this.options.unit?this._setScale(e,s/1852,"nautical-mile"):s>=1e3?this._setScale(e,s/1e3,"kilometer"):this._setScale(e,s,"meter")}_setScale(e,t,r){this._map._requestDomTask((()=>{const i=function(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let r=e/t;return r=r>=10?10:r>=5?5:r>=3?3:r>=2?2:r>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(r),t*r}(t),n=i/t;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==r?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:r}).format(i):`${i}&nbsp;${va[r]}`,this._container.style.width=e*n+"px"}))}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof HTMLElement?this._container=t.container:e.w("Full screen control 'container' must be a DOM element.")),e.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=o("button","mapboxgl-ctrl-fullscreen",this._controlContainer);o("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends e.E{constructor(t){super(),this.options=e.e(Object.create(ca),t),e.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new e.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new e.b("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=e.bn.convert(t),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){const t=document.createDocumentFragment(),r=document.createElement("body");let i;for(r.innerHTML=e;i=r.firstChild,i;)t.appendChild(i);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=o("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=o("button","mapboxgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.setAttribute("aria-hidden","true"),e.innerHTML="&#215;",e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,r=this._container,i=this._pos;if(!t||!r||!i)return"bottom";const n=r.offsetWidth,o=r.offsetHeight,s=i.x<n/2,a=i.x>t.transform.width-n/2;if(i.y+e<o)return s?"top-left":a?"top-right":"top";if(i.y>t.transform.height-o){if(s)return"bottom-left";if(a)return"bottom-right"}return s?"left":a?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(t){const r=this._map,i=this._content;if(!r||!this._lngLat&&!this._trackPointer||!i)return;let n=this._container;if(n||(n=this._container=o("div","mapboxgl-popup",r.getContainer()),this._tip=o("div","mapboxgl-popup-tip",n),n.appendChild(i)),this.options.maxWidth&&n.style.maxWidth!==this.options.maxWidth&&(n.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=sa(this._lngLat,this._pos,r.transform)),!this._trackPointer||t){const e=this._pos=this._trackPointer&&t?t:r.project(this._lngLat),i=ha(this.options.offset),n=this._anchor=this._getAnchor(i.y),o=ha(this.options.offset,n),s=e.add(o).round();r._requestDomTask((()=>{this._container&&n&&(this._container.style.transform=`${aa[n]} translate(${s.x}px,${s.y}px)`)}))}if(!this._marker&&r._showingGlobe()){const t=e.d6(r.transform,this._lngLat)?0:1;this._setOpacity(t)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(ua);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity=`${e}`),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:la,Style:Ri,LngLat:e.bn,LngLatBounds:e.ad,Point:e.P,MercatorCoordinate:e.L,FreeCameraOptions:hi,Evented:e.E,config:e.d5,prewarm:e.dp,clearPrewarmedResources:e.dq,get accessToken(){return e.d5.ACCESS_TOKEN},set accessToken(t){e.d5.ACCESS_TOKEN=t},get baseApiUrl(){return e.d5.API_URL},set baseApiUrl(t){e.d5.API_URL=t},get workerCount(){return e.dr.workerCount},set workerCount(t){e.dr.workerCount=t},get maxParallelImageRequests(){return e.d5.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.d5.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){e.ds(t)},get workerUrl(){return e.dt.workerUrl},set workerUrl(t){e.dt.workerUrl=t},get workerClass(){return e.dt.workerClass},set workerClass(t){e.dt.workerClass=t},get workerParams(){return e.dt.workerParams},set workerParams(t){e.dt.workerParams=t},get dracoUrl(){return e.du()},set dracoUrl(t){e.dv(t)},get meshoptUrl(){return e.dw()},set meshoptUrl(t){e.dx(t)},setNow:e.f.setNow,restoreNow:e.f.restoreNow};return ba}));var n=r;return n}))},1241:function(e,t){"use strict";t.A=(e,t)=>{const r=e.__vccOpts||e;for(const[i,n]of t)r[i]=n;return r}},3022:function(e){function t(e,t){const r=new RegExp(t,"g"),i=e.match(r);return i?i.length:0}e.exports=t,e.exports["default"]=t},1775:function(e,t,r){const i=r(3562),n=r(5261),o=r(3022);function s(e,t,r){const s=r&&r.debug||!1,a=!(r&&!1===typeof r.nested),l=r&&r.startIndex||0;s&&console.log("[xml-utils] starting findTagByName with",t," and ",r);const c=i(e,`<${t}[ \n>/]`,l);if(s&&console.log("[xml-utils] start:",c),-1===c)return;const u=e.slice(c+t.length);let h=n(u,"^[^<]*[ /]>",0);const d=-1!==h&&"/"===u[h-1];if(s&&console.log("[xml-utils] selfClosing:",d),!1===d)if(a){let e=0,r=1,i=0;while(-1!==(h=n(u,"[ /]"+t+">",e))){const n=u.substring(e,h+1);if(r+=o(n,"<"+t+"[ \n\t>]"),i+=o(n,"</"+t+">"),i>=r)break;e=h}}else h=n(u,"[ /]"+t+">",0);const p=c+t.length+h+1;if(s&&console.log("[xml-utils] end:",p),-1===p)return;const f=e.slice(c,p);let m;return m=d?null:f.slice(f.indexOf(">")+1,f.lastIndexOf("<")),{inner:m,outer:f,start:c,end:p}}e.exports=s,e.exports["default"]=s},554:function(e,t,r){r(4114);const i=r(1775);function n(e,t,r){const n=[],o=r&&r.debug||!1,s=!r||"boolean"!==typeof r.nested||r.nested;let a,l=r&&r.startIndex||0;while(a=i(e,t,{debug:o,startIndex:l}))l=s?a.start+1+t.length:a.end,n.push(a);return o&&console.log("findTagsByName found",n.length,"tags"),n}e.exports=n,e.exports["default"]=n},3146:function(e){function t(e,t,r){const i=r&&r.debug||!1;i&&console.log("[xml-utils] getting "+t+" in "+e);const n="object"===typeof e?e.outer:e,o=n.slice(0,n.indexOf(">")+1),s=['"',"'"];for(let a=0;a<s.length;a++){const e=s[a],r=t+"\\="+e+"([^"+e+"]*)"+e;i&&console.log("[xml-utils] pattern:",r);const n=new RegExp(r),l=n.exec(o);if(i&&console.log("[xml-utils] match:",l),l)return l[1]}}e.exports=t,e.exports["default"]=t},5261:function(e){function t(e,t,r){const i=new RegExp(t),n=i.exec(e.slice(r));return n?r+n.index+n[0].length-1:-1}e.exports=t,e.exports["default"]=t},3562:function(e){function t(e,t,r){const i=new RegExp(t),n=i.exec(e.slice(r));return n?r+n.index:-1}e.exports=t,e.exports["default"]=t},9306:function(e,t,r){"use strict";var i=r(4901),n=r(6823),o=TypeError;e.exports=function(e){if(i(e))return e;throw new o(n(e)+" is not a function")}},3506:function(e,t,r){"use strict";var i=r(3925),n=String,o=TypeError;e.exports=function(e){if(i(e))return e;throw new o("Can't set "+n(e)+" as a prototype")}},7080:function(e,t,r){"use strict";var i=r(4402).has;e.exports=function(e){return i(e),e}},679:function(e,t,r){"use strict";var i=r(1625),n=TypeError;e.exports=function(e,t){if(i(t,e))return e;throw new n("Incorrect invocation")}},8551:function(e,t,r){"use strict";var i=r(34),n=String,o=TypeError;e.exports=function(e){if(i(e))return e;throw new o(n(e)+" is not an object")}},7811:function(e){"use strict";e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},7394:function(e,t,r){"use strict";var i=r(6706),n=r(4576),o=TypeError;e.exports=i(ArrayBuffer.prototype,"byteLength","get")||function(e){if("ArrayBuffer"!==n(e))throw new o("ArrayBuffer expected");return e.byteLength}},3238:function(e,t,r){"use strict";var i=r(9504),n=r(7394),o=i(ArrayBuffer.prototype.slice);e.exports=function(e){if(0!==n(e))return!1;try{return o(e,0,0),!1}catch(t){return!0}}},5636:function(e,t,r){"use strict";var i=r(4475),n=r(9504),o=r(6706),s=r(7696),a=r(3238),l=r(7394),c=r(4483),u=r(1548),h=i.structuredClone,d=i.ArrayBuffer,p=i.DataView,f=i.TypeError,m=Math.min,_=d.prototype,g=p.prototype,y=n(_.slice),x=o(_,"resizable","get"),v=o(_,"maxByteLength","get"),b=n(g.getInt8),w=n(g.setInt8);e.exports=(u||c)&&function(e,t,r){var i,n=l(e),o=void 0===t?n:s(t),_=!x||!x(e);if(a(e))throw new f("ArrayBuffer is detached");if(u&&(e=h(e,{transfer:[e]}),n===o&&(r||_)))return e;if(n>=o&&(!r||_))i=y(e,0,o);else{var g=r&&!_&&v?{maxByteLength:v(e)}:void 0;i=new d(o,g);for(var T=new p(e),E=new p(i),S=m(o,n),M=0;M<S;M++)w(E,M,b(T,M))}return u||c(e),i}},4644:function(e,t,r){"use strict";var i,n,o,s=r(7811),a=r(3724),l=r(4475),c=r(4901),u=r(34),h=r(9297),d=r(6955),p=r(6823),f=r(6699),m=r(6840),_=r(2106),g=r(1625),y=r(2787),x=r(2967),v=r(8227),b=r(3392),w=r(1181),T=w.enforce,E=w.get,S=l.Int8Array,M=S&&S.prototype,A=l.Uint8ClampedArray,I=A&&A.prototype,C=S&&y(S),P=M&&y(M),L=Object.prototype,R=l.TypeError,D=v("toStringTag"),O=b("TYPED_ARRAY_TAG"),z="TypedArrayConstructor",k=s&&!!x&&"Opera"!==d(l.opera),F=!1,B={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},N={BigInt64Array:8,BigUint64Array:8},U=function(e){if(!u(e))return!1;var t=d(e);return"DataView"===t||h(B,t)||h(N,t)},V=function(e){var t=y(e);if(u(t)){var r=E(t);return r&&h(r,z)?r[z]:V(t)}},j=function(e){if(!u(e))return!1;var t=d(e);return h(B,t)||h(N,t)},G=function(e){if(j(e))return e;throw new R("Target is not a typed array")},$=function(e){if(c(e)&&(!x||g(C,e)))return e;throw new R(p(e)+" is not a typed array constructor")},q=function(e,t,r,i){if(a){if(r)for(var n in B){var o=l[n];if(o&&h(o.prototype,e))try{delete o.prototype[e]}catch(s){try{o.prototype[e]=t}catch(c){}}}P[e]&&!r||m(P,e,r?t:k&&M[e]||t,i)}},Z=function(e,t,r){var i,n;if(a){if(x){if(r)for(i in B)if(n=l[i],n&&h(n,e))try{delete n[e]}catch(o){}if(C[e]&&!r)return;try{return m(C,e,r?t:k&&C[e]||t)}catch(o){}}for(i in B)n=l[i],!n||n[e]&&!r||m(n,e,t)}};for(i in B)n=l[i],o=n&&n.prototype,o?T(o)[z]=n:k=!1;for(i in N)n=l[i],o=n&&n.prototype,o&&(T(o)[z]=n);if((!k||!c(C)||C===Function.prototype)&&(C=function(){throw new R("Incorrect invocation")},k))for(i in B)l[i]&&x(l[i],C);if((!k||!P||P===L)&&(P=C.prototype,k))for(i in B)l[i]&&x(l[i].prototype,P);if(k&&y(I)!==P&&x(I,P),a&&!h(P,D))for(i in F=!0,_(P,D,{configurable:!0,get:function(){return u(this)?this[O]:void 0}}),B)l[i]&&f(l[i],O,i);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:k,TYPED_ARRAY_TAG:F&&O,aTypedArray:G,aTypedArrayConstructor:$,exportTypedArrayMethod:q,exportTypedArrayStaticMethod:Z,getTypedArrayConstructor:V,isView:U,isTypedArray:j,TypedArray:C,TypedArrayPrototype:P}},5370:function(e,t,r){"use strict";var i=r(6198);e.exports=function(e,t,r){var n=0,o=arguments.length>2?r:i(t),s=new e(o);while(o>n)s[n]=t[n++];return s}},9617:function(e,t,r){"use strict";var i=r(5397),n=r(5610),o=r(6198),s=function(e){return function(t,r,s){var a=i(t),l=o(a);if(0===l)return!e&&-1;var c,u=n(s,l);if(e&&r!==r){while(l>u)if(c=a[u++],c!==c)return!0}else for(;l>u;u++)if((e||u in a)&&a[u]===r)return e||u||0;return!e&&-1}};e.exports={includes:s(!0),indexOf:s(!1)}},4527:function(e,t,r){"use strict";var i=r(3724),n=r(4376),o=TypeError,s=Object.getOwnPropertyDescriptor,a=i&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=a?function(e,t){if(n(e)&&!s(e,"length").writable)throw new o("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t}},7628:function(e,t,r){"use strict";var i=r(6198);e.exports=function(e,t){for(var r=i(e),n=new t(r),o=0;o<r;o++)n[o]=e[r-o-1];return n}},9928:function(e,t,r){"use strict";var i=r(6198),n=r(1291),o=RangeError;e.exports=function(e,t,r,s){var a=i(e),l=n(r),c=l<0?a+l:l;if(c>=a||c<0)throw new o("Incorrect index");for(var u=new t(a),h=0;h<a;h++)u[h]=h===c?s:e[h];return u}},4576:function(e,t,r){"use strict";var i=r(9504),n=i({}.toString),o=i("".slice);e.exports=function(e){return o(n(e),8,-1)}},6955:function(e,t,r){"use strict";var i=r(2140),n=r(4901),o=r(4576),s=r(8227),a=s("toStringTag"),l=Object,c="Arguments"===o(function(){return arguments}()),u=function(e,t){try{return e[t]}catch(r){}};e.exports=i?o:function(e){var t,r,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=u(t=l(e),a))?r:c?o(t):"Object"===(i=o(t))&&n(t.callee)?"Arguments":i}},7740:function(e,t,r){"use strict";var i=r(9297),n=r(5031),o=r(7347),s=r(4913);e.exports=function(e,t,r){for(var a=n(t),l=s.f,c=o.f,u=0;u<a.length;u++){var h=a[u];i(e,h)||r&&i(r,h)||l(e,h,c(t,h))}}},2211:function(e,t,r){"use strict";var i=r(9039);e.exports=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},6699:function(e,t,r){"use strict";var i=r(3724),n=r(4913),o=r(6980);e.exports=i?function(e,t,r){return n.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},6980:function(e){"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},2106:function(e,t,r){"use strict";var i=r(283),n=r(4913);e.exports=function(e,t,r){return r.get&&i(r.get,t,{getter:!0}),r.set&&i(r.set,t,{setter:!0}),n.f(e,t,r)}},6840:function(e,t,r){"use strict";var i=r(4901),n=r(4913),o=r(283),s=r(9433);e.exports=function(e,t,r,a){a||(a={});var l=a.enumerable,c=void 0!==a.name?a.name:t;if(i(r)&&o(r,c,a),a.global)l?e[t]=r:s(t,r);else{try{a.unsafe?e[t]&&(l=!0):delete e[t]}catch(u){}l?e[t]=r:n.f(e,t,{value:r,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return e}},9433:function(e,t,r){"use strict";var i=r(4475),n=Object.defineProperty;e.exports=function(e,t){try{n(i,e,{value:t,configurable:!0,writable:!0})}catch(r){i[e]=t}return t}},3724:function(e,t,r){"use strict";var i=r(9039);e.exports=!i((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},4483:function(e,t,r){"use strict";var i,n,o,s,a=r(4475),l=r(9714),c=r(1548),u=a.structuredClone,h=a.ArrayBuffer,d=a.MessageChannel,p=!1;if(c)p=function(e){u(e,{transfer:[e]})};else if(h)try{d||(i=l("worker_threads"),i&&(d=i.MessageChannel)),d&&(n=new d,o=new h(2),s=function(e){n.port1.postMessage(null,[e])},2===o.byteLength&&(s(o),0===o.byteLength&&(p=s)))}catch(f){}e.exports=p},4055:function(e,t,r){"use strict";var i=r(4475),n=r(34),o=i.document,s=n(o)&&n(o.createElement);e.exports=function(e){return s?o.createElement(e):{}}},6837:function(e){"use strict";var t=TypeError,r=9007199254740991;e.exports=function(e){if(e>r)throw t("Maximum allowed index exceeded");return e}},5002:function(e){"use strict";e.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},7290:function(e,t,r){"use strict";var i=r(516),n=r(9088);e.exports=!i&&!n&&"object"==typeof window&&"object"==typeof document},516:function(e){"use strict";e.exports="object"==typeof Deno&&Deno&&"object"==typeof Deno.version},9088:function(e,t,r){"use strict";var i=r(4475),n=r(4576);e.exports="process"===n(i.process)},9392:function(e){"use strict";e.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},7388:function(e,t,r){"use strict";var i,n,o=r(4475),s=r(9392),a=o.process,l=o.Deno,c=a&&a.versions||l&&l.version,u=c&&c.v8;u&&(i=u.split("."),n=i[0]>0&&i[0]<4?1:+(i[0]+i[1])),!n&&s&&(i=s.match(/Edge\/(\d+)/),(!i||i[1]>=74)&&(i=s.match(/Chrome\/(\d+)/),i&&(n=+i[1]))),e.exports=n},8727:function(e){"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},6193:function(e,t,r){"use strict";var i=r(9504),n=Error,o=i("".replace),s=function(e){return String(new n(e).stack)}("zxcasd"),a=/\n\s*at [^:]*:[^\n]*/,l=a.test(s);e.exports=function(e,t){if(l&&"string"==typeof e&&!n.prepareStackTrace)while(t--)e=o(e,a,"");return e}},6518:function(e,t,r){"use strict";var i=r(4475),n=r(7347).f,o=r(6699),s=r(6840),a=r(9433),l=r(7740),c=r(2796);e.exports=function(e,t){var r,u,h,d,p,f,m=e.target,_=e.global,g=e.stat;if(u=_?i:g?i[m]||a(m,{}):i[m]&&i[m].prototype,u)for(h in t){if(p=t[h],e.dontCallGetSet?(f=n(u,h),d=f&&f.value):d=u[h],r=c(_?h:m+(g?".":"#")+h,e.forced),!r&&void 0!==d){if(typeof p==typeof d)continue;l(p,d)}(e.sham||d&&d.sham)&&o(p,"sham",!0),s(u,h,p,e)}}},9039:function(e){"use strict";e.exports=function(e){try{return!!e()}catch(t){return!0}}},616:function(e,t,r){"use strict";var i=r(9039);e.exports=!i((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},9565:function(e,t,r){"use strict";var i=r(616),n=Function.prototype.call;e.exports=i?n.bind(n):function(){return n.apply(n,arguments)}},350:function(e,t,r){"use strict";var i=r(3724),n=r(9297),o=Function.prototype,s=i&&Object.getOwnPropertyDescriptor,a=n(o,"name"),l=a&&"something"===function(){}.name,c=a&&(!i||i&&s(o,"name").configurable);e.exports={EXISTS:a,PROPER:l,CONFIGURABLE:c}},6706:function(e,t,r){"use strict";var i=r(9504),n=r(9306);e.exports=function(e,t,r){try{return i(n(Object.getOwnPropertyDescriptor(e,t)[r]))}catch(o){}}},9504:function(e,t,r){"use strict";var i=r(616),n=Function.prototype,o=n.call,s=i&&n.bind.bind(o,o);e.exports=i?s:function(e){return function(){return o.apply(e,arguments)}}},7751:function(e,t,r){"use strict";var i=r(4475),n=r(4901),o=function(e){return n(e)?e:void 0};e.exports=function(e,t){return arguments.length<2?o(i[e]):i[e]&&i[e][t]}},1767:function(e){"use strict";e.exports=function(e){return{iterator:e,next:e.next,done:!1}}},5966:function(e,t,r){"use strict";var i=r(9306),n=r(4117);e.exports=function(e,t){var r=e[t];return n(r)?void 0:i(r)}},3789:function(e,t,r){"use strict";var i=r(9306),n=r(8551),o=r(9565),s=r(1291),a=r(1767),l="Invalid size",c=RangeError,u=TypeError,h=Math.max,d=function(e,t){this.set=e,this.size=h(t,0),this.has=i(e.has),this.keys=i(e.keys)};d.prototype={getIterator:function(){return a(n(o(this.keys,this.set)))},includes:function(e){return o(this.has,this.set,e)}},e.exports=function(e){n(e);var t=+e.size;if(t!==t)throw new u(l);var r=s(t);if(r<0)throw new c(l);return new d(e,r)}},4475:function(e,t,r){"use strict";var i=function(e){return e&&e.Math===Math&&e};e.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof r.g&&r.g)||i("object"==typeof this&&this)||function(){return this}()||Function("return this")()},9297:function(e,t,r){"use strict";var i=r(9504),n=r(8981),o=i({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(n(e),t)}},421:function(e){"use strict";e.exports={}},5917:function(e,t,r){"use strict";var i=r(3724),n=r(9039),o=r(4055);e.exports=!i&&!n((function(){return 7!==Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},7055:function(e,t,r){"use strict";var i=r(9504),n=r(9039),o=r(4576),s=Object,a=i("".split);e.exports=n((function(){return!s("z").propertyIsEnumerable(0)}))?function(e){return"String"===o(e)?a(e,""):s(e)}:s},3167:function(e,t,r){"use strict";var i=r(4901),n=r(34),o=r(2967);e.exports=function(e,t,r){var s,a;return o&&i(s=t.constructor)&&s!==r&&n(a=s.prototype)&&a!==r.prototype&&o(e,a),e}},3706:function(e,t,r){"use strict";var i=r(9504),n=r(4901),o=r(7629),s=i(Function.toString);n(o.inspectSource)||(o.inspectSource=function(e){return s(e)}),e.exports=o.inspectSource},1181:function(e,t,r){"use strict";var i,n,o,s=r(8622),a=r(4475),l=r(34),c=r(6699),u=r(9297),h=r(7629),d=r(6119),p=r(421),f="Object already initialized",m=a.TypeError,_=a.WeakMap,g=function(e){return o(e)?n(e):i(e,{})},y=function(e){return function(t){var r;if(!l(t)||(r=n(t)).type!==e)throw new m("Incompatible receiver, "+e+" required");return r}};if(s||h.state){var x=h.state||(h.state=new _);x.get=x.get,x.has=x.has,x.set=x.set,i=function(e,t){if(x.has(e))throw new m(f);return t.facade=e,x.set(e,t),t},n=function(e){return x.get(e)||{}},o=function(e){return x.has(e)}}else{var v=d("state");p[v]=!0,i=function(e,t){if(u(e,v))throw new m(f);return t.facade=e,c(e,v,t),t},n=function(e){return u(e,v)?e[v]:{}},o=function(e){return u(e,v)}}e.exports={set:i,get:n,has:o,enforce:g,getterFor:y}},4376:function(e,t,r){"use strict";var i=r(4576);e.exports=Array.isArray||function(e){return"Array"===i(e)}},1108:function(e,t,r){"use strict";var i=r(6955);e.exports=function(e){var t=i(e);return"BigInt64Array"===t||"BigUint64Array"===t}},4901:function(e){"use strict";var t="object"==typeof document&&document.all;e.exports="undefined"==typeof t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(e){return"function"==typeof e}},2796:function(e,t,r){"use strict";var i=r(9039),n=r(4901),o=/#|\.prototype\./,s=function(e,t){var r=l[a(e)];return r===u||r!==c&&(n(t)?i(t):!!t)},a=s.normalize=function(e){return String(e).replace(o,".").toLowerCase()},l=s.data={},c=s.NATIVE="N",u=s.POLYFILL="P";e.exports=s},4117:function(e){"use strict";e.exports=function(e){return null===e||void 0===e}},34:function(e,t,r){"use strict";var i=r(4901);e.exports=function(e){return"object"==typeof e?null!==e:i(e)}},3925:function(e,t,r){"use strict";var i=r(34);e.exports=function(e){return i(e)||null===e}},6395:function(e){"use strict";e.exports=!1},757:function(e,t,r){"use strict";var i=r(7751),n=r(4901),o=r(1625),s=r(7040),a=Object;e.exports=s?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return n(t)&&o(t.prototype,a(e))}},507:function(e,t,r){"use strict";var i=r(9565);e.exports=function(e,t,r){var n,o,s=r?e:e.iterator,a=e.next;while(!(n=i(a,s)).done)if(o=t(n.value),void 0!==o)return o}},9539:function(e,t,r){"use strict";var i=r(9565),n=r(8551),o=r(5966);e.exports=function(e,t,r){var s,a;n(e);try{if(s=o(e,"return"),!s){if("throw"===t)throw r;return r}s=i(s,e)}catch(l){a=!0,s=l}if("throw"===t)throw r;if(a)throw s;return n(s),r}},6198:function(e,t,r){"use strict";var i=r(8014);e.exports=function(e){return i(e.length)}},283:function(e,t,r){"use strict";var i=r(9504),n=r(9039),o=r(4901),s=r(9297),a=r(3724),l=r(350).CONFIGURABLE,c=r(3706),u=r(1181),h=u.enforce,d=u.get,p=String,f=Object.defineProperty,m=i("".slice),_=i("".replace),g=i([].join),y=a&&!n((function(){return 8!==f((function(){}),"length",{value:8}).length})),x=String(String).split("String"),v=e.exports=function(e,t,r){"Symbol("===m(p(t),0,7)&&(t="["+_(p(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!s(e,"name")||l&&e.name!==t)&&(a?f(e,"name",{value:t,configurable:!0}):e.name=t),y&&r&&s(r,"arity")&&e.length!==r.arity&&f(e,"length",{value:r.arity});try{r&&s(r,"constructor")&&r.constructor?a&&f(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(n){}var i=h(e);return s(i,"source")||(i.source=g(x,"string"==typeof t?t:"")),e};Function.prototype.toString=v((function(){return o(this)&&d(this).source||c(this)}),"toString")},741:function(e){"use strict";var t=Math.ceil,r=Math.floor;e.exports=Math.trunc||function(e){var i=+e;return(i>0?r:t)(i)}},2603:function(e,t,r){"use strict";var i=r(655);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:i(e)}},4913:function(e,t,r){"use strict";var i=r(3724),n=r(5917),o=r(8686),s=r(8551),a=r(6969),l=TypeError,c=Object.defineProperty,u=Object.getOwnPropertyDescriptor,h="enumerable",d="configurable",p="writable";t.f=i?o?function(e,t,r){if(s(e),t=a(t),s(r),"function"===typeof e&&"prototype"===t&&"value"in r&&p in r&&!r[p]){var i=u(e,t);i&&i[p]&&(e[t]=r.value,r={configurable:d in r?r[d]:i[d],enumerable:h in r?r[h]:i[h],writable:!1})}return c(e,t,r)}:c:function(e,t,r){if(s(e),t=a(t),s(r),n)try{return c(e,t,r)}catch(i){}if("get"in r||"set"in r)throw new l("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},7347:function(e,t,r){"use strict";var i=r(3724),n=r(9565),o=r(8773),s=r(6980),a=r(5397),l=r(6969),c=r(9297),u=r(5917),h=Object.getOwnPropertyDescriptor;t.f=i?h:function(e,t){if(e=a(e),t=l(t),u)try{return h(e,t)}catch(r){}if(c(e,t))return s(!n(o.f,e,t),e[t])}},8480:function(e,t,r){"use strict";var i=r(1828),n=r(8727),o=n.concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return i(e,o)}},3717:function(e,t){"use strict";t.f=Object.getOwnPropertySymbols},2787:function(e,t,r){"use strict";var i=r(9297),n=r(4901),o=r(8981),s=r(6119),a=r(2211),l=s("IE_PROTO"),c=Object,u=c.prototype;e.exports=a?c.getPrototypeOf:function(e){var t=o(e);if(i(t,l))return t[l];var r=t.constructor;return n(r)&&t instanceof r?r.prototype:t instanceof c?u:null}},1625:function(e,t,r){"use strict";var i=r(9504);e.exports=i({}.isPrototypeOf)},1828:function(e,t,r){"use strict";var i=r(9504),n=r(9297),o=r(5397),s=r(9617).indexOf,a=r(421),l=i([].push);e.exports=function(e,t){var r,i=o(e),c=0,u=[];for(r in i)!n(a,r)&&n(i,r)&&l(u,r);while(t.length>c)n(i,r=t[c++])&&(~s(u,r)||l(u,r));return u}},8773:function(e,t){"use strict";var r={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,n=i&&!r.call({1:2},1);t.f=n?function(e){var t=i(this,e);return!!t&&t.enumerable}:r},2967:function(e,t,r){"use strict";var i=r(6706),n=r(34),o=r(7750),s=r(3506);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{e=i(Object.prototype,"__proto__","set"),e(r,[]),t=r instanceof Array}catch(a){}return function(r,i){return o(r),s(i),n(r)?(t?e(r,i):r.__proto__=i,r):r}}():void 0)},4270:function(e,t,r){"use strict";var i=r(9565),n=r(4901),o=r(34),s=TypeError;e.exports=function(e,t){var r,a;if("string"===t&&n(r=e.toString)&&!o(a=i(r,e)))return a;if(n(r=e.valueOf)&&!o(a=i(r,e)))return a;if("string"!==t&&n(r=e.toString)&&!o(a=i(r,e)))return a;throw new s("Can't convert object to primitive value")}},5031:function(e,t,r){"use strict";var i=r(7751),n=r(9504),o=r(8480),s=r(3717),a=r(8551),l=n([].concat);e.exports=i("Reflect","ownKeys")||function(e){var t=o.f(a(e)),r=s.f;return r?l(t,r(e)):t}},7979:function(e,t,r){"use strict";var i=r(8551);e.exports=function(){var e=i(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},7750:function(e,t,r){"use strict";var i=r(4117),n=TypeError;e.exports=function(e){if(i(e))throw new n("Can't call method on "+e);return e}},9286:function(e,t,r){"use strict";var i=r(4402),n=r(8469),o=i.Set,s=i.add;e.exports=function(e){var t=new o;return n(e,(function(e){s(t,e)})),t}},3440:function(e,t,r){"use strict";var i=r(7080),n=r(4402),o=r(9286),s=r(5170),a=r(3789),l=r(8469),c=r(507),u=n.has,h=n.remove;e.exports=function(e){var t=i(this),r=a(e),n=o(t);return s(t)<=r.size?l(t,(function(e){r.includes(e)&&h(n,e)})):c(r.getIterator(),(function(e){u(t,e)&&h(n,e)})),n}},4402:function(e,t,r){"use strict";var i=r(9504),n=Set.prototype;e.exports={Set:Set,add:i(n.add),has:i(n.has),remove:i(n["delete"]),proto:n}},8750:function(e,t,r){"use strict";var i=r(7080),n=r(4402),o=r(5170),s=r(3789),a=r(8469),l=r(507),c=n.Set,u=n.add,h=n.has;e.exports=function(e){var t=i(this),r=s(e),n=new c;return o(t)>r.size?l(r.getIterator(),(function(e){h(t,e)&&u(n,e)})):a(t,(function(e){r.includes(e)&&u(n,e)})),n}},4449:function(e,t,r){"use strict";var i=r(7080),n=r(4402).has,o=r(5170),s=r(3789),a=r(8469),l=r(507),c=r(9539);e.exports=function(e){var t=i(this),r=s(e);if(o(t)<=r.size)return!1!==a(t,(function(e){if(r.includes(e))return!1}),!0);var u=r.getIterator();return!1!==l(u,(function(e){if(n(t,e))return c(u,"normal",!1)}))}},3838:function(e,t,r){"use strict";var i=r(7080),n=r(5170),o=r(8469),s=r(3789);e.exports=function(e){var t=i(this),r=s(e);return!(n(t)>r.size)&&!1!==o(t,(function(e){if(!r.includes(e))return!1}),!0)}},8527:function(e,t,r){"use strict";var i=r(7080),n=r(4402).has,o=r(5170),s=r(3789),a=r(507),l=r(9539);e.exports=function(e){var t=i(this),r=s(e);if(o(t)<r.size)return!1;var c=r.getIterator();return!1!==a(c,(function(e){if(!n(t,e))return l(c,"normal",!1)}))}},8469:function(e,t,r){"use strict";var i=r(9504),n=r(507),o=r(4402),s=o.Set,a=o.proto,l=i(a.forEach),c=i(a.keys),u=c(new s).next;e.exports=function(e,t,r){return r?n({iterator:c(e),next:u},t):l(e,t)}},4916:function(e,t,r){"use strict";var i=r(7751),n=function(e){return{size:e,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}};e.exports=function(e){var t=i("Set");try{(new t)[e](n(0));try{return(new t)[e](n(-1)),!1}catch(r){return!0}}catch(o){return!1}}},5170:function(e,t,r){"use strict";var i=r(6706),n=r(4402);e.exports=i(n.proto,"size","get")||function(e){return e.size}},3650:function(e,t,r){"use strict";var i=r(7080),n=r(4402),o=r(9286),s=r(3789),a=r(507),l=n.add,c=n.has,u=n.remove;e.exports=function(e){var t=i(this),r=s(e).getIterator(),n=o(t);return a(r,(function(e){c(t,e)?u(n,e):l(n,e)})),n}},4204:function(e,t,r){"use strict";var i=r(7080),n=r(4402).add,o=r(9286),s=r(3789),a=r(507);e.exports=function(e){var t=i(this),r=s(e).getIterator(),l=o(t);return a(r,(function(e){n(l,e)})),l}},6119:function(e,t,r){"use strict";var i=r(5745),n=r(3392),o=i("keys");e.exports=function(e){return o[e]||(o[e]=n(e))}},7629:function(e,t,r){"use strict";var i=r(6395),n=r(4475),o=r(9433),s="__core-js_shared__",a=e.exports=n[s]||o(s,{});(a.versions||(a.versions=[])).push({version:"3.37.1",mode:i?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.37.1/LICENSE",source:"https://github.com/zloirock/core-js"})},5745:function(e,t,r){"use strict";var i=r(7629);e.exports=function(e,t){return i[e]||(i[e]=t||{})}},1548:function(e,t,r){"use strict";var i=r(4475),n=r(9039),o=r(7388),s=r(7290),a=r(516),l=r(9088),c=i.structuredClone;e.exports=!!c&&!n((function(){if(a&&o>92||l&&o>94||s&&o>97)return!1;var e=new ArrayBuffer(8),t=c(e,{transfer:[e]});return 0!==e.byteLength||8!==t.byteLength}))},4495:function(e,t,r){"use strict";var i=r(7388),n=r(9039),o=r(4475),s=o.String;e.exports=!!Object.getOwnPropertySymbols&&!n((function(){var e=Symbol("symbol detection");return!s(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&i&&i<41}))},5610:function(e,t,r){"use strict";var i=r(1291),n=Math.max,o=Math.min;e.exports=function(e,t){var r=i(e);return r<0?n(r+t,0):o(r,t)}},5854:function(e,t,r){"use strict";var i=r(2777),n=TypeError;e.exports=function(e){var t=i(e,"number");if("number"==typeof t)throw new n("Can't convert number to bigint");return BigInt(t)}},7696:function(e,t,r){"use strict";var i=r(1291),n=r(8014),o=RangeError;e.exports=function(e){if(void 0===e)return 0;var t=i(e),r=n(t);if(t!==r)throw new o("Wrong length or index");return r}},5397:function(e,t,r){"use strict";var i=r(7055),n=r(7750);e.exports=function(e){return i(n(e))}},1291:function(e,t,r){"use strict";var i=r(741);e.exports=function(e){var t=+e;return t!==t||0===t?0:i(t)}},8014:function(e,t,r){"use strict";var i=r(1291),n=Math.min;e.exports=function(e){var t=i(e);return t>0?n(t,9007199254740991):0}},8981:function(e,t,r){"use strict";var i=r(7750),n=Object;e.exports=function(e){return n(i(e))}},2777:function(e,t,r){"use strict";var i=r(9565),n=r(34),o=r(757),s=r(5966),a=r(4270),l=r(8227),c=TypeError,u=l("toPrimitive");e.exports=function(e,t){if(!n(e)||o(e))return e;var r,l=s(e,u);if(l){if(void 0===t&&(t="default"),r=i(l,e,t),!n(r)||o(r))return r;throw new c("Can't convert object to primitive value")}return void 0===t&&(t="number"),a(e,t)}},6969:function(e,t,r){"use strict";var i=r(2777),n=r(757);e.exports=function(e){var t=i(e,"string");return n(t)?t:t+""}},2140:function(e,t,r){"use strict";var i=r(8227),n=i("toStringTag"),o={};o[n]="z",e.exports="[object z]"===String(o)},655:function(e,t,r){"use strict";var i=r(6955),n=String;e.exports=function(e){if("Symbol"===i(e))throw new TypeError("Cannot convert a Symbol value to a string");return n(e)}},9714:function(e,t,r){"use strict";var i=r(9088);e.exports=function(e){try{if(i)return Function('return require("'+e+'")')()}catch(t){}}},6823:function(e){"use strict";var t=String;e.exports=function(e){try{return t(e)}catch(r){return"Object"}}},3392:function(e,t,r){"use strict";var i=r(9504),n=0,o=Math.random(),s=i(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++n+o,36)}},7040:function(e,t,r){"use strict";var i=r(4495);e.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},8686:function(e,t,r){"use strict";var i=r(3724),n=r(9039);e.exports=i&&n((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},2812:function(e){"use strict";var t=TypeError;e.exports=function(e,r){if(e<r)throw new t("Not enough arguments");return e}},8622:function(e,t,r){"use strict";var i=r(4475),n=r(4901),o=i.WeakMap;e.exports=n(o)&&/native code/.test(String(o))},8227:function(e,t,r){"use strict";var i=r(4475),n=r(5745),o=r(9297),s=r(3392),a=r(4495),l=r(7040),c=i.Symbol,u=n("wks"),h=l?c["for"]||c:c&&c.withoutSetter||s;e.exports=function(e){return o(u,e)||(u[e]=a&&o(c,e)?c[e]:h("Symbol."+e)),u[e]}},6573:function(e,t,r){"use strict";var i=r(3724),n=r(2106),o=r(3238),s=ArrayBuffer.prototype;i&&!("detached"in s)&&n(s,"detached",{configurable:!0,get:function(){return o(this)}})},7936:function(e,t,r){"use strict";var i=r(6518),n=r(5636);n&&i({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return n(this,arguments.length?arguments[0]:void 0,!1)}})},8100:function(e,t,r){"use strict";var i=r(6518),n=r(5636);n&&i({target:"ArrayBuffer",proto:!0},{transfer:function(){return n(this,arguments.length?arguments[0]:void 0,!0)}})},4114:function(e,t,r){"use strict";var i=r(6518),n=r(8981),o=r(6198),s=r(4527),a=r(6837),l=r(9039),c=l((function(){return 4294967297!==[].push.call({length:4294967296},1)})),u=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}},h=c||!u();i({target:"Array",proto:!0,arity:1,forced:h},{push:function(e){var t=n(this),r=o(t),i=arguments.length;a(r+i);for(var l=0;l<i;l++)t[r]=arguments[l],r++;return s(t,r),r}})},9479:function(e,t,r){"use strict";var i=r(4475),n=r(3724),o=r(2106),s=r(7979),a=r(9039),l=i.RegExp,c=l.prototype,u=n&&a((function(){var e=!0;try{l(".","d")}catch(u){e=!1}var t={},r="",i=e?"dgimsy":"gimsy",n=function(e,i){Object.defineProperty(t,e,{get:function(){return r+=i,!0}})},o={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var s in e&&(o.hasIndices="d"),o)n(s,o[s]);var a=Object.getOwnPropertyDescriptor(c,"flags").get.call(t);return a!==i||r!==i}));u&&o(c,"flags",{configurable:!0,get:s})},7642:function(e,t,r){"use strict";var i=r(6518),n=r(3440),o=r(4916);i({target:"Set",proto:!0,real:!0,forced:!o("difference")},{difference:n})},8004:function(e,t,r){"use strict";var i=r(6518),n=r(9039),o=r(8750),s=r(4916),a=!s("intersection")||n((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}));i({target:"Set",proto:!0,real:!0,forced:a},{intersection:o})},3853:function(e,t,r){"use strict";var i=r(6518),n=r(4449),o=r(4916);i({target:"Set",proto:!0,real:!0,forced:!o("isDisjointFrom")},{isDisjointFrom:n})},5876:function(e,t,r){"use strict";var i=r(6518),n=r(3838),o=r(4916);i({target:"Set",proto:!0,real:!0,forced:!o("isSubsetOf")},{isSubsetOf:n})},2475:function(e,t,r){"use strict";var i=r(6518),n=r(8527),o=r(4916);i({target:"Set",proto:!0,real:!0,forced:!o("isSupersetOf")},{isSupersetOf:n})},5024:function(e,t,r){"use strict";var i=r(6518),n=r(3650),o=r(4916);i({target:"Set",proto:!0,real:!0,forced:!o("symmetricDifference")},{symmetricDifference:n})},1698:function(e,t,r){"use strict";var i=r(6518),n=r(4204),o=r(4916);i({target:"Set",proto:!0,real:!0,forced:!o("union")},{union:n})},7467:function(e,t,r){"use strict";var i=r(7628),n=r(4644),o=n.aTypedArray,s=n.exportTypedArrayMethod,a=n.getTypedArrayConstructor;s("toReversed",(function(){return i(o(this),a(this))}))},4732:function(e,t,r){"use strict";var i=r(4644),n=r(9504),o=r(9306),s=r(5370),a=i.aTypedArray,l=i.getTypedArrayConstructor,c=i.exportTypedArrayMethod,u=n(i.TypedArrayPrototype.sort);c("toSorted",(function(e){void 0!==e&&o(e);var t=a(this),r=s(l(t),t);return u(r,e)}))},9577:function(e,t,r){"use strict";var i=r(9928),n=r(4644),o=r(1108),s=r(1291),a=r(5854),l=n.aTypedArray,c=n.getTypedArrayConstructor,u=n.exportTypedArrayMethod,h=!!function(){try{new Int8Array(1)["with"](2,{valueOf:function(){throw 8}})}catch(e){return 8===e}}();u("with",{with:function(e,t){var r=l(this),n=s(e),u=o(r)?a(t):+t;return i(r,c(r),n,u)}}["with"],!h)},3375:function(e,t,r){"use strict";r(7642)},9225:function(e,t,r){"use strict";r(8004)},3972:function(e,t,r){"use strict";r(3853)},9209:function(e,t,r){"use strict";r(5876)},5714:function(e,t,r){"use strict";r(2475)},7561:function(e,t,r){"use strict";r(5024)},6197:function(e,t,r){"use strict";r(1698)},4979:function(e,t,r){"use strict";var i=r(6518),n=r(4475),o=r(7751),s=r(6980),a=r(4913).f,l=r(9297),c=r(679),u=r(3167),h=r(2603),d=r(5002),p=r(6193),f=r(3724),m=r(6395),_="DOMException",g=o("Error"),y=o(_),x=function(){c(this,v);var e=arguments.length,t=h(e<1?void 0:arguments[0]),r=h(e<2?void 0:arguments[1],"Error"),i=new y(t,r),n=new g(t);return n.name=_,a(i,"stack",s(1,p(n.stack,1))),u(i,this,x),i},v=x.prototype=y.prototype,b="stack"in new g(_),w="stack"in new y(1,2),T=y&&f&&Object.getOwnPropertyDescriptor(n,_),E=!!T&&!(T.writable&&T.configurable),S=b&&!E&&!w;i({global:!0,constructor:!0,forced:m||S},{DOMException:S?x:y});var M=o(_),A=M.prototype;if(A.constructor!==M)for(var I in m||a(A,"constructor",s(1,M)),d)if(l(d,I)){var C=d[I],P=C.s;l(M,P)||a(M,P,s(6,C.c))}},4603:function(e,t,r){"use strict";var i=r(6840),n=r(9504),o=r(655),s=r(2812),a=URLSearchParams,l=a.prototype,c=n(l.append),u=n(l["delete"]),h=n(l.forEach),d=n([].push),p=new a("a=1&a=2&b=3");p["delete"]("a",1),p["delete"]("b",void 0),p+""!=="a=2"&&i(l,"delete",(function(e){var t=arguments.length,r=t<2?void 0:arguments[1];if(t&&void 0===r)return u(this,e);var i=[];h(this,(function(e,t){d(i,{key:t,value:e})})),s(t,1);var n,a=o(e),l=o(r),p=0,f=0,m=!1,_=i.length;while(p<_)n=i[p++],m||n.key===a?(m=!0,u(this,n.key)):f++;while(f<_)n=i[f++],n.key===a&&n.value===l||c(this,n.key,n.value)}),{enumerable:!0,unsafe:!0})},7566:function(e,t,r){"use strict";var i=r(6840),n=r(9504),o=r(655),s=r(2812),a=URLSearchParams,l=a.prototype,c=n(l.getAll),u=n(l.has),h=new a("a=1");!h.has("a",2)&&h.has("a",void 0)||i(l,"has",(function(e){var t=arguments.length,r=t<2?void 0:arguments[1];if(t&&void 0===r)return u(this,e);var i=c(this,e);s(t,1);var n=o(r),a=0;while(a<i.length)if(i[a++]===n)return!0;return!1}),{enumerable:!0,unsafe:!0})},8721:function(e,t,r){"use strict";var i=r(3724),n=r(9504),o=r(2106),s=URLSearchParams.prototype,a=n(s.forEach);i&&!("size"in s)&&o(s,"size",{get:function(){var e=0;return a(this,(function(){e++})),e},configurable:!0,enumerable:!0})},8355:function(e,t,r){"use strict";r.d(t,{A:function(){return jt}});var i={};r.r(i),r.d(i,{hasBrowserEnv:function(){return Re},hasStandardBrowserEnv:function(){return De},hasStandardBrowserWebWorkerEnv:function(){return Oe}});r(4114),r(6573),r(8100),r(7936),r(7467),r(4732),r(9577);function n(e,t){return function(){return e.apply(t,arguments)}}const{toString:o}=Object.prototype,{getPrototypeOf:s}=Object,a=(e=>t=>{const r=o.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),l=e=>(e=e.toLowerCase(),t=>a(t)===e),c=e=>t=>typeof t===e,{isArray:u}=Array,h=c("undefined");function d(e){return null!==e&&!h(e)&&null!==e.constructor&&!h(e.constructor)&&_(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const p=l("ArrayBuffer");function f(e){let t;return t="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&p(e.buffer),t}const m=c("string"),_=c("function"),g=c("number"),y=e=>null!==e&&"object"===typeof e,x=e=>!0===e||!1===e,v=e=>{if("object"!==a(e))return!1;const t=s(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},b=l("Date"),w=l("File"),T=l("Blob"),E=l("FileList"),S=e=>y(e)&&_(e.pipe),M=e=>{let t;return e&&("function"===typeof FormData&&e instanceof FormData||_(e.append)&&("formdata"===(t=a(e))||"object"===t&&_(e.toString)&&"[object FormData]"===e.toString()))},A=l("URLSearchParams"),I=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function C(e,t,{allOwnKeys:r=!1}={}){if(null===e||"undefined"===typeof e)return;let i,n;if("object"!==typeof e&&(e=[e]),u(e))for(i=0,n=e.length;i<n;i++)t.call(null,e[i],i,e);else{const n=r?Object.getOwnPropertyNames(e):Object.keys(e),o=n.length;let s;for(i=0;i<o;i++)s=n[i],t.call(null,e[s],s,e)}}function P(e,t){t=t.toLowerCase();const r=Object.keys(e);let i,n=r.length;while(n-- >0)if(i=r[n],t===i.toLowerCase())return i;return null}const L=(()=>"undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:global)(),R=e=>!h(e)&&e!==L;function D(){const{caseless:e}=R(this)&&this||{},t={},r=(r,i)=>{const n=e&&P(t,i)||i;v(t[n])&&v(r)?t[n]=D(t[n],r):v(r)?t[n]=D({},r):u(r)?t[n]=r.slice():t[n]=r};for(let i=0,n=arguments.length;i<n;i++)arguments[i]&&C(arguments[i],r);return t}const O=(e,t,r,{allOwnKeys:i}={})=>(C(t,((t,i)=>{r&&_(t)?e[i]=n(t,r):e[i]=t}),{allOwnKeys:i}),e),z=e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),k=(e,t,r,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},F=(e,t,r,i)=>{let n,o,a;const l={};if(t=t||{},null==e)return t;do{n=Object.getOwnPropertyNames(e),o=n.length;while(o-- >0)a=n[o],i&&!i(a,e,t)||l[a]||(t[a]=e[a],l[a]=!0);e=!1!==r&&s(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},B=(e,t,r)=>{e=String(e),(void 0===r||r>e.length)&&(r=e.length),r-=t.length;const i=e.indexOf(t,r);return-1!==i&&i===r},N=e=>{if(!e)return null;if(u(e))return e;let t=e.length;if(!g(t))return null;const r=new Array(t);while(t-- >0)r[t]=e[t];return r},U=(e=>t=>e&&t instanceof e)("undefined"!==typeof Uint8Array&&s(Uint8Array)),V=(e,t)=>{const r=e&&e[Symbol.iterator],i=r.call(e);let n;while((n=i.next())&&!n.done){const r=n.value;t.call(e,r[0],r[1])}},j=(e,t)=>{let r;const i=[];while(null!==(r=e.exec(t)))i.push(r);return i},G=l("HTMLFormElement"),$=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,r){return t.toUpperCase()+r})),q=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),Z=l("RegExp"),W=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),i={};C(r,((r,n)=>{let o;!1!==(o=t(r,n,e))&&(i[n]=o||r)})),Object.defineProperties(e,i)},H=e=>{W(e,((t,r)=>{if(_(e)&&-1!==["arguments","caller","callee"].indexOf(r))return!1;const i=e[r];_(i)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))}))},X=(e,t)=>{const r={},i=e=>{e.forEach((e=>{r[e]=!0}))};return u(e)?i(e):i(String(e).split(t)),r},Y=()=>{},K=(e,t)=>(e=+e,Number.isFinite(e)?e:t),J="abcdefghijklmnopqrstuvwxyz",Q="0123456789",ee={DIGIT:Q,ALPHA:J,ALPHA_DIGIT:J+J.toUpperCase()+Q},te=(e=16,t=ee.ALPHA_DIGIT)=>{let r="";const{length:i}=t;while(e--)r+=t[Math.random()*i|0];return r};function re(e){return!!(e&&_(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])}const ie=e=>{const t=new Array(10),r=(e,i)=>{if(y(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[i]=e;const n=u(e)?[]:{};return C(e,((e,t)=>{const o=r(e,i+1);!h(o)&&(n[t]=o)})),t[i]=void 0,n}}return e};return r(e,0)},ne=l("AsyncFunction"),oe=e=>e&&(y(e)||_(e))&&_(e.then)&&_(e.catch);var se={isArray:u,isArrayBuffer:p,isBuffer:d,isFormData:M,isArrayBufferView:f,isString:m,isNumber:g,isBoolean:x,isObject:y,isPlainObject:v,isUndefined:h,isDate:b,isFile:w,isBlob:T,isRegExp:Z,isFunction:_,isStream:S,isURLSearchParams:A,isTypedArray:U,isFileList:E,forEach:C,merge:D,extend:O,trim:I,stripBOM:z,inherits:k,toFlatObject:F,kindOf:a,kindOfTest:l,endsWith:B,toArray:N,forEachEntry:V,matchAll:j,isHTMLForm:G,hasOwnProperty:q,hasOwnProp:q,reduceDescriptors:W,freezeMethods:H,toObjectSet:X,toCamelCase:$,noop:Y,toFiniteNumber:K,findKey:P,global:L,isContextDefined:R,ALPHABET:ee,generateString:te,isSpecCompliantForm:re,toJSONObject:ie,isAsyncFn:ne,isThenable:oe};function ae(e,t,r,i,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),i&&(this.request=i),n&&(this.response=n)}se.inherits(ae,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:se.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const le=ae.prototype,ce={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{ce[e]={value:e}})),Object.defineProperties(ae,ce),Object.defineProperty(le,"isAxiosError",{value:!0}),ae.from=(e,t,r,i,n,o)=>{const s=Object.create(le);return se.toFlatObject(e,s,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),ae.call(s,e.message,t,r,i,n),s.cause=e,s.name=e.name,o&&Object.assign(s,o),s};var ue=ae,he=null;function de(e){return se.isPlainObject(e)||se.isArray(e)}function pe(e){return se.endsWith(e,"[]")?e.slice(0,-2):e}function fe(e,t,r){return e?e.concat(t).map((function(e,t){return e=pe(e),!r&&t?"["+e+"]":e})).join(r?".":""):t}function me(e){return se.isArray(e)&&!e.some(de)}const _e=se.toFlatObject(se,{},null,(function(e){return/^is[A-Z]/.test(e)}));function ge(e,t,r){if(!se.isObject(e))throw new TypeError("target must be an object");t=t||new(he||FormData),r=se.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!se.isUndefined(t[e])}));const i=r.metaTokens,n=r.visitor||u,o=r.dots,s=r.indexes,a=r.Blob||"undefined"!==typeof Blob&&Blob,l=a&&se.isSpecCompliantForm(t);if(!se.isFunction(n))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(se.isDate(e))return e.toISOString();if(!l&&se.isBlob(e))throw new ue("Blob is not supported. Use a Buffer instead.");return se.isArrayBuffer(e)||se.isTypedArray(e)?l&&"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}function u(e,r,n){let a=e;if(e&&!n&&"object"===typeof e)if(se.endsWith(r,"{}"))r=i?r:r.slice(0,-2),e=JSON.stringify(e);else if(se.isArray(e)&&me(e)||(se.isFileList(e)||se.endsWith(r,"[]"))&&(a=se.toArray(e)))return r=pe(r),a.forEach((function(e,i){!se.isUndefined(e)&&null!==e&&t.append(!0===s?fe([r],i,o):null===s?r:r+"[]",c(e))})),!1;return!!de(e)||(t.append(fe(n,r,o),c(e)),!1)}const h=[],d=Object.assign(_e,{defaultVisitor:u,convertValue:c,isVisitable:de});function p(e,r){if(!se.isUndefined(e)){if(-1!==h.indexOf(e))throw Error("Circular reference detected in "+r.join("."));h.push(e),se.forEach(e,(function(e,i){const o=!(se.isUndefined(e)||null===e)&&n.call(t,e,se.isString(i)?i.trim():i,r,d);!0===o&&p(e,r?r.concat(i):[i])})),h.pop()}}if(!se.isObject(e))throw new TypeError("data must be an object");return p(e),t}var ye=ge;function xe(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function ve(e,t){this._pairs=[],e&&ye(e,this,t)}const be=ve.prototype;be.append=function(e,t){this._pairs.push([e,t])},be.toString=function(e){const t=e?function(t){return e.call(this,t,xe)}:xe;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};var we=ve;function Te(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Ee(e,t,r){if(!t)return e;const i=r&&r.encode||Te,n=r&&r.serialize;let o;if(o=n?n(t,r):se.isURLSearchParams(t)?t.toString():new we(t,r).toString(i),o){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}class Se{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){se.forEach(this.handlers,(function(t){null!==t&&e(t)}))}}var Me=Se,Ae={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Ie=(r(4603),r(7566),r(8721),"undefined"!==typeof URLSearchParams?URLSearchParams:we),Ce="undefined"!==typeof FormData?FormData:null,Pe="undefined"!==typeof Blob?Blob:null,Le={isBrowser:!0,classes:{URLSearchParams:Ie,FormData:Ce,Blob:Pe},protocols:["http","https","file","blob","url","data"]};const Re="undefined"!==typeof window&&"undefined"!==typeof document,De=(e=>Re&&["ReactNative","NativeScript","NS"].indexOf(e)<0)("undefined"!==typeof navigator&&navigator.product),Oe=(()=>"undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts)();var ze={...i,...Le};function ke(e,t){return ye(e,new ze.classes.URLSearchParams,Object.assign({visitor:function(e,t,r,i){return ze.isNode&&se.isBuffer(e)?(this.append(t,e.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},t))}function Fe(e){return se.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}function Be(e){const t={},r=Object.keys(e);let i;const n=r.length;let o;for(i=0;i<n;i++)o=r[i],t[o]=e[o];return t}function Ne(e){function t(e,r,i,n){let o=e[n++];if("__proto__"===o)return!0;const s=Number.isFinite(+o),a=n>=e.length;if(o=!o&&se.isArray(i)?i.length:o,a)return se.hasOwnProp(i,o)?i[o]=[i[o],r]:i[o]=r,!s;i[o]&&se.isObject(i[o])||(i[o]=[]);const l=t(e,r,i[o],n);return l&&se.isArray(i[o])&&(i[o]=Be(i[o])),!s}if(se.isFormData(e)&&se.isFunction(e.entries)){const r={};return se.forEachEntry(e,((e,i)=>{t(Fe(e),i,r,0)})),r}return null}var Ue=Ne;function Ve(e,t,r){if(se.isString(e))try{return(t||JSON.parse)(e),se.trim(e)}catch(i){if("SyntaxError"!==i.name)throw i}return(r||JSON.stringify)(e)}const je={transitional:Ae,adapter:["xhr","http"],transformRequest:[function(e,t){const r=t.getContentType()||"",i=r.indexOf("application/json")>-1,n=se.isObject(e);n&&se.isHTMLForm(e)&&(e=new FormData(e));const o=se.isFormData(e);if(o)return i?JSON.stringify(Ue(e)):e;if(se.isArrayBuffer(e)||se.isBuffer(e)||se.isStream(e)||se.isFile(e)||se.isBlob(e))return e;if(se.isArrayBufferView(e))return e.buffer;if(se.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(n){if(r.indexOf("application/x-www-form-urlencoded")>-1)return ke(e,this.formSerializer).toString();if((s=se.isFileList(e))||r.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return ye(s?{"files[]":e}:e,t&&new t,this.formSerializer)}}return n||i?(t.setContentType("application/json",!1),Ve(e)):e}],transformResponse:[function(e){const t=this.transitional||je.transitional,r=t&&t.forcedJSONParsing,i="json"===this.responseType;if(e&&se.isString(e)&&(r&&!this.responseType||i)){const r=t&&t.silentJSONParsing,o=!r&&i;try{return JSON.parse(e)}catch(n){if(o){if("SyntaxError"===n.name)throw ue.from(n,ue.ERR_BAD_RESPONSE,this,null,this.response);throw n}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ze.classes.FormData,Blob:ze.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};se.forEach(["delete","get","head","post","put","patch"],(e=>{je.headers[e]={}}));var Ge=je;const $e=se.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]);var qe=e=>{const t={};let r,i,n;return e&&e.split("\n").forEach((function(e){n=e.indexOf(":"),r=e.substring(0,n).trim().toLowerCase(),i=e.substring(n+1).trim(),!r||t[r]&&$e[r]||("set-cookie"===r?t[r]?t[r].push(i):t[r]=[i]:t[r]=t[r]?t[r]+", "+i:i)})),t};const Ze=Symbol("internals");function We(e){return e&&String(e).trim().toLowerCase()}function He(e){return!1===e||null==e?e:se.isArray(e)?e.map(He):String(e)}function Xe(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;while(i=r.exec(e))t[i[1]]=i[2];return t}const Ye=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function Ke(e,t,r,i,n){return se.isFunction(i)?i.call(this,t,r):(n&&(t=r),se.isString(t)?se.isString(i)?-1!==t.indexOf(i):se.isRegExp(i)?i.test(t):void 0:void 0)}function Je(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,r)=>t.toUpperCase()+r))}function Qe(e,t){const r=se.toCamelCase(" "+t);["get","set","has"].forEach((i=>{Object.defineProperty(e,i+r,{value:function(e,r,n){return this[i].call(this,t,e,r,n)},configurable:!0})}))}class et{constructor(e){e&&this.set(e)}set(e,t,r){const i=this;function n(e,t,r){const n=We(t);if(!n)throw new Error("header name must be a non-empty string");const o=se.findKey(i,n);(!o||void 0===i[o]||!0===r||void 0===r&&!1!==i[o])&&(i[o||t]=He(e))}const o=(e,t)=>se.forEach(e,((e,r)=>n(e,r,t)));return se.isPlainObject(e)||e instanceof this.constructor?o(e,t):se.isString(e)&&(e=e.trim())&&!Ye(e)?o(qe(e),t):null!=e&&n(t,e,r),this}get(e,t){if(e=We(e),e){const r=se.findKey(this,e);if(r){const e=this[r];if(!t)return e;if(!0===t)return Xe(e);if(se.isFunction(t))return t.call(this,e,r);if(se.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=We(e),e){const r=se.findKey(this,e);return!(!r||void 0===this[r]||t&&!Ke(this,this[r],r,t))}return!1}delete(e,t){const r=this;let i=!1;function n(e){if(e=We(e),e){const n=se.findKey(r,e);!n||t&&!Ke(r,r[n],n,t)||(delete r[n],i=!0)}}return se.isArray(e)?e.forEach(n):n(e),i}clear(e){const t=Object.keys(this);let r=t.length,i=!1;while(r--){const n=t[r];e&&!Ke(this,this[n],n,e,!0)||(delete this[n],i=!0)}return i}normalize(e){const t=this,r={};return se.forEach(this,((i,n)=>{const o=se.findKey(r,n);if(o)return t[o]=He(i),void delete t[n];const s=e?Je(n):String(n).trim();s!==n&&delete t[n],t[s]=He(i),r[s]=!0})),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return se.forEach(this,((r,i)=>{null!=r&&!1!==r&&(t[i]=e&&se.isArray(r)?r.join(", "):r)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([e,t])=>e+": "+t)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach((e=>r.set(e))),r}static accessor(e){const t=this[Ze]=this[Ze]={accessors:{}},r=t.accessors,i=this.prototype;function n(e){const t=We(e);r[t]||(Qe(i,e),r[t]=!0)}return se.isArray(e)?e.forEach(n):n(e),this}}et.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),se.reduceDescriptors(et.prototype,(({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[r]=e}}})),se.freezeMethods(et);var tt=et;function rt(e,t){const r=this||Ge,i=t||r,n=tt.from(i.headers);let o=i.data;return se.forEach(e,(function(e){o=e.call(r,o,n.normalize(),t?t.status:void 0)})),n.normalize(),o}function it(e){return!(!e||!e.__CANCEL__)}function nt(e,t,r){ue.call(this,null==e?"canceled":e,ue.ERR_CANCELED,t,r),this.name="CanceledError"}se.inherits(nt,ue,{__CANCEL__:!0});var ot=nt;r(4979);function st(e,t,r){const i=r.config.validateStatus;r.status&&i&&!i(r.status)?t(new ue("Request failed with status code "+r.status,[ue.ERR_BAD_REQUEST,ue.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}var at=ze.hasStandardBrowserEnv?{write(e,t,r,i,n,o){const s=[e+"="+encodeURIComponent(t)];se.isNumber(r)&&s.push("expires="+new Date(r).toGMTString()),se.isString(i)&&s.push("path="+i),se.isString(n)&&s.push("domain="+n),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function lt(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function ct(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function ut(e,t){return e&&!lt(t)?ct(e,t):t}var ht=ze.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let r;function i(r){let i=r;return e&&(t.setAttribute("href",i),i=t.href),t.setAttribute("href",i),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return r=i(window.location.href),function(e){const t=se.isString(e)?i(e):e;return t.protocol===r.protocol&&t.host===r.host}}():function(){return function(){return!0}}();function dt(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function pt(e,t){e=e||10;const r=new Array(e),i=new Array(e);let n,o=0,s=0;return t=void 0!==t?t:1e3,function(a){const l=Date.now(),c=i[s];n||(n=l),r[o]=a,i[o]=l;let u=s,h=0;while(u!==o)h+=r[u++],u%=e;if(o=(o+1)%e,o===s&&(s=(s+1)%e),l-n<t)return;const d=c&&l-c;return d?Math.round(1e3*h/d):void 0}}var ft=pt;function mt(e,t){let r=0;const i=ft(50,250);return n=>{const o=n.loaded,s=n.lengthComputable?n.total:void 0,a=o-r,l=i(a),c=o<=s;r=o;const u={loaded:o,total:s,progress:s?o/s:void 0,bytes:a,rate:l||void 0,estimated:l&&s&&c?(s-o)/l:void 0,event:n};u[t?"download":"upload"]=!0,e(u)}}const _t="undefined"!==typeof XMLHttpRequest;var gt=_t&&function(e){return new Promise((function(t,r){let i=e.data;const n=tt.from(e.headers).normalize();let o,s,{responseType:a,withXSRFToken:l}=e;function c(){e.cancelToken&&e.cancelToken.unsubscribe(o),e.signal&&e.signal.removeEventListener("abort",o)}if(se.isFormData(i))if(ze.hasStandardBrowserEnv||ze.hasStandardBrowserWebWorkerEnv)n.setContentType(!1);else if(!1!==(s=n.getContentType())){const[e,...t]=s?s.split(";").map((e=>e.trim())).filter(Boolean):[];n.setContentType([e||"multipart/form-data",...t].join("; "))}let u=new XMLHttpRequest;if(e.auth){const t=e.auth.username||"",r=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";n.set("Authorization","Basic "+btoa(t+":"+r))}const h=ut(e.baseURL,e.url);function d(){if(!u)return;const i=tt.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders()),n=a&&"text"!==a&&"json"!==a?u.response:u.responseText,o={data:n,status:u.status,statusText:u.statusText,headers:i,config:e,request:u};st((function(e){t(e),c()}),(function(e){r(e),c()}),o),u=null}if(u.open(e.method.toUpperCase(),Ee(h,e.params,e.paramsSerializer),!0),u.timeout=e.timeout,"onloadend"in u?u.onloadend=d:u.onreadystatechange=function(){u&&4===u.readyState&&(0!==u.status||u.responseURL&&0===u.responseURL.indexOf("file:"))&&setTimeout(d)},u.onabort=function(){u&&(r(new ue("Request aborted",ue.ECONNABORTED,e,u)),u=null)},u.onerror=function(){r(new ue("Network Error",ue.ERR_NETWORK,e,u)),u=null},u.ontimeout=function(){let t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const i=e.transitional||Ae;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),r(new ue(t,i.clarifyTimeoutError?ue.ETIMEDOUT:ue.ECONNABORTED,e,u)),u=null},ze.hasStandardBrowserEnv&&(l&&se.isFunction(l)&&(l=l(e)),l||!1!==l&&ht(h))){const t=e.xsrfHeaderName&&e.xsrfCookieName&&at.read(e.xsrfCookieName);t&&n.set(e.xsrfHeaderName,t)}void 0===i&&n.setContentType(null),"setRequestHeader"in u&&se.forEach(n.toJSON(),(function(e,t){u.setRequestHeader(t,e)})),se.isUndefined(e.withCredentials)||(u.withCredentials=!!e.withCredentials),a&&"json"!==a&&(u.responseType=e.responseType),"function"===typeof e.onDownloadProgress&&u.addEventListener("progress",mt(e.onDownloadProgress,!0)),"function"===typeof e.onUploadProgress&&u.upload&&u.upload.addEventListener("progress",mt(e.onUploadProgress)),(e.cancelToken||e.signal)&&(o=t=>{u&&(r(!t||t.type?new ot(null,e,u):t),u.abort(),u=null)},e.cancelToken&&e.cancelToken.subscribe(o),e.signal&&(e.signal.aborted?o():e.signal.addEventListener("abort",o)));const p=dt(h);p&&-1===ze.protocols.indexOf(p)?r(new ue("Unsupported protocol "+p+":",ue.ERR_BAD_REQUEST,e)):u.send(i||null)}))};const yt={http:he,xhr:gt};se.forEach(yt,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(r){}Object.defineProperty(e,"adapterName",{value:t})}}));const xt=e=>`- ${e}`,vt=e=>se.isFunction(e)||null===e||!1===e;var bt={getAdapter:e=>{e=se.isArray(e)?e:[e];const{length:t}=e;let r,i;const n={};for(let o=0;o<t;o++){let t;if(r=e[o],i=r,!vt(r)&&(i=yt[(t=String(r)).toLowerCase()],void 0===i))throw new ue(`Unknown adapter '${t}'`);if(i)break;n[t||"#"+o]=i}if(!i){const e=Object.entries(n).map((([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build")));let r=t?e.length>1?"since :\n"+e.map(xt).join("\n"):" "+xt(e[0]):"as no adapter specified";throw new ue("There is no suitable adapter to dispatch the request "+r,"ERR_NOT_SUPPORT")}return i},adapters:yt};function wt(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ot(null,e)}function Tt(e){wt(e),e.headers=tt.from(e.headers),e.data=rt.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);const t=bt.getAdapter(e.adapter||Ge.adapter);return t(e).then((function(t){return wt(e),t.data=rt.call(e,e.transformResponse,t),t.headers=tt.from(t.headers),t}),(function(t){return it(t)||(wt(e),t&&t.response&&(t.response.data=rt.call(e,e.transformResponse,t.response),t.response.headers=tt.from(t.response.headers))),Promise.reject(t)}))}const Et=e=>e instanceof tt?{...e}:e;function St(e,t){t=t||{};const r={};function i(e,t,r){return se.isPlainObject(e)&&se.isPlainObject(t)?se.merge.call({caseless:r},e,t):se.isPlainObject(t)?se.merge({},t):se.isArray(t)?t.slice():t}function n(e,t,r){return se.isUndefined(t)?se.isUndefined(e)?void 0:i(void 0,e,r):i(e,t,r)}function o(e,t){if(!se.isUndefined(t))return i(void 0,t)}function s(e,t){return se.isUndefined(t)?se.isUndefined(e)?void 0:i(void 0,e):i(void 0,t)}function a(r,n,o){return o in t?i(r,n):o in e?i(void 0,r):void 0}const l={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(e,t)=>n(Et(e),Et(t),!0)};return se.forEach(Object.keys(Object.assign({},e,t)),(function(i){const o=l[i]||n,s=o(e[i],t[i],i);se.isUndefined(s)&&o!==a||(r[i]=s)})),r}const Mt="1.6.8",At={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{At[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));const It={};function Ct(e,t,r){if("object"!==typeof e)throw new ue("options must be an object",ue.ERR_BAD_OPTION_VALUE);const i=Object.keys(e);let n=i.length;while(n-- >0){const o=i[n],s=t[o];if(s){const t=e[o],r=void 0===t||s(t,o,e);if(!0!==r)throw new ue("option "+o+" must be "+r,ue.ERR_BAD_OPTION_VALUE)}else if(!0!==r)throw new ue("Unknown option "+o,ue.ERR_BAD_OPTION)}}At.transitional=function(e,t,r){function i(e,t){return"[Axios v"+Mt+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return(r,n,o)=>{if(!1===e)throw new ue(i(n," has been removed"+(t?" in "+t:"")),ue.ERR_DEPRECATED);return t&&!It[n]&&(It[n]=!0,console.warn(i(n," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,n,o)}};var Pt={assertOptions:Ct,validators:At};const Lt=Pt.validators;class Rt{constructor(e){this.defaults=e,this.interceptors={request:new Me,response:new Me}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let e;Error.captureStackTrace?Error.captureStackTrace(e={}):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";r.stack?t&&!String(r.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(r.stack+="\n"+t):r.stack=t}throw r}}_request(e,t){"string"===typeof e?(t=t||{},t.url=e):t=e||{},t=St(this.defaults,t);const{transitional:r,paramsSerializer:i,headers:n}=t;void 0!==r&&Pt.assertOptions(r,{silentJSONParsing:Lt.transitional(Lt.boolean),forcedJSONParsing:Lt.transitional(Lt.boolean),clarifyTimeoutError:Lt.transitional(Lt.boolean)},!1),null!=i&&(se.isFunction(i)?t.paramsSerializer={serialize:i}:Pt.assertOptions(i,{encode:Lt.function,serialize:Lt.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=n&&se.merge(n.common,n[t.method]);n&&se.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete n[e]})),t.headers=tt.concat(o,n);const s=[];let a=!0;this.interceptors.request.forEach((function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(a=a&&e.synchronous,s.unshift(e.fulfilled,e.rejected))}));const l=[];let c;this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)}));let u,h=0;if(!a){const e=[Tt.bind(this),void 0];e.unshift.apply(e,s),e.push.apply(e,l),u=e.length,c=Promise.resolve(t);while(h<u)c=c.then(e[h++],e[h++]);return c}u=s.length;let d=t;h=0;while(h<u){const e=s[h++],t=s[h++];try{d=e(d)}catch(p){t.call(this,p);break}}try{c=Tt.call(this,d)}catch(p){return Promise.reject(p)}h=0,u=l.length;while(h<u)c=c.then(l[h++],l[h++]);return c}getUri(e){e=St(this.defaults,e);const t=ut(e.baseURL,e.url);return Ee(t,e.params,e.paramsSerializer)}}se.forEach(["delete","get","head","options"],(function(e){Rt.prototype[e]=function(t,r){return this.request(St(r||{},{method:e,url:t,data:(r||{}).data}))}})),se.forEach(["post","put","patch"],(function(e){function t(t){return function(r,i,n){return this.request(St(n||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}Rt.prototype[e]=t(),Rt.prototype[e+"Form"]=t(!0)}));var Dt=Rt;class Ot{constructor(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const r=this;this.promise.then((e=>{if(!r._listeners)return;let t=r._listeners.length;while(t-- >0)r._listeners[t](e);r._listeners=null})),this.promise.then=e=>{let t;const i=new Promise((e=>{r.subscribe(e),t=e})).then(e);return i.cancel=function(){r.unsubscribe(t)},i},e((function(e,i,n){r.reason||(r.reason=new ot(e,i,n),t(r.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;const t=new Ot((function(t){e=t}));return{token:t,cancel:e}}}var zt=Ot;function kt(e){return function(t){return e.apply(null,t)}}function Ft(e){return se.isObject(e)&&!0===e.isAxiosError}const Bt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Bt).forEach((([e,t])=>{Bt[t]=e}));var Nt=Bt;function Ut(e){const t=new Dt(e),r=n(Dt.prototype.request,t);return se.extend(r,Dt.prototype,t,{allOwnKeys:!0}),se.extend(r,t,null,{allOwnKeys:!0}),r.create=function(t){return Ut(St(e,t))},r}const Vt=Ut(Ge);Vt.Axios=Dt,Vt.CanceledError=ot,Vt.CancelToken=zt,Vt.isCancel=it,Vt.VERSION=Mt,Vt.toFormData=ye,Vt.AxiosError=ue,Vt.Cancel=Vt.CanceledError,Vt.all=function(e){return Promise.all(e)},Vt.spread=kt,Vt.isAxiosError=Ft,Vt.mergeConfig=St,Vt.AxiosHeaders=tt,Vt.formToJSON=e=>Ue(se.isHTMLForm(e)?new FormData(e):e),Vt.getAdapter=bt.getAdapter,Vt.HttpStatusCode=Nt,Vt.default=Vt;var jt=Vt},5322:function(e,t,r){"use strict";r.d(t,{Ay:function(){return nt}});r(4114),r(6573),r(8100),r(7936),r(7467),r(4732),r(9577);const i="Cannot convert undefined or null to object";function n(e){return(t,...r)=>s(e,t,r)}function o(e,t){return n(u(e,t).get)}const{apply:s,construct:a,defineProperty:l,get:c,getOwnPropertyDescriptor:u,getPrototypeOf:h,has:d,ownKeys:p,set:f,setPrototypeOf:m}=Reflect,{EPSILON:_,MAX_SAFE_INTEGER:g,isFinite:y,isNaN:x}=Number,{iterator:v,species:b,toStringTag:w,for:T}=Symbol,E=Object,{create:S,defineProperty:M,freeze:A,is:I}=E,C=E.prototype,P=(C.__lookupGetter__&&n(C.__lookupGetter__),E.hasOwn||n(C.hasOwnProperty)),L=Array,R=(L.isArray,L.prototype),D=(n(R.join),n(R.push),n(R.toLocaleString),R[v]),O=n(D),{abs:z,trunc:k}=Math,F=ArrayBuffer,B=(F.isView,F.prototype),N=(n(B.slice),o(B,"byteLength"),"undefined"!==typeof SharedArrayBuffer?SharedArrayBuffer:null),U=(N&&o(N.prototype,"byteLength"),h(Uint8Array)),V=(U.from,U.prototype),j=(V[v],n(V.keys),n(V.values),n(V.entries),n(V.set),n(V.reverse),n(V.fill),n(V.copyWithin),n(V.sort),n(V.slice),n(V.subarray),o(V,"buffer"),o(V,"byteOffset"),o(V,"length"),o(V,w),Uint8Array),G=Uint16Array,$=Uint32Array,q=Float32Array,Z=h([][v]()),W=n(Z.next),H=n(function*(){}().next),X=h(Z),Y=DataView.prototype,K=n(Y.getUint16),J=(n(Y.setUint16),TypeError),Q=WeakSet,ee=Q.prototype,te=(n(ee.add),n(ee.has),WeakMap),re=te.prototype,ie=n(re.get),ne=(n(re.has),n(re.set)),oe=new te,se=S(null,{next:{value:function(){const e=ie(oe,this);return W(e)}},[v]:{value:function(){return this}}});function ae(e){if(e[v]===D&&Z.next===W)return e;const t=S(se);return ne(oe,t,O(e)),t}const le=new te,ce=S(X,{next:{value:function(){const e=ie(le,this);return H(e)},writable:!0,configurable:!0}});for(const ot of p(Z))"next"!==ot&&M(ce,ot,u(Z,ot));const ue=new F(4),he=new q(ue),de=new $(ue),pe=new G(512),fe=new j(512);for(let ot=0;ot<256;++ot){const e=ot-127;e<-24?(pe[ot]=0,pe[256|ot]=32768,fe[ot]=24,fe[256|ot]=24):e<-14?(pe[ot]=1024>>-e-14,pe[256|ot]=1024>>-e-14|32768,fe[ot]=-e-1,fe[256|ot]=-e-1):e<=15?(pe[ot]=e+15<<10,pe[256|ot]=e+15<<10|32768,fe[ot]=13,fe[256|ot]=13):e<128?(pe[ot]=31744,pe[256|ot]=64512,fe[ot]=24,fe[256|ot]=24):(pe[ot]=31744,pe[256|ot]=64512,fe[ot]=13,fe[256|ot]=13)}const me=new $(2048);for(let ot=1;ot<1024;++ot){let e=ot<<13,t=0;while(0===(8388608&e))e<<=1,t-=8388608;e&=-8388609,t+=947912704,me[ot]=e|t}for(let ot=1024;ot<2048;++ot)me[ot]=939524096+(ot-1024<<13);const _e=new $(64);for(let ot=1;ot<31;++ot)_e[ot]=ot<<23;_e[31]=1199570944,_e[32]=2147483648;for(let ot=33;ot<63;++ot)_e[ot]=2147483648+(ot-32<<23);_e[63]=3347054592;const ge=new G(64);for(let ot=1;ot<64;++ot)32!==ot&&(ge[ot]=1024);function ye(e){const t=e>>10;return de[0]=me[ge[t]+(1023&e)]+_e[t],he[0]}function xe(e,t,...r){return ye(K(e,t,...ae(r)))}var ve=r(3146),be=r(554),we=r(4329);function Te(e,t){const{width:r,height:i}=e,n=new Uint8Array(r*i*3);let o;for(let s=0,a=0;s<e.length;++s,a+=3)o=256-e[s]/t*256,n[a]=o,n[a+1]=o,n[a+2]=o;return n}function Ee(e,t){const{width:r,height:i}=e,n=new Uint8Array(r*i*3);let o;for(let s=0,a=0;s<e.length;++s,a+=3)o=e[s]/t*256,n[a]=o,n[a+1]=o,n[a+2]=o;return n}function Se(e,t){const{width:r,height:i}=e,n=new Uint8Array(r*i*3),o=t.length/3,s=t.length/3*2;for(let a=0,l=0;a<e.length;++a,l+=3){const r=e[a];n[l]=t[r]/65536*256,n[l+1]=t[r+o]/65536*256,n[l+2]=t[r+s]/65536*256}return n}function Me(e){const{width:t,height:r}=e,i=new Uint8Array(t*r*3);for(let n=0,o=0;n<e.length;n+=4,o+=3){const t=e[n],r=e[n+1],s=e[n+2],a=e[n+3];i[o]=(255-t)/256*255*((255-a)/256),i[o+1]=(255-r)/256*255*((255-a)/256),i[o+2]=(255-s)/256*255*((255-a)/256)}return i}function Ae(e){const{width:t,height:r}=e,i=new Uint8ClampedArray(t*r*3);for(let n=0,o=0;n<e.length;n+=3,o+=3){const t=e[n],r=e[n+1],s=e[n+2];i[o]=t+1.402*(s-128),i[o+1]=t-.34414*(r-128)-.71414*(s-128),i[o+2]=t+1.772*(r-128)}return i}const Ie=.95047,Ce=1,Pe=1.08883;function Le(e){const{width:t,height:r}=e,i=new Uint8Array(t*r*3);for(let n=0,o=0;n<e.length;n+=3,o+=3){const t=e[n+0],r=e[n+1]<<24>>24,s=e[n+2]<<24>>24;let a,l,c,u=(t+16)/116,h=r/500+u,d=u-s/200;h=Ie*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),u=Ce*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),d=Pe*(d*d*d>.008856?d*d*d:(d-16/116)/7.787),a=3.2406*h+-1.5372*u+-.4986*d,l=-.9689*h+1.8758*u+.0415*d,c=.0557*h+-.204*u+1.057*d,a=a>.0031308?1.055*a**(1/2.4)-.055:12.92*a,l=l>.0031308?1.055*l**(1/2.4)-.055:12.92*l,c=c>.0031308?1.055*c**(1/2.4)-.055:12.92*c,i[o]=255*Math.max(0,Math.min(1,a)),i[o+1]=255*Math.max(0,Math.min(1,l)),i[o+2]=255*Math.max(0,Math.min(1,c))}return i}const Re=new Map;function De(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>Re.set(e,t)))}async function Oe(e){const t=Re.get(e.Compression);if(!t)throw new Error(`Unknown compression method identifier: ${e.Compression}`);const r=await t();return new r(e)}function ze(e,t,r,i=1){return new(Object.getPrototypeOf(e).constructor)(t*r*i)}function ke(e,t,r,i,n){const o=t/i,s=r/n;return e.map((e=>{const a=ze(e,i,n);for(let l=0;l<n;++l){const n=Math.min(Math.round(s*l),r-1);for(let r=0;r<i;++r){const s=Math.min(Math.round(o*r),t-1),c=e[n*t+s];a[l*i+r]=c}}return a}))}function Fe(e,t,r){return(1-r)*e+r*t}function Be(e,t,r,i,n){const o=t/i,s=r/n;return e.map((e=>{const a=ze(e,i,n);for(let l=0;l<n;++l){const n=s*l,c=Math.floor(n),u=Math.min(Math.ceil(n),r-1);for(let r=0;r<i;++r){const s=o*r,h=s%1,d=Math.floor(s),p=Math.min(Math.ceil(s),t-1),f=e[c*t+d],m=e[c*t+p],_=e[u*t+d],g=e[u*t+p],y=Fe(Fe(f,m,h),Fe(_,g,h),n%1);a[l*i+r]=y}}return a}))}function Ne(e,t,r,i,n,o="nearest"){switch(o.toLowerCase()){case"nearest":return ke(e,t,r,i,n);case"bilinear":case"linear":return Be(e,t,r,i,n);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function Ue(e,t,r,i,n,o){const s=t/i,a=r/n,l=ze(e,i,n,o);for(let c=0;c<n;++c){const n=Math.min(Math.round(a*c),r-1);for(let r=0;r<i;++r){const a=Math.min(Math.round(s*r),t-1);for(let s=0;s<o;++s){const u=e[n*t*o+a*o+s];l[c*i*o+r*o+s]=u}}}return l}function Ve(e,t,r,i,n,o){const s=t/i,a=r/n,l=ze(e,i,n,o);for(let c=0;c<n;++c){const n=a*c,u=Math.floor(n),h=Math.min(Math.ceil(n),r-1);for(let r=0;r<i;++r){const a=s*r,d=a%1,p=Math.floor(a),f=Math.min(Math.ceil(a),t-1);for(let s=0;s<o;++s){const a=e[u*t*o+p*o+s],m=e[u*t*o+f*o+s],_=e[h*t*o+p*o+s],g=e[h*t*o+f*o+s],y=Fe(Fe(a,m,d),Fe(_,g,d),n%1);l[c*i*o+r*o+s]=y}}}return l}function je(e,t,r,i,n,o,s="nearest"){switch(s.toLowerCase()){case"nearest":return Ue(e,t,r,i,n,o);case"bilinear":case"linear":return Ve(e,t,r,i,n,o);default:throw new Error(`Unsupported resampling method: '${s}'`)}}function Ge(e,t,r){let i=0;for(let n=t;n<r;++n)i+=e[n];return i}function $e(e,t,r){switch(e){case 1:if(t<=8)return new Uint8Array(r);if(t<=16)return new Uint16Array(r);if(t<=32)return new Uint32Array(r);break;case 2:if(8===t)return new Int8Array(r);if(16===t)return new Int16Array(r);if(32===t)return new Int32Array(r);break;case 3:switch(t){case 16:case 32:return new Float32Array(r);case 64:return new Float64Array(r);default:break}break;default:break}throw Error("Unsupported data format/bitsPerSample")}function qe(e,t){return(1!==e&&2!==e||!(t<=32)||t%8!==0)&&(3!==e||16!==t&&32!==t&&64!==t)}function Ze(e,t,r,i,n,o,s){const a=new DataView(e),l=2===r?s*o:s*o*i,c=2===r?1:i,u=$e(t,n,l),h=parseInt("1".repeat(n),2);if(1===t){let e;e=1===r?i*n:n;let t=o*e;0!==(7&t)&&(t=t+7&-8);for(let r=0;r<s;++r){const e=r*t;for(let t=0;t<o;++t){const i=e+t*c*n;for(let e=0;e<c;++e){const s=i+e*n,l=(r*o+t)*c+e,d=Math.floor(s/8),p=s%8;if(p+n<=8)u[l]=a.getUint8(d)>>8-n-p&h;else if(p+n<=16)u[l]=a.getUint16(d)>>16-n-p&h;else if(p+n<=24){const e=a.getUint16(d)<<8|a.getUint8(d+2);u[l]=e>>24-n-p&h}else u[l]=a.getUint32(d)>>32-n-p&h}}}}return u.buffer}De([void 0,1],(()=>r.e(234).then(r.bind(r,5234)).then((e=>e.default)))),De(5,(()=>r.e(243).then(r.bind(r,4243)).then((e=>e.default)))),De(6,(()=>{throw new Error("old style JPEG compression is not supported.")})),De(7,(()=>r.e(632).then(r.bind(r,1632)).then((e=>e.default)))),De([8,32946],(()=>Promise.all([r.e(167),r.e(855)]).then(r.bind(r,9855)).then((e=>e.default)))),De(32773,(()=>r.e(223).then(r.bind(r,7223)).then((e=>e.default)))),De(34887,(()=>Promise.all([r.e(167),r.e(967)]).then(r.bind(r,3967)).then((async e=>(await e.zstd.init(),e))).then((e=>e.default)))),De(50001,(()=>r.e(441).then(r.bind(r,7441)).then((e=>e.default))));class We{constructor(e,t,r,i,n,o){this.fileDirectory=e,this.geoKeys=t,this.dataView=r,this.littleEndian=i,this.tiles=n?{}:null,this.isTiled=!e.StripOffsets;const s=e.PlanarConfiguration;if(this.planarConfiguration="undefined"===typeof s?1:s,1!==this.planarConfiguration&&2!==this.planarConfiguration)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return"undefined"!==typeof this.fileDirectory.SamplesPerPixel?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:"undefined"!==typeof this.fileDirectory.RowsPerStrip?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,r=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(r<=8)return DataView.prototype.getUint8;if(r<=16)return DataView.prototype.getUint16;if(r<=32)return DataView.prototype.getUint32;break;case 2:if(r<=8)return DataView.prototype.getInt8;if(r<=16)return DataView.prototype.getInt16;if(r<=32)return DataView.prototype.getInt32;break;case 3:switch(r){case 16:return function(e,t){return xe(this,e,t)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64;default:break}break;default:break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){const r=this.getSampleFormat(e),i=this.getBitsPerSample(e);return $e(r,i,t)}async getTileOrStrip(e,t,r,i,n){const o=Math.ceil(this.getWidth()/this.getTileWidth()),s=Math.ceil(this.getHeight()/this.getTileHeight());let a;const{tiles:l}=this;let c,u;1===this.planarConfiguration?a=t*o+e:2===this.planarConfiguration&&(a=r*o*s+t*o+e),this.isTiled?(c=this.fileDirectory.TileOffsets[a],u=this.fileDirectory.TileByteCounts[a]):(c=this.fileDirectory.StripOffsets[a],u=this.fileDirectory.StripByteCounts[a]);const h=(await this.source.fetch([{offset:c,length:u}],n))[0];let d;return null!==l&&l[a]?d=l[a]:(d=(async()=>{let e=await i.decode(this.fileDirectory,h);const r=this.getSampleFormat(),n=this.getBitsPerSample();return qe(r,n)&&(e=Ze(e,r,this.planarConfiguration,this.getSamplesPerPixel(),n,this.getTileWidth(),this.getBlockHeight(t))),e})(),null!==l&&(l[a]=d)),{x:e,y:t,sample:r,data:await d}}async _readRaster(e,t,r,i,n,o,s,a,l){const c=this.getTileWidth(),u=this.getTileHeight(),h=this.getWidth(),d=this.getHeight(),p=Math.max(Math.floor(e[0]/c),0),f=Math.min(Math.ceil(e[2]/c),Math.ceil(h/c)),m=Math.max(Math.floor(e[1]/u),0),_=Math.min(Math.ceil(e[3]/u),Math.ceil(d/u)),g=e[2]-e[0];let y=this.getBytesPerPixel();const x=[],v=[];for(let T=0;T<t.length;++T)1===this.planarConfiguration?x.push(Ge(this.fileDirectory.BitsPerSample,0,t[T])/8):x.push(0),v.push(this.getReaderForSample(t[T]));const b=[],{littleEndian:w}=this;for(let T=m;T<_;++T)for(let o=p;o<f;++o){let s;1===this.planarConfiguration&&(s=this.getTileOrStrip(o,T,0,n,l));for(let a=0;a<t.length;++a){const p=a,f=t[a];2===this.planarConfiguration&&(y=this.getSampleByteSize(f),s=this.getTileOrStrip(o,T,f,n,l));const m=s.then((n=>{const o=n.data,s=new DataView(o),a=this.getBlockHeight(n.y),l=n.y*u,f=n.x*c,m=l+a,_=(n.x+1)*c,b=v[p],T=Math.min(a,a-(m-e[3]),d-l),E=Math.min(c,c-(_-e[2]),h-f);for(let u=Math.max(0,e[1]-l);u<T;++u)for(let n=Math.max(0,e[0]-f);n<E;++n){const o=(u*c+n)*y,a=b.call(s,o+x[p],w);let h;i?(h=(u+l-e[1])*g*t.length+(n+f-e[0])*t.length+p,r[h]=a):(h=(u+l-e[1])*g+n+f-e[0],r[p][h]=a)}}));b.push(m)}}if(await Promise.all(b),o&&e[2]-e[0]!==o||s&&e[3]-e[1]!==s){let n;return n=i?je(r,e[2]-e[0],e[3]-e[1],o,s,t.length,a):Ne(r,e[2]-e[0],e[3]-e[1],o,s,a),n.width=o,n.height=s,n}return r.width=o||e[2]-e[0],r.height=s||e[3]-e[1],r}async readRasters({window:e,samples:t=[],interleave:r,pool:i=null,width:n,height:o,resampleMethod:s,fillValue:a,signal:l}={}){const c=e||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const u=c[2]-c[0],h=c[3]-c[1],d=u*h,p=this.getSamplesPerPixel();if(t&&t.length){for(let g=0;g<t.length;++g)if(t[g]>=p)return Promise.reject(new RangeError(`Invalid sample index '${t[g]}'.`))}else for(let g=0;g<p;++g)t.push(g);let f;if(r){const e=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,r=Math.max.apply(null,this.fileDirectory.BitsPerSample);f=$e(e,r,d*t.length),a&&f.fill(a)}else{f=[];for(let e=0;e<t.length;++e){const r=this.getArrayForSample(t[e],d);Array.isArray(a)&&e<a.length?r.fill(a[e]):a&&!Array.isArray(a)&&r.fill(a),f.push(r)}}const m=i||await Oe(this.fileDirectory),_=await this._readRaster(c,t,f,r,m,n,o,s,l);return _}async readRGB({window:e,interleave:t=!0,pool:r=null,width:i,height:n,resampleMethod:o,enableAlpha:s=!1,signal:a}={}){const l=e||[0,0,this.getWidth(),this.getHeight()];if(l[0]>l[2]||l[1]>l[3])throw new Error("Invalid subsets");const c=this.fileDirectory.PhotometricInterpretation;if(c===we.ub.RGB){let l=[0,1,2];if(this.fileDirectory.ExtraSamples!==we.AC.Unspecified&&s){l=[];for(let e=0;e<this.fileDirectory.BitsPerSample.length;e+=1)l.push(e)}return this.readRasters({window:e,interleave:t,samples:l,pool:r,width:i,height:n,resampleMethod:o,signal:a})}let u;switch(c){case we.ub.WhiteIsZero:case we.ub.BlackIsZero:case we.ub.Palette:u=[0];break;case we.ub.CMYK:u=[0,1,2,3];break;case we.ub.YCbCr:case we.ub.CIELab:u=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const h={window:l,interleave:!0,samples:u,pool:r,width:i,height:n,resampleMethod:o,signal:a},{fileDirectory:d}=this,p=await this.readRasters(h),f=2**this.fileDirectory.BitsPerSample[0];let m;switch(c){case we.ub.WhiteIsZero:m=Te(p,f);break;case we.ub.BlackIsZero:m=Ee(p,f);break;case we.ub.Palette:m=Se(p,d.ColorMap);break;case we.ub.CMYK:m=Me(p);break;case we.ub.YCbCr:m=Ae(p);break;case we.ub.CIELab:m=Le(p);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const e=new Uint8Array(m.length/3),t=new Uint8Array(m.length/3),r=new Uint8Array(m.length/3);for(let i=0,n=0;i<m.length;i+=3,++n)e[n]=m[i],t[n]=m[i+1],r[n]=m[i+2];m=[e,t,r]}return m.width=p.width,m.height=p.height,m}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const r=this.fileDirectory.GDAL_METADATA;let i=be(r,"Item");i=null===e?i.filter((e=>void 0===ve(e,"sample"))):i.filter((t=>Number(ve(t,"sample"))===e));for(let n=0;n<i.length;++n){const e=i[n];t[ve(e,"name")]=e.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&6===e.length)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,r=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(r)return 0===r[1]&&0===r[4]?[r[0],-r[5],r[10]]:[Math.sqrt(r[0]*r[0]+r[4]*r[4]),-Math.sqrt(r[1]*r[1]+r[5]*r[5]),r[10]];if(e){const[t,r,i]=e.getResolution();return[t*e.getWidth()/this.getWidth(),r*e.getHeight()/this.getHeight(),i*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return 1===this.geoKeys.GTRasterTypeGeoKey}getBoundingBox(e=!1){const t=this.getHeight(),r=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[e,i,n,o,s,a,l,c]=this.fileDirectory.ModelTransformation,u=[[0,0],[0,t],[r,0],[r,t]],h=u.map((([t,r])=>[o+e*t+i*r,c+s*t+a*r])),d=h.map((e=>e[0])),p=h.map((e=>e[1]));return[Math.min(...d),Math.min(...p),Math.max(...d),Math.max(...p)]}{const e=this.getOrigin(),i=this.getResolution(),n=e[0],o=e[1],s=n+i[0]*r,a=o+i[1]*t;return[Math.min(n,s),Math.min(o,a),Math.max(n,s),Math.max(o,a)]}}}var He=We;class Xe{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const r=this.getUint32(e,t),i=this.getUint32(e+4,t);let n;if(t){if(n=r+2**32*i,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}if(n=2**32*r+i,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}getInt64(e,t){let r=0;const i=(128&this._dataView.getUint8(e+(t?7:0)))>0;let n=!0;for(let o=0;o<8;o++){let s=this._dataView.getUint8(e+(t?o:7-o));i&&(n?0!==s&&(s=255&~(s-1),n=!1):s=255&~s),r+=s*256**o}return i&&(r=-r),r}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return xe(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class Ye{constructor(e,t,r,i){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=r,this._bigTiff=i}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),r=this.readUint32(e+4);let i;if(this._littleEndian){if(i=t+2**32*r,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}if(i=2**32*t+r,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}readInt64(e){let t=0;const r=(128&this._dataView.getUint8(e+(this._littleEndian?7:0)))>0;let i=!0;for(let n=0;n<8;n++){let o=this._dataView.getUint8(e+(this._littleEndian?n:7-n));r&&(i?0!==o&&(o=255&~(o-1),i=!1):o=255&~o),t+=o*256**n}return r&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}function Ke(e){switch(e){case we.s$.BYTE:case we.s$.ASCII:case we.s$.SBYTE:case we.s$.UNDEFINED:return 1;case we.s$.SHORT:case we.s$.SSHORT:return 2;case we.s$.LONG:case we.s$.SLONG:case we.s$.FLOAT:case we.s$.IFD:return 4;case we.s$.RATIONAL:case we.s$.SRATIONAL:case we.s$.DOUBLE:case we.s$.LONG8:case we.s$.SLONG8:case we.s$.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${e}`)}}function Je(e){const t=e.GeoKeyDirectory;if(!t)return null;const r={};for(let i=4;i<=4*t[3];i+=4){const n=we.Hm[t[i]],o=t[i+1]?we.$[t[i+1]]:null,s=t[i+2],a=t[i+3];let l=null;if(o){if(l=e[o],"undefined"===typeof l||null===l)throw new Error(`Could not get value of geoKey '${n}'.`);"string"===typeof l?l=l.substring(a,a+s-1):l.subarray&&(l=l.subarray(a,a+s),1===s&&(l=l[0]))}else l=a;r[n]=l}return r}function Qe(e,t,r,i){let n=null,o=null;const s=Ke(t);switch(t){case we.s$.BYTE:case we.s$.ASCII:case we.s$.UNDEFINED:n=new Uint8Array(r),o=e.readUint8;break;case we.s$.SBYTE:n=new Int8Array(r),o=e.readInt8;break;case we.s$.SHORT:n=new Uint16Array(r),o=e.readUint16;break;case we.s$.SSHORT:n=new Int16Array(r),o=e.readInt16;break;case we.s$.LONG:case we.s$.IFD:n=new Uint32Array(r),o=e.readUint32;break;case we.s$.SLONG:n=new Int32Array(r),o=e.readInt32;break;case we.s$.LONG8:case we.s$.IFD8:n=new Array(r),o=e.readUint64;break;case we.s$.SLONG8:n=new Array(r),o=e.readInt64;break;case we.s$.RATIONAL:n=new Uint32Array(2*r),o=e.readUint32;break;case we.s$.SRATIONAL:n=new Int32Array(2*r),o=e.readInt32;break;case we.s$.FLOAT:n=new Float32Array(r),o=e.readFloat32;break;case we.s$.DOUBLE:n=new Float64Array(r),o=e.readFloat64;break;default:throw new RangeError(`Invalid field type: ${t}`)}if(t!==we.s$.RATIONAL&&t!==we.s$.SRATIONAL)for(let a=0;a<r;++a)n[a]=o.call(e,i+a*s);else for(let a=0;a<r;a+=2)n[a]=o.call(e,i+a*s),n[a+1]=o.call(e,i+(a*s+4));return t===we.s$.ASCII?new TextDecoder("utf-8").decode(n):n}class et{constructor(e,t,r){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=r}}class tt extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class rt{async readRasters(e={}){const{window:t,width:r,height:i}=e;let{resX:n,resY:o,bbox:s}=e;const a=await this.getImage();let l=a;const c=await this.getImageCount(),u=a.getBoundingBox();if(t&&s)throw new Error('Both "bbox" and "window" passed.');if(r||i){if(t){const[e,r]=a.getOrigin(),[i,n]=a.getResolution();s=[e+t[0]*i,r+t[1]*n,e+t[2]*i,r+t[3]*n]}const e=s||u;if(r){if(n)throw new Error("Both width and resX passed");n=(e[2]-e[0])/r}if(i){if(o)throw new Error("Both width and resY passed");o=(e[3]-e[1])/i}}if(n||o){const e=[];for(let t=0;t<c;++t){const r=await this.getImage(t),{SubfileType:i,NewSubfileType:n}=r.fileDirectory;(0===t||2===i||1&n)&&e.push(r)}e.sort(((e,t)=>e.getWidth()-t.getWidth()));for(let t=0;t<e.length;++t){const r=e[t],i=(u[2]-u[0])/r.getWidth(),s=(u[3]-u[1])/r.getHeight();if(l=r,n&&n>i||o&&o>s)break}}let h=t;if(s){const[e,t]=a.getOrigin(),[r,i]=l.getResolution(a);h=[Math.round((s[0]-e)/r),Math.round((s[1]-t)/i),Math.round((s[2]-e)/r),Math.round((s[3]-t)/i)],h=[Math.min(h[0],h[2]),Math.min(h[1],h[3]),Math.max(h[0],h[2]),Math.max(h[1],h[3])]}return l.readRasters({...e,window:h})}}class it extends rt{constructor(e,t,r,i,n={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=r,this.firstIFDOffset=i,this.cache=n.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const r=this.bigTiff?4048:1024;return new Ye((await this.source.fetch([{offset:e,length:"undefined"!==typeof t?t:r}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,r=this.bigTiff?8:2;let i=await this.getSlice(e);const n=this.bigTiff?i.readUint64(e):i.readUint16(e),o=n*t+(this.bigTiff?16:6);i.covers(e,o)||(i=await this.getSlice(e,o));const s={};let a=e+(this.bigTiff?8:2);for(let u=0;u<n;a+=t,++u){const e=i.readUint16(a),t=i.readUint16(a+2),r=this.bigTiff?i.readUint64(a+4):i.readUint32(a+4);let n,o;const l=Ke(t),c=a+(this.bigTiff?12:8);if(l*r<=(this.bigTiff?8:4))n=Qe(i,t,r,c);else{const e=i.readOffset(c),o=Ke(t)*r;if(i.covers(e,o))n=Qe(i,t,r,e);else{const i=await this.getSlice(e,o);n=Qe(i,t,r,e)}}o=1===r&&-1===we.NZ.indexOf(e)&&t!==we.s$.RATIONAL&&t!==we.s$.SRATIONAL?n[0]:n,s[we.$[e]]=o}const l=Je(s),c=i.readOffset(e+r+t*n);return new et(s,l,c)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(0===e)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){if(t instanceof tt)throw new tt(e);throw t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(0===t.nextIFDByteOffset)throw new tt(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new He(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;while(t)try{await this.requestIFD(e),++e}catch(r){if(!(r instanceof tt))throw r;t=!1}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const t="GDAL_STRUCTURAL_METADATA_SIZE=",r=t.length+100;let i=await this.getSlice(e,r);if(t===Qe(i,we.s$.ASCII,t.length,e)){const t=Qe(i,we.s$.ASCII,r,e),n=t.split("\n")[0],o=Number(n.split("=")[1].split(" ")[0])+n.length;o>r&&(i=await this.getSlice(e,o));const s=Qe(i,we.s$.ASCII,o,e);this.ghostValues={},s.split("\n").filter((e=>e.length>0)).map((e=>e.split("="))).forEach((([e,t])=>{this.ghostValues[e]=t}))}return this.ghostValues}static async fromSource(e,t,r){const i=(await e.fetch([{offset:0,length:1024}],r))[0],n=new Xe(i),o=n.getUint16(0,0);let s;if(18761===o)s=!0;else{if(19789!==o)throw new TypeError("Invalid byte order value.");s=!1}const a=n.getUint16(2,s);let l;if(42===a)l=!1;else{if(43!==a)throw new TypeError("Invalid magic number.");{l=!0;const e=n.getUint16(4,s);if(8!==e)throw new Error("Unsupported offset byte-size.")}}const c=l?n.getUint64(8,s):n.getUint32(4,s);return new it(e,s,l,c,t)}close(){return"function"===typeof this.source.close&&this.source.close()}}var nt=it},4329:function(e,t,r){"use strict";r.d(t,{$:function(){return i},AC:function(){return c},Hm:function(){return d},NZ:function(){return o},S3:function(){return h},TZ:function(){return u},s$:function(){return a},ub:function(){return l}});const i={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},n={};for(const f in i)i.hasOwnProperty(f)&&(n[i[f]]=parseInt(f,10));const o=[n.BitsPerSample,n.ExtraSamples,n.SampleFormat,n.StripByteCounts,n.StripOffsets,n.StripRowCounts,n.TileByteCounts,n.TileOffsets,n.SubIFDs],s={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},a={};for(const f in s)s.hasOwnProperty(f)&&(a[s[f]]=parseInt(f,10));const l={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},c={Unspecified:0,Assocalpha:1,Unassalpha:2},u={Version:0,AddCompression:1},h={None:0,Deflate:1,Zstandard:2},d={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},p={};for(const f in d)d.hasOwnProperty(f)&&(p[d[f]]=parseInt(f,10))},1387:function(e,t,r){"use strict";r.d(t,{LA:function(){return se},aE:function(){return tt}});r(4114),r(3375),r(9225),r(3972),r(9209),r(5714),r(7561),r(6197);var i=r(6768),n=r(144);
/*!
  * vue-router v4.3.2
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */
const o="undefined"!==typeof document;function s(e){return e.__esModule||"Module"===e[Symbol.toStringTag]}const a=Object.assign;function l(e,t){const r={};for(const i in t){const n=t[i];r[i]=u(n)?n.map(e):e(n)}return r}const c=()=>{},u=Array.isArray;const h=/#/g,d=/&/g,p=/\//g,f=/=/g,m=/\?/g,_=/\+/g,g=/%5B/g,y=/%5D/g,x=/%5E/g,v=/%60/g,b=/%7B/g,w=/%7C/g,T=/%7D/g,E=/%20/g;function S(e){return encodeURI(""+e).replace(w,"|").replace(g,"[").replace(y,"]")}function M(e){return S(e).replace(b,"{").replace(T,"}").replace(x,"^")}function A(e){return S(e).replace(_,"%2B").replace(E,"+").replace(h,"%23").replace(d,"%26").replace(v,"`").replace(b,"{").replace(T,"}").replace(x,"^")}function I(e){return A(e).replace(f,"%3D")}function C(e){return S(e).replace(h,"%23").replace(m,"%3F")}function P(e){return null==e?"":C(e).replace(p,"%2F")}function L(e){try{return decodeURIComponent(""+e)}catch(t){}return""+e}const R=/\/$/,D=e=>e.replace(R,"");function O(e,t,r="/"){let i,n={},o="",s="";const a=t.indexOf("#");let l=t.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(i=t.slice(0,l),o=t.slice(l+1,a>-1?a:t.length),n=e(o)),a>-1&&(i=i||t.slice(0,a),s=t.slice(a,t.length)),i=j(null!=i?i:t,r),{fullPath:i+(o&&"?")+o+s,path:i,query:n,hash:L(s)}}function z(e,t){const r=t.query?e(t.query):"";return t.path+(r&&"?")+r+(t.hash||"")}function k(e,t){return t&&e.toLowerCase().startsWith(t.toLowerCase())?e.slice(t.length)||"/":e}function F(e,t,r){const i=t.matched.length-1,n=r.matched.length-1;return i>-1&&i===n&&B(t.matched[i],r.matched[n])&&N(t.params,r.params)&&e(t.query)===e(r.query)&&t.hash===r.hash}function B(e,t){return(e.aliasOf||e)===(t.aliasOf||t)}function N(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(!U(e[r],t[r]))return!1;return!0}function U(e,t){return u(e)?V(e,t):u(t)?V(t,e):e===t}function V(e,t){return u(t)?e.length===t.length&&e.every(((e,r)=>e===t[r])):1===e.length&&e[0]===t}function j(e,t){if(e.startsWith("/"))return e;if(!e)return t;const r=t.split("/"),i=e.split("/"),n=i[i.length-1];".."!==n&&"."!==n||i.push("");let o,s,a=r.length-1;for(o=0;o<i.length;o++)if(s=i[o],"."!==s){if(".."!==s)break;a>1&&a--}return r.slice(0,a).join("/")+"/"+i.slice(o).join("/")}var G,$;(function(e){e["pop"]="pop",e["push"]="push"})(G||(G={})),function(e){e["back"]="back",e["forward"]="forward",e["unknown"]=""}($||($={}));function q(e){if(!e)if(o){const t=document.querySelector("base");e=t&&t.getAttribute("href")||"/",e=e.replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return"/"!==e[0]&&"#"!==e[0]&&(e="/"+e),D(e)}const Z=/^[^#]+#/;function W(e,t){return e.replace(Z,"#")+t}function H(e,t){const r=document.documentElement.getBoundingClientRect(),i=e.getBoundingClientRect();return{behavior:t.behavior,left:i.left-r.left-(t.left||0),top:i.top-r.top-(t.top||0)}}const X=()=>({left:window.scrollX,top:window.scrollY});function Y(e){let t;if("el"in e){const r=e.el,i="string"===typeof r&&r.startsWith("#");0;const n="string"===typeof r?i?document.getElementById(r.slice(1)):document.querySelector(r):r;if(!n)return;t=H(n,e)}else t=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(t):window.scrollTo(null!=t.left?t.left:window.scrollX,null!=t.top?t.top:window.scrollY)}function K(e,t){const r=history.state?history.state.position-t:-1;return r+e}const J=new Map;function Q(e,t){J.set(e,t)}function ee(e){const t=J.get(e);return J.delete(e),t}let te=()=>location.protocol+"//"+location.host;function re(e,t){const{pathname:r,search:i,hash:n}=t,o=e.indexOf("#");if(o>-1){let t=n.includes(e.slice(o))?e.slice(o).length:1,r=n.slice(t);return"/"!==r[0]&&(r="/"+r),k(r,"")}const s=k(r,e);return s+i+n}function ie(e,t,r,i){let n=[],o=[],s=null;const l=({state:o})=>{const a=re(e,location),l=r.value,c=t.value;let u=0;if(o){if(r.value=a,t.value=o,s&&s===l)return void(s=null);u=c?o.position-c.position:0}else i(a);n.forEach((e=>{e(r.value,l,{delta:u,type:G.pop,direction:u?u>0?$.forward:$.back:$.unknown})}))};function c(){s=r.value}function u(e){n.push(e);const t=()=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)};return o.push(t),t}function h(){const{history:e}=window;e.state&&e.replaceState(a({},e.state,{scroll:X()}),"")}function d(){for(const e of o)e();o=[],window.removeEventListener("popstate",l),window.removeEventListener("beforeunload",h)}return window.addEventListener("popstate",l),window.addEventListener("beforeunload",h,{passive:!0}),{pauseListeners:c,listen:u,destroy:d}}function ne(e,t,r,i=!1,n=!1){return{back:e,current:t,forward:r,replaced:i,position:window.history.length,scroll:n?X():null}}function oe(e){const{history:t,location:r}=window,i={value:re(e,r)},n={value:t.state};function o(i,o,s){const a=e.indexOf("#"),l=a>-1?(r.host&&document.querySelector("base")?e:e.slice(a))+i:te()+e+i;try{t[s?"replaceState":"pushState"](o,"",l),n.value=o}catch(c){console.error(c),r[s?"replace":"assign"](l)}}function s(e,r){const s=a({},t.state,ne(n.value.back,e,n.value.forward,!0),r,{position:n.value.position});o(e,s,!0),i.value=e}function l(e,r){const s=a({},n.value,t.state,{forward:e,scroll:X()});o(s.current,s,!0);const l=a({},ne(i.value,e,null),{position:s.position+1},r);o(e,l,!1),i.value=e}return n.value||o(i.value,{back:null,current:i.value,forward:null,position:t.length-1,replaced:!0,scroll:null},!0),{location:i,state:n,push:l,replace:s}}function se(e){e=q(e);const t=oe(e),r=ie(e,t.state,t.location,t.replace);function i(e,t=!0){t||r.pauseListeners(),history.go(e)}const n=a({location:"",base:e,go:i,createHref:W.bind(null,e)},t,r);return Object.defineProperty(n,"location",{enumerable:!0,get:()=>t.location.value}),Object.defineProperty(n,"state",{enumerable:!0,get:()=>t.state.value}),n}function ae(e){return"string"===typeof e||e&&"object"===typeof e}function le(e){return"string"===typeof e||"symbol"===typeof e}const ce={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},ue=Symbol("");var he;(function(e){e[e["aborted"]=4]="aborted",e[e["cancelled"]=8]="cancelled",e[e["duplicated"]=16]="duplicated"})(he||(he={}));function de(e,t){return a(new Error,{type:e,[ue]:!0},t)}function pe(e,t){return e instanceof Error&&ue in e&&(null==t||!!(e.type&t))}const fe="[^/]+?",me={sensitive:!1,strict:!1,start:!0,end:!0},_e=/[.+*?^${}()[\]/\\]/g;function ge(e,t){const r=a({},me,t),i=[];let n=r.start?"^":"";const o=[];for(const a of e){const e=a.length?[]:[90];r.strict&&!a.length&&(n+="/");for(let t=0;t<a.length;t++){const i=a[t];let s=40+(r.sensitive?.25:0);if(0===i.type)t||(n+="/"),n+=i.value.replace(_e,"\\$&"),s+=40;else if(1===i.type){const{value:e,repeatable:r,optional:l,regexp:c}=i;o.push({name:e,repeatable:r,optional:l});const u=c||fe;if(u!==fe){s+=10;try{new RegExp(`(${u})`)}catch(h){throw new Error(`Invalid custom RegExp for param "${e}" (${u}): `+h.message)}}let d=r?`((?:${u})(?:/(?:${u}))*)`:`(${u})`;t||(d=l&&a.length<2?`(?:/${d})`:"/"+d),l&&(d+="?"),n+=d,s+=20,l&&(s+=-8),r&&(s+=-20),".*"===u&&(s+=-50)}e.push(s)}i.push(e)}if(r.strict&&r.end){const e=i.length-1;i[e][i[e].length-1]+=.7000000000000001}r.strict||(n+="/?"),r.end?n+="$":r.strict&&(n+="(?:/|$)");const s=new RegExp(n,r.sensitive?"":"i");function l(e){const t=e.match(s),r={};if(!t)return null;for(let i=1;i<t.length;i++){const e=t[i]||"",n=o[i-1];r[n.name]=e&&n.repeatable?e.split("/"):e}return r}function c(t){let r="",i=!1;for(const n of e){i&&r.endsWith("/")||(r+="/"),i=!1;for(const e of n)if(0===e.type)r+=e.value;else if(1===e.type){const{value:o,repeatable:s,optional:a}=e,l=o in t?t[o]:"";if(u(l)&&!s)throw new Error(`Provided param "${o}" is an array but it is not repeatable (* or + modifiers)`);const c=u(l)?l.join("/"):l;if(!c){if(!a)throw new Error(`Missing required param "${o}"`);n.length<2&&(r.endsWith("/")?r=r.slice(0,-1):i=!0)}r+=c}}return r||"/"}return{re:s,score:i,keys:o,parse:l,stringify:c}}function ye(e,t){let r=0;while(r<e.length&&r<t.length){const i=t[r]-e[r];if(i)return i;r++}return e.length<t.length?1===e.length&&80===e[0]?-1:1:e.length>t.length?1===t.length&&80===t[0]?1:-1:0}function xe(e,t){let r=0;const i=e.score,n=t.score;while(r<i.length&&r<n.length){const e=ye(i[r],n[r]);if(e)return e;r++}if(1===Math.abs(n.length-i.length)){if(ve(i))return 1;if(ve(n))return-1}return n.length-i.length}function ve(e){const t=e[e.length-1];return e.length>0&&t[t.length-1]<0}const be={type:0,value:""},we=/[a-zA-Z0-9_]/;function Te(e){if(!e)return[[]];if("/"===e)return[[be]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function t(e){throw new Error(`ERR (${r})/"${c}": ${e}`)}let r=0,i=r;const n=[];let o;function s(){o&&n.push(o),o=[]}let a,l=0,c="",u="";function h(){c&&(0===r?o.push({type:0,value:c}):1===r||2===r||3===r?(o.length>1&&("*"===a||"+"===a)&&t(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),o.push({type:1,value:c,regexp:u,repeatable:"*"===a||"+"===a,optional:"*"===a||"?"===a})):t("Invalid state to consume buffer"),c="")}function d(){c+=a}while(l<e.length)if(a=e[l++],"\\"!==a||2===r)switch(r){case 0:"/"===a?(c&&h(),s()):":"===a?(h(),r=1):d();break;case 4:d(),r=i;break;case 1:"("===a?r=2:we.test(a)?d():(h(),r=0,"*"!==a&&"?"!==a&&"+"!==a&&l--);break;case 2:")"===a?"\\"==u[u.length-1]?u=u.slice(0,-1)+a:r=3:u+=a;break;case 3:h(),r=0,"*"!==a&&"?"!==a&&"+"!==a&&l--,u="";break;default:t("Unknown state");break}else i=r,r=4;return 2===r&&t(`Unfinished custom RegExp for param "${c}"`),h(),s(),n}function Ee(e,t,r){const i=ge(Te(e.path),r);const n=a(i,{record:e,parent:t,children:[],alias:[]});return t&&!n.record.aliasOf===!t.record.aliasOf&&t.children.push(n),n}function Se(e,t){const r=[],i=new Map;function n(e){return i.get(e)}function o(e,r,i){const n=!i,l=Ae(e);l.aliasOf=i&&i.record;const h=Le(t,e),d=[l];if("alias"in e){const t="string"===typeof e.alias?[e.alias]:e.alias;for(const e of t)d.push(a({},l,{components:i?i.record.components:l.components,path:e,aliasOf:i?i.record:l}))}let p,f;for(const t of d){const{path:a}=t;if(r&&"/"!==a[0]){const e=r.record.path,i="/"===e[e.length-1]?"":"/";t.path=r.record.path+(a&&i+a)}if(p=Ee(t,r,h),i?i.alias.push(p):(f=f||p,f!==p&&f.alias.push(p),n&&e.name&&!Ce(p)&&s(e.name)),l.children){const e=l.children;for(let t=0;t<e.length;t++)o(e[t],p,i&&i.children[t])}i=i||p,(p.record.components&&Object.keys(p.record.components).length||p.record.name||p.record.redirect)&&u(p)}return f?()=>{s(f)}:c}function s(e){if(le(e)){const t=i.get(e);t&&(i.delete(e),r.splice(r.indexOf(t),1),t.children.forEach(s),t.alias.forEach(s))}else{const t=r.indexOf(e);t>-1&&(r.splice(t,1),e.record.name&&i.delete(e.record.name),e.children.forEach(s),e.alias.forEach(s))}}function l(){return r}function u(e){let t=0;while(t<r.length&&xe(e,r[t])>=0&&(e.record.path!==r[t].record.path||!Re(e,r[t])))t++;r.splice(t,0,e),e.record.name&&!Ce(e)&&i.set(e.record.name,e)}function h(e,t){let n,o,s,l={};if("name"in e&&e.name){if(n=i.get(e.name),!n)throw de(1,{location:e});0,s=n.record.name,l=a(Me(t.params,n.keys.filter((e=>!e.optional)).concat(n.parent?n.parent.keys.filter((e=>e.optional)):[]).map((e=>e.name))),e.params&&Me(e.params,n.keys.map((e=>e.name)))),o=n.stringify(l)}else if(null!=e.path)o=e.path,n=r.find((e=>e.re.test(o))),n&&(l=n.parse(o),s=n.record.name);else{if(n=t.name?i.get(t.name):r.find((e=>e.re.test(t.path))),!n)throw de(1,{location:e,currentLocation:t});s=n.record.name,l=a({},t.params,e.params),o=n.stringify(l)}const c=[];let u=n;while(u)c.unshift(u.record),u=u.parent;return{name:s,path:o,params:l,matched:c,meta:Pe(c)}}return t=Le({strict:!1,end:!0,sensitive:!1},t),e.forEach((e=>o(e))),{addRoute:o,resolve:h,removeRoute:s,getRoutes:l,getRecordMatcher:n}}function Me(e,t){const r={};for(const i of t)i in e&&(r[i]=e[i]);return r}function Ae(e){return{path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:void 0,beforeEnter:e.beforeEnter,props:Ie(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}}}function Ie(e){const t={},r=e.props||!1;if("component"in e)t.default=r;else for(const i in e.components)t[i]="object"===typeof r?r[i]:r;return t}function Ce(e){while(e){if(e.record.aliasOf)return!0;e=e.parent}return!1}function Pe(e){return e.reduce(((e,t)=>a(e,t.meta)),{})}function Le(e,t){const r={};for(const i in e)r[i]=i in t?t[i]:e[i];return r}function Re(e,t){return t.children.some((t=>t===e||Re(e,t)))}function De(e){const t={};if(""===e||"?"===e)return t;const r="?"===e[0],i=(r?e.slice(1):e).split("&");for(let n=0;n<i.length;++n){const e=i[n].replace(_," "),r=e.indexOf("="),o=L(r<0?e:e.slice(0,r)),s=r<0?null:L(e.slice(r+1));if(o in t){let e=t[o];u(e)||(e=t[o]=[e]),e.push(s)}else t[o]=s}return t}function Oe(e){let t="";for(let r in e){const i=e[r];if(r=I(r),null==i){void 0!==i&&(t+=(t.length?"&":"")+r);continue}const n=u(i)?i.map((e=>e&&A(e))):[i&&A(i)];n.forEach((e=>{void 0!==e&&(t+=(t.length?"&":"")+r,null!=e&&(t+="="+e))}))}return t}function ze(e){const t={};for(const r in e){const i=e[r];void 0!==i&&(t[r]=u(i)?i.map((e=>null==e?null:""+e)):null==i?i:""+i)}return t}const ke=Symbol(""),Fe=Symbol(""),Be=Symbol(""),Ne=Symbol(""),Ue=Symbol("");function Ve(){let e=[];function t(t){return e.push(t),()=>{const r=e.indexOf(t);r>-1&&e.splice(r,1)}}function r(){e=[]}return{add:t,list:()=>e.slice(),reset:r}}function je(e,t,r,i,n,o=(e=>e())){const s=i&&(i.enterCallbacks[n]=i.enterCallbacks[n]||[]);return()=>new Promise(((a,l)=>{const c=e=>{!1===e?l(de(4,{from:r,to:t})):e instanceof Error?l(e):ae(e)?l(de(2,{from:t,to:e})):(s&&i.enterCallbacks[n]===s&&"function"===typeof e&&s.push(e),a())},u=o((()=>e.call(i&&i.instances[n],t,r,c)));let h=Promise.resolve(u);e.length<3&&(h=h.then(c)),h.catch((e=>l(e)))}))}function Ge(e,t,r,i,n=(e=>e())){const o=[];for(const a of e){0;for(const e in a.components){let l=a.components[e];if("beforeRouteEnter"===t||a.instances[e])if($e(l)){const s=l.__vccOpts||l,c=s[t];c&&o.push(je(c,r,i,a,e,n))}else{let c=l();0,o.push((()=>c.then((o=>{if(!o)return Promise.reject(new Error(`Couldn't resolve component "${e}" at "${a.path}"`));const l=s(o)?o.default:o;a.components[e]=l;const c=l.__vccOpts||l,u=c[t];return u&&je(u,r,i,a,e,n)()}))))}}}return o}function $e(e){return"object"===typeof e||"displayName"in e||"props"in e||"__vccOpts"in e}function qe(e){const t=(0,i.WQ)(Be),r=(0,i.WQ)(Ne);const o=(0,i.EW)((()=>{const r=(0,n.R1)(e.to);return t.resolve(r)})),s=(0,i.EW)((()=>{const{matched:e}=o.value,{length:t}=e,i=e[t-1],n=r.matched;if(!i||!n.length)return-1;const s=n.findIndex(B.bind(null,i));if(s>-1)return s;const a=Ye(e[t-2]);return t>1&&Ye(i)===a&&n[n.length-1].path!==a?n.findIndex(B.bind(null,e[t-2])):s})),a=(0,i.EW)((()=>s.value>-1&&Xe(r.params,o.value.params))),l=(0,i.EW)((()=>s.value>-1&&s.value===r.matched.length-1&&N(r.params,o.value.params)));function u(r={}){return He(r)?t[(0,n.R1)(e.replace)?"replace":"push"]((0,n.R1)(e.to)).catch(c):Promise.resolve()}return{route:o,href:(0,i.EW)((()=>o.value.href)),isActive:a,isExactActive:l,navigate:u}}const Ze=(0,i.pM)({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:qe,setup(e,{slots:t}){const r=(0,n.Kh)(qe(e)),{options:o}=(0,i.WQ)(Be),s=(0,i.EW)((()=>({[Ke(e.activeClass,o.linkActiveClass,"router-link-active")]:r.isActive,[Ke(e.exactActiveClass,o.linkExactActiveClass,"router-link-exact-active")]:r.isExactActive})));return()=>{const n=t.default&&t.default(r);return e.custom?n:(0,i.h)("a",{"aria-current":r.isExactActive?e.ariaCurrentValue:null,href:r.href,onClick:r.navigate,class:s.value},n)}}}),We=Ze;function He(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)&&!e.defaultPrevented&&(void 0===e.button||0===e.button)){if(e.currentTarget&&e.currentTarget.getAttribute){const t=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(t))return}return e.preventDefault&&e.preventDefault(),!0}}function Xe(e,t){for(const r in t){const i=t[r],n=e[r];if("string"===typeof i){if(i!==n)return!1}else if(!u(n)||n.length!==i.length||i.some(((e,t)=>e!==n[t])))return!1}return!0}function Ye(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const Ke=(e,t,r)=>null!=e?e:null!=t?t:r,Je=(0,i.pM)({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:t,slots:r}){const o=(0,i.WQ)(Ue),s=(0,i.EW)((()=>e.route||o.value)),l=(0,i.WQ)(Fe,0),c=(0,i.EW)((()=>{let e=(0,n.R1)(l);const{matched:t}=s.value;let r;while((r=t[e])&&!r.components)e++;return e})),u=(0,i.EW)((()=>s.value.matched[c.value]));(0,i.Gt)(Fe,(0,i.EW)((()=>c.value+1))),(0,i.Gt)(ke,u),(0,i.Gt)(Ue,s);const h=(0,n.KR)();return(0,i.wB)((()=>[h.value,u.value,e.name]),(([e,t,r],[i,n,o])=>{t&&(t.instances[r]=e,n&&n!==t&&e&&e===i&&(t.leaveGuards.size||(t.leaveGuards=n.leaveGuards),t.updateGuards.size||(t.updateGuards=n.updateGuards))),!e||!t||n&&B(t,n)&&i||(t.enterCallbacks[r]||[]).forEach((t=>t(e)))}),{flush:"post"}),()=>{const n=s.value,o=e.name,l=u.value,c=l&&l.components[o];if(!c)return Qe(r.default,{Component:c,route:n});const d=l.props[o],p=d?!0===d?n.params:"function"===typeof d?d(n):d:null,f=e=>{e.component.isUnmounted&&(l.instances[o]=null)},m=(0,i.h)(c,a({},p,t,{onVnodeUnmounted:f,ref:h}));return Qe(r.default,{Component:m,route:n})||m}}});function Qe(e,t){if(!e)return null;const r=e(t);return 1===r.length?r[0]:r}const et=Je;function tt(e){const t=Se(e.routes,e),r=e.parseQuery||De,s=e.stringifyQuery||Oe,h=e.history;const d=Ve(),p=Ve(),f=Ve(),m=(0,n.IJ)(ce);let _=ce;o&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const g=l.bind(null,(e=>""+e)),y=l.bind(null,P),x=l.bind(null,L);function v(e,r){let i,n;return le(e)?(i=t.getRecordMatcher(e),n=r):n=e,t.addRoute(n,i)}function b(e){const r=t.getRecordMatcher(e);r&&t.removeRoute(r)}function w(){return t.getRoutes().map((e=>e.record))}function T(e){return!!t.getRecordMatcher(e)}function E(e,i){if(i=a({},i||m.value),"string"===typeof e){const n=O(r,e,i.path),o=t.resolve({path:n.path},i),s=h.createHref(n.fullPath);return a(n,o,{params:x(o.params),hash:L(n.hash),redirectedFrom:void 0,href:s})}let n;if(null!=e.path)n=a({},e,{path:O(r,e.path,i.path).path});else{const t=a({},e.params);for(const e in t)null==t[e]&&delete t[e];n=a({},e,{params:y(t)}),i.params=y(i.params)}const o=t.resolve(n,i),l=e.hash||"";o.params=g(x(o.params));const c=z(s,a({},e,{hash:M(l),path:o.path})),u=h.createHref(c);return a({fullPath:c,hash:l,query:s===Oe?ze(e.query):e.query||{}},o,{redirectedFrom:void 0,href:u})}function S(e){return"string"===typeof e?O(r,e,m.value.path):a({},e)}function A(e,t){if(_!==e)return de(8,{from:t,to:e})}function I(e){return D(e)}function C(e){return I(a(S(e),{replace:!0}))}function R(e){const t=e.matched[e.matched.length-1];if(t&&t.redirect){const{redirect:r}=t;let i="function"===typeof r?r(e):r;return"string"===typeof i&&(i=i.includes("?")||i.includes("#")?i=S(i):{path:i},i.params={}),a({query:e.query,hash:e.hash,params:null!=i.path?{}:e.params},i)}}function D(e,t){const r=_=E(e),i=m.value,n=e.state,o=e.force,l=!0===e.replace,c=R(r);if(c)return D(a(S(c),{state:"object"===typeof c?a({},n,c.state):n,force:o,replace:l}),t||r);const u=r;let h;return u.redirectedFrom=t,!o&&F(s,i,r)&&(h=de(16,{to:u,from:i}),re(i,i,!0,!1)),(h?Promise.resolve(h):N(u,i)).catch((e=>pe(e)?pe(e,2)?e:te(e):H(e,u,i))).then((e=>{if(e){if(pe(e,2))return D(a({replace:l},S(e.to),{state:"object"===typeof e.to?a({},n,e.to.state):n,force:o}),t||u)}else e=V(u,i,!0,l,n);return U(u,i,e),e}))}function k(e,t){const r=A(e,t);return r?Promise.reject(r):Promise.resolve()}function B(e){const t=oe.values().next().value;return t&&"function"===typeof t.runWithContext?t.runWithContext(e):e()}function N(e,t){let r;const[i,n,o]=rt(e,t);r=Ge(i.reverse(),"beforeRouteLeave",e,t);for(const a of i)a.leaveGuards.forEach((i=>{r.push(je(i,e,t))}));const s=k.bind(null,e,t);return r.push(s),ae(r).then((()=>{r=[];for(const i of d.list())r.push(je(i,e,t));return r.push(s),ae(r)})).then((()=>{r=Ge(n,"beforeRouteUpdate",e,t);for(const i of n)i.updateGuards.forEach((i=>{r.push(je(i,e,t))}));return r.push(s),ae(r)})).then((()=>{r=[];for(const i of o)if(i.beforeEnter)if(u(i.beforeEnter))for(const n of i.beforeEnter)r.push(je(n,e,t));else r.push(je(i.beforeEnter,e,t));return r.push(s),ae(r)})).then((()=>(e.matched.forEach((e=>e.enterCallbacks={})),r=Ge(o,"beforeRouteEnter",e,t,B),r.push(s),ae(r)))).then((()=>{r=[];for(const i of p.list())r.push(je(i,e,t));return r.push(s),ae(r)})).catch((e=>pe(e,8)?e:Promise.reject(e)))}function U(e,t,r){f.list().forEach((i=>B((()=>i(e,t,r)))))}function V(e,t,r,i,n){const s=A(e,t);if(s)return s;const l=t===ce,c=o?history.state:{};r&&(i||l?h.replace(e.fullPath,a({scroll:l&&c&&c.scroll},n)):h.push(e.fullPath,n)),m.value=e,re(e,t,r,l),te()}let j;function $(){j||(j=h.listen(((e,t,r)=>{if(!se.listening)return;const i=E(e),n=R(i);if(n)return void D(a(n,{replace:!0}),i).catch(c);_=i;const s=m.value;o&&Q(K(s.fullPath,r.delta),X()),N(i,s).catch((e=>pe(e,12)?e:pe(e,2)?(D(e.to,i).then((e=>{pe(e,20)&&!r.delta&&r.type===G.pop&&h.go(-1,!1)})).catch(c),Promise.reject()):(r.delta&&h.go(-r.delta,!1),H(e,i,s)))).then((e=>{e=e||V(i,s,!1),e&&(r.delta&&!pe(e,8)?h.go(-r.delta,!1):r.type===G.pop&&pe(e,20)&&h.go(-1,!1)),U(i,s,e)})).catch(c)})))}let q,Z=Ve(),W=Ve();function H(e,t,r){te(e);const i=W.list();return i.length?i.forEach((i=>i(e,t,r))):console.error(e),Promise.reject(e)}function J(){return q&&m.value!==ce?Promise.resolve():new Promise(((e,t)=>{Z.add([e,t])}))}function te(e){return q||(q=!e,$(),Z.list().forEach((([t,r])=>e?r(e):t())),Z.reset()),e}function re(t,r,n,s){const{scrollBehavior:a}=e;if(!o||!a)return Promise.resolve();const l=!n&&ee(K(t.fullPath,0))||(s||!n)&&history.state&&history.state.scroll||null;return(0,i.dY)().then((()=>a(t,r,l))).then((e=>e&&Y(e))).catch((e=>H(e,t,r)))}const ie=e=>h.go(e);let ne;const oe=new Set,se={currentRoute:m,listening:!0,addRoute:v,removeRoute:b,hasRoute:T,getRoutes:w,resolve:E,options:e,push:I,replace:C,go:ie,back:()=>ie(-1),forward:()=>ie(1),beforeEach:d.add,beforeResolve:p.add,afterEach:f.add,onError:W.add,isReady:J,install(e){const t=this;e.component("RouterLink",We),e.component("RouterView",et),e.config.globalProperties.$router=t,Object.defineProperty(e.config.globalProperties,"$route",{enumerable:!0,get:()=>(0,n.R1)(m)}),o&&!ne&&m.value===ce&&(ne=!0,I(h.location).catch((e=>{0})));const r={};for(const n in ce)Object.defineProperty(r,n,{get:()=>m.value[n],enumerable:!0});e.provide(Be,t),e.provide(Ne,(0,n.Gc)(r)),e.provide(Ue,m);const i=e.unmount;oe.add(e),e.unmount=function(){oe.delete(e),oe.size<1&&(_=ce,j&&j(),j=null,m.value=ce,ne=!1,q=!1),i()}}};function ae(e){return e.reduce(((e,t)=>e.then((()=>B(t)))),Promise.resolve())}return se}function rt(e,t){const r=[],i=[],n=[],o=Math.max(t.matched.length,e.matched.length);for(let s=0;s<o;s++){const o=t.matched[s];o&&(e.matched.find((e=>B(e,o)))?i.push(o):r.push(o));const a=e.matched[s];a&&(t.matched.find((e=>B(e,a)))||n.push(a))}return[r,i,n]}}}]);
//# sourceMappingURL=chunk-vendors.610ea462.js.map